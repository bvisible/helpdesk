import{j as re,e as r,k as V,l as p,d as ue,m as X,n as I,p as ce,f as N,w as f,r as T,g as s,q as de,b as Ce,s as me,t as H,h as b,v as le,x as q,y as pe,z as P,c as Y,A as K,B as Ve,C as $e,D as Le,F as Q,E as W,G as Te,H as Se,u as De,a as Me,I as L,J as g,K as R,L as ne,M as Ne,N as Be,O as ie,P as Ae,T as Fe,Q as se,R as Re}from"./index-3194ec9b.js";import{u as Ee}from"./pageMeta-9b603434.js";import{I as je,u as He,g as Pe,c as O}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-a9d0f8af.js";import{d as M}from"./dayjs-f66c5460.js";import{L as Ue}from"./LayoutHeader-3eb7ac7a.js";import{_ as ze,E as Oe}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-1a82bb67.js";import{I as qe}from"./IndicatorIcon-423c4b7a.js";import{D as ae}from"./Dropdown-c7dd9c29.js";import{u as Ie}from"./ticketStatus-895288f5.js";import"./TabButtons-439c1e4c.js";import"./description-9202ef38.js";import"./DateTimePicker-8cacf145.js";import"./useDatePicker-fa7d5592.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-7827f28c.js";import"./Link-431cfb69.js";import"./StarRating.vue_vue_type_script_setup_true_lang-0c43ad36.js";import"./NestedPopover-37db8746.js";import"./portal-4ee54923.js";import"./MultipleAvatar.vue_vue_type_script_setup_true_lang-7025dfbf.js";import"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-946d36ad.js";const Je={},Ze={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ge(d,c){return r(),V("svg",Ze,[...c[0]||(c[0]=[p("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.17683 1C4.89138 1 3.81543 1.97482 3.68896 3.25405L3.19111 8.2899C3.16577 8.54615 3.0749 8.79156 2.92723 9.00252L1.98134 10.3538C1.51739 11.0166 1.99155 11.9273 2.80057 11.9273H7.53349V14.4999C7.53349 14.7761 7.75735 14.9999 8.03349 14.9999C8.30963 14.9999 8.53349 14.7761 8.53349 14.4999V11.9273H13.2016C14.0107 11.9273 14.4848 11.0166 14.0209 10.3538L13.068 8.99254C12.9236 8.78634 12.8335 8.54713 12.8059 8.29695L12.246 3.22567C12.1062 1.95882 11.0357 1 9.76113 1H6.17683ZM4.68411 3.35243C4.75999 2.5849 5.40556 2 6.17683 2H9.76113C10.5259 2 11.1682 2.57529 11.2521 3.3354L11.8119 8.40668C11.858 8.82365 12.0082 9.22233 12.2488 9.566L13.2016 10.9273H2.80057L3.74646 9.57598C3.99257 9.22439 4.14403 8.81536 4.18625 8.38828L4.68411 3.35243Z",fill:"currentColor"},null,-1)])])}const Ke=re(Je,[["render",Ge]]),Qe={},We={width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Xe(d,c){return r(),V("svg",We,[...c[0]||(c[0]=[p("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.1783 0C3.89284 0 2.81689 0.974825 2.69042 2.25405L2.19257 7.2899C2.16724 7.54615 2.07636 7.79156 1.92869 8.00252L0.982801 9.35379C0.518857 10.0166 0.99301 10.9273 1.80203 10.9273H6.53506V13.4998C6.53506 13.776 6.75892 13.9998 7.03506 13.9998C7.31121 13.9998 7.53506 13.776 7.53506 13.4998V10.9273H12.2031C13.0121 10.9273 13.4863 10.0166 13.0223 9.35379L12.0695 7.99254C11.9251 7.78634 11.835 7.54713 11.8074 7.29695L11.2475 2.22567C11.1076 0.958818 10.0371 0 8.76259 0H5.1783ZM3.68557 2.35243C3.76145 1.5849 4.40702 1 5.1783 1H8.76259C9.52732 1 10.1696 1.57529 10.2535 2.3354L10.8134 7.40668C10.8594 7.82365 11.0097 8.22233 11.2502 8.566L12.2031 9.92725H1.80203L2.74793 8.57598C2.99404 8.22439 3.1455 7.81536 3.18772 7.38828L3.68557 2.35243Z",fill:"currentColor"},null,-1),p("rect",{x:"0.792893",width:"2",height:"17",rx:"1",transform:"rotate(-45 0.792893 0)",fill:"currentColor",class:"stroke stroke-ink-white"},null,-1)])])}const Ye=re(Qe,[["render",Xe]]),et={class:"mt-3"},tt=ue({__name:"ExportModal",props:X({rowCount:{}},{modelValue:{},modelModifiers:{}}),emits:X(["update"],["update:modelValue"]),setup(d,{emit:c}){const i=c,m=I(d,"modelValue"),v=ce({export_type:"Excel",export_all:!1});return(C,y)=>{const a=T("FormControl"),_=T("Button"),l=T("Dialog");return r(),N(l,{modelValue:m.value,"onUpdate:modelValue":y[3]||(y[3]=o=>m.value=o),options:{title:"Export"}},{"body-content":f(()=>[s(a,{modelValue:v.export_type,"onUpdate:modelValue":y[0]||(y[0]=o=>v.export_type=o),variant:"outline",label:"Export Type",type:"select",options:[{label:"Excel",value:"Excel"},{label:"CSV",value:"CSV"}],placeholder:"Excel"},null,8,["modelValue"]),p("div",et,[s(a,{modelValue:v.export_all,"onUpdate:modelValue":y[1]||(y[1]=o=>v.export_all=o),type:"checkbox",label:`Export All ${C.rowCount} Record(s)`},null,8,["modelValue","label"])])]),actions:f(()=>[s(_,{label:"Download",variant:"solid",onClick:y[2]||(y[2]=()=>i("update",v)),class:"w-full"})]),_:1},8,["modelValue"])}}}),ot={class:"flex items-center -ml-0.5"},lt=["onClick"],nt={class:"flex items-center"},it={class:"whitespace-nowrap"},st={key:0,class:"flex flex-row-reverse gap-2 items-center min-w-11"},at={__name:"ViewBreadcrumbs",props:{routeName:{type:String,required:!0},label:{type:String,required:!0},options:{type:Array,required:!0},dropdownActions:{type:Function,required:!0},currentView:{type:Object,required:!0}},setup(d){const c=de(),{isMobileView:i}=Ce(),m=v=>c.query.view?v.name===c.query.view:!1;return(v,C)=>{const y=T("router-link"),a=T("FeatherIcon"),_=T("Button");return r(),V("div",ot,[s(y,{to:{name:d.routeName},class:"px-0.5 py-1 text-lg font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-5 hover:text-ink-gray-7 flex items-center justify-center"},{default:f(()=>[me(H(b(i)?"...":d.label),1)]),_:1},8,["to"]),C[1]||(C[1]=p("span",{class:"mx-0.5 text-base text-ink-gray-4","aria-hidden":"true"}," / ",-1)),s(b(ae),{options:d.options},{default:f(({open:l})=>[s(_,{variant:"ghost",class:"text-lg font-medium text-nowrap",label:d.currentView.label},{prefix:f(()=>[typeof d.currentView.icon=="string"?(r(),N(b(je),{key:0,icon:d.currentView.icon,class:"h-4"},null,8,["icon"])):(r(),N(le(d.currentView.icon),{key:1,class:"h-4 flex items-center justify-center"}))]),suffix:f(()=>[s(a,{name:l?"chevron-up":"chevron-down",class:"h-4 text-ink-gray-8"},null,8,["name"])]),_:2},1032,["label"])]),item:f(({item:l})=>[p("button",{class:"group flex text-ink-gray-6 gap-4 h-7 w-full justify-between items-center rounded px-2 text-base hover:bg-surface-gray-3",onClick:l.onClick},[p("div",nt,[l.icon&&typeof l.icon=="string"?(r(),N(a,{key:0,name:l.icon,class:"mr-2 h-4 w-4 flex-shrink-0 text-ink-gray-7","aria-hidden":"true"},null,8,["name"])):l.icon?(r(),N(le(l.icon),{key:1,class:"mr-2 h-4 w-4 flex-shrink-0 text-ink-gray-7"})):q("",!0),p("span",it,H(l.label),1)]),l.name?(r(),V("div",st,[s(b(ae),{placement:"right-start",options:d.dropdownActions(l)},{default:f(()=>[s(_,{variant:"ghost",class:"group-hover:!size-5 !size-0 group-hover:opacity-100 opacity-0 group-hover:ml-0 -ml-2",icon:"more-horizontal",onClick:C[0]||(C[0]=pe(()=>{},["stop"]))})]),_:1},8,["options"]),m(l)?(r(),N(a,{key:0,name:"check",class:"size-4 text-ink-gray-7"})):q("",!0)])):q("",!0)],8,lt)]),_:1},8,["options"])])}}},rt={class:"text-base"},ut={key:0,class:"px-2 py-1 flex items-center justify-center gap-2 rounded-full bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none"},ct=["onClick"],dt={key:1,class:"my-3 max-w-max transform bg-surface-white px-4 sm:px-0"},mt={class:"relative max-h-96 pb-3 overflow-y-auto min-w-40 rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none"},pt={class:"flex gap-2 px-3 pb-1 pt-3"},ft={class:"flex-1"},vt={class:"sticky top-0 bg-surface-modal pb-2 pt-3 text-sm text-ink-gray-7"},wt={class:"grid w-96 grid-cols-12 place-items-center"},gt=["onClick","title"],bt={__name:"IconPicker",props:{modelValue:{},modelModifiers:{},reaction:{},reactionModifiers:{}},emits:["update:modelValue","update:reaction"],setup(d,{expose:c}){const i=P(""),m=I(d,"modelValue"),v=I(d,"reaction"),C=P(["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™"]),y=Y(()=>{let l={};for(let o of K){if(i.value&&![o.description,...o.names,...o.tags].join(" ").toLowerCase().includes(i.value.toLowerCase()))continue;let B=l[o.category];B||(l[o.category]=[],B=l[o.category]),B.push(o)}return Object.keys(l).length||(l["No results"]=[]),l});function a(){let l=K.length,o=_(0,l-1);m.value=K[o].emoji}function _(l,o){return Math.floor(Math.random()*(o-l+1)+l)}return c({setRandom:a}),(l,o)=>{const B=T("Button"),U=T("FormControl");return r(),N(b(Te),{transition:"default"},{target:f(({togglePopover:h,isOpen:x})=>[Ve(l.$slots,"default",$e(Le({isOpen:x,togglePopover:h})),()=>[p("span",rt,H(d.modelValue||""),1)])]),body:f(({togglePopover:h})=>[v.value?(r(),V("div",ut,[(r(!0),V(Q,null,W(C.value,x=>(r(),V("div",{class:"size-5 cursor-pointer rounded-full bg-surface-transparent text-xl",key:x,onClick:()=>(m.value=x)&&h()},[p("button",null,H(x),1)],8,ct))),128)),s(B,{class:"rounded-full",icon:"plus",onClick:o[0]||(o[0]=pe(()=>v.value=!1,["stop"]))})])):(r(),V("div",dt,[p("div",mt,[p("div",pt,[p("div",ft,[s(U,{type:"text",placeholder:"Search by keyword",modelValue:i.value,"onUpdate:modelValue":o[1]||(o[1]=x=>i.value=x),debounce:300},null,8,["modelValue"])]),s(B,{onClick:a},{default:f(()=>[...o[2]||(o[2]=[me("Random",-1)])]),_:1})]),o[3]||(o[3]=p("div",{class:"w-96"},null,-1)),(r(!0),V(Q,null,W(y.value,(x,z)=>(r(),V("div",{class:"px-3",key:z},[p("div",vt,H(z),1),p("div",wt,[(r(!0),V(Q,null,W(x,S=>(r(),V("button",{class:"h-8 w-8 rounded-md p-1 text-2xl hover:bg-surface-gray-2 focus:outline-none focus:ring focus:ring-blue-200",key:S.description,onClick:()=>(m.value=S.emoji)&&h(),title:S.description},H(S.emoji),9,gt))),128))])]))),128))])]))]),_:3})}}},yt={class:"flex gap-2"},kt={__name:"ViewModal",props:{modelValue:{},modelModifiers:{}},emits:X(["update"],["update:modelValue"]),setup(d,{emit:c}){let i=I(d,"modelValue");const m=P({label:i.value.view.label||"",icon:i.value.view.icon||"",name:i.value.view.name||""}),v=Y(()=>({modalTitle:i.value.mode==="edit"?"Edit View":i.value.mode==="duplicate"?"Duplicate View":"Create View",buttonLabel:i.value.mode==="edit"?"Update":i.value.mode==="duplicate"?"Duplicate":"Create",action:i.value.mode==="edit"?"update":i.value.mode==="duplicate"?"duplicate":"create"})),C=c;return(y,a)=>{const _=T("Button"),l=T("FormControl");return r(),N(b(Se),{modelValue:b(i).show,"onUpdate:modelValue":a[3]||(a[3]=o=>b(i).show=o),options:{title:v.value.modalTitle}},{"body-content":f(()=>[a[4]||(a[4]=p("div",{class:"mb-1.5 block text-base text-ink-gray-5"},"View Name",-1)),p("div",yt,[s(bt,{modelValue:m.value.icon,"onUpdate:modelValue":a[0]||(a[0]=o=>m.value.icon=o)},{default:f(({togglePopover:o})=>[s(_,{size:"md",class:"flex size-8 text-2xl leading-none",label:m.value.icon,onClick:o},null,8,["label","onClick"])]),_:1},8,["modelValue"]),s(l,{class:"flex-1",size:"md",type:"text",placeholder:"My Open Tickets",modelValue:m.value.label,"onUpdate:modelValue":a[1]||(a[1]=o=>m.value.label=o)},null,8,["modelValue"])])]),actions:f(()=>[s(_,{label:v.value.buttonLabel,variant:"solid",onClick:a[2]||(a[2]=o=>C("update",m.value,v.value.action)),class:"w-full"},null,8,["label"])]),_:1},8,["modelValue","options"])}}},_t=kt,Ot=ue({__name:"Tickets",setup(d){const c=De(),i=de(),{getCurrentUserViews:m,createView:v,publicViews:C,pinnedViews:y,findView:a,updateView:_,deleteView:l}=He("HD Ticket"),{$dialog:o,$socket:B}=Pe(),{isManager:U}=Me(),h=P(null),x=P(!1),{getStatus:z}=Ie(),S=P(new Set),fe=[{label:"Export",icon:"download",onClick:t=>{S.value=new Set(t),x.value=!0}}],ve={doctype:"HD Ticket",columnConfig:{status:{custom:({item:t})=>{const e=z(t),n=L.value?e==null?void 0:e.label_customer:e==null?void 0:e.label_agent;return g("div",{class:"flex items-center space-x-2 justify-start w-full"},[g(qe,{class:e==null?void 0:e.parsed_color}),g("span",{class:"truncate flex-1"},n)])}},agreement_status:{custom:({item:t})=>g(R,{label:t,theme:ke[t],variant:"outline"})},response_by:{custom:({row:t,item:e})=>we(t,e)},resolution_by:{custom:({row:t,item:e})=>ge(t,e)}},isCustomerPortal:L.value,selectable:!0,showSelectBanner:!0,selectBannerActions:fe,emptyState:{title:"No Tickets Found",icon:g(Fe,{class:"h-10 w-10"})},rowRoute:{name:L.value?"TicketCustomer":"TicketAgent",prop:"ticketId"},hideColumnSetting:!1};function we(t,e){return!t.first_responded_on&&M(e).isBefore(new Date)?g(R,{label:"Failed",theme:"red",variant:"outline"}):t.first_responded_on&&M(t.first_responded_on).isBefore(e)?g(R,{label:"Fulfilled",theme:"green",variant:"outline"}):M(t.first_responded_on).isAfter(e)?g(R,{label:"Failed",theme:"red",variant:"outline"}):g(ne,{text:M(e).long()},()=>M.tz(e).fromNow())}function ge(t,e){return(z(t.status)||{}).category==="Paused"?g(R,{label:"Paused",theme:"blue",variant:"outline"}):t.resolution_date&&M(t.resolution_date).isBefore(e)?g(R,{label:"Fulfilled",theme:"green",variant:"outline"}):M(t.resolution_date).isAfter(e)?g(R,{label:"Failed",theme:"red",variant:"outline"}):g(ne,{text:M(e).long()},()=>M.tz(e).fromNow())}async function be(t="Excel",e=!1){var F;const n=(F=h.value)==null?void 0:F.list;if(!n)return;const w=JSON.stringify(n.data.columns.map(k=>k.key)),A=n.params.order_by;let $={...n.params.filters},D;e?($=JSON.stringify($),D=n.data.total_count):(D=S.value.size,$.name=["in",Array.from(S.value)],$=JSON.stringify($)),window.location.href=`/api/method/frappe.desk.reportview.export_query?file_format_type=${t}&title=HD Ticket&doctype=HD Ticket&fields=${w}&filters=${$}&order_by=${A}&page_length=${D}&start=0&view=Report&with_comment_count=1`,ye(),x.value=!1}function ye(t=!1){var e,n;(e=h.value)==null||e.unselectAll(),(n=S.value)==null||n.clear(),t&&h.value.reload()}const ke={Fulfilled:"green",Failed:"red","Resolution Due":"orange","First Response Due":"orange",Paused:"blue"};let u=ce({show:!1,view:{label:"",icon:"",name:""},mode:"create"});const _e=Y(()=>{var e,n,w;const t=[{group:"Default Views",items:[{label:"List View",icon:"align-justify",onClick:()=>c.push({name:L.value?"TicketsCustomer":"TicketsAgent"})}]}];return((e=m.value)==null?void 0:e.length)!==0&&t.push({group:"Saved Views",items:J(m.value)}),((n=y.value)==null?void 0:n.length)!==0&&t.push({group:"Private Views",items:J(y.value)}),((w=C.value)==null?void 0:w.length)!==0&&t.push({group:"Public Views",items:J(C.value)}),t.push({group:"Create View",hideLabel:!0,items:[{label:"Create View",icon:"plus",onClick:()=>{ee(),u.show=!0}}]}),t});let E=null;const he=t=>{const e=a(t.name).value;let n=[{group:"Default Views",hideLabel:!0,items:[{label:"Duplicate",icon:g(se,{name:"copy"}),onClick:()=>{u.view.label=e.label+" (New)",u.view.icon=e.icon,u.view.name=e.name,u.mode="duplicate",E=e,u.show=!0}}]}];return(!e.public||U)&&(n[0].items.push({label:"Edit",icon:g(Oe,{class:"h-4 w-4"}),onClick:()=>{u.view.label=e.label,u.view.icon=e.icon,u.view.name=e.name,u.mode="edit",u.show=!0}}),e.public||n[0].items.push({label:e!=null&&e.pinned?"Unpin View":"Pin View",icon:g(e!=null&&e.pinned?Ye:Ke,{class:"h-4 w-4"}),onClick:()=>{const w={name:e.name};w.pinned=!e.pinned,_(w)}}),U&&!L.value&&n[0].items.push({label:e!=null&&e.public?"Make Private":"Make Public",icon:g(se,{name:e!=null&&e.public?"lock":"unlock",class:"h-4 w-4"}),onClick:()=>{const w={name:e.name,public:!e.public};e.public?o({title:`Make ${e.label} private?`,message:"This view is currently public. Changing it to private will hide it for all the users.",actions:[{label:"Confirm",variant:"solid",onClick({close:A}){A(),_(w)}}]}):_(w)}}),n.push({group:"Delete View",hideLabel:!0,items:[{label:"Delete",icon:"trash-2",onClick:()=>{o({title:`Delete ${e.label}?`,message:`Are you sure you want to delete this view?
              ${e.public?"This view is public, and will be removed for all users.":""}`,actions:[{label:"Confirm",variant:"solid",onClick({close:w}){i.query.view===e.name&&c.push({name:L.value?"TicketsCustomer":"TicketsAgent"}),l(e.name),Z("deleted"),w()}}]})}}]})),n};function J(t){return t==null?void 0:t.map(e=>({...e,onClick:()=>{O.value={label:e.label,icon:e.icon},c.push({name:e.route_name,query:{view:e.name}})}}))}function xe(t,e){var w,A,$,D,F,k,j,te,oe;let n;if(e==="update"){_(t),Z("updated"),O.value={label:t.label,icon:ie(t.icon)};return}else e==="duplicate"?n={...E,filters:JSON.stringify(E.filters),columns:JSON.stringify(E.columns),rows:JSON.stringify(E.rows),label:t.label,icon:t.icon,public:!1,pinned:!1}:n={dt:"HD Ticket",type:"list",label:t.label??"List",icon:t.icon??"",route_name:c.currentRoute.value.name,order_by:(A=(w=h.value)==null?void 0:w.list)==null?void 0:A.params.order_by,filters:JSON.stringify((D=($=h.value)==null?void 0:$.list)==null?void 0:D.params.filters),columns:JSON.stringify((k=(F=h.value)==null?void 0:F.list)==null?void 0:k.data.columns),rows:JSON.stringify((oe=(te=(j=h.value)==null?void 0:j.list)==null?void 0:te.data)==null?void 0:oe.rows),is_customer_portal:L.value};v(n,G=>{O.value={label:G.label||"List",icon:ie(G.icon)},c.push({name:L.value?"TicketsCustomer":"TicketsAgent",query:{view:G.name}}),Z()})}function Z(t="created"){Ae.success(`View ${t}`),ee()}function ee(){u.show=!1,u.view.label="",u.view.icon="",u.view.name="",u.mode=null,E=null}return Ne(()=>{i.query.view||(O.value={label:"List",icon:"lucide:align-justify"}),B.on("helpdesk:new-ticket",()=>{var t;(t=h.value)==null||t.reload()})}),Ee(()=>({title:"Tickets"})),(t,e)=>{var $,D,F;const n=Re,w=T("Button"),A=T("RouterLink");return r(),V("div",null,[s(b(Ue),null,{"left-header":f(()=>[s(at,{label:"Tickets","route-name":b(L)?"TicketsCustomer":"TicketsAgent",options:_e.value,"dropdown-actions":he,"current-view":b(O)},null,8,["route-name","options","current-view"])]),"right-header":f(()=>[s(A,{to:{name:b(L)?"TicketNew":"TicketAgentNew"}},{default:f(()=>[s(w,{label:"Create",theme:"gray",variant:"solid"},{prefix:f(()=>[s(n,{class:"h-4 w-4"})]),_:1})]),_:1},8,["to"])]),_:1}),s(b(ze),{ref_key:"listViewRef",ref:h,options:ve,onEmptyStateAction:e[0]||(e[0]=()=>t.$router.push({name:b(L)?"TicketNew":"TicketAgentNew"})),onRowClick:e[1]||(e[1]=k=>t.$router.push({name:b(L)?"TicketCustomer":"TicketAgent",params:{ticketId:k}}))},null,512),s(tt,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=k=>x.value=k),rowCount:((F=(D=($=t.$refs.listViewRef)==null?void 0:$.list)==null?void 0:D.data)==null?void 0:F.total_count)??0,onUpdate:e[3]||(e[3]=({export_type:k,export_all:j})=>be(k,j))},null,8,["modelValue","rowCount"]),b(u).show?(r(),N(_t,{key:0,modelValue:b(u),"onUpdate:modelValue":e[4]||(e[4]=k=>Be(u)?u.value=k:u=k),onUpdate:e[5]||(e[5]=(k,j)=>xe(k,j))},null,8,["modelValue"])):q("",!0)])}}});export{Ot as default};
//# sourceMappingURL=Tickets-d353ff0f.js.map
