var h=Object.defineProperty;var f=(l,e,t)=>e in l?h(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var p=(l,e,t)=>(f(l,typeof e!="symbol"?e+"":e,t),t);import{j as c,r as g,e as m,k as _,l as F,C as y,g as x,w as S,t as w,v,D as N,E as k}from"./index-b4c863a6.js";class E{constructor(){p(this,"listeners");p(this,"failed");this.listeners={},this.failed=!1}on(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}trigger(e,t){(this.listeners[e]||[]).forEach(a=>{a.call(this,t)})}upload(e,t){return new Promise((n,a)=>{let s=new XMLHttpRequest;s.upload.addEventListener("loadstart",()=>{this.trigger("start")}),s.upload.addEventListener("progress",r=>{r.lengthComputable&&this.trigger("progress",{uploaded:r.loaded,total:r.total})}),s.upload.addEventListener("load",()=>{this.trigger("finish")}),s.addEventListener("error",()=>{this.trigger("error"),a()}),s.onreadystatechange=()=>{if(s.readyState==XMLHttpRequest.DONE){let r;if(s.status===200){let d=null;try{d=JSON.parse(s.responseText)}catch{d=s.responseText}let u=d.message||d;n(u)}else if(s.status===403)r=JSON.parse(s.responseText);else{this.failed=!0;try{r=JSON.parse(s.responseText)}catch{}}r&&r.exc&&console.error(JSON.parse(r.exc)[0]),a(r)}};const o=t.upload_endpoint||"/api/method/upload_file";s.open("POST",o,!0),s.setRequestHeader("Accept","application/json"),window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&s.setRequestHeader("X-Frappe-CSRF-Token",window.csrf_token);let i=new FormData;e&&i.append("file",e,e.name),i.append("is_private",t.private?"1":"0"),i.append("folder",t.folder||"Home"),t.file_url&&i.append("file_url",t.file_url),t.doctype&&i.append("doctype",t.doctype),t.docname&&i.append("docname",t.docname),t.fieldname&&i.append("fieldname",t.fieldname),t.method&&i.append("method",t.method),t.type&&i.append("type",t.type),t.optimize&&(i.append("optimize","1"),t.max_width&&i.append("max_width",t.max_width.toString()),t.max_height&&i.append("max_height",t.max_height.toString())),s.send(i)})}}const U=E,O={name:"FileUploader",props:{fileTypes:{type:[String,Array]},uploadArgs:{type:Object},validateFile:{type:Function,default:null}},data(){return{uploader:null,uploading:!1,uploaded:0,error:null,message:"",total:0,file:null,finishedUploading:!1}},computed:{progress(){let l=Math.floor(this.uploaded/this.total*100);return isNaN(l)?0:l},success(){return this.finishedUploading&&!this.error}},methods:{inputRef(){return this.$refs.input},openFileSelector(){this.$refs.input.click()},async onFileAdd(l){if(this.error=null,this.file=l.target.files[0],this.file&&this.validateFile)try{let e=await this.validateFile(this.file);e&&(this.error=e)}catch(e){this.error=e}this.error||this.uploadFile(this.file)},async uploadFile(l){this.error=null,this.uploaded=0,this.total=0,this.uploader=new U,this.uploader.on("start",()=>{this.uploading=!0}),this.uploader.on("progress",e=>{this.uploaded=e.uploaded,this.total=e.total}),this.uploader.on("error",()=>{this.uploading=!1,this.error="Error Uploading File"}),this.uploader.on("finish",()=>{this.uploading=!1,this.finishedUploading=!0}),this.uploader.upload(l,this.uploadArgs||{}).then(e=>{this.$emit("success",e)}).catch(e=>{this.uploading=!1;let t="Error Uploading File";e!=null&&e._server_messages?t=JSON.parse(JSON.parse(e._server_messages)[0]).message:e!=null&&e.exc&&(t=JSON.parse(e.exc)[0].split(`
`).slice(-2,-1)[0]),this.error=t,this.$emit("failure",e)})}},expose:["inputRef"]},T=["accept"];function C(l,e,t,n,a,s){const o=g("Button");return m(),_("div",null,[F("input",{ref:"input",type:"file",accept:t.fileTypes,class:"hidden",onChange:e[0]||(e[0]=(...i)=>s.onFileAdd&&s.onFileAdd(...i))},null,40,T),y(l.$slots,"default",N(k({file:a.file,uploading:a.uploading,progress:s.progress,uploaded:a.uploaded,message:a.message,error:a.error,total:a.total,success:s.success,openFileSelector:s.openFileSelector})),()=>[x(o,{onClick:s.openFileSelector,loading:a.uploading},{default:S(()=>[w(v(a.uploading?`Uploading ${s.progress}%`:"Upload File"),1)]),_:1},8,["onClick","loading"])])])}const J=c(O,[["render",C]]);export{J as F};
//# sourceMappingURL=FileUploader-44680597.js.map
