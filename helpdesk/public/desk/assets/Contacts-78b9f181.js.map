{"version":3,"file":"Contacts-78b9f181.js","sources":["../../../../desk/src/stores/contact.ts","../../../../desk/src/components/desk/global/NewContactDialog.vue","../../../../desk/src/components/Pill.vue","../../../../desk/src/components/MultiSelect.vue","../../../../desk/src/pages/desk/contact/ContactDialog.vue","../../../../desk/src/pages/desk/contact/Contacts.vue"],"sourcesContent":["import { computed, ComputedRef } from \"vue\";\nimport { defineStore } from \"pinia\";\nimport { createListResource } from \"frappe-ui\";\n\ntype Contact = {\n  name: string;\n  first_name: string;\n  last_name: string;\n  full_name: string;\n  email_id: string;\n};\n\nexport const useContactStore = defineStore(\"contact\", () => {\n  const d__ = createListResource({\n    doctype: \"Contact\",\n    fields: [\"*\"],\n    auto: true,\n    pageLength: 99999,\n  });\n\n  const options: ComputedRef<Array<Contact>> = computed(\n    () => d__.list?.data || []\n  );\n\n  return {\n    options,\n  };\n});\n","<template>\n  <div>\n    <Dialog v-model=\"open\" :options=\"{ title: 'Create New Contact' }\">\n      <template #body-content>\n        <div class=\"space-y-4\">\n          <div\n            v-for=\"field in formFields\"\n            :key=\"field.label\"\n            class=\"flex flex-col gap-1\"\n          >\n            <span class=\"mb-2 block text-sm leading-4 text-gray-700\">\n              {{ field.label }}\n              <span\n                v-if=\"field.required\"\n                class=\"place-self-center text-red-500\"\n              >\n                *\n              </span>\n            </span>\n            <Input\n              v-if=\"field.type === 'input'\"\n              v-model=\"state[field.value]\"\n              type=\"text\"\n              @blur=\"field.action\"\n            />\n            <Autocomplete\n              v-else\n              v-model=\"state[field.value]\"\n              :options=\"customerResource.data\"\n              @update:model-value=\"handleCustomerChange\"\n            />\n            <ErrorMessage :message=\"error[field.error]\" />\n          </div>\n          <div class=\"flex justify-end space-x-2\">\n            <Button\n              label=\"Create\"\n              :loading=\"contactResource.loading\"\n              theme=\"gray\"\n              variant=\"solid\"\n              @click=\"createContact()\"\n            />\n          </div>\n        </div>\n      </template>\n    </Dialog>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useContactStore } from \"@/stores/contact\";\nimport { computed, ref } from \"vue\";\n\nimport {\n  Autocomplete,\n  Dialog,\n  ErrorMessage,\n  Input,\n  createListResource,\n  createResource,\n  toast,\n} from \"frappe-ui\";\nimport zod from \"zod\";\n\nimport { AutoCompleteItem } from \"@/types\";\n\ninterface Props {\n  modelValue: boolean;\n}\n\nconst props = defineProps<Props>();\nconst emit = defineEmits<{\n  (event: \"update:modelValue\", value: boolean): void;\n  (event: \"close\"): void;\n  (event: \"contactCreated\"): void;\n}>();\n\nconst contactStore = useContactStore();\n\nconst state = ref({\n  emailID: \"\",\n  firstName: \"\",\n  lastName: \"\",\n  phone: \"\",\n  selectedCustomer: null,\n});\n\nconst error = ref({\n  emailValidationError: \"\",\n  firstNameValidationError: \"\",\n  lastNameValidationError: \"\",\n  phoneValidationError: \"\",\n  customerValidationError: \"\",\n});\n\ninterface FormField {\n  label: string;\n  value: string;\n  error: string;\n  type: string;\n  required: boolean;\n  action?: () => void;\n}\n\nconst formFields: FormField[] = [\n  {\n    label: \"Email Id\",\n    value: \"emailID\",\n    error: \"emailValidationError\",\n    type: \"input\",\n    required: true,\n    action: () => validateEmailInput(state.value.emailID),\n  },\n  {\n    label: \"First Name\",\n    value: \"firstName\",\n    error: \"firstNameValidationError\",\n    type: \"input\",\n    required: true,\n    action: () => validateFirstName(state.value.firstName),\n  },\n  {\n    label: \"Last Name\",\n    value: \"lastName\",\n    error: \"lastNameValidationError\",\n    type: \"input\",\n    required: false,\n  },\n  {\n    label: \"Phone\",\n    value: \"phone\",\n    error: \"phoneValidationError\",\n    type: \"input\",\n    required: false,\n    action: () => validatePhone(state.value.phone),\n  },\n  {\n    label: \"Customer\",\n    value: \"selectedCustomer\",\n    error: \"customerValidationError\",\n    type: \"autocomplete\",\n    required: false,\n  },\n];\n\nconst open = computed({\n  get: () => props.modelValue,\n  set: (val) => {\n    emit(\"update:modelValue\", val);\n    if (!val) {\n      emit(\"close\");\n    }\n  },\n});\n\nconst customerResource = createListResource({\n  doctype: \"HD Customer\",\n  fields: [\"name\"],\n  cache: \"customers\",\n  transform: (data) => {\n    return data.map((option) => {\n      return {\n        label: option.name,\n        value: option.name,\n      };\n    });\n  },\n  auto: true,\n});\n\nconst contactResource = createResource({\n  url: \"frappe.client.insert\",\n  onSuccess: () => {\n    state.value = {\n      emailID: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      phone: \"\",\n      selectedCustomer: null,\n    };\n    toast.success(\"Contact created\");\n    emit(\"contactCreated\");\n  },\n});\n\nfunction createContact() {\n  if (validateInputs()) return;\n\n  let doc = {\n    doctype: \"Contact\",\n    first_name: state.value.firstName,\n    last_name: state.value.lastName,\n    email_ids: [{ email_id: state.value.emailID, is_primary: true }],\n    links: [],\n    phone_nos: [],\n  };\n  if (state.value.phone) {\n    doc.phone_nos = [{ phone: state.value.phone }];\n  }\n  if (state.value.selectedCustomer) {\n    doc.links.push({\n      link_doctype: \"HD Customer\",\n      link_name: state.value.selectedCustomer,\n    });\n  }\n\n  contactResource.submit({ doc });\n}\n\nfunction handleCustomerChange(item: AutoCompleteItem | null) {\n  if (!item || item.label === \"No label\") {\n    state.value.selectedCustomer = null;\n  } else {\n    state.value.selectedCustomer = item.value;\n  }\n}\n\nfunction validateInputs() {\n  let error = validateEmailInput(state.value.emailID);\n  error += validateFirstName(state.value.firstName);\n  error += validatePhone(state.value.phone);\n  return error;\n}\n\nfunction validateEmailInput(value: string) {\n  error.value.emailValidationError = \"\";\n  const success = zod.string().email().safeParse(value).success;\n\n  if (!value) {\n    error.value.emailValidationError = \"Email should not be empty\";\n  } else if (!success) {\n    error.value.emailValidationError = \"Enter a valid email\";\n  } else if (existingContactEmails(contactStore.options).includes(value)) {\n    error.value.emailValidationError = \"Contact with email already exists\";\n  }\n  return error.value.emailValidationError;\n}\n\nfunction validateFirstName(value: string) {\n  error.value.firstNameValidationError = \"\";\n  if (!value || value.trim() === \"\") {\n    error.value.firstNameValidationError = \"First name should not be empty\";\n  }\n  return error.value.firstNameValidationError;\n}\n\nfunction validatePhone(value: string) {\n  error.value.phoneValidationError = \"\";\n  const reg = /[0-9]+/;\n  if (value && (!reg.test(value) || value.length < 10)) {\n    error.value.phoneValidationError = \"Enter a valid phone number\";\n  }\n  return error.value.phoneValidationError;\n}\n\nfunction existingContactEmails(contacts) {\n  return contacts.map((contact) => contact.email_id);\n}\n</script>\n\n<style></style>\n","<template>\n  <Button\n    :key=\"label\"\n    theme=\"gray\"\n    variant=\"outline\"\n    :label=\"label\"\n    :disabled=\"disabled\"\n  >\n    <template #suffix>\n      <IconX class=\"h-3 w-3\" @click=\"handleClick(label)\" />\n    </template>\n  </Button>\n</template>\n<script setup>\nimport { Button } from \"frappe-ui\";\nimport IconX from \"~icons/lucide/x\";\ndefineProps({\n  label: {\n    type: String,\n    default: \"Button\",\n    require: true,\n  },\n  disabled: {\n    type: Boolean,\n    default: false,\n  },\n});\n\nconst emit = defineEmits([\"click\"]);\n\nconst handleClick = (label) => {\n  emit(\"click\", label);\n};\n</script>\n","<template>\n  <div class=\"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2\">\n    <Pill\n      v-for=\"item in items\"\n      :key=\"item.value\"\n      :label=\"item.label\"\n      @click=\"(i) => remove(i)\"\n    />\n\n    <Input\n      v-model=\"input\"\n      class=\"w-full\"\n      :placeholder=\"placeholder\"\n      @keyup.enter=\"add({ label: input, value: input })\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { Input, toast } from \"frappe-ui\";\nimport { ref, toRefs } from \"vue\";\nimport Pill from \"./Pill.vue\";\n\ntype Item = {\n  label: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  value: any;\n};\n\nconst props = defineProps({\n  items: {\n    type: Array<Item>,\n    required: true,\n  },\n  placeholder: {\n    type: String,\n    required: false,\n    default: \"Type...\",\n  },\n  validate: {\n    type: Function,\n    required: false,\n    default: () => false,\n  },\n});\n\nconst emit = defineEmits<{\n  (event: \"update:items\", items: Array<Item>): void;\n}>();\n\nconst { items } = toRefs(props);\nconst input = ref(\"\");\n\nfunction add(item: Item) {\n  const err = props.validate(item);\n\n  if (err) {\n    toast.error(err);\n\n    return;\n  }\n\n  const res = [...items.value, item];\n  emit(\"update:items\", res);\n  input.value = \"\";\n}\n\nfunction remove(item: Item) {\n  const res = items.value.filter((i) => i.value !== item);\n  emit(\"update:items\", res);\n}\n</script>\n","<template>\n  <Dialog :options=\"options\">\n    <template #body-main>\n      <div class=\"flex flex-col items-center gap-4 p-6\">\n        <div class=\"text-xl font-medium text-gray-900\">\n          {{ contact.doc?.full_name }}\n        </div>\n        <Avatar\n          size=\"2xl\"\n          :label=\"contact.doc?.full_name\"\n          :image=\"contact.doc?.image\"\n          class=\"cursor-pointer hover:opacity-80\"\n        />\n        <div class=\"flex gap-2\">\n          <FileUploader\n            :validate-file=\"validateFile\"\n            @success=\"(file:File) => updateImage(file)\"\n          >\n            <template #default=\"{ uploading, openFileSelector }\">\n              <Button\n                :label=\"contact.doc?.image ? 'Change photo' : 'Upload photo'\"\n                :loading=\"uploading\"\n                @click=\"openFileSelector\"\n              />\n            </template>\n          </FileUploader>\n          <Button\n            v-if=\"contact.doc?.image\"\n            label=\"Remove photo\"\n            @click=\"updateImage(null)\"\n          />\n          <Button\n            v-if=\"!contact.doc?.user && isManager\"\n            label=\"Invite as user\"\n            @click=\"inviteContact\"\n            :loading=\"isLoading\"\n          />\n        </div>\n        <div class=\"w-full space-y-2 text-sm text-gray-700\">\n          <div class=\"space-y-1\">\n            <div class=\"text-xs\">Emails</div>\n            <MultiSelect\n              v-model:items=\"emails\"\n              placeholder=\"john.doe@example.com\"\n              :validate=\"validateEmail\"\n            />\n          </div>\n          <div class=\"space-y-1\">\n            <div class=\"text-xs\">Phone Nos</div>\n            <MultiSelect\n              v-model:items=\"phones\"\n              placeholder=\"+91 98765 43210\"\n              :validate=\"validatePhone\"\n            />\n          </div>\n          <div class=\"space-y-1\">\n            <div class=\"text-xs\">Customer</div>\n            <Link\n              doctype=\"HD Customer\"\n              class=\"form-control flex-1\"\n              placeholder=\"Link to a customer\"\n              v-model=\"selectedCustomer\"\n              :hide-me=\"true\"\n            />\n          </div>\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  Avatar,\n  call,\n  createDocumentResource,\n  createListResource,\n  Dialog,\n  FileUploader,\n  toast,\n} from \"frappe-ui\";\nimport { useOnboarding } from \"frappe-ui/frappe\";\nimport type { Ref } from \"vue\";\nimport { computed, ref } from \"vue\";\nimport zod from \"zod\";\n\nimport Link from \"@/components/frappe-ui/Link.vue\";\nimport MultiSelect from \"@/components/MultiSelect.vue\";\nimport { useAuthStore } from \"@/stores/auth\";\nimport { AutoCompleteItem, File } from \"@/types\";\n\ninterface Props {\n  name: {\n    type: string;\n    required: true;\n  };\n}\n\nconst props = defineProps<Props>();\n\nconst emit = defineEmits<{\n  (event: \"contactUpdated\"): void;\n}>();\n\ninterface Email {\n  email_id: string;\n  is_primary?: boolean;\n}\n\ninterface Phone {\n  phone: string;\n  is_primary_phone?: boolean;\n  is_primary_mobile?: boolean;\n}\n\nconst isDirty: Ref<boolean> = ref(false);\n\nconst emails = computed({\n  get() {\n    const emails = contact.doc?.email_ids || [];\n    return emails.map((e: Email) => ({\n      label: e.email_id,\n      value: e.email_id,\n    }));\n  },\n  set(newVal) {\n    if (newVal.length === 0) {\n      toast.error(\"At least one email is required\");\n      return;\n    }\n    if (newVal.length !== contact.doc.email_ids.length) {\n      isDirty.value = true;\n    }\n    contact.doc.email_ids = newVal.map((email: AutoCompleteItem) => ({\n      email_id: email.value,\n    }));\n  },\n});\n\nconst phones = computed({\n  get() {\n    const phone_nos = contact.doc?.phone_nos || [];\n    return phone_nos.map((e: Phone) => ({\n      label: e.phone,\n      value: e.phone,\n    }));\n  },\n  set(newVal) {\n    if (newVal.length !== contact.doc.phone_nos.length) {\n      isDirty.value = true;\n    }\n    contact.doc.phone_nos = newVal.map((item: AutoCompleteItem) => ({\n      phone: item.value,\n    }));\n  },\n});\n\nconst selectedCustomer = computed({\n  get() {\n    const customerLink = contact.doc?.links?.find(\n      (link) => link.link_doctype === \"HD Customer\"\n    );\n    return customerLink?.link_name || null;\n  },\n  set(value) {\n    const currentCustomer = contact.doc?.links?.find(\n      (link) => link.link_doctype === \"HD Customer\"\n    )?.link_name;\n\n    if (value !== currentCustomer) {\n      if (value) {\n        const existingCustomerLinkIndex = contact.doc.links?.findIndex(\n          (link) => link.link_doctype === \"HD Customer\"\n        );\n        if (existingCustomerLinkIndex !== -1) {\n          contact.doc.links[existingCustomerLinkIndex].link_name = value;\n        } else {\n          contact.doc.links.push({\n            link_doctype: \"HD Customer\",\n            link_name: value,\n          });\n        }\n      } else {\n        contact.doc.links = contact.doc.links?.filter(\n          (link) => link.link_doctype !== \"HD Customer\"\n        );\n      }\n      isDirty.value = true;\n    }\n  },\n});\n\nconst customerResource = createListResource({\n  doctype: \"HD Customer\",\n  fields: [\"name\"],\n  cache: \"customers\",\n  transform: (data) => {\n    return data.map((option) => ({\n      label: option.name,\n      value: option.name,\n    }));\n  },\n  auto: true,\n});\n\nfunction handleCustomerChange(item: AutoCompleteItem | null) {\n  if (!item || item.label === \"No label\") {\n    selectedCustomer.value = null;\n  } else {\n    selectedCustomer.value = item.value;\n  }\n}\n\nconst { updateOnboardingStep } = useOnboarding(\"helpdesk\");\nconst { isManager } = useAuthStore();\n\nconst contact = createDocumentResource({\n  doctype: \"Contact\",\n  name: props.name,\n  auto: true,\n  setValue: {\n    onSuccess() {\n      emit(\"contactUpdated\");\n    },\n  },\n});\n\nconst options = computed(() => ({\n  title: contact.doc?.name,\n  actions: [\n    {\n      label: \"Save\",\n      theme: \"gray\",\n      variant: \"solid\",\n      onClick: () => update(),\n    },\n  ],\n}));\n\nfunction update(): void {\n  if (!isDirty.value) {\n    toast.error(\"No changes to save\");\n    return;\n  }\n  contact.setValue.submit({\n    email_ids: emails.value.map((email: AutoCompleteItem) => ({\n      email_id: email.value,\n      is_primary: email.value === contact.doc.email_id,\n    })),\n    phone_nos: phones.value.map((phoneNum: AutoCompleteItem) => ({\n      phone: phoneNum.value,\n      is_primary_phone: phoneNum.value === contact.doc.phone,\n      is_primary_mobile: phoneNum.value === contact.doc.phone,\n    })),\n    links: contact.doc.links,\n  });\n  isDirty.value = false;\n  emit(\"contactUpdated\");\n}\n\nfunction updateImage(file: File): void {\n  contact.setValue.submit({\n    image: file?.file_url || null,\n  });\n  isDirty.value = true;\n}\n\nfunction validateEmail(input: AutoCompleteItem): string | void {\n  const success = zod.string().email().safeParse(input.value).success;\n  if (!success) return \"Invalid email\";\n}\n\nfunction validatePhone(input: AutoCompleteItem): string | void {\n  const success = zod\n    .string()\n    .regex(/^\\+[1-9]\\d{1,14}$/)\n    .min(10)\n    .max(15)\n    .safeParse(input.value).success;\n  if (!success) return \"Invalid phone number\";\n}\n\nfunction validateFile(file: File): string | void {\n  let extn = file.name.split(\".\").pop().toLowerCase();\n  if (![\"png\", \"jpg\", \"jpeg\"].includes(extn)) {\n    toast.error(\"Invalid file type, only PNG and JPG images are allowed\");\n    return \"Invalid file type, only PNG and JPG images are allowed\";\n  }\n}\n\nconst isLoading = ref(false);\nasync function inviteContact(): Promise<void> {\n  try {\n    isLoading.value = true;\n    const user = await call(\n      \"frappe.contacts.doctype.contact.contact.invite_user\",\n      {\n        contact: contact.doc.name,\n      }\n    );\n    toast.success(\"Contact invited successfully\");\n    await contact.setValue.submit({\n      user: user,\n    });\n    updateOnboardingStep(\"add_invite_contact\");\n  } catch (error) {\n    isLoading.value = false;\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(\n      error.messages?.[0] || error.message,\n      \"text/html\"\n    );\n\n    const errMsg = doc.body.innerText;\n    toast.error(errMsg);\n  } finally {\n    isLoading.value = false;\n  }\n}\n</script>\n","<template>\n  <div class=\"flex flex-col\">\n    <LayoutHeader>\n      <template #left-header>\n        <div class=\"text-lg font-medium text-gray-900\">Contacts</div>\n      </template>\n      <template #right-header>\n        <Button\n          label=\"New contact\"\n          theme=\"gray\"\n          variant=\"solid\"\n          @click=\"showNewContactModal = !showNewContactModal\"\n        >\n          <template #prefix>\n            <LucidePlus class=\"h-4 w-4\" />\n          </template>\n        </Button>\n      </template>\n    </LayoutHeader>\n    <ListViewBuilder\n      ref=\"listViewRef\"\n      :options=\"options\"\n      @row-click=\"openContact\"\n      @empty-state-action=\"showNewContactModal = true\"\n    />\n    <NewContactDialog\n      v-model=\"showNewContactModal\"\n      @contact-created=\"handleContactCreated\"\n    />\n    <ContactDialog\n      v-if=\"isContactDialogVisible\"\n      :key=\"selectedContact\"\n      v-model=\"isContactDialogVisible\"\n      :name=\"selectedContact\"\n      @contact-updated=\"handleContactUpdated\"\n    />\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { LayoutHeader, ListViewBuilder } from \"@/components\";\nimport NewContactDialog from \"@/components/desk/global/NewContactDialog.vue\";\nimport { PhoneIcon } from \"@/components/icons\";\nimport { Avatar, toast, usePageMeta } from \"frappe-ui\";\nimport { computed, h, ref } from \"vue\";\nimport ContactDialog from \"./ContactDialog.vue\";\nimport { showNewContactModal } from \"./dialogState\";\n\nconst isContactDialogVisible = ref(false);\nconst selectedContact = ref(null);\n\nconst listViewRef = ref(null);\nconst options = computed(() => {\n  return {\n    doctype: \"Contact\",\n    selectable: true,\n    showSelectBanner: true,\n    columnConfig: {\n      full_name: {\n        prefix: ({ row }) => {\n          return h(Avatar, {\n            shape: \"circle\",\n            image: row.image,\n            label: row.name,\n            size: \"sm\",\n          });\n        },\n      },\n      mobile_no: {\n        prefix: PhoneIcon,\n      },\n    },\n    emptyState: {\n      title: \"No Contacts Found\",\n    },\n  };\n});\n\nfunction handleContactCreated(): void {\n  showNewContactModal.value = false;\n  listViewRef.value?.reload();\n}\n\nfunction openContact(id: string): void {\n  selectedContact.value = id;\n  isContactDialogVisible.value = true;\n}\n\nfunction handleContactUpdated(): void {\n  toast.success(\"Contact updated\");\n  isContactDialogVisible.value = !isContactDialogVisible.value;\n  listViewRef.value?.reload();\n}\nusePageMeta(() => {\n  return {\n    title: \"Contacts\",\n  };\n});\n</script>\n"],"names":["useContactStore","defineStore","d__","createListResource","computed","_a","props","__props","emit","__emit","contactStore","state","ref","error","formFields","validateEmailInput","validateFirstName","validatePhone","open","val","customerResource","data","option","contactResource","createResource","toast","createContact","validateInputs","doc","handleCustomerChange","item","value","success","zod","existingContactEmails","contacts","contact","_createElementBlock","_createVNode","_unref","Dialog","$event","_createElementVNode","_hoisted_1","_Fragment","_renderList","field","_hoisted_2","_hoisted_3","_createBlock","Input","Autocomplete","ErrorMessage","_hoisted_4","_component_Button","handleClick","label","Button","IconX","_cache","items","toRefs","input","add","err","res","remove","i","_openBlock","Pill","_withKeys","isDirty","emails","e","newVal","email","phones","selectedCustomer","customerLink","_b","link","currentCustomer","_c","existingCustomerLinkIndex","_d","_e","updateOnboardingStep","useOnboarding","isManager","useAuthStore","createDocumentResource","options","update","phoneNum","updateImage","file","validateEmail","validateFile","extn","isLoading","inviteContact","user","call","errMsg","_toDisplayString","Avatar","FileUploader","_withCtx","uploading","openFileSelector","_hoisted_5","MultiSelect","_hoisted_6","_hoisted_7","Link","isContactDialogVisible","selectedContact","listViewRef","row","h","PhoneIcon","handleContactCreated","showNewContactModal","openContact","id","handleContactUpdated","usePageMeta","LayoutHeader","_component_LucidePlus","ListViewBuilder","NewContactDialog","ContactDialog"],"mappings":"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"}