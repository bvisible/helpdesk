import{j as ue,e as m,k as T,l as u,r as E,h as t,aa as Ge,v as U,D as _e,ab as ie,f as D,x as Xe,d as W,m as fe,n as ke,A as z,W as Z,S as oe,Z as Ke,a4 as ce,w as S,t as ge,g as p,y as F,I as Qe,a0 as R,$ as be,c as B,ac as Ye,F as N,i as et,_ as tt,u as Ue,s as ye,N as he,a2 as at,ad as ne,L as Se,a3 as Le,a6 as Ae,M as ee,a8 as te,ae as ot,K as st,q as pe,R as nt,X as Re,af as lt,ag as xe,G as K,ah as it,C as rt,E as ct,ai as ut,aj as dt,ak as Ie,U as He,al as mt,am as pt,z as se,an as vt,H as _t,ao as ft,a1 as Be,ap as gt,p as kt,aq as bt,a7 as Y,ar as yt}from"./index-b4c863a6.js";import{u as ht,a as xt,b as Ct,A as wt,C as $t,_ as qe,T as Tt}from"./useActiveTabManager-f5a47eda.js";import{_ as de}from"./EmailIcon-c867fb48.js";import{P as Ce}from"./PhoneIcon-ea7dd5f1.js";import{u as me}from"./telephony-64d62ea1.js";import{T as Q,A as le,C as we,a as $e,R as Ee,b as Te}from"./types-27fcf86f.js";import{T as Vt,a as J,u as St,b as Pe,g as Ne,t as Lt,d as At,s as Bt,e as Dt}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js";import"./dayjs-95f8111d.js";import"./knowledgeBase-2d00b929.js";import{I as De}from"./IndicatorIcon-517b841b.js";import{_ as zt}from"./LayoutHeader-0efddba1.js";import{u as We}from"./ticketStatus-60f6a20e.js";import{_ as Me}from"./MultipleAvatar.vue_vue_type_script_setup_true_lang-20371312.js";import{a as Ve}from"./Link-842a8a10.js";import{L as Oe}from"./merge-255e3c9f.js";import{s as Ft,p as ze}from"./formCustomisation-8a41b461.js";import{_ as jt}from"./chevron-left-d60af664.js";import{_ as Ut}from"./chevron-right-cd59273c.js";import{d as H}from"./utils-4e66359c.js";import{_ as Rt}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c05e3797.js";import{D as ve,_ as It}from"./Dropdown-f79f7542.js";import{_ as Ht}from"./Section-1a9e5612.js";import{_ as Ze}from"./Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js";import{_ as Fe}from"./UserAvatar.vue_vue_type_script_setup_true_lang-e554c997.js";import{T as qt}from"./TabButtons-928aa2d2.js";import{u as Et}from"./pageMeta-b63f711b.js";import"./CallLogModal.vue_vue_type_script_setup_true_lang-a58a218c.js";import"./StarRating.vue_vue_type_script_setup_true_lang-4484b1d1.js";import"./Autocomplete-3ef14fd0.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-a14f638d.js";import"./index-6b12b9aa.js";import"./index-3720151f.js";import"./description-c763d251.js";const Pt={},Nt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Wt(h,e){return m(),T("svg",Nt,[...e[0]||(e[0]=[u("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.9996 3.54443V8.771C13.9994 9.32318 13.5518 9.771 12.9996 9.771H12.1802C11.9041 9.771 11.6802 9.99485 11.6802 10.271C11.6803 10.547 11.9042 10.771 12.1802 10.771H12.9996C14.104 10.771 14.9994 9.87546 14.9996 8.771V3.54443C14.9996 2.43986 14.1041 1.54443 12.9996 1.54443H6.72124C5.61667 1.54443 4.72124 2.43986 4.72124 3.54443V4.37158C4.72124 4.64772 4.94509 4.87158 5.22124 4.87158C5.49738 4.87158 5.72124 4.64772 5.72124 4.37158V3.54443C5.72124 2.99215 6.16895 2.54443 6.72124 2.54443H12.9996C13.5518 2.54443 13.9996 2.99215 13.9996 3.54443ZM9.27832 6.22928C9.8306 6.22928 10.2783 6.67699 10.2783 7.22928V12.4558C10.2782 13.008 9.83053 13.4558 9.27832 13.4558H3C2.44779 13.4558 2.00012 13.008 2 12.4558V7.22928C2 6.67699 2.44772 6.22928 3 6.22928H9.27832ZM9.27832 14.4558C10.3828 14.4558 11.2782 13.5603 11.2783 12.4558V7.22928C11.2783 6.12471 10.3829 5.22928 9.27832 5.22928H3C1.89543 5.22928 1 6.12471 1 7.22928V12.4558C1.00012 13.5603 1.89551 14.4558 3 14.4558H9.27832Z",fill:"#525252"},null,-1)])])}const je=ue(Pt,[["render",Wt]]),Mt={},Ot={width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Zt(h,e){return m(),T("svg",Ot,[...e[0]||(e[0]=[u("path",{d:"M5.66406 2.25C5.94021 2.25 6.16406 2.47386 6.16406 2.75C6.16406 3.02614 5.94021 3.25 5.66406 3.25H4.25C3.42157 3.25 2.75 3.92157 2.75 4.75V12.25L2.75781 12.4033C2.83461 13.1597 3.47334 13.75 4.25 13.75H11.75C12.5784 13.75 13.25 13.0784 13.25 12.25V10.8359C13.25 10.5598 13.4739 10.3359 13.75 10.3359C14.0261 10.3359 14.25 10.5598 14.25 10.8359V12.25C14.25 13.6307 13.1307 14.75 11.75 14.75H4.25C2.95566 14.75 1.89082 13.7664 1.7627 12.5059L1.75 12.25V4.75C1.75 3.36929 2.86929 2.25 4.25 2.25H5.66406ZM13.75 2.25C13.7827 2.25 13.8155 2.25243 13.8477 2.25879C13.8574 2.26071 13.8665 2.2651 13.876 2.26758C13.9592 2.28923 14.0383 2.33126 14.1035 2.39648C14.2012 2.49413 14.25 2.62202 14.25 2.75V7.25C14.25 7.52608 14.0261 7.74994 13.75 7.75C13.4739 7.75 13.25 7.52611 13.25 7.25V3.95703L6.81152 10.3955C6.61626 10.5908 6.29975 10.5908 6.10449 10.3955C5.90923 10.2002 5.90923 9.88374 6.10449 9.68848L12.543 3.25H9.25C8.97388 3.25 8.75003 3.02611 8.75 2.75C8.75 2.47386 8.97386 2.25 9.25 2.25H13.75Z",fill:"#525252"},null,-1)])])}const Jt=ue(Mt,[["render",Zt]]),Gt={},Xt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Kt(h,e){return m(),T("svg",Xt,[...e[0]||(e[0]=[u("g",{"clip-path":"url(#clip0_11163_86342)"},[u("path",{d:"M8 0.75C12.0041 0.75 15.25 3.99594 15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75ZM9.83691 4.24902C9.83246 4.31586 9.82822 4.40482 9.80762 4.49316C9.79115 4.5636 9.76659 4.63202 9.73535 4.69727C9.69606 4.77931 9.64388 4.85125 9.60547 4.90625L9.57715 4.94727C9.53169 5.01237 9.47353 5.10016 9.39648 5.1748C9.33512 5.23421 9.26581 5.2852 9.19141 5.32715C9.09793 5.37982 8.99723 5.41143 8.92188 5.43652L7.01367 6.07227C6.96479 6.08854 6.93927 6.09602 6.92188 6.10254L6.9209 6.10449C6.90952 6.11925 6.89436 6.14042 6.86426 6.18262L6.30859 6.96094C6.25045 7.04245 6.17582 7.15257 6.07422 7.24023C5.99357 7.30979 5.9021 7.36646 5.80371 7.40723C5.67989 7.45842 5.54801 7.47592 5.44922 7.49121L5.38574 7.50098C5.29011 7.51579 5.16346 7.53843 5.03418 7.52832C4.93128 7.52017 4.82895 7.4961 4.7334 7.45703C4.61327 7.40776 4.51037 7.32967 4.43164 7.27344L2.19727 5.67773C1.90962 6.39582 1.75 7.17915 1.75 8C1.75 11.4518 4.54822 14.25 8 14.25C11.4518 14.25 14.25 11.4518 14.25 8C14.25 5.2413 12.4623 2.90124 9.98242 2.07227L9.83691 4.24902ZM7.12207 8.18945C7.27526 7.95989 7.58574 7.89776 7.81543 8.05078L10.6025 9.9082C10.7167 9.98443 10.7942 10.1049 10.8174 10.2402C10.8406 10.3756 10.8069 10.5151 10.7246 10.625L9.33203 12.4824C9.23768 12.6082 9.08888 12.6825 8.93164 12.6826H7.07422C6.83589 12.6826 6.63074 12.514 6.58398 12.2803L6.11914 9.95801C6.09321 9.82809 6.1199 9.69327 6.19336 9.58301L7.12207 8.18945ZM7.13965 9.96484L7.48438 11.6826H8.68164L9.60742 10.4463L7.67676 9.15918L7.13965 9.96484ZM8 1.75C5.72993 1.75 3.74217 2.96003 2.64746 4.77051L5.0127 6.45996C5.06466 6.49708 5.09177 6.51562 5.11133 6.52832L5.1123 6.5293H5.11426C5.13745 6.52677 5.16993 6.52251 5.2334 6.5127L5.2959 6.50293C5.3614 6.49279 5.39526 6.48721 5.41895 6.48242L5.41992 6.48145L5.42188 6.48047C5.4368 6.46146 5.45658 6.43391 5.49512 6.37988L6.0498 5.60156C6.09519 5.53793 6.15408 5.45185 6.23047 5.37891C6.29114 5.32101 6.35945 5.27146 6.43262 5.23047C6.52471 5.17891 6.6241 5.14773 6.69824 5.12305L8.60645 4.4873C8.65567 4.47091 8.68058 4.46266 8.69824 4.45605L8.7002 4.45508L8.70117 4.4541C8.71253 4.43905 8.72714 4.41753 8.75684 4.375L8.78613 4.33398C8.81121 4.29807 8.82337 4.27987 8.83203 4.2666V4.26465L8.83301 4.26367C8.83455 4.24789 8.83595 4.22533 8.83887 4.18164L8.99609 1.83008C8.67167 1.77811 8.33907 1.75 8 1.75Z",fill:"#7C7C7C"})],-1),u("defs",null,[u("clipPath",{id:"clip0_11163_86342"},[u("rect",{width:"16",height:"16",fill:"white"})])],-1)])])}const Qt=ue(Gt,[["render",Kt]]),Je={__name:"Icon",props:{icon:{type:[String,Object],required:!0}},setup(h){return(e,l)=>{const n=E("FeatherIcon");return t(Ge)(h.icon)?(m(),T("div",_e(ie({key:0},e.$attrs)),U(h.icon),17)):typeof h.icon=="string"?(m(),D(n,ie({key:1,name:h.icon},e.$attrs),null,16,["name"])):(m(),D(Xe(h.icon),_e(ie({key:2},e.$attrs)),null,16))}}},Yt={class:"flex flex-col gap-4"},ea={class:"text-p-base text-ink-gray-8"},ta={class:"whitespace-nowrap font-semibold"},aa={class:"flex items-center gap-2 rounded-md p-2 ring-1 ring-gray-200"},oa=W({__name:"TicketMergeModal",props:fe({ticket:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:fe(["update"],["update:modelValue"]),setup(h,{emit:e}){const l=h,n=e,_=ke(h,"modelValue");function f(){const b={status_category:["in",["Open","Paused"]],is_merged:0,name:["!=",l.ticket.name]};return l.ticket.customer&&(b.customer=l.ticket.customer),l.ticket.raised_by&&(b.raised_by=["like",`%${l.ticket.raised_by}%`]),b}const a=z(null),r=z(null),k=Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.merge_ticket",makeParams({source:b,target:g}){return{source:b,target:g}},validate({source:b,target:g}){if(!b)throw{message:"Category is required"};if(!g)throw{message:"Ticket to merged with is required"}},onSuccess:()=>{oe.success("Ticket merged successfully"),n("update"),_.value=!1,window.open(window.location.origin+"/helpdesk/tickets/"+a.value,"_blank"),a.value=null}}),x=Ke({doctype:"HD Ticket",filters:{name:["=",a]},fields:["subject"],onSuccess:b=>{b.length>0&&(r.value=b[0].subject)}});ce(()=>a.value,b=>{b&&(x.update({filters:{name:["=",b]}}),x.reload())});function C(){k.submit({source:l.ticket.name,target:a.value})}return(b,g)=>{const d=E("FormControl"),c=E("Button");return m(),D(t(Qe),{options:{title:"Merge with another ticket"},modelValue:_.value,"onUpdate:modelValue":g[2]||(g[2]=s=>_.value=s)},{"body-content":S(()=>[u("div",Yt,[u("p",ea,[g[3]||(g[3]=ge(" All comments and emails of the ticket ",-1)),u("span",ta,"#"+U(h.ticket.name),1),g[4]||(g[4]=ge(" will be moved to the selected ticket. ",-1))]),p(t(Ve),{class:"form-control",doctype:"HD Ticket",placeholder:"Select Ticket",filters:f(),label:"Ticket","page-length":10,value:a.value,"show-description":!0,onChange:g[0]||(g[0]=s=>a.value=String(s))},null,8,["filters","value"]),a.value?(m(),D(d,{key:0,label:"Ticket Subject",type:"text",modelValue:r.value,"onUpdate:modelValue":g[1]||(g[1]=s=>r.value=s),disabled:!0},null,8,["modelValue"])):F("",!0),u("div",aa,[p(t(Vt),{class:"h-6 w-5 w-min-5 w-max-5 min-h-5 max-w-5 text-yellow-500"}),g[5]||(g[5]=u("div",{class:"text-wrap text-sm text-gray-700"}," This action is irreversible. ",-1))])])]),actions:S(()=>[p(c,{class:"w-full",variant:"solid",label:a.value?`Merge with ticket #${a.value} `:"Select Ticket",loading:t(k).loading,"icon-left":a.value&&t(Oe),onClick:C},null,8,["label","loading","icon-left"])]),_:1},8,["modelValue"])}}}),sa={key:1,class:"flex items-center justify-center flex-col mt-20"},na=W({__name:"TicketActivityPanel",setup(h){const e=et(()=>tt(()=>import("./CommunicationArea-4057d8e5.js"),["assets/CommunicationArea-4057d8e5.js","assets/TypingIndicator-460dd024.js","assets/index-b4c863a6.js","assets/index-66cee687.css","assets/TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js","assets/TypingIndicator-f6a7560f.css","assets/dayjs-95f8111d.js","assets/knowledgeBase-2d00b929.js","assets/AttachmentItem.vue_vue_type_script_setup_true_lang-b54cd9d5.js","assets/agent-b7600b38.js","assets/onboarding-89cf30fe.js","assets/index-6b12b9aa.js","assets/index-3720151f.js","assets/file-to-base64-e61fad39.js","assets/popper-0aa08b12.js","assets/chevron-left-d60af664.js","assets/chevron-right-cd59273c.js","assets/plus-3c348a65.js","assets/file-to-base64-e1a7a8ca.css","assets/FileUploader-44680597.js","assets/useActiveTabManager-f5a47eda.js","assets/Dropdown-f79f7542.js","assets/Dropdown-4048bc75.css","assets/MultipleAvatar.vue_vue_type_script_setup_true_lang-20371312.js","assets/Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js","assets/CallLogModal.vue_vue_type_script_setup_true_lang-a58a218c.js","assets/Link-842a8a10.js","assets/CallLogModal-ac943e0d.css","assets/EmailIcon-c867fb48.js","assets/PhoneIcon-ea7dd5f1.js","assets/telephony-64d62ea1.js","assets/StarRating.vue_vue_type_script_setup_true_lang-4484b1d1.js","assets/Autocomplete-3ef14fd0.js","assets/utils-4e66359c.js","assets/DateTimePicker.vue_vue_type_script_setup_true_lang-a14f638d.js","assets/useActiveTabManager-0e7e4004.css","assets/UserAvatar.vue_vue_type_script_setup_true_lang-e554c997.js"])),l=R(Q),n=R(le),_=z(null),f=z(null),a=me(),{isCallingEnabled:r}=be(a),k=B(()=>{const d=[{name:"activity",label:"Activity",icon:wt},{name:"email",label:"Emails",icon:de},{name:"comment",label:"Comments",icon:$t}];return r.value&&d.push({name:"call",label:"Calls",icon:Ce}),d}),{tabIndex:x,changeTabTo:C}=ht(k),b=B(()=>{var q,G,V,$,L,M,O,A;if(!((q=n.value)!=null&&q.data))return[];const d=(V=(G=n.value)==null?void 0:G.data)==null?void 0:V.communications.map((y,X)=>({subject:y.subject,content:y.content,sender:{name:y.user.email,full_name:y.user.name},to:y.recipients,type:"email",key:y.creation,cc:y.cc,bcc:y.bcc,creation:y.communication_date||y.creation,attachments:y.attachments,name:y.name,deliveryStatus:y.delivery_status,isFirstEmail:X===0})),c=n.value.data.comments.map(y=>({name:y.name,type:"comment",key:y.creation,commentedBy:y.commented_by,commenter:y.user.name,creation:y.creation,content:y.content,attachments:y.attachments})),s=[...n.value.data.history,...n.value.data.views].map(y=>({type:"history",key:y.creation,content:y.action?y.action:"viewed this",creation:y.creation,user:y.user.name+" "})),o=n.value.data.calls.map(y=>({...y,type:"call",name:y.name,key:y.creation,call_type:y.type,content:`${y.caller||"Unknown"} made a call to ${y.receiver||"Unknown"}`,duration:y.duration?y.duration+"s":"0s"})),v=[...d,...c,...s,...o].sort((y,X)=>new Date(y.creation)-new Date(X.creation)),i=[];let w=0;for(;w<v.length;){const y=v[w];if(y.type==="history"){y.relatedActivities=[y];for(let X=w+1;X<v.length+1;X++){const ae=v[X];if(ae&&ae.user===y.user&&ae.content!=="viewed this"&&!ae.content.includes("assigned")&&!ae.content.includes("unassigned"))y.relatedActivities.push(ae);else{i.push(y),w=X-1;break}}}else i.push(y);w++}if(l.value.doc.feedback_rating===0)return i;let I=[{type:"feedback",key:"feedback-activity",feedback_rating:($=l.value)==null?void 0:$.doc.feedback_rating,feedback_extra:(L=l.value)==null?void 0:L.doc.feedback_extra,feedback:(M=l.value)==null?void 0:M.doc.feedback,sender:{name:(O=l.value)==null?void 0:O.doc.raised_by,full_name:(A=l.value)==null?void 0:A.doc.contact}}];return i.push(...I),i});function g(d){return d==="activity"?b.value:b.value.filter(c=>c.type===d)}return(d,c)=>{var s,o,v;return m(),T(N,null,[p(t(Ct),{modelValue:t(x),tabs:k.value,"onUpdate:modelValue":t(C),class:"[&_[role='tab']]:px-0 [&_[role='tablist']]:px-5 [&_[role='tablist']]:gap-7.5"},{"tab-panel":S(({tab:i})=>[t(n).data?(m(),D(xt,{key:0,ref_key:"ticketAgentActivitiesRef",ref:_,activities:g(i.name),title:i.label,"ticket-status":t(l).doc.status,"onEmail:reply":c[0]||(c[0]=w=>{f.value.replyToEmail(w)}),onUpdate:c[1]||(c[1]=()=>{t(n).reload(),_.value.scrollToLatestActivity()})},null,8,["activities","title","ticket-status"])):(m(),T("div",sa,[p(t(Ye),{scale:8,class:"text-ink-gray-5"}),c[3]||(c[3]=u("p",{class:"text-xl font-medium text-ink-gray-5 absolute top-[50%]"}," Loading... ",-1))]))]),_:1},8,["modelValue","tabs","onUpdate:modelValue"]),(m(),D(t(e),{ref_key:"communicationAreaRef",ref:f,ticketId:String((s=t(l).doc)==null?void 0:s.name),"to-emails":[(o=t(l).doc)==null?void 0:o.raised_by],"cc-emails":[],"bcc-emails":[],key:(v=t(l).doc)==null?void 0:v.name,onUpdate:c[2]||(c[2]=()=>{t(n).reload(),_.value.scrollToLatestActivity()})},null,8,["ticketId","to-emails"]))],64)}}}),P=z(0),j=Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_navigation_tickets",cache:["ticketsToNavigate"]});function la(){const h=Ue(),e=ye();function l(){if(P.value<j.data.length-1){P.value+=1;const k=j.data[P.value];return r(k),k}return null}function n(){if(P.value>0){P.value-=1;const k=j.data[P.value];return r(k),k}return null}function _(){return j.data[P.value]}function f(){return j.data&&P.value<j.data.length-1?j.data[P.value+1]:null}function a(){return j.data&&P.value>0?j.data[P.value-1]:null}function r(k){let x=e.query.view,C={name:"TicketAgent",params:{ticketId:k},hash:""};x&&(C.query={view:x}),h.push(C)}return{currentTicketIndex:P,ticketsToNavigate:j,goToNextTicket:l,goToPreviousTicket:n,getCurrentTicket:_,getNextTicket:f,getPreviousTicket:a,navigateToTicket:r}}const ia={class:"flex gap-1"},ra=W({__name:"TicketNavigation",setup(h){const{currentTicketIndex:e,goToNextTicket:l,goToPreviousTicket:n,getNextTicket:_,getPreviousTicket:f}=la();z(null),z(null);const a=B(()=>{var k;return j.loading||!((k=j.data)!=null&&k.length)?!0:e.value==0}),r=B(()=>{var k;return j.loading||!((k=j.data)!=null&&k.length)||j.data.length<=1?!0:e.value>=j.data.length-1});return he(()=>{J({key:">",shift:!0},()=>{r.value||l()}),J({key:"<",shift:!0},()=>{a.value||n()})}),(k,x)=>{const C=E("Button"),b=E("Tooltip");return m(),T("div",ia,[p(b,{text:t(f)()?`Go to previous ticket: #${t(f)()}`:"No previous ticket",disabled:a.value},{default:S(()=>[p(C,{icon:t(jt),variant:"ghost",disabled:a.value,onClick:x[0]||(x[0]=g=>t(n)())},null,8,["icon","disabled"])]),_:1},8,["text","disabled"]),p(b,{text:t(_)()?`Go to next ticket: #${t(_)()}`:"No next ticket",disabled:r.value},{default:S(()=>[p(C,{icon:t(Ut),variant:"ghost",disabled:r.value,onClick:x[1]||(x[1]=g=>t(l)())},null,8,["icon","disabled"])]),_:1},8,["text","disabled"])])}}}),ca={class:"flex items-center mx-5 md:mr-0 text-p-sm gap-3 text-[14px] mb-[13px]"},ua={class:"flex items-center gap-1"},da={key:0,class:"text-ink-gray-4 flex items-center"},ma={key:1,class:"text-ink-gray-4 flex items-center"},pa={class:"flex items-center gap-1"},va={class:"flex items-center gap-1"},_a=W({__name:"TicketSLA",setup(h){const e=R(Q),l=B(()=>{var f,a;return(a=(f=e.value)==null?void 0:f.get)!=null&&a.loading?{label:"",color:"",date:""}:!e.value.doc.first_responded_on&&H().isBefore(H(e.value.doc.response_by))?{label:`Due in ${_(e.value.doc.response_by)}`,color:"orange",date:e.value.doc.response_by}:H(e.value.doc.first_responded_on).isBefore(H(e.value.doc.response_by))?{label:`Fulfilled in ${_(e.value.doc.first_responded_on,e.value.doc.creation)}`,color:"green",date:e.value.doc.first_responded_on}:{label:`Failed by ${_(String(new Date),e.value.doc.response_by)}`,color:"red",date:e.value.doc.response_by}}),n=B(()=>{var f,a,r,k,x,C,b,g,d,c,s,o,v,i,w,I,q,G,V;if((a=(f=e.value)==null?void 0:f.get)!=null&&a.loading)return{label:"",color:"",date:""};if(((r=e.value.doc)==null?void 0:r.status_category)==="Paused"&&((k=e.value.doc)!=null&&k.on_hold_since)&&H((x=e.value.doc)==null?void 0:x.resolution_by).isAfter(H((C=e.value.doc)==null?void 0:C.on_hold_since))){let $=H((b=e.value.doc)==null?void 0:b.resolution_by).diff(H(),"s");return{label:`${at($)} left (On Hold)`,color:"blue",date:(g=e.value.doc)==null?void 0:g.on_hold_since}}else return!((d=e.value.doc)!=null&&d.resolution_date)&&H().isBefore(H((c=e.value.doc)==null?void 0:c.resolution_by))?{label:`Due in ${_((s=e.value.doc)==null?void 0:s.resolution_by)}`,color:"purple",date:(o=e.value.doc)==null?void 0:o.resolution_by}:H((v=e.value.doc)==null?void 0:v.resolution_date).isBefore(H((i=e.value.doc)==null?void 0:i.resolution_by))?{label:`Fulfilled in ${_((w=e.value.doc)==null?void 0:w.resolution_date,(I=e.value.doc)==null?void 0:I.creation)}`,color:"green",date:(q=e.value.doc)==null?void 0:q.resolution_date}:{label:`Failed by ${_(String(new Date),(G=e.value.doc)==null?void 0:G.resolution_by)}`,color:"red",date:(V=e.value.doc)==null?void 0:V.resolution_by}});function _(f,a){a||(a=H().toString());let r=H(f),k=H.duration(r.diff(H(a))),x=k.days(),C=k.hours(),b=k.minutes();return x>0?`${x}d ${C}h`:C>0?`${C}h ${b}m`:`${b}m`}return J({meta:!0,shift:!0,key:"."},()=>{ne(window.location.href,"Ticket URL copied to clipboard")}),J({meta:!0,key:"."},()=>{ne(e.value.doc.name,`Ticket #${e.value.doc.name} copied to clipboard`)}),(f,a)=>{const r=de,k=Qt;return m(),D(ot,{to:"#app-header"},[u("div",ca,[u("div",ua,[u("p",{onClick:a[0]||(a[0]=x=>t(ne)(t(e).doc.name,`Ticket #${t(e).doc.name} copied to clipboard`)),class:"cursor-copy"}," #"+U(t(e).doc.name),1),t(e).doc.via_customer_portal?(m(),T("div",ma,[a[3]||(a[3]=u("span",{class:"text-ink-gray-4 mr-[6px]"},"via",-1)),p(k,{class:"size-4 inline-block mr-1"}),a[4]||(a[4]=u("span",{class:"font-medium"},"Portal",-1))])):(m(),T("div",da,[a[1]||(a[1]=u("span",{class:"text-ink-gray-4 mr-[6px]"},"via",-1)),p(r,{class:"size-4 inline-block mr-1"}),a[2]||(a[2]=u("span",{class:""},"Email",-1))]))]),a[7]||(a[7]=u("div",{class:"border-l border-outline-gray-2 h-[13px]"},null,-1)),u("div",pa,[a[5]||(a[5]=u("span",null,"First Response",-1)),p(t(ee),{text:t(Le)(l.value.date,t(Ae)),"hover-delay":.25,placement:"top"},{default:S(()=>[p(t(Se),{label:l.value.label,variant:"subtle",theme:l.value.color},null,8,["label","theme"])]),_:1},8,["text"])]),a[8]||(a[8]=u("div",{class:"border-l border-outline-gray-2 h-[13px]"},null,-1)),u("div",va,[a[6]||(a[6]=u("span",null,"Resolution ",-1)),p(t(ee),{text:t(Le)(n.value.date,t(Ae)),"hover-delay":.25,placement:"top"},{default:S(()=>[n.value?(m(),D(t(Se),{key:0,label:n.value.label,variant:"subtle",theme:n.value.color!=="purple"&&n.value.color,class:te(n.value.color==="purple"&&"!text-[#6B46C1] !bg-[#F3E8FF]")},null,8,["label","theme","class"])):F("",!0)]),_:1},8,["text"])])])])}}}),fa={class:"flex flex-col flex-1 gap-3"},ga=W({__name:"TicketSubjectModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(h){var a,r;const e=R(Q),l=ke(h,"modelValue"),n=z(((r=(a=e.value)==null?void 0:a.doc)==null?void 0:r.subject)||""),_=z(!1);function f(){_.value=!0,e.value.setValue.submit({subject:n.value},{onSuccess(){_.value=!1,l.value=!1}})}return(k,x)=>{const C=E("FormControl"),b=E("Button"),g=E("Dialog");return m(),D(g,{modelValue:l.value,"onUpdate:modelValue":x[1]||(x[1]=d=>l.value=d),options:{title:"Rename Subject"}},{"body-content":S(()=>[u("div",fa,[p(C,{modelValue:n.value,"onUpdate:modelValue":x[0]||(x[0]=d=>n.value=d),type:"textarea",size:"sm",variant:"subtle",disabled:!1},null,8,["modelValue"]),p(b,{variant:"solid",loading:_.value,label:"Rename",onClick:f},null,8,["loading"])])]),_:1},8,["modelValue"])}}}),ka={class:"flex flex-col truncate"},ba={class:"flex gap-2 items-center"},ya={key:0,class:"flex gap-2"},ha={key:1},xa=W({__name:"TicketHeader",props:{viewers:{type:Array,required:!0}},setup(h){var G;const e=ye(),l=Ue(),{findView:n}=St("HD Ticket"),_=We(),f=R(Q),a=R(we),r=R(le),k=z(!1),{notifyTicketUpdate:x}=Pe((G=f.value)==null?void 0:G.name),C=B(()=>{var $;return((($=_.statuses.data)==null?void 0:$.filter(L=>L.enabled))||[]).map(L=>({label:L.label_agent,value:L.label_agent,onClick:()=>{x("Status",L.label_agent),f.value.doc.status!==L.label_agent&&f.value.setValue.submit({status:L.label_agent},{onSuccess(){r.value.reload()}})},icon:()=>st(De,{class:L.parsed_color})}))}),b=B(()=>{var $,L,M,O;let V=[{label:pe("Tickets"),route:{name:"TicketsAgent"}}];if(e.query.view){const A=n(e.query.view);A&&V.push({label:($=A.value)==null?void 0:$.label,icon:nt((L=A.value)==null?void 0:L.icon),route:{name:"TicketsAgent",query:{view:(M=A.value)==null?void 0:M.name}}})}return V.push({label:(O=f.value.doc)==null?void 0:O.subject,onClick:()=>{k.value=!0}}),V});function g(V,$,L=()=>{}){f.value.setValue.submit({[V]:$}),L()}const d=z(!1),c=B(()=>!f.value.doc.is_merged&&["Open","Paused"].includes(f.value.doc.status_category)),s=B(()=>{let V=[];return c.value&&V.push({label:pe("Merge Ticket"),icon:Oe,condition:()=>!f.value.doc.is_merged,onClick:()=>d.value=!0}),[{group:pe("Default actions"),hideLabel:!0,items:V}]}),o=z([]),v=B(()=>o.value.filter(V=>!V.group)),i=B(()=>{let V=[];return o.value.filter($=>$.buttonLabel&&$.group).forEach($=>{let L=V.findIndex(M=>M.label===$.buttonLabel);L>-1?V[L].action.push($):V.push({label:$.buttonLabel,action:[$]})}),V}),w=B(()=>{let V=[];return V=V.concat(o.value.filter($=>$.group&&!$.buttonLabel)),V}),I=B(()=>{var V;return{doc:(V=f==null?void 0:f.value)==null?void 0:V.doc,call:Re,router:l,toast:oe,$dialog:Ne().$dialog,updateField:g,createToast:oe.create}});lt(async()=>{var V,$,L;(V=a.value)!=null&&V.data&&(await Ft(a.value.data,I.value),o.value=[...s.value,...((L=($=a.value)==null?void 0:$.data)==null?void 0:L._customActions)||[]])});const q=xe("statusRef");return he(()=>{J("s",()=>{var V,$,L;(L=($=(V=q.value)==null?void 0:V.$el)==null?void 0:$.nextElementSibling)==null||L.click()})}),(V,$)=>{const L=Je,M=E("FeatherIcon"),O=E("Button");return m(),T(N,null,[p(zt,null,{"left-header":S(()=>[u("div",ka,[p(t(Rt),{items:b.value,class:"breadcrumbs"},{prefix:S(({item:A})=>[A.icon?(m(),D(L,{key:0,icon:A.icon,class:"mr-1 h-4 flex items-center justify-center self-center"},null,8,["icon"])):F("",!0)]),_:1},8,["items"]),p(_a)])]),"right-header":S(()=>[u("div",ba,[p(t(Me),{avatars:JSON.stringify(h.viewers),size:"md","hide-name":!0},null,8,["avatars"]),(m(),D(ra,{key:t(f).name})),v.value.length?(m(),T("div",ya,[(m(!0),T(N,null,K(v.value,A=>(m(),D(O,ie({key:A.label,label:A.label,onClick:y=>A.onClick()},{ref_for:!0},A),it({_:2},[A.icon?{name:"prefix",fn:S(()=>[p(M,{name:A.icon,class:"h-4 w-4"},null,8,["name"])]),key:"0"}:void 0]),1040,["label","onClick"]))),128))])):F("",!0),i.value.length?(m(),T("div",ha,[(m(!0),T(N,null,K(i.value,A=>(m(),T("div",{key:A.label},[p(t(ve),{options:A.action},{default:S(({open:y})=>[p(O,{label:A.label},{suffix:S(()=>[p(M,{name:y?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:2},1032,["options"])]))),128))])):F("",!0),p(t(ve),{options:C.value,placement:"right"},{default:S(({open:A})=>[p(O,{label:t(f).doc.status,ref_key:"statusRef",ref:q},{prefix:S(()=>{var y;return[p(t(De),{class:te((y=t(_).getStatus(t(f).doc.status))==null?void 0:y.parsed_color)},null,8,["class"])]}),_:1},8,["label"])]),_:1},8,["options"]),w.value.length?(m(),D(t(ve),{key:2,options:w.value,placement:"right"},{default:S(()=>[p(O,{icon:"more-horizontal"})]),_:1},8,["options"])):F("",!0)])]),_:1}),d.value?(m(),D(oa,{key:0,ticket:t(f).doc,modelValue:d.value,"onUpdate:modelValue":$[0]||($[0]=A=>d.value=A),onUpdate:$[1]||($[1]=A=>t(f).reload())},null,8,["ticket","modelValue"])):F("",!0),k.value?(m(),D(ga,{key:1,modelValue:k.value,"onUpdate:modelValue":$[2]||($[2]=A=>k.value=A)},null,8,["modelValue"])):F("",!0)],64)}}});const Ca={__name:"Resizer",props:{defaultWidth:{type:Number,default:352},minWidth:{type:Number,default:16*16},maxWidth:{type:Number,default:30*16},side:{type:String,default:"left"},parent:{type:Object,default:null}},setup(h){const e=h,l=z(!1),n=z(e.defaultWidth);function _(){document.addEventListener("mousemove",f),document.addEventListener("mouseup",()=>{document.body.classList.remove("select-none"),document.body.classList.remove("cursor-col-resize"),document.querySelectorAll(".select-text1").forEach(r=>{r.classList.remove("select-text1"),r.classList.add("select-text")}),localStorage.setItem("sidebarWidth",n.value),l.value=!1,document.removeEventListener("mousemove",f)})}function f(r){l.value=!0,document.body.classList.add("select-none"),document.body.classList.add("cursor-col-resize"),document.querySelectorAll(".select-text").forEach(C=>{C.classList.remove("select-text"),C.classList.add("select-text1")}),n.value=e.side=="left"?r.clientX:window.innerWidth-r.clientX;let k=e.parent?a():0;n.value=n.value-k;let x=[e.defaultWidth-10,e.defaultWidth+10];n.value>x[0]&&n.value<x[1]&&(n.value=e.defaultWidth),n.value<e.minWidth&&(n.value=e.minWidth),n.value>e.maxWidth&&(n.value=e.maxWidth)}function a(){return e.parent?e.parent.getBoundingClientRect()[e.side]:0}return(r,k)=>(m(),T("div",{class:"relative",style:ut({width:`${n.value}px`})},[rt(r.$slots,"default",_e(ct({sidebarResizing:l.value,sidebarWidth:n.value}))),u("div",{class:te(["absolute z-1 h-full w-1 cursor-col-resize bg-surface-gray-4 opacity-0 transition-opacity hover:opacity-100",{"opacity-100":l.value,"left-0":h.side=="right","right-0":h.side=="left"}]),onMousedown:_},null,34)],4))}},wa={key:0},$a={class:"flex gap-3 items-center px-5 py-2.5"},Ta={class:"text-ink-gray-8 font-medium text-xl max-w-full truncate"},Va={class:"px-5 text-ink-gray-5 pb-2"},Sa={class:"flex gap-2 items-center p-1.5"},La={class:"text-p-sm text-ink-gray-6 hover:underline cursor-pointer"},Aa={key:0,class:"flex gap-2 items-center p-1.5"},Ba={class:"text-p-sm text-ink-gray-6 hover:underline cursor-pointer"},Da={class:"px-5 border-t pb-2.5"},za={class:"flex gap-2.5 items-center py-[13px] justify-between"},Fa=["onClick"],ja=["onClick"],Ua={class:"text-base text-ink-gray-8 max-w-[60%] truncate"},Ra={class:"flex items-end justify-between"},Ia={class:"text-base text-ink-gray-5"},Ha={class:"transition duration-400 hover:underline"},qa=W({__name:"TicketContactTab",setup(h){const e=me(),{isCallingEnabled:l}=be(e),n=R($e),_=R(Ee),f=window.date_format,{getStatus:a,colorMap:r}=We();function k(g){let{color:d}=a(g);return r[d]?r[d]:r.Default}const x=B(()=>{var s,o,v,i;if(_.value.loading||!_.value.data)return[];const g=((o=(s=_.value)==null?void 0:s.data)==null?void 0:o.recent_tickets)||[],d=((i=(v=_.value)==null?void 0:v.data)==null?void 0:i.similar_tickets)||[],c=[];return g.length&&c.push({label:"Recent Tickets",tooltipMessage:"Tickets recently raised by this contact/customer",hideLabel:!1,opened:!0,tickets:g}),d.length&&c.push({label:"Similar Tickets",tooltipMessage:"Tickets with similar queries",hideLabel:!1,opened:!0,tickets:d}),c});function C(g){return dt(g).format(f.toUpperCase())}function b(g){let d=window.location.origin+"/helpdesk/tickets/"+g;window.open(d,"_blank")}return(g,d)=>{const c=Ie;return m(),T("div",null,[t(n).loading?F("",!0):(m(),T("div",wa,[u("div",$a,[p(t(Ze),{label:t(n).data.name,image:t(n).data.image,size:"2xl"},null,8,["label","image"]),u("p",Ta,U(t(n).data.name),1)]),u("div",Va,[u("div",Sa,[p(de,{class:"size-4"}),u("p",La,U(t(n).data.email_id),1),p(t(je),{class:"size-4 cursor-pointer",onClick:d[0]||(d[0]=s=>t(ne)(t(n).data.email_id,`'${t(n).data.email_id}' copied to clipboard`))})]),t(l)&&(t(n).data.mobile_no||t(n).data.phone)?(m(),T("div",Aa,[p(Ce,{class:"size-4"}),u("p",Ba,U(t(n).data.mobile_no||t(n).data.phone),1),t(n).data.mobile_no||t(n).data.phone?(m(),D(t(je),{key:0,class:"size-4 cursor-pointer",onClick:d[1]||(d[1]=s=>t(ne)(t(n).data.mobile_no||t(n).data.phone,`'${t(n).data.mobile_no||t(n).data.phone}' copied to clipboard`))})):F("",!0)])):F("",!0)])])),t(_).loading?F("",!0):(m(!0),T(N,{key:1},K(x.value,s=>(m(),T("div",Da,[(m(),D(Ht,{key:s.label,label:s.label,hideLabel:s.hideLabel,opened:s.opened},{header:S(({opened:o,hide:v,toggle:i})=>[u("div",za,[p(t(ee),{text:s.tooltipMessage},{default:S(()=>[u("span",{class:"text-ink-gray-8 font-medium text-base cursor-pointer select-none",onClick:i},U(s.label),9,Fa)]),_:2},1032,["text"]),p(c,{class:te(["size-4 text-ink-gray-6 cursor-pointer",{"rotate-180":o}]),onClick:i},null,8,["class","onClick"])])]),default:S(()=>[u("ul",null,[(m(!0),T(N,null,K(s.tickets,o=>(m(),T("li",{key:o.name,class:"py-2.5 cursor-pointer",onClick:v=>b(o.name)},[u("p",Ua,U(o.subject),1),u("div",Ra,[u("p",Ia,[ge(U(C(o.creation)+" Â· ")+" ",1),u("span",Ha,U("#"+o.name),1)]),u("p",{class:te(["px-1.5 py-[3px] text-sm rounded-sm max-w-[80px] text-center truncate h-5",k(o.status)])},U(o.status),3)])],8,ja))),128))])]),_:2},1032,["label","hideLabel","opened"]))]))),256))])}}}),Ea={class:"flex flex-col gap-2 my-2 w-[470px] rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black p-3 ring-opacity-5 focus:outline-none"},Pa={class:"text-base text-ink-gray-5"},Na=["onClick"],Wa={class:"ml-1"},Ma={class:"cursor-pointer text-ink-gray-9"},Oa={class:"flex items-center justify-between gap-2"},Za={__name:"AssignToBody",props:fe({doctype:{type:String,default:""},docname:{type:String,default:null},open:{type:Boolean,default:!1},onUpdate:{type:Function,default:null}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const e=h,l=ke(h,"modelValue"),n=z([]),_=z(!1),f=z(""),{users:a,getUser:r}=He(),k=c=>{c===r("").name&&(_.value=!1),l.value=l.value.filter(s=>s.name!==c)},x=c=>{if(!c)return;c===r("").name&&(_.value=!0),f.value="";let s={name:c,image:r(c).user_image,label:r(c).full_name};l.value.find(o=>o.name===c)||l.value.push(s)};ce(_,c=>{let s=r("");c?x(s.name):k(s.name)}),ce(()=>e.open,c=>{c?(n.value=[...l.value||[]],_.value=l.value.some(s=>s.name===r("").name)):C()},{immediate:!0});async function C(){const c=l.value.map(i=>i.name),s=n.value.map(i=>i.name);if(JSON.stringify(s)===JSON.stringify(c))return;const o=n.value.filter(i=>!l.value.find(w=>w.name===i.name)).map(i=>i.name),v=l.value.filter(i=>!n.value.find(w=>w.name===i.name)).map(i=>i.name);if(v.length||o.length){let i=`${v.length?`assigned ${v.join(", ")}`:""} ${v.length&&o.length?" & ":""} ${o.length?`unassigned ${o.join(", ")}`:""}`;Re("frappe.client.insert",{doc:{doctype:"HD Ticket Activity",ticket:e.docname,action:i}})}e.onUpdate?e.onUpdate(v,o,b,g):(o.length&&await g.submit(o),v.length&&await b.submit(v))}const b=Z({url:"frappe.desk.form.assign_to.add",makeParams:c=>({doctype:e.doctype,name:e.docname,assign_to:c}),onSuccess:()=>{mt("assign_to",{doctype:e.doctype})}}),g=Z({url:"helpdesk.api.doc.remove_assignments",makeParams:c=>({doctype:e.doctype,name:e.docname,assignees:c})}),d=xe("input");return pt(()=>{d.value.click()}),(c,s)=>{const o=E("FeatherIcon"),v=E("Button");return m(),T("div",Ea,[u("div",Pa,U(c.__("Assign to")),1),p(Ve,{class:"form-control",value:"",doctype:"HD Agent",onChange:s[2]||(s[2]=i=>x(i)&&(c.$refs.input.value="")),placeholder:c.__("John Doe"),filters:{is_active:!0,name:["not in",l.value.map(i=>i.name)]},hideMe:!0},{target:S(({togglePopover:i})=>[u("div",{class:"w-full min-h-12 flex flex-wrap items-center gap-1.5 p-1.5 pb-5 rounded-lg bg-surface-gray-2 cursor-text",onClick:se(i,["stop"]),ref:"input"},[(m(!0),T(N,null,K(l.value,w=>(m(),D(t(ee),{text:w.name,key:w.name,onClick:s[1]||(s[1]=se(()=>{},["stop"]))},{default:S(()=>[u("div",{class:"flex items-center text-sm p-0.5 text-ink-gray-6 border border-outline-gray-1 bg-surface-modal rounded-full cursor-pointer",onClick:s[0]||(s[0]=se(()=>{},["stop"]))},[p(Fe,{name:w.name,size:"sm"},null,8,["name"]),u("div",Wa,U(t(r)(w.name).full_name),1),p(v,{variant:"ghost",class:"rounded-full !size-4 m-1",onClick:se(I=>k(w.name),["stop"])},{icon:S(()=>[p(o,{name:"x",class:"h-3 w-3 text-ink-gray-6"})]),_:1},8,["onClick"])])]),_:2},1032,["text"]))),128))],8,Na)]),"item-prefix":S(({option:i})=>[p(Fe,{class:"mr-2",name:i.value,size:"sm"},null,8,["name"])]),"item-label":S(({option:i})=>[p(t(ee),{text:i.value},{default:S(()=>[u("div",Ma,U(t(r)(i.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["placeholder","filters"]),u("div",Oa,[u("div",{class:"text-base text-ink-gray-5 cursor-pointer select-none",onClick:s[3]||(s[3]=i=>_.value=!_.value)},U(c.__("Assign to me")),1),p(t(It),{modelValue:_.value,"onUpdate:modelValue":s[4]||(s[4]=i=>_.value=i),onClick:s[5]||(s[5]=se(()=>{},["stop"]))},null,8,["modelValue"])])])}}},Ja={class:"flex flex-col gap-1.5 w-full"},Ga={key:0},Xa={key:1,class:"flex gap-1.5 items-center"},Ka={key:0,class:"ml-2 text-sm text-ink-gray-8"},Qa=W({__name:"AssignTo",setup(h){const e=R(Q),l=R(Te),n=R(le);async function _(a,r,k,x){r.length&&await x.submit(r),a.length&&await k.submit(a),n.value.reload()}const f=xe("assigneeButton");return J("a",()=>{var a,r,k;(k=(r=(a=f.value)==null?void 0:a.$el)==null?void 0:r.nextElementSibling)==null||k.click()}),(a,r)=>{const k=Je,x=E("Button");return m(),D(t(_t),{class:"flex w-full",placement:"bottom-end"},{target:S(({open:C,close:b,togglePopover:g})=>[u("div",Ja,[r[1]||(r[1]=u("span",{class:"block text-xs text-gray-600"},"Assignee",-1)),p(x,{variant:"outline",class:"!flex !justify-start w-full active:!bg-inherit hover:shadow-sm",ref:"assigneeButton",onClick:d=>g()},{suffix:S(()=>[p(k,{icon:t(Ie),class:"h-4 w-4 ml-auto text-ink-gray-5"},null,8,["icon"])]),default:S(()=>{var d,c,s,o;return[t(l).loading||((d=t(l).data)==null?void 0:d.length)===0?(m(),T("p",Ga,U(a.__("No assignees")),1)):((c=t(l).data)==null?void 0:c.length)>=1?(m(),T("div",Xa,[p(Me,{avatars:t(l).data.map(v=>v.name),size:"sm"},null,8,["avatars"]),((s=t(l).data)==null?void 0:s.length)>1?(m(),T("p",Ka,U((o=t(l).data)==null?void 0:o.length)+" assignees ",1)):F("",!0)])):F("",!0)]}),_:1},8,["onClick"])])]),body:S(({isOpen:C})=>[vt(p(Za,{modelValue:t(l).data,"onUpdate:modelValue":r[0]||(r[0]=b=>t(l).data=b),doctype:"HD Ticket",docname:t(e).name,open:C,onUpdate:_},null,8,["modelValue","docname","open"]),[[ft,C]])]),_:1})}}}),Ya={key:0,class:"my-4 flex items-center justify-start gap-5"},eo={class:"flex flex-col gap-1.5"},to={class:"flex gap-2.5 items-center"},ao={class:"text-ink-gray-8 font-medium text-xl max-w-[170px] truncate"},oo={class:"flex gap-1.5"},so=W({__name:"TicketContact",setup(h){const e=me(),{getUser:l}=He(),{isCallingEnabled:n}=be(e),_=z(!1),f=R(Q),a=R($e),r=B(()=>{var C,b,g,d,c;return((b=(C=a.value)==null?void 0:C.data)==null?void 0:b.image)||((c=l((d=(g=a.value)==null?void 0:g.data)==null?void 0:d.email_id))==null?void 0:c.user_image)||null});function k(C){let b=window.location.origin+"/app/contact/"+C;window.open(b,"_blank")}const x=()=>{if(!a.value.data.mobile_no&&!a.value.data.phone){_.value=!0;return}e.makeCall({number:a.value.data.mobile_no||a.value.data.phone,doctype:"HD Ticket",docname:f.value.name})};return(C,b)=>t(a).loading?F("",!0):(m(),T("div",Ya,[p(t(Ze),{label:t(a).data.name,image:r.value,size:"2xl"},null,8,["label","image"]),u("div",eo,[p(t(ee),{text:t(a).data.name||t(a).data.email_id},{default:S(()=>[u("div",to,[u("p",ao,U(t(a).data.name||t(a).data.email_id),1),p(t(Jt),{class:"size-4 text-ink-gray-6 cursor-pointer",onClick:b[0]||(b[0]=g=>k(t(a).data.name))})])]),_:1},8,["text"]),u("div",oo,[p(t(ee),{text:t(a).data.email_id},{default:S(()=>[p(t(Be),{size:"sm",onClick:b[1]||(b[1]=g=>t(Lt)())},{icon:S(()=>[p(de,{class:"size-4"})]),_:1}),t(n)?(m(),D(t(Be),{key:0,size:"sm",onClick:x},{icon:S(()=>[p(Ce,{class:"size-4"})]),_:1})):F("",!0)]),_:1},8,["text"])])]),p(qe,{modelValue:_.value,"onUpdate:modelValue":b[2]||(b[2]=g=>_.value=g),name:t(a).data.name,onOnUpdate:t(a).reload},null,8,["modelValue","name","onOnUpdate"])]))}}),no={class:"h-full overflow-y-hidden flex flex-1 flex-col justify-between overflow-hidden max-h-full"},lo={class:"px-5 pb-4 flex flex-col"},io={class:"border-t flex flex-col flex-1 h-full pb-3 overflow-y-hidden"},ro={class:"overflow-y-scroll max-h-[80%]"},co=W({__name:"TicketDetailsTab",setup(h){var c;const e=R(Q),l=R(Te),n=R(we),_=R(le),{getFields:f,getField:a}=gt("HD Ticket"),{notifyTicketUpdate:r}=Pe((c=e.value)==null?void 0:c.name),k=B(()=>{const s=f();if(!s||s.length===0)return[];const o=[{group:!0,fields:[a("ticket_type"),a("priority")]},{group:!1,fields:[a("customer")]},{group:!0,fields:[a("agent_group")]}];return o.forEach(v=>{v.fields=v.fields.map(i=>(i=ze(i,e.value.doc),i.required=i.reqd,i.ref=i.fieldname,i=C(i,i),i.visible=!0,i))}),o}),x=B(()=>{var w;const s=f();if(!s||s.length===0)return[];if(!n.value.data||n.value.loading)return[];let o=((w=n.value.data)==null?void 0:w.custom_fields)||[];const v=["ticket_type","priority","customer","agent_group","subject","status"];return o=o.filter(I=>!v.includes(I.fieldname)),o.map(I=>{let q=a(I.fieldname);return q=ze(q,e.value.doc),q.required=q.reqd||I.required,C(I,q)})});function C(s,o){return{label:(o==null?void 0:o.label)||s.fieldname,value:e.value.doc[s.fieldname],fieldtype:o==null?void 0:o.fieldtype,doctype:(o==null?void 0:o.options)||"",options:(o==null?void 0:o.options)||"",placeholder:s.placeholder||`Enter ${(o==null?void 0:o.label)||s.fieldname}`,readonly:!!o.read_only,disabled:!!o.read_only,url_method:s.url_method||"",fieldname:s.fieldname,required:s.required||(o==null?void 0:o.required)||!1,visible:o.display_via_depends_on&&!o.hidden}}function b(s,o,v=!1){var i;if(e.value.doc[s]!=o){if(v){const w=((i=a(s))==null?void 0:i.label)||s;r(w,o)}e.value.setValue.submit({[s]:o},{onSuccess:()=>{s==="agent_group"&&l.value.reload(),_.value.reload()}})}}const g=z({}),d=(s,o)=>{o&&(g.value[s]=o)};return J("t",()=>{var s,o,v,i;(i=(v=(o=(s=g.value)==null?void 0:s.ticket_type)==null?void 0:o.$el)==null?void 0:v.querySelector("button"))==null||i.click()}),J("p",()=>{var s,o,v,i;(i=(v=(o=(s=g.value)==null?void 0:s.priority)==null?void 0:o.$el)==null?void 0:v.querySelector("button"))==null||i.click()}),J({key:"t",shift:!0},()=>{var s,o,v,i;(i=(v=(o=(s=g.value)==null?void 0:s.agent_group)==null?void 0:o.$el)==null?void 0:v.querySelector("button"))==null||i.click()}),(s,o)=>(m(),T("div",no,[u("div",lo,[p(so),u("div",null,[(m(!0),T(N,null,K(k.value,(v,i)=>(m(),T("div",{key:i,class:te(v.group?"flex gap-2 items-center w-full mb-3":"mb-3")},[(m(!0),T(N,null,K(v.fields,w=>(m(),T(N,null,[w.visible?(m(),D(t(Ve),{key:w.fieldname,ref_for:!0,ref:I=>d(w.fieldname,I),class:te(["form-control-core",v.group?"flex-1":"w-full"]),id:w.fieldname,"page-length":10,label:w.label,placeholder:w.placeholder,doctype:w.doctype,modelValue:w.value,required:w.required,"onUpdate:modelValue":I=>b(w.fieldname,I,!0)},null,8,["id","class","label","placeholder","doctype","modelValue","required","onUpdate:modelValue"])):F("",!0)],64))),256))],2))),128)),p(Qa)])]),u("div",io,[u("div",ro,[(m(!0),T(N,null,K(x.value,v=>(m(),T(N,null,[v.visible?(m(),D(Tt,{key:v.fieldname,field:v,value:v.value,onChange:o[0]||(o[0]=({fieldname:i,value:w})=>b(i,w))},null,8,["field","value"])):F("",!0)],64))),256))])])]))}});const uo=ue(co,[["__scopeId","data-v-419c42cd"]]),mo={class:"flex-1 max-h-full"},po=W({__name:"TicketSidebar",setup(h){const e=z("details"),l=[{label:"Details",value:"details"},{label:"Contact",value:"contact"}];return(n,_)=>(m(),D(Ca,{class:"flex flex-col justify-between border-l",side:"right"},{default:S(()=>[p(t(qt),{buttons:l,modelValue:e.value,"onUpdate:modelValue":_[0]||(_[0]=f=>e.value=f),class:"tab-buttons mb-1 px-5 mt-3.5"},null,8,["modelValue"]),u("div",mo,[e.value==="details"?(m(),D(uo,{key:0})):(m(),D(qa,{key:1}))])]),_:1}))}});const re=kt({}),vo=h=>{let e=!1;return re[h]||(re[h]={ticket:bt({doctype:"HD Ticket",name:h,whitelistedMethods:{markSeen:"mark_seen"},setValue:{onSuccess:()=>{oe.success(__("Ticket updated")),e=!1},onError:l=>{if(e)return;e=!0;const n=l.exc_type?(l.messages||l.message||[]).join(", "):l.message;oe.error(n)}}}),assignees:Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_assignees",params:{ticket:h},auto:!0,transform:l=>JSON.parse(l).map(n=>({name:n}))}),contact:Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_contact",params:{ticket:h},auto:!0}),recentSimilarTickets:Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_recent_similar_tickets",params:{ticket:h},auto:!0}),activities:Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_activities",params:{ticket:h},auto:!0})}),re[h]};function _o(h){const e=re[h];e&&(e.ticket.reload(),e.assignees.reload(),e.activities.reload())}const fo={key:0,class:"flex-1"},go={class:"h-full flex overflow-hidden"},ko={class:"flex-1 flex flex-col overflow-hidden"},Qo=W({__name:"TicketAgent",props:{ticketId:{type:String,required:!0}},setup(h){const e=me(),{$socket:l}=Ne(),n=h,_=ye(),f=z(!1),a=B(()=>vo(n.ticketId)),r=B(()=>a.value.ticket),k=Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_customizations",cache:["HD Ticket","customizations"],auto:!0});Y(Q,r),Y(Te,B(()=>a.value.assignees)),Y($e,B(()=>a.value.contact)),Y(we,B(()=>k)),Y(Ee,B(()=>a.value.recentSimilarTickets)),Y(le,B(()=>a.value.activities)),Y("makeCall",()=>{var d,c,s,o;if(!((d=a.value.contact.data)!=null&&d.mobile_no)&&!((c=a.value.contact.data)!=null&&c.phone)){f.value=!0;return}e.makeCall({number:((s=a.value.contact.data)==null?void 0:s.phone)||((o=a.value.contact.data)==null?void 0:o.mobile_no),doctype:"HD Ticket",docname:n.ticketId})});const x=B(()=>At(r.value.name)),C=B(()=>x.value.currentViewers[n.ticketId]||[]),{startViewing:b,stopViewing:g}=x.value;return ce(()=>_.params.ticketId,(d,c)=>{d!==c&&(c&&g(c),b(d))},{immediate:!0}),he(()=>{j.update({params:{ticket:n.ticketId,current_view:_.query.view}}),j.reload(),r.value.markSeen.reload(),l.on("ticket_update",d=>{var c;d.ticket_id===((c=r.value)==null?void 0:c.name)&&oe.info(`User ${d.user} updated ${d.field} to ${d.value}`)}),l.on("helpdesk:ticket-comment",d=>{d.ticket_id==n.ticketId&&a.value.activities.reload()}),l.on("helpdesk:ticket-update",d=>{d.ticket_id==n.ticketId&&_o(n.ticketId)})}),yt(()=>{g(n.ticketId),Bt.value=!1,Dt.value=!1,l.off("ticket_update"),l.off("helpdesk:ticket-comment"),l.off("helpdesk:ticket-update")}),Et(()=>({title:n.ticketId})),(d,c)=>{var s,o,v;return(s=r.value.doc)!=null&&s.name?(m(),T("div",fo,[p(xa,{viewers:C.value},null,8,["viewers"]),u("div",go,[u("div",ko,[p(na)]),p(po)]),p(qe,{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=i=>f.value=i),name:(v=(o=r.value.data)==null?void 0:o.contact)==null?void 0:v.name,onOnUpdate:r.value.reload},null,8,["modelValue","name","onOnUpdate"])])):F("",!0)}}});export{Qo as default};
//# sourceMappingURL=TicketAgent-1668886b.js.map
