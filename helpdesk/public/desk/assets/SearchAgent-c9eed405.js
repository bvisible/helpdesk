import{L as ve}from"./mail-28c56cfa.js";import{a_ as he,e as a,k as r,l as o,d as oe,A as S,ag as re,c as v,a4 as ie,g as h,w as $,h as n,ak as ge,a8 as F,F as w,G as R,v as f,a1 as Q,an as _e,b2 as ye,z as xe,f as y,b0 as ue,y as p,am as ke,ai as be,b3 as ee,x as te,K as J,u as we,s as Se,W as se,q as m,N as $e,r as ae,aF as Ce,b4 as Te,aG as Ve,t as Oe,b5 as De,aj as le}from"./index-b4c863a6.js";import{a as Me,i as Ie,j as Ae}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js";import"./dayjs-95f8111d.js";import"./knowledgeBase-2d00b929.js";import{_ as Le}from"./LayoutHeader-0efddba1.js";import{_ as X}from"./Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js";import{_ as He}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c05e3797.js";import"./index-6b12b9aa.js";import"./index-3720151f.js";import"./Dropdown-f79f7542.js";const qe={class:"lucide lucide-message-square",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function ze(C,u){return a(),r("svg",qe,[...u[0]||(u[0]=[o("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},null,-1)])])}const Fe=he({name:"lucide-message-square",render:ze}),Re={class:"relative inline-block text-left"},je={class:"flex"},Ee={class:"flex -space-x-2 isolate"},Ne={class:"text-ink-gray-7"},Be={key:1,class:"text-ink-gray-6"},Ke={key:0,class:"absolute z-50 mt-2 w-64 divide-y divide-outline-gray-modals rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none left-0 origin-top-left"},Pe={class:"py-1.5 px-1.5"},Ue={class:"flex h-7 items-center text-sm font-medium text-ink-gray-6 justify-between"},Ge=["placeholder"],Ye={class:"px-1.5 pb-1.5 max-h-64 overflow-y-auto"},Je={key:0,class:"pt-1.5"},Xe=["onClick"],We={class:"text-ink-gray-7 flex-1 text-left truncate"},Ze={key:2,class:"text-xs text-ink-gray-5 ml-auto"},Qe={class:"flex h-7 pt-1.5 sticky top-0 bg-surface-white items-center px-2 text-sm font-medium text-ink-gray-6"},et=["onClick"],tt={key:2,class:"mr-2 w-6 h-6 flex-shrink-0"},st={class:"text-ink-gray-7 flex-1 text-left truncate"},at={key:3,class:"text-xs text-ink-gray-5 ml-auto"},lt={key:1,class:"px-2 py-4 text-center text-sm text-ink-gray-5"},P=oe({__name:"SearchMultiSelect",props:{options:{default:()=>[]},modelValue:{},placeholder:{default:"Select options..."},label:{default:"Options"},selectionText:{default:"items"}},emits:["update:modelValue"],setup(C,{emit:u}){const i=C,_=u,d=S(!1),k=S(""),x=S(0),D=re("inputRef"),g=v(()=>i.modelValue.length),b=v(()=>i.options.length>0&&"group"in i.options[0]&&"items"in i.options[0]),U=v(()=>b.value?[]:i.options),G=v(()=>b.value?i.options:[]),j=v(()=>b.value?i.options.flatMap(s=>s.items):i.options),M=v(()=>j.value.filter(s=>i.modelValue.includes(s.value))),I=v(()=>M.value.some(s=>s.image)),E=v(()=>j.value.some(s=>s.image||s.icon)),A=v(()=>{if(!b.value)return[];const s=k.value.toLowerCase();return G.value.map(e=>({...e,items:e.items.filter(t=>{const l=e.group.toLowerCase().includes(s),O=t.label.toLowerCase().includes(s);return l||O})})).filter(e=>e.items.length>0)}),L=v(()=>U.value.filter(s=>s.label.toLowerCase().includes(k.value.toLowerCase()))),H=v(()=>{const s=L.value,e=A.value.flatMap(t=>t.items);return[...s,...e]}),T=v(()=>H.value[x.value]||null);function V(){d.value=!d.value,d.value&&(x.value=0,ke(()=>{var s;(s=D.value)==null||s.focus()}))}function N(){d.value=!1}function q(s){const e=[...i.modelValue],t=e.indexOf(s.value);t>-1?e.splice(t,1):e.push(s.value),_("update:modelValue",e)}function Y(){k.value="",_("update:modelValue",[])}function z(s){d.value&&(s.key==="Escape"?(s.preventDefault(),N()):s.key==="Enter"&&T.value?(s.preventDefault(),s.stopPropagation(),q(T.value)):s.key==="ArrowDown"?(s.preventDefault(),x.value=Math.min(x.value+1,H.value.length-1)):s.key==="ArrowUp"&&(s.preventDefault(),x.value=Math.max(x.value-1,0)))}function B(s){if(!s)return null;const e=typeof s=="string"?J("span",{class:"text-base"},s):J(s,{class:"w-4 h-4"});return J("span",{class:"flex-shrink-0 w-4 h-4 inline-flex items-center justify-center mr-2"},[e])}function K(s){var e;return((e=T.value)==null?void 0:e.value)===s.value}return ie(k,()=>{x.value=0}),(s,e)=>(a(),r("div",Re,[o("div",je,[h(n(Q),{variant:"outline",class:F({"ring-2 ring-outline-gray-2":d.value}),onClick:V},{suffix:$(()=>[h(n(ge),{class:F(["ml-2 h-4 w-4 transition-transform duration-200",{"rotate-180":d.value}])},null,8,["class"])]),default:$(()=>{var t;return[o("div",{class:F(["flex items-center min-h-[20px]",{"gap-2":I.value&&g.value>0}])},[g.value>0?(a(),r(w,{key:0},[o("div",Ee,[(a(!0),r(w,null,R(M.value.slice(0,3),(l,O)=>(a(),r("div",{key:`avatar-${l.value}`,class:"relative flex",style:be({zIndex:10-O})},[l.image?(a(),y(n(X),{key:0,image:l.image,label:l.label,class:"border-2 border-white flex-shrink-0",size:"sm"},null,8,["image","label"])):p("",!0)],4))),128))]),o("span",Ne,f(g.value===1?(t=M.value[0])==null?void 0:t.label:`${g.value} ${C.selectionText}`),1)],64)):(a(),r("span",Be,f(C.placeholder),1))],2)]}),_:1},8,["class"])]),d.value?(a(),r("div",Ke,[o("div",Pe,[o("div",Ue,[_e(o("input",{ref_key:"inputRef",ref:D,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:C.label,class:"px-2 flex-1 bg-transparent border-none outline-none text-sm focus:border-none focus:ring-0 text-ink-gray-6 placeholder-ink-gray-4",onClick:e[1]||(e[1]=xe(()=>{},["stop"])),onKeydown:z},null,40,Ge),[[ye,k.value]]),g.value>0?(a(),y(n(Q),{key:0,variant:"ghost",size:"sm",onClick:Y},{icon:$(()=>[h(n(ue),{class:"size-4"})]),_:1})):p("",!0)])]),o("div",Ye,[L.value.length>0?(a(),r("div",Je,[(a(!0),r(w,null,R(L.value,t=>(a(),r("button",{key:`individual-${t.value}`,class:F(["group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6",{"bg-surface-gray-2":K(t)}]),onClick:l=>q(t)},[h(n(ee),{modelValue:i.modelValue.includes(t.value),class:"mr-2 flex-shrink-0"},null,8,["modelValue"]),t.icon?(a(),y(te(B(t.icon)),{key:0})):E.value?(a(),y(n(X),{key:1,image:t.image,label:t.label,class:"mr-2 flex-shrink-0",size:"sm"},null,8,["image","label"])):p("",!0),o("span",We,f(t.label),1),(t.count??0)>0?(a(),r("span",Ze,f(t.count),1)):p("",!0)],10,Xe))),128))])):p("",!0),(a(!0),r(w,null,R(A.value,t=>(a(),r("div",{key:`group-${t.group}`},[o("div",Qe,f(t.group),1),(a(!0),r(w,null,R(t.items,l=>(a(),r("button",{key:`grouped-${l.value}`,class:F(["group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6",{"bg-surface-gray-2":K(l)}]),onClick:O=>q(l)},[h(n(ee),{modelValue:i.modelValue.includes(l.value),class:"mr-2 flex-shrink-0"},null,8,["modelValue"]),l.icon?(a(),y(te(B(l.icon)),{key:0})):l.image?(a(),y(n(X),{key:1,image:l.image,label:l.label,class:"mr-2 flex-shrink-0",size:"sm"},null,8,["image","label"])):E.value?(a(),r("div",tt)):p("",!0),o("span",st,f(l.label),1),(l.count??0)>0?(a(),r("span",at,f(l.count),1)):p("",!0)],10,et))),128))]))),128)),H.value.length===0?(a(),r("div",lt," No options found ")):p("",!0)])])):p("",!0),d.value?(a(),r("div",{key:1,class:"fixed inset-0 z-40",onClick:N})):p("",!0)]))}}),nt={class:"mx-auto mt-6 max-w-4xl px-4 sm:px-5"},ot={class:"flex items-center space-x-2 px-2.5"},rt={class:"flex items-center"},it={class:"mt-2 px-2.5"},ut={class:"flex gap-2 items-center"},ct={class:"mt-2 px-2.5 text-sm flex items-center justify-between min-h-6"},dt={key:1,class:"text-ink-gray-6"},mt={key:2,class:"text-ink-gray-6"},ft={key:3,class:"space-y-1"},pt={class:"text-ink-gray-6"},vt={key:0},ht={key:0,class:"text-ink-gray-6"},gt={class:"text-ink-gray-5"},_t={class:"ml-1 font-medium text-primary"},yt={class:"mt-5"},xt={class:"flex items-start space-x-2"},kt={class:"flex-shrink-0"},bt={class:"w-full"},wt={class:"flex items-center"},St=["innerHTML"],$t={key:1,class:"text-base font-medium"},Ct={class:"px-1 leading-none text-sm text-ink-gray-5"},Tt={class:"px-1 leading-none text-sm text-ink-gray-5"},Vt={class:"ml-auto text-sm text-ink-gray-5"},Ot=["innerHTML"],ne="helpdesk_search:",Et=oe({__name:"SearchAgent",setup(C){const u=S(""),i=S(null),_=S(!0),d=S({}),k=re("searchInput"),x=we(),D=Se(),g=se({url:"helpdesk.api.search.search",makeParams(){return{query:u.value,filters:JSON.stringify(d.value),limit:50}},onSuccess(e){i.value=e,_.value=!1,u.value&&K(u.value,e)}}),b=se({url:"helpdesk.api.search.get_filter_options",auto:!0}),U=v(()=>{var t;const e=((t=b.data)==null?void 0:t.teams)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),G=v(()=>{var t;const e=((t=b.data)==null?void 0:t.statuses)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),j=v(()=>{var t;const e=((t=b.data)==null?void 0:t.priorities)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),M=v(()=>[{value:"HD Ticket",label:m("Tickets"),count:0},{value:"Communication",label:m("Emails"),count:0},{value:"HD Ticket Comment",label:m("Comments"),count:0}]),I=De(()=>{u.value.length>2&&g.submit()},500);function E(e){u.value=e,_.value=!0,I()}function A(){u.value.length>2&&(x.replace({name:"SearchAgent",query:{q:u.value}}),g.submit())}function L(){u.value="",i.value=null,_.value=!0,s(),x.replace({name:"SearchAgent"})}function H(){d.value={},u.value.length>2&&I()}function T(){return Object.values(d.value).some(e=>e&&e.length>0)}function V(e,t){!t||t.length===0?delete d.value[e]:d.value[e]=t,u.value.length>2&&I()}function N(e){return!e||!e.doctype||!e.name?{name:"SearchAgent"}:e.doctype==="HD Ticket"?{name:"TicketAgent",params:{ticketId:e.name}}:e.doctype==="HD Ticket Comment"&&e.reference_ticket?{name:"TicketAgent",params:{ticketId:e.reference_ticket},hash:`#comment-${e.name}`}:e.doctype==="Communication"&&e.reference_name?{name:"TicketAgent",params:{ticketId:e.reference_name},hash:`#communication-${e.name}`}:{name:"SearchAgent"}}function q(e){return!e||!e.doctype?"":e.doctype==="HD Ticket"?e.name||"":e.doctype==="HD Ticket Comment"?e.reference_ticket||"":e.doctype==="Communication"&&e.reference_name||""}function Y(e){if(!e)return"";let t="MMM D, YYYY hh:mm A";try{return typeof e=="number"?le.unix(e).format(t):le(e).format(t)}catch{return""}}function z(e){return`${ne}${e}`}function B(e){const t=localStorage.getItem(z(e));if(t){const l=JSON.parse(t);if(Date.now()-l.timestamp<30*60*1e3)return i.value=l.results,l.filters&&(d.value=l.filters),_.value=!1,!0;localStorage.removeItem(z(e))}return!1}function K(e,t){const l={results:t,filters:d.value,timestamp:Date.now()};localStorage.setItem(z(e),JSON.stringify(l))}function s(){for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t!=null&&t.startsWith(ne)&&localStorage.removeItem(t)}}return ie(()=>D.query.q,e=>{e&&typeof e=="string"&&e!==u.value?(u.value=e,_.value=!1,g.submit()):!e&&u.value&&(u.value="",i.value=null,_.value=!0)}),$e(()=>{const e=D.query.q;e?(u.value=e,B(e)||A()):s(),Me("/",()=>{k.value.el.focus()})}),(e,t)=>{var W,Z;const l=Ie,O=ue,ce=ae("Button"),de=Ae,me=Fe,fe=ve,pe=ae("router-link");return a(),r("div",null,[o("div",null,[h(n(Le),null,{"left-header":$(()=>[h(n(He),{items:[{label:n(m)("Search"),route:{name:"SearchAgent"}}]},null,8,["items"])]),_:1}),o("div",nt,[o("div",ot,[h(n(Te),{ref_key:"searchInput",ref:k,class:"flex-1",placeholder:n(m)("Search tickets, comments, and communications..."),autocomplete:"off","model-value":u.value,"onUpdate:modelValue":E,onKeydown:[t[0]||(t[0]=c=>_.value=!0),t[1]||(t[1]=Ce(()=>A(),["enter"]))]},{prefix:$(()=>[h(l,{class:"w-4 text-ink-gray-5"})]),suffix:$(()=>[o("div",rt,[u.value?(a(),r("button",{key:0,onClick:L,class:"p-1 size-6 grid place-content-center focus:outline-none focus:ring focus:ring-outline-gray-3 rounded"},[h(O,{class:"w-4 text-ink-gray-7"})])):p("",!0)])]),_:1},8,["placeholder","model-value"])]),o("div",it,[o("div",ut,[h(P,{options:U.value,"model-value":d.value.agent_group||[],"onUpdate:modelValue":t[2]||(t[2]=c=>V("agent_group",c)),placeholder:n(m)("Team"),label:n(m)("Team")},null,8,["options","model-value","placeholder","label"]),h(P,{options:G.value,"model-value":d.value.status||[],"onUpdate:modelValue":t[3]||(t[3]=c=>V("status",c)),placeholder:n(m)("Status"),label:n(m)("Status")},null,8,["options","model-value","placeholder","label"]),h(P,{options:j.value,"model-value":d.value.priority||[],"onUpdate:modelValue":t[4]||(t[4]=c=>V("priority",c)),placeholder:n(m)("Priority"),label:n(m)("Priority")},null,8,["options","model-value","placeholder","label"]),h(P,{options:M.value,"model-value":d.value.doctype||[],"onUpdate:modelValue":t[5]||(t[5]=c=>V("doctype",c)),placeholder:n(m)("Type"),label:n(m)("Type")},null,8,["options","model-value","placeholder","label"]),T()?(a(),y(ce,{key:0,size:"sm",class:"ml-auto text-ink-gray-5",variant:"gray-ghost",onClick:H,label:n(m)("Clear all filters")},null,8,["label"])):p("",!0)])]),o("div",ct,[o("div",null,[n(g).error?(a(),y(n(Ve),{key:0,message:n(g).error.type=="HelpdeskSearchIndexMissingError"?n(m)("Search index does not exist. Please build the index first."):n(g).error},null,8,["message"])):_.value&&u.value.length>2?(a(),r("p",dt,f(n(m)("Press enter to search")),1)):n(g).loading?(a(),r("p",mt,f(n(m)("Searching...")),1)):(W=i.value)!=null&&W.summary?(a(),r("div",ft,[o("p",pt,[Oe(f(n(m)("{0} matches ({1}s)",[i.value.summary.filtered_matches,i.value.summary.duration]))+" ",1),T()?(a(),r("span",vt," • "+f(n(m)("{0} filter(s) applied",[Object.keys(i.value.summary.applied_filters||{}).length])),1)):p("",!0)]),i.value.summary.corrected_query?(a(),r("p",ht,[o("span",gt,f(n(m)("Searched for:")),1),o("span",_t,f(i.value.summary.corrected_query),1)])):p("",!0)])):p("",!0)])]),o("div",yt,[(a(!0),r(w,null,R((Z=i.value)==null?void 0:Z.results,c=>(a(),r(w,{key:c.id},[h(pe,{to:N(c),class:"flex space-x-2 overflow-hidden rounded px-2.5 py-3 hover:bg-surface-gray-2"},{default:$(()=>[o("div",xt,[o("div",kt,[c.doctype==="HD Ticket"?(a(),y(de,{key:0,class:"h-4 w-4 text-ink-gray-6"})):c.doctype==="HD Ticket Comment"?(a(),y(me,{key:1,class:"h-4 w-4 text-ink-gray-6"})):c.doctype==="Communication"?(a(),y(fe,{key:2,class:"h-4 w-4 text-ink-gray-6"})):p("",!0)])]),o("div",bt,[o("div",wt,[c.title?(a(),r("div",{key:0,class:"text-base font-medium",innerHTML:c.title},null,8,St)):(a(),r("div",$t,f(c.name),1)),o("span",Ct," · "+f(c.doctype=="Communication"?n(m)("Email"):c.doctype.replace("HD ","")),1),o("span",Tt," · #"+f(q(c)),1),o("div",Vt,f(Y(c.modified)),1)]),c.content?(a(),r("div",{key:0,class:"mt-1 text-p-base text-ink-gray-6",innerHTML:c.content},null,8,Ot)):p("",!0)])]),_:2},1032,["to"]),t[6]||(t[6]=o("div",{class:"border-b mx-2"},null,-1))],64))),128))])])])])}}});export{Et as default};
//# sourceMappingURL=SearchAgent-c9eed405.js.map
