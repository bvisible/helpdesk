{"version":3,"file":"TypingIndicator-460dd024.js","sources":["../../../../desk/src/components/CannedResponseSelectorModal.vue","../../../../desk/src/components/icons/AttachmentIcon.vue","../../../../desk/src/components/CommentTextEditor.vue","../../../../desk/src/components/CommunicationArea.vue","../../../../desk/src/components/EmailEditor.vue","../../../../desk/src/components/MultiSelectInput.vue","../../../../desk/src/components/TypingIndicator.vue"],"sourcesContent":["<template>\n  <Dialog\n    v-model=\"show\"\n    :options=\"{\n      title: 'Canned Responses',\n      size: '4xl',\n    }\"\n  >\n    <template #body-content>\n      <TextInput\n        ref=\"searchInput\"\n        v-model=\"search\"\n        type=\"text\"\n        :placeholder=\"'Site Down'\"\n      >\n        <template #prefix>\n          <FeatherIcon name=\"search\" class=\"h-4 w-4 text-gray-500\" />\n        </template>\n      </TextInput>\n      <div\n        v-if=\"filteredTemplates.length\"\n        class=\"mt-2 grid max-h-[560px] grid-cols-1 md:grid-cols-3 gap-2 overflow-y-auto\"\n      >\n        <div\n          v-for=\"template in filteredTemplates\"\n          :key=\"template.name\"\n          class=\"flex h-56 cursor-pointer flex-col gap-2 rounded-lg border p-3 hover:bg-gray-100\"\n          @click=\"emit('apply', template)\"\n        >\n          <div class=\"border-b pb-2 text-base font-semibold\">\n            {{ template.title }}\n          </div>\n          <TextEditor\n            v-if=\"template.message\"\n            :content=\"template.message\"\n            :editable=\"false\"\n            editor-class=\"!prose-sm max-w-none !text-sm text-gray-600 focus:outline-none\"\n            class=\"flex-1 overflow-hidden\"\n          />\n        </div>\n      </div>\n      <div v-else class=\"mt-2\">\n        <div class=\"flex h-56 flex-col items-center justify-center\">\n          <div class=\"text-lg text-gray-500\">\n            {{ \"No templates found\" }}\n          </div>\n        </div>\n      </div>\n      <div class=\"flex justify-end mt-4\">\n        <Button\n          label=\"New Canned Response\"\n          @click=\"\n            () => {\n              $router.push('/canned-responses#new');\n              templates.data = null;\n            }\n          \"\n        />\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport { TextEditor, createListResource } from \"frappe-ui\";\nimport { ref, computed, nextTick, watch, onMounted, onUnmounted } from \"vue\";\nimport { showEmailBox } from \"../pages/ticket/modalStates\";\n\nconst props = defineProps({\n  doctype: {\n    type: String,\n    default: \"\",\n  },\n});\n\nconst show = defineModel();\nconst searchInput = ref(\"\");\n\nconst emit = defineEmits([\"apply\"]);\n\nconst search = ref(\"\");\n\nconst templates = createListResource({\n  type: \"list\",\n  doctype: \"HD Canned Response\",\n  cache: [\"cannedResponses\", props.doctype],\n  fields: [\"title\", \"message\", \"modified\"],\n  orderBy: \"modified desc\",\n  pageLength: 99999,\n});\n\nonMounted(() => {\n  if (templates.data == null) {\n    templates.fetch();\n  }\n});\nonUnmounted(() => {\n  showEmailBox.value = true;\n});\n\nconst filteredTemplates = computed(() => {\n  return (\n    templates.data?.filter((template) => {\n      return template.title.toLowerCase().includes(search.value.toLowerCase());\n    }) ?? []\n  );\n});\n\nwatch(show, (value) => value && nextTick(() => searchInput.value?.el?.focus()));\n</script>\n","<template>\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M12.5684 2.50774C11.5403 1.49742 9.95026 1.49742 8.92215 2.50774L3.62404 7.71417C2.12532 9.18695 2.12532 11.669 3.62404 13.1418C5.12762 14.6194 7.66861 14.6194 9.17219 13.1418L12.1609 10.2049C12.3578 10.0113 12.6744 10.0141 12.8679 10.211C13.0615 10.408 13.0587 10.7246 12.8618 10.9181L9.8731 13.8551C7.98045 15.715 4.81578 15.715 2.92313 13.8551C1.02562 11.9904 1.02562 8.86558 2.92313 7.00091L8.22124 1.79449C9.63842 0.401838 11.8521 0.401838 13.2693 1.79449C14.6914 3.19191 14.6914 5.38225 13.2693 6.77968L13.2668 6.78213L13.2668 6.78212L8.37876 11.5189C8.37834 11.5193 8.37793 11.5197 8.37752 11.5201C7.51767 12.3638 6.11144 12.3939 5.29119 11.5097C4.43611 10.6596 4.40778 9.26893 5.30922 8.46081L7.33823 6.46692C7.53518 6.27337 7.85175 6.27613 8.04531 6.47309C8.23886 6.67005 8.23609 6.98662 8.03913 7.18017L6.0014 9.18264L5.99203 9.19185L5.98219 9.20055C5.5391 9.59243 5.5104 10.3231 6.0014 10.8056L6.01078 10.8148L6.01967 10.8245C6.42299 11.2649 7.18224 11.2926 7.67785 10.8056L7.68034 10.8032L7.68035 10.8032L12.5684 6.06643C12.5688 6.06604 12.5692 6.06565 12.5696 6.06526C13.5917 5.05969 13.5913 3.51289 12.5684 2.50774Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n</template>\n","<template>\n  <TextEditor\n    v-if=\"agentsList.data\"\n    ref=\"editorRef\"\n    :editor-class=\"[\n      'prose-sm max-w-none',\n      editable &&\n        'min-h-[7rem] mx-6 md:ml-10 md:mr-9 max-h-[50vh] overflow-y-auto border-t py-3',\n      getFontFamily(newComment),\n    ]\"\n    :content=\"newComment\"\n    :starterkit-options=\"{ heading: { levels: [2, 3, 4, 5, 6] } }\"\n    :placeholder=\"placeholder\"\n    :editable=\"editable\"\n    :mentions=\"agents\"\n    @change=\"editable ? (newComment = $event) : null\"\n    :extensions=\"[PreserveVideoControls]\"\n    :uploadFunction=\"(file:any)=>uploadFunction(file, doctype, ticketId)\"\n  >\n    <template #bottom>\n      <div v-if=\"editable\" class=\"flex flex-col gap-2 px-6 md:pl-10 md:pr-9\">\n        <!-- Attachments -->\n        <div class=\"flex flex-wrap gap-2\">\n          <AttachmentItem\n            v-for=\"a in attachments\"\n            :key=\"a.file_url\"\n            :label=\"a.file_name\"\n            :url=\"!['MOV', 'MP4'].includes(a.file_type) ? a.file_url : null\"\n          >\n            <template #suffix>\n              <FeatherIcon\n                class=\"h-3.5\"\n                name=\"x\"\n                @click.stop=\"removeAttachment(a)\"\n              />\n            </template>\n          </AttachmentItem>\n        </div>\n        <!-- Fixed Menu -->\n        <div class=\"flex justify-between overflow-hidden border-t py-2.5\">\n          <div class=\"flex items-center overflow-x-auto w-[60%]\">\n            <TextEditorFixedMenu\n              class=\"-ml-1\"\n              :buttons=\"textEditorMenuButtons\"\n            />\n            <FileUploader\n              :upload-args=\"{\n                doctype: doctype,\n                docname: ticketId,\n                private: true,\n              }\"\n              @success=\"(f) => attachments.push(f)\"\n            >\n              <template #default=\"{ openFileSelector }\">\n                <Button\n                  theme=\"gray\"\n                  variant=\"ghost\"\n                  @click=\"openFileSelector()\"\n                >\n                  <template #icon>\n                    <AttachmentIcon\n                      class=\"h-4\"\n                      style=\"color: #000000; stroke-width: 1.5 !important\"\n                    />\n                  </template>\n                </Button>\n              </template>\n            </FileUploader>\n          </div>\n          <div class=\"flex items-center justify-end space-x-2 w-[40%]\">\n            <Button\n              label=\"Discard\"\n              @click=\"\n                () => {\n                  newComment = '';\n                  attachments = [];\n                  emit('discard');\n                }\n              \"\n            />\n            <Button\n              variant=\"solid\"\n              :label=\"label\"\n              :disabled=\"commentEmpty\"\n              :loading=\"loading\"\n              @click=\"\n                () => {\n                  loading = true;\n                  submitComment();\n                  newComment = '';\n                }\n              \"\n            />\n          </div>\n        </div>\n      </div>\n    </template>\n  </TextEditor>\n</template>\n<script setup lang=\"ts\">\nimport {\n  FileUploader,\n  TextEditor,\n  TextEditorFixedMenu,\n  createResource,\n} from \"frappe-ui\";\nimport { useOnboarding } from \"frappe-ui/frappe\";\nimport { computed, onBeforeUnmount, onMounted, ref, watch } from \"vue\";\n\nimport { AttachmentItem } from \"@/components/\";\nimport { AttachmentIcon } from \"@/components/icons/\";\nimport { useTyping } from \"@/composables/realtime\";\nimport { useAgentStore } from \"@/stores/agent\";\nimport { useAuthStore } from \"@/stores/auth\";\nimport { PreserveVideoControls } from \"@/tiptap-extensions\";\nimport {\n  getFontFamily,\n  isContentEmpty,\n  removeAttachmentFromServer,\n  textEditorMenuButtons,\n  uploadFunction,\n} from \"@/utils\";\nimport { useStorage } from \"@vueuse/core\";\n\nconst { updateOnboardingStep } = useOnboarding(\"helpdesk\");\nconst { agents: agentsList } = useAgentStore();\nconst { isManager } = useAuthStore();\n\nonMounted(() => {\n  if (\n    agentsList.loading ||\n    agentsList.data?.length ||\n    agentsList.list.promise\n  ) {\n    return;\n  }\n  agentsList.fetch();\n});\n\nconst props = defineProps({\n  ticketId: {\n    type: String,\n    default: null,\n  },\n  placeholder: {\n    type: String,\n    default: null,\n  },\n  label: {\n    type: String,\n    default: \"Comment\",\n  },\n  editable: {\n    type: Boolean,\n    default: true,\n  },\n  doctype: {\n    type: String,\n    default: \"HD Ticket\",\n  },\n});\n\nconst emit = defineEmits([\"submit\", \"discard\"]);\n\nconst newComment = useStorage(\"commentBoxContent\" + props.ticketId, null);\n\n// Initialize typing composable\nconst { onUserType, cleanup } = useTyping(props.ticketId);\n\nconst attachments = ref([]);\nconst commentEmpty = computed(() => {\n  return isContentEmpty(newComment.value);\n});\nconst loading = ref(false);\n\n// Watch for changes in comment content to trigger typing events\nwatch(newComment, (newValue, oldValue) => {\n  if (newValue !== oldValue && newValue) {\n    onUserType();\n  }\n});\n\nonBeforeUnmount(() => {\n  cleanup();\n});\n\nconst label = computed(() => {\n  return loading.value ? \"Sending...\" : props.label;\n});\n\nconst agents = computed(() => {\n  return (\n    agentsList.data?.map((agent) => ({\n      label: agent.agent_name.trimEnd(),\n      value: agent.name,\n    })) || []\n  );\n});\n\nfunction removeAttachment(attachment) {\n  attachments.value = attachments.value.filter((a) => a !== attachment);\n  removeAttachmentFromServer(attachment.name);\n}\n\nasync function submitComment() {\n  if (isContentEmpty(newComment.value)) {\n    return false;\n  }\n  const comment = createResource({\n    url: \"run_doc_method\",\n    makeParams: () => ({\n      dt: props.doctype,\n      dn: props.ticketId,\n      method: \"new_comment\",\n      args: {\n        content: newComment.value,\n        attachments: attachments.value,\n      },\n    }),\n    onSuccess: () => {\n      if (isManager) {\n        updateOnboardingStep(\"comment_on_ticket\");\n      }\n      emit(\"submit\");\n      loading.value = false;\n      attachments.value = [];\n      newComment.value = null;\n    },\n    onError: () => {\n      loading.value = false;\n    },\n  });\n\n  comment.submit();\n}\n\nconst editorRef = ref(null);\nconst editor = computed(() => editorRef.value?.editor);\n\ndefineExpose({\n  submitComment,\n  editor,\n});\n</script>\n","<template>\n  <div class=\"comm-area\">\n    <div\n      class=\"flex justify-between gap-3 border-t px-6 md:px-10 py-4 md:py-2.5\"\n    >\n      <div class=\"flex gap-1.5 items-center\">\n        <Button\n          ref=\"sendEmailRef\"\n          variant=\"ghost\"\n          label=\"Reply\"\n          :class=\"[showEmailBox ? '!bg-gray-300 hover:!bg-gray-200' : '']\"\n          @click=\"toggleEmailBox()\"\n        >\n          <template #prefix>\n            <EmailIcon class=\"h-4\" />\n          </template>\n        </Button>\n        <Button\n          variant=\"ghost\"\n          label=\"Comment\"\n          :class=\"[showCommentBox ? '!bg-gray-300 hover:!bg-gray-200' : '']\"\n          @click=\"toggleCommentBox()\"\n        >\n          <template #prefix>\n            <CommentIcon class=\"h-4\" />\n          </template>\n        </Button>\n        <TypingIndicator :ticketId=\"ticketId\" />\n      </div>\n    </div>\n    <div\n      ref=\"emailBoxRef\"\n      v-show=\"showEmailBox\"\n      class=\"flex gap-1.5 flex-1\"\n      @keydown.ctrl.enter.capture.stop=\"submitEmail\"\n      @keydown.meta.enter.capture.stop=\"submitEmail\"\n    >\n      <EmailEditor\n        ref=\"emailEditorRef\"\n        :label=\"\n          isMobileView ? 'Send' : isMac ? 'Send (⌘ + ⏎)' : 'Send (Ctrl + ⏎)'\n        \"\n        v-model:content=\"content\"\n        placeholder=\"Hi John, we are looking into this issue.\"\n        :ticketId=\"ticketId\"\n        :to-emails=\"toEmails\"\n        :cc-emails=\"ccEmails\"\n        :bcc-emails=\"bccEmails\"\n        @submit=\"\n          () => {\n            showEmailBox = false;\n            emit('update');\n          }\n        \"\n        @discard=\"\n          () => {\n            showEmailBox = false;\n          }\n        \"\n      />\n    </div>\n    <div\n      ref=\"commentBoxRef\"\n      v-show=\"showCommentBox\"\n      @keydown.ctrl.enter.capture.stop=\"submitComment\"\n      @keydown.meta.enter.capture.stop=\"submitComment\"\n    >\n      <CommentTextEditor\n        ref=\"commentTextEditorRef\"\n        :label=\"\n          isMobileView\n            ? 'Comment'\n            : isMac\n            ? 'Comment (⌘ + ⏎)'\n            : 'Comment (Ctrl + ⏎)'\n        \"\n        :ticketId=\"ticketId\"\n        :editable=\"showCommentBox\"\n        :doctype=\"doctype\"\n        placeholder=\"@John could you please look into this?\"\n        @submit=\"\n          () => {\n            showCommentBox = false;\n            emit('update');\n          }\n        \"\n        @discard=\"\n          () => {\n            showCommentBox = false;\n          }\n        \"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { CommentTextEditor, EmailEditor, TypingIndicator } from \"@/components\";\nimport { CommentIcon, EmailIcon } from \"@/components/icons/\";\nimport { useDevice } from \"@/composables\";\nimport { useScreenSize } from \"@/composables/screen\";\nimport { useShortcut } from \"@/composables/shortcuts\";\nimport { showCommentBox, showEmailBox } from \"@/pages/ticket/modalStates\";\nimport { ref, watch } from \"vue\";\nimport { onClickOutside } from \"@vueuse/core\";\n\nconst emit = defineEmits([\"update\"]);\nconst content = defineModel(\"content\");\nconst { isMac } = useDevice();\nconst { isMobileView } = useScreenSize();\nlet doc = defineModel();\n// let doc = inject(TicketSymbol)?.value.doc\nconst emailEditorRef = ref(null);\nconst commentTextEditorRef = ref(null);\nconst emailBoxRef = ref(null);\nconst commentBoxRef = ref(null);\n\nfunction toggleEmailBox() {\n  if (showCommentBox.value) {\n    showCommentBox.value = false;\n  }\n  showEmailBox.value = !showEmailBox.value;\n}\n\nfunction toggleCommentBox() {\n  if (showEmailBox.value) {\n    showEmailBox.value = false;\n  }\n  showCommentBox.value = !showCommentBox.value;\n}\n\nfunction submitEmail() {\n  if (emailEditorRef.value.submitMail()) {\n    emit(\"update\");\n  }\n}\n\nfunction submitComment() {\n  if (commentTextEditorRef.value.submitComment()) {\n    emit(\"update\");\n  }\n}\n\nfunction splitIfString(str: string | string[]) {\n  if (typeof str === \"string\") {\n    return str.split(\",\");\n  }\n  return str;\n}\n\nfunction replyToEmail(data: object) {\n  showEmailBox.value = true;\n\n  emailEditorRef.value.addToReply(\n    data.content,\n    splitIfString(data.to),\n    splitIfString(data.cc),\n    splitIfString(data.bcc)\n  );\n}\n\nconst props = defineProps({\n  doctype: {\n    type: String,\n    default: \"HD Ticket\",\n  },\n  ticketId: {\n    type: String,\n    default: null,\n  },\n  toEmails: {\n    type: Array,\n    default: () => [],\n  },\n  ccEmails: {\n    type: Array,\n    default: () => [],\n  },\n  bccEmails: {\n    type: Array,\n    default: () => [],\n  },\n});\n\nwatch(\n  () => showEmailBox.value,\n  (value) => {\n    if (value) {\n      emailEditorRef.value?.editor?.commands?.focus();\n    }\n  }\n);\n\nwatch(\n  () => showCommentBox.value,\n  (value) => {\n    if (value) {\n      commentTextEditorRef.value?.editor?.commands?.focus();\n    }\n  }\n);\n\nuseShortcut(\"r\", () => {\n  toggleEmailBox();\n});\nuseShortcut(\"c\", () => {\n  toggleCommentBox();\n});\n\ndefineExpose({\n  replyToEmail,\n  toggleEmailBox,\n  toggleCommentBox,\n  editor: emailEditorRef,\n});\n\nonClickOutside(\n  emailBoxRef,\n  () => {\n    if (showEmailBox.value) {\n      showEmailBox.value = false;\n    }\n  },\n  {\n    ignore: [\".tippy-box\", \".tippy-content\"],\n  }\n);\n\nonClickOutside(\n  commentBoxRef,\n  () => {\n    if (showCommentBox.value) {\n      showCommentBox.value = false;\n    }\n  },\n  {\n    ignore: [\".tippy-box\", \".tippy-content\"],\n  }\n);\n</script>\n\n<style>\n@media screen and (max-width: 640px) {\n  .comm-area {\n    width: 100vw;\n  }\n}\n</style>\n","<template>\n  <TextEditor\n    ref=\"editorRef\"\n    :editor-class=\"[\n      'prose-sm max-w-full mx-6 md:mx-10 max-h-[50vh] py-3',\n      'min-h-[7rem]',\n      getFontFamily(newEmail),\n      editable && '!max-h-[35vh] overflow-y-auto',\n    ]\"\n    :content=\"newEmail\"\n    :starterkit-options=\"{ heading: { levels: [2, 3, 4, 5, 6] } }\"\n    :placeholder=\"placeholder\"\n    :editable=\"editable\"\n    @change=\"editable ? (newEmail = $event) : null\"\n    :extensions=\"[PreserveVideoControls]\"\n    :uploadFunction=\"(file:any)=>uploadFunction(file, doctype, ticketId)\"\n  >\n    <template #top>\n      <div class=\"mx-6 md:mx-10 flex items-center gap-2 border-y py-2.5\">\n        <span class=\"text-xs text-gray-500\">TO:</span>\n        <MultiSelectInput\n          v-model=\"toEmailsClone\"\n          class=\"flex-1\"\n          :validate=\"validateEmail\"\n          :error-message=\"(value) => `${value} is an invalid email address`\"\n        />\n        <Button\n          :label=\"'CC'\"\n          :class=\"[cc ? 'bg-gray-300 hover:bg-gray-200' : '']\"\n          @click=\"toggleCC()\"\n        />\n        <Button\n          :label=\"'BCC'\"\n          :class=\"[bcc ? 'bg-gray-300 hover:bg-gray-200' : '']\"\n          @click=\"toggleBCC()\"\n        />\n      </div>\n      <div\n        v-if=\"showCC || cc\"\n        class=\"mx-10 flex items-center gap-2 py-2.5\"\n        :class=\"cc || showCC ? 'border-b' : ''\"\n      >\n        <span class=\"text-xs text-gray-500\">CC:</span>\n        <MultiSelectInput\n          ref=\"ccInput\"\n          v-model=\"ccEmailsClone\"\n          class=\"flex-1\"\n          :validate=\"validateEmail\"\n          :error-message=\"(value) => `${value} is an invalid email address`\"\n        />\n      </div>\n      <div\n        v-if=\"showBCC || bcc\"\n        class=\"mx-10 flex items-center gap-2 py-2.5\"\n        :class=\"bcc || showBCC ? 'border-b' : ''\"\n      >\n        <span class=\"text-xs text-gray-500\">BCC:</span>\n        <MultiSelectInput\n          ref=\"bccInput\"\n          v-model=\"bccEmailsClone\"\n          class=\"flex-1\"\n          :validate=\"validateEmail\"\n          :error-message=\"(value) => `${value} is an invalid email address`\"\n        />\n      </div>\n    </template>\n    <!-- <template v-slot:editor=\"{ _editor }\">\n      <EditorContent\n        :class=\"[editable && 'max-h-[35vh] overflow-y-auto']\"\n        :editor=\"_editor\"\n      />\n    </template> -->\n    <template #bottom>\n      <!-- Attachments -->\n      <div class=\"flex flex-wrap gap-2 px-10\">\n        <AttachmentItem\n          v-for=\"a in attachments\"\n          :key=\"a.file_url\"\n          :label=\"a.file_name\"\n          :url=\"!['MOV', 'MP4'].includes(a.file_type) ? a.file_url : null\"\n        >\n          <template #suffix>\n            <FeatherIcon\n              class=\"h-3.5\"\n              name=\"x\"\n              @click.self.stop=\"removeAttachment(a)\"\n            />\n          </template>\n        </AttachmentItem>\n      </div>\n      <!-- TextEditor Fixed Menu -->\n      <div\n        class=\"flex justify-between overflow-scroll pl-10 py-2.5 items-center\"\n      >\n        <div class=\"flex items-center overflow-x-auto w-[60%]\">\n          <div class=\"flex gap-1\">\n            <FileUploader\n              :upload-args=\"{\n                doctype: doctype,\n                docname: ticketId,\n                private: true,\n              }\"\n              @success=\"\n                (f) => {\n                  attachments.push(f);\n                }\n              \"\n            >\n              <template #default=\"{ openFileSelector }\">\n                <Button variant=\"ghost\" @click=\"openFileSelector()\">\n                  <template #icon>\n                    <AttachmentIcon\n                      class=\"h-4\"\n                      style=\"color: #000000; stroke-width: 1.5 !important\"\n                    />\n                  </template>\n                </Button>\n              </template>\n            </FileUploader>\n            <Button\n              variant=\"ghost\"\n              @click=\"showCannedResponseSelectorModal = true\"\n            >\n              <template #icon>\n                <EmailIcon\n                  class=\"h-4\"\n                  style=\"color: #000000; stroke-width: 1.2\"\n                />\n              </template>\n            </Button>\n          </div>\n          <TextEditorFixedMenu class=\"ml-1\" :buttons=\"textEditorMenuButtons\" />\n        </div>\n        <div\n          class=\"flex items-center justify-end space-x-2 sm:mt-0 w-[40%] mr-9\"\n        >\n          <Button label=\"Discard\" @click=\"handleDiscard\" />\n          <Button\n            variant=\"solid\"\n            :disabled=\"emailEmpty\"\n            :loading=\"sendMail.loading\"\n            :label=\"label\"\n            @click=\"\n              () => {\n                submitMail();\n              }\n            \"\n          />\n        </div>\n      </div>\n    </template>\n  </TextEditor>\n  <CannedResponseSelectorModal\n    v-if=\"showCannedResponseSelectorModal\"\n    v-model=\"showCannedResponseSelectorModal\"\n    :doctype=\"doctype\"\n    @apply=\"applyCannedResponse\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  AttachmentItem,\n  CannedResponseSelectorModal,\n  MultiSelectInput,\n} from \"@/components\";\nimport { AttachmentIcon, EmailIcon } from \"@/components/icons\";\nimport { useTyping } from \"@/composables/realtime\";\nimport { useAuthStore } from \"@/stores/auth\";\nimport { PreserveVideoControls } from \"@/tiptap-extensions\";\nimport {\n  getFontFamily,\n  isContentEmpty,\n  removeAttachmentFromServer,\n  textEditorMenuButtons,\n  uploadFunction,\n  validateEmail,\n} from \"@/utils\";\n// import { EditorContent } from \"@tiptap/vue-3\";\nimport { useStorage } from \"@vueuse/core\";\nimport {\n  FileUploader,\n  TextEditor,\n  TextEditorFixedMenu,\n  createResource,\n  toast,\n} from \"frappe-ui\";\nimport { useOnboarding } from \"frappe-ui/frappe\";\nimport { computed, nextTick, onBeforeUnmount, ref, watch } from \"vue\";\n\nconst editorRef = ref(null);\nconst showCannedResponseSelectorModal = ref(false);\n\nconst props = defineProps({\n  ticketId: {\n    type: String,\n    default: null,\n  },\n  placeholder: {\n    type: String,\n    default: null,\n  },\n  label: {\n    type: String,\n    default: \"Send\",\n  },\n  editable: {\n    type: Boolean,\n    default: true,\n  },\n  doctype: {\n    type: String,\n    default: \"HD Ticket\",\n  },\n  toEmails: {\n    type: Array,\n    default: () => [],\n  },\n  ccEmails: {\n    type: Array,\n    default: () => [],\n  },\n  bccEmails: {\n    type: Array,\n    default: () => [],\n  },\n});\n\nconst label = computed(() => {\n  return sendMail.loading ? \"Sending...\" : props.label;\n});\n\nconst emit = defineEmits([\"submit\", \"discard\"]);\n\nconst newEmail = useStorage(\"emailBoxContent\" + props.ticketId, null);\nconst { updateOnboardingStep } = useOnboarding(\"helpdesk\");\nconst { isManager } = useAuthStore();\n\n// Initialize typing composable\nconst { onUserType, cleanup } = useTyping(props.ticketId);\n\nconst attachments = ref([]);\nconst emailEmpty = computed(() => {\n  return isContentEmpty(newEmail.value);\n});\n\n// Watch for changes in email content to trigger typing events\nwatch(newEmail, (newValue, oldValue) => {\n  if (newValue !== oldValue && newValue) {\n    onUserType();\n  }\n});\n\nonBeforeUnmount(() => {\n  cleanup();\n});\n\nconst toEmailsClone = ref([...props.toEmails]);\nconst ccEmailsClone = ref([...props.ccEmails]);\nconst bccEmailsClone = ref([...props.bccEmails]);\nconst showCC = ref(false);\nconst showBCC = ref(false);\nconst cc = computed(() => (ccEmailsClone.value?.length ? true : false));\nconst bcc = computed(() => (bccEmailsClone.value?.length ? true : false));\nconst ccInput = ref(null);\nconst bccInput = ref(null);\n\nfunction applyCannedResponse(template) {\n  newEmail.value = template.message;\n  showCannedResponseSelectorModal.value = false;\n}\n\nconst sendMail = createResource({\n  url: \"run_doc_method\",\n  makeParams: () => ({\n    dt: props.doctype,\n    dn: props.ticketId,\n    method: \"reply_via_agent\",\n    args: {\n      attachments: attachments.value.map((x) => x.name),\n      to: toEmailsClone.value.join(\",\"),\n      cc: ccEmailsClone.value?.join(\",\"),\n      bcc: bccEmailsClone.value?.join(\",\"),\n      message: newEmail.value,\n    },\n  }),\n  onSuccess: () => {\n    resetState();\n    emit(\"submit\");\n\n    if (isManager) {\n      updateOnboardingStep(\"reply_on_ticket\");\n    }\n  },\n  debounce: 300,\n});\n\nfunction submitMail() {\n  if (isContentEmpty(newEmail.value)) {\n    return false;\n  }\n  if (!toEmailsClone.value.length) {\n    toast.warning(\n      \"Email has no recipients. Please add at least one email address in the 'TO' field.\"\n    );\n    return false;\n  }\n\n  sendMail.submit();\n}\n\nfunction toggleCC() {\n  showCC.value = !showCC.value;\n\n  showCC.value &&\n    nextTick(() => {\n      ccInput.value.setFocus();\n    });\n}\n\nfunction toggleBCC() {\n  showBCC.value = !showBCC.value;\n  showBCC.value &&\n    nextTick(() => {\n      bccInput.value.setFocus();\n    });\n}\n\nasync function removeAttachment(attachment) {\n  attachments.value = attachments.value.filter((a) => a !== attachment);\n  await removeAttachmentFromServer(attachment.name);\n}\n\nfunction addToReply(\n  body: string,\n  toEmails: string[],\n  ccEmails: string[],\n  bccEmails: string[]\n) {\n  toEmailsClone.value = toEmails;\n  ccEmailsClone.value = ccEmails;\n  bccEmailsClone.value = bccEmails;\n  editorRef.value.editor\n    .chain()\n    .clearContent()\n    .insertContent(body)\n    .focus(\"all\")\n    .setBlockquote()\n    .insertContentAt(0, { type: \"paragraph\" })\n    .focus(\"start\")\n    .run();\n}\n\nfunction resetState() {\n  newEmail.value = null;\n  attachments.value = [];\n}\n\nfunction handleDiscard() {\n  attachments.value = [];\n  newEmail.value = null;\n\n  ccEmailsClone.value = [];\n  bccEmailsClone.value = [];\n  ccEmailsClone.value = [];\n  showCC.value = false;\n  showBCC.value = false;\n\n  emit(\"discard\");\n}\n\nconst editor = computed(() => {\n  return editorRef.value.editor;\n});\n\ndefineExpose({\n  addToReply,\n  editor,\n  submitMail,\n});\n</script>\n","<template>\n  <div>\n    <div class=\"flex flex-wrap gap-1\">\n      <Button\n        v-for=\"value in values\"\n        ref=\"emails\"\n        :key=\"value\"\n        :label=\"value\"\n        theme=\"gray\"\n        variant=\"subtle\"\n        class=\"rounded-full\"\n        @keydown.delete.capture.stop=\"removeLastValue\"\n      >\n        <template #suffix>\n          <FeatherIcon\n            class=\"h-3.5\"\n            name=\"x\"\n            @click.stop=\"removeValue(value)\"\n          />\n        </template>\n      </Button>\n      <div class=\"flex-1\">\n        <Combobox v-model=\"selectedValue\" nullable>\n          <Popover v-model:show=\"showOptions\" class=\"w-full\">\n            <template #target=\"{ togglePopover }\">\n              <ComboboxInput\n                ref=\"search\"\n                class=\"search-input form-input w-full border-none bg-white hover:bg-white focus:border-none focus:!shadow-none focus-visible:!ring-0\"\n                type=\"text\"\n                :value=\"query\"\n                autocomplete=\"off\"\n                @change=\"\n                  (e) => {\n                    query = e.target.value;\n                    showOptions = true;\n                  }\n                \"\n                @focus=\"() => togglePopover()\"\n                @keydown.delete.capture.stop=\"removeLastValue\"\n              />\n            </template>\n            <template #body=\"{ isOpen }\">\n              <div v-show=\"isOpen\">\n                <div class=\"mt-1 rounded-lg bg-white py-1 text-base shadow-2xl\">\n                  <ComboboxOptions\n                    class=\"my-1 max-h-[12rem] overflow-y-auto px-1.5\"\n                    static\n                  >\n                    <ComboboxOption\n                      v-for=\"option in options\"\n                      :key=\"option.value\"\n                      v-slot=\"{ active }\"\n                      :value=\"option\"\n                    >\n                      <li\n                        :class=\"[\n                          'flex cursor-pointer items-center rounded px-2 py-1 text-base',\n                          { 'bg-gray-100': active },\n                        ]\"\n                      >\n                        <UserAvatar\n                          class=\"mr-2\"\n                          :name=\"option.value\"\n                          size=\"lg\"\n                        />\n                        <div class=\"flex flex-col gap-1 p-1 text-gray-800\">\n                          <div class=\"text-base font-medium\">\n                            {{ option.label }}\n                          </div>\n                          <div class=\"text-sm text-gray-600\">\n                            {{ option.value }}\n                          </div>\n                        </div>\n                      </li>\n                    </ComboboxOption>\n                  </ComboboxOptions>\n                </div>\n              </div>\n            </template>\n          </Popover>\n        </Combobox>\n      </div>\n    </div>\n    <ErrorMessage v-if=\"error\" class=\"mt-2 pl-2\" :message=\"error\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  Combobox,\n  ComboboxInput,\n  ComboboxOptions,\n  ComboboxOption,\n} from \"@headlessui/vue\";\nimport { UserAvatar } from \"@/components/\";\nimport { Popover, createResource } from \"frappe-ui\";\nimport { ref, computed, nextTick } from \"vue\";\nimport { watchDebounced } from \"@vueuse/core\";\n\nconst props = defineProps({\n  validate: {\n    type: Function,\n    default: null,\n  },\n  errorMessage: {\n    type: Function,\n    default: (value) => `${value} is an Invalid value`,\n  },\n});\n\nconst values = defineModel();\n\nconst emails = ref([]);\nconst search = ref(null);\nconst error = ref(null);\nconst query = ref(\"\");\nconst text = ref(\"\");\nconst showOptions = ref(false);\n\nconst selectedValue = computed({\n  get: () => query.value || \"\",\n  set: (val) => {\n    query.value = \"\";\n    if (val) {\n      showOptions.value = false;\n    }\n    val?.value && addValue(val.value);\n  },\n});\n\nwatchDebounced(\n  query,\n  (val) => {\n    val = val || \"\";\n    if (text.value === val) return;\n    text.value = val;\n    reload(val);\n  },\n  { debounce: 300, immediate: true }\n);\n\nconst filterOptions = createResource({\n  url: \"helpdesk.api.contact.search_contacts\",\n  method: \"GET\",\n  cache: [\"Contact\", text.value],\n  params: {\n    txt: text.value,\n  },\n  transform: (data: Record<\"full_name\" | \"name\" | \"email_id\", string>[]) => {\n    return data.map(({ full_name, email_id, name }) => ({\n      label: full_name || name || email_id,\n      value: email_id,\n    }));\n  },\n});\n\nconst options = computed(() => {\n  let searchedContacts = filterOptions.data || [];\n  if (!searchedContacts.length && query.value) {\n    searchedContacts.push({\n      label: query.value,\n      value: query.value,\n    });\n  }\n  return searchedContacts;\n});\n\nfunction reload(val) {\n  filterOptions.update({\n    params: {\n      txt: val,\n    },\n  });\n  filterOptions.reload();\n}\n\nconst addValue = (value) => {\n  error.value = null;\n  if (value) {\n    const splitValues = value.split(\",\");\n    splitValues.forEach((value) => {\n      value = value.trim();\n      if (value) {\n        // check if value is not already in the values array\n        if (!values.value?.includes(value)) {\n          // check if value is valid\n          if (value && props.validate && !props.validate(value)) {\n            error.value = props.errorMessage(value);\n            return;\n          }\n          // add value to values array\n          if (!values.value) {\n            values.value = [value];\n          } else {\n            values.value.push(value);\n          }\n          value = value.replace(value, \"\");\n        }\n      }\n    });\n    !error.value && (value = \"\");\n  }\n};\n\nconst removeValue = (value) => {\n  values.value = values.value.filter((v) => v !== value);\n};\n\nconst removeLastValue = () => {\n  if (query.value) return;\n\n  let emailRef = emails.value[emails.value.length - 1]?.$el;\n  if (document.activeElement === emailRef) {\n    values.value.pop();\n    nextTick(() => {\n      if (values.value.length) {\n        emailRef = emails.value[emails.value.length - 1].$el;\n        emailRef?.focus();\n      } else {\n        setFocus();\n      }\n    });\n  } else {\n    emailRef?.focus();\n  }\n};\n\nfunction setFocus() {\n  search.value.$el.focus();\n}\n\ndefineExpose({ setFocus });\n</script>\n","<template>\n  <div v-if=\"typingUsers.length > 0\" class=\"pl-2\">\n    <div class=\"flex items-center gap-2 text-sm text-gray-600\">\n      <div class=\"flex items-center gap-1.5\">\n        <component :is=\"typingMessage\" />\n        <div class=\"typing-dots\">\n          <span></span>\n          <span></span>\n          <span></span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useTyping } from \"@/composables/realtime\";\nimport { useUserStore } from \"@/stores/user\";\nimport { computed, h, onBeforeUnmount } from \"vue\";\nimport UserAvatar from \"./UserAvatar.vue\";\n\nconst props = defineProps({\n  ticketId: {\n    type: String,\n    required: true,\n  },\n});\n\nconst { typingUsers, cleanup } = useTyping(props.ticketId);\n\nconst typingMessage = computed(() => {\n  const count = typingUsers.length;\n  if (count === 0) return null;\n  const { getUser } = useUserStore();\n  let firstUser = getUser(typingUsers[0])?.full_name || typingUsers[0];\n  console.log(firstUser);\n  console.log(typingUsers);\n\n  if (count === 1) {\n    return h(\"div\", { class: \"flex items-center gap-1\" }, [\n      h(UserAvatar, { name: typingUsers[0], size: \"sm\" }),\n      h(\"span\", { class: \"text-ink-gray-6 font-medium\" }, firstUser),\n      h(\"span\", { class: \"text-ink-gray-5\" }, \" is typing\"),\n    ]);\n  } else if (count === 2) {\n    return h(\"div\", { class: \"flex items-center gap-1\" }, [\n      h(\"span\", { class: \"text-ink-gray-6 font-medium\" }, firstUser),\n      h(\"span\", { class: \"text-ink-gray-5\" }, \" and \"),\n      h(\n        \"span\",\n        { class: \"text-ink-gray-6 font-medium\" },\n        getUser(typingUsers[1])?.full_name\n      ),\n      h(\"span\", { class: \"text-ink-gray-5\" }, \" are typing\"),\n    ]);\n  } else {\n    return h(\"div\", { class: \"flex items-center gap-1\" }, [\n      h(\"span\", { class: \"text-ink-gray-6 font-medium\" }, firstUser),\n      h(\"span\", { class: \"text-ink-gray-5\" }, \" and \"),\n      h(\n        \"span\",\n        { class: \"text-ink-gray-6 font-medium\" },\n        `${count - 1} others`\n      ),\n      h(\"span\", { class: \"text-ink-gray-5\" }, \" are typing\"),\n    ]);\n  }\n});\n\nonBeforeUnmount(() => {\n  cleanup();\n});\n</script>\n\n<style scoped>\n.typing-dots {\n  display: inline-flex;\n  gap: 2px;\n  align-items: center;\n}\n\n.typing-dots span {\n  height: 4px;\n  width: 4px;\n  background-color: #6b7280;\n  border-radius: 50%;\n  animation: typing 1.4s infinite ease-in-out;\n}\n\n.typing-dots span:nth-child(1) {\n  animation-delay: -0.32s;\n}\n\n.typing-dots span:nth-child(2) {\n  animation-delay: -0.16s;\n}\n\n@keyframes typing {\n  0%,\n  80%,\n  100% {\n    transform: scale(0);\n    opacity: 0.5;\n  }\n  40% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n</style>\n"],"names":["props","__props","show","_useModel","searchInput","ref","emit","__emit","search","templates","createListResource","onMounted","onUnmounted","showEmailBox","filteredTemplates","computed","_a","template","watch","value","nextTick","_b","_createBlock","_component_Dialog","$event","_createVNode","_component_TextInput","_component_FeatherIcon","_openBlock","_createElementBlock","_hoisted_1","_Fragment","_renderList","_createElementVNode","_hoisted_3","_toDisplayString","_unref","TextEditor","_hoisted_4","_cache","_hoisted_5","_component_Button","$router","_sfc_render","_ctx","updateOnboardingStep","useOnboarding","agentsList","useAgentStore","isManager","useAuthStore","newComment","useStorage","onUserType","cleanup","useTyping","attachments","commentEmpty","isContentEmpty","loading","newValue","oldValue","onBeforeUnmount","label","agents","agent","removeAttachment","attachment","a","removeAttachmentFromServer","submitComment","createResource","editorRef","editor","__expose","getFontFamily","PreserveVideoControls","file","uploadFunction","_hoisted_2","AttachmentItem","_withModifiers","TextEditorFixedMenu","textEditorMenuButtons","FileUploader","f","_withCtx","openFileSelector","AttachmentIcon","content","isMac","useDevice","isMobileView","useScreenSize","emailEditorRef","commentTextEditorRef","emailBoxRef","commentBoxRef","toggleEmailBox","showCommentBox","toggleCommentBox","submitEmail","splitIfString","str","replyToEmail","data","_c","useShortcut","onClickOutside","EmailIcon","CommentIcon","TypingIndicator","EmailEditor","CommentTextEditor","showCannedResponseSelectorModal","sendMail","newEmail","emailEmpty","toEmailsClone","ccEmailsClone","bccEmailsClone","showCC","showBCC","cc","bcc","ccInput","bccInput","applyCannedResponse","x","resetState","submitMail","toast","toggleCC","toggleBCC","addToReply","body","toEmails","ccEmails","bccEmails","handleDiscard","MultiSelectInput","validateEmail","_normalizeClass","_hoisted_6","CannedResponseSelectorModal","values","emails","error","query","text","showOptions","selectedValue","val","addValue","watchDebounced","reload","filterOptions","full_name","email_id","name","options","searchedContacts","removeValue","v","removeLastValue","emailRef","setFocus","Combobox","Popover","togglePopover","ComboboxInput","e","isOpen","ComboboxOptions","option","ComboboxOption","active","UserAvatar","_component_ErrorMessage","typingUsers","typingMessage","count","getUser","useUserStore","firstUser","h","_resolveDynamicComponent"],"mappings":"s9CAoEA,MAAMA,EAAQC,EAORC,EAAOC,gBAAY,EACnBC,EAAcC,EAAI,EAAE,EAEpBC,EAAOC,EAEPC,EAASH,EAAI,EAAE,EAEfI,EAAYC,GAAmB,CACnC,KAAM,OACN,QAAS,qBACT,MAAO,CAAC,kBAAmBV,EAAM,OAAO,EACxC,OAAQ,CAAC,QAAS,UAAW,UAAU,EACvC,QAAS,gBACT,WAAY,KACd,CAAC,EAEDW,GAAU,IAAM,CACVF,EAAU,MAAQ,MACpBA,EAAU,MAAK,CAEnB,CAAC,EACDG,GAAY,IAAM,CAChBC,EAAa,MAAQ,EACvB,CAAC,EAED,MAAMC,EAAoBC,EAAS,IAAM,OACvC,QACEC,EAAAP,EAAU,OAAV,YAAAO,EAAgB,OAAQC,GACfA,EAAS,MAAM,YAAa,EAAC,SAAST,EAAO,MAAM,YAAW,CAAE,KACnE,CAAC,CAEX,CAAC,EAED,OAAAU,EAAMhB,EAAOiB,GAAUA,GAASC,EAAS,aAAM,OAAAC,GAAAL,EAAAZ,EAAY,QAAZ,YAAAY,EAAmB,KAAnB,YAAAK,EAAuB,QAAO,CAAC,2FA3G5EC,EA2DSC,EAAA,YA1DErB,EAAI,2CAAJA,EAAI,MAAAsB,GACZ,QAAS,oCAGT,IAEU,iBACT,IASY,CATZC,EASYC,EAAA,SARN,cAAJ,IAAItB,aACKI,EAAM,2CAANA,EAAM,MAAAgB,GACf,KAAK,OACJ,YAAa,cAEH,SACT,IAA2D,CAA3DC,EAA2DE,EAAA,CAA9C,KAAK,SAAS,MAAM,mDAI7Bb,EAAA,MAAkB,QAD1Bc,IAAAC,EAqBM,MArBNC,GAqBM,QAjBJD,EAgBME,EAAA,KAAAC,EAfelB,EAAiB,MAA7BG,QADTY,EAgBM,MAAA,CAdH,IAAKZ,EAAS,KACf,MAAM,kFACL,QAAKO,GAAElB,EAAI,QAAUW,CAAQ,IAE9BgB,EAEM,MAFNC,GACKC,GAAAlB,EAAS,KAAK,EAAA,CAAA,EAGXA,EAAS,aADjBK,EAMEc,EAAAC,EAAA,EAAA,OAJC,QAASpB,EAAS,QAClB,SAAU,GACX,eAAa,iEACb,MAAM,2EAIZW,IAAAC,EAMM,MANNS,GAMM,CAAA,GAAAC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CALJN,EAIM,MAAA,CAJD,MAAM,gDAAgD,EAAA,CACzDA,EAEM,MAFD,CAAA,MAAM,uBAAuB,KAC7B,oBAAoB,CAAA,YAI7BA,EAUM,MAVNO,GAUM,CATJf,EAQEgB,EAAA,CAPA,MAAM,sBACL,QAAKF,EAAA,CAAA,IAAAA,EAAA,CAAA,OAAqCG,EAAAA,QAAQ,KAAI,uBAAA,EAAyCN,EAAA3B,CAAA,EAAU,KAAI,6CCjDpHqB,GAAU,CACV,WACA,YACA,QAAW,YACX,gDALF,SAAAa,GAAAC,EAAAL,EAAA,QAYIX,EAAA,EAAAC,EAAA,MAAAC,GAAA,CAAA,GAAAS,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CAJAN,EAAmB,OAAA,CACnB,YAAU,UACV,YAA6mC,UAC7mC,EAAA,guDCgHN,KAAM,CAAE,qBAAAY,CAAA,EAAyBC,GAAc,UAAU,EACnD,CAAE,OAAQC,CAAW,EAAIC,GAAc,EACvC,CAAE,UAAAC,GAAcC,KAEtBvC,GAAU,IAAM,OAEZoC,EAAW,UACX/B,EAAA+B,EAAW,OAAX,MAAA/B,EAAiB,QACjB+B,EAAW,KAAK,SAIlBA,EAAW,MAAM,CAAA,CAClB,EAED,MAAM/C,EAAQC,EAuBRK,EAAOC,EAEP4C,EAAaC,GAAW,oBAAsBpD,EAAM,SAAU,IAAI,EAGlE,CAAE,WAAAqD,EAAY,QAAAC,CAAA,EAAYC,GAAUvD,EAAM,QAAQ,EAElDwD,EAAcnD,EAAI,CAAA,CAAE,EACpBoD,EAAe1C,EAAS,IACrB2C,GAAeP,EAAW,KAAK,CACvC,EACKQ,EAAUtD,EAAI,EAAK,EAGnBa,EAAAiC,EAAY,CAACS,EAAUC,IAAa,CACpCD,IAAaC,GAAYD,GAChBP,GACb,CACD,EAEDS,GAAgB,IAAM,CACZR,GAAA,CACT,EAEK,MAAAS,EAAQhD,EAAS,IACd4C,EAAQ,MAAQ,aAAe3D,EAAM,KAC7C,EAEKgE,EAASjD,EAAS,IAAM,OAC5B,QACEC,EAAA+B,EAAW,OAAX,YAAA/B,EAAiB,IAAKiD,IAAW,CAC/B,MAAOA,EAAM,WAAW,QAAQ,EAChC,MAAOA,EAAM,IAAA,MACR,CAAA,CAAC,CAEX,EAED,SAASC,EAAiBC,EAAY,CACpCX,EAAY,MAAQA,EAAY,MAAM,OAAQY,GAAMA,IAAMD,CAAU,EACpEE,GAA2BF,EAAW,IAAI,CAC5C,CAEA,eAAeG,GAAgB,CACzB,GAAAZ,GAAeP,EAAW,KAAK,EAC1B,MAAA,GAEOoB,GAAe,CAC7B,IAAK,iBACL,WAAY,KAAO,CACjB,GAAIvE,EAAM,QACV,GAAIA,EAAM,SACV,OAAQ,cACR,KAAM,CACJ,QAASmD,EAAW,MACpB,YAAaK,EAAY,KAC3B,CAAA,GAEF,UAAW,IAAM,CACXP,GACFJ,EAAqB,mBAAmB,EAE1CvC,EAAK,QAAQ,EACbqD,EAAQ,MAAQ,GAChBH,EAAY,MAAQ,GACpBL,EAAW,MAAQ,IACrB,EACA,QAAS,IAAM,CACbQ,EAAQ,MAAQ,EAClB,CAAA,CACD,EAEO,OAAO,CACjB,CAEM,MAAAa,EAAYnE,EAAI,IAAI,EACpBoE,EAAS1D,EAAS,IAAA,OAAM,OAAAC,EAAAwD,EAAU,QAAV,YAAAxD,EAAiB,OAAM,EAExC,OAAA0D,EAAA,CACX,cAAAJ,EACA,OAAAG,CAAA,CACD,iDAhPS,OAAArC,EAAAW,CAAA,EAAW,UADnBzB,EAgGac,EAAAC,EAAA,EAAA,eA9FP,YAAJ,IAAImC,EACH,eAAY,uBAAuCvE,EAAQ,0FAAmGmC,EAAAuC,EAAA,EAAcvC,EAAUe,CAAA,CAAA,GAMtL,QAASf,EAAUe,CAAA,EACnB,qBAAoB,CAAwC,QAAA,CAAA,OAAA,CAAA,EAAA,EAAA,EAAA,EAAA,CAAA,EAAA,EAC5D,YAAalD,EAAW,YACxB,SAAUA,EAAQ,SAClB,SAAU+D,EAAM,MAChB,SAAQzB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAf,GAAAvB,EAAA,SAAYkD,EAAA,MAAa3B,EAAM,MACvC,YAAaY,EAAqBwC,EAAA,CAAA,EAClC,eAAiBC,GAAWzC,EAAA0C,EAAA,EAAeD,EAAM5E,EAAO,QAAEA,EAAQ,QAAA,CAAA,GAExD,SACT,IA2EM,CA3EKA,EAAQ,UAAnB2B,EAAA,EAAAC,EA2EM,MA3ENC,GA2EM,CAzEJG,EAeM,MAfN8C,GAeM,QAdJlD,EAaiBE,EAAA,KAAAC,EAZHwB,EAAW,MAAhBY,QADT9C,EAaiBc,EAAA4C,EAAA,EAAA,CAXd,IAAKZ,EAAE,SACP,MAAOA,EAAE,UACT,IAAG,CAAA,MAAA,KAAA,EAAkB,SAASA,EAAE,SAAS,EAAc,KAAVA,EAAE,QAAQ,GAE7C,SACT,IAIE,CAJF3C,EAIEE,EAAA,CAHA,MAAM,QACN,KAAK,IACJ,QAAKsD,EAAAzD,GAAO0C,EAAiBE,CAAC,EAAA,CAAA,MAAA,CAAA,8DAMvCnC,EAuDM,MAvDNC,GAuDM,CAtDJD,EA4BM,MA5BNK,GA4BM,CA3BJb,EAGEW,EAAA8C,EAAA,EAAA,CAFA,MAAM,QACL,QAAS9C,EAAqB+C,EAAA,uBAEjC1D,EAsBeW,EAAAgD,EAAA,EAAA,CArBZ,cAAW,SAA6BnF,EAAO,gBAA2BA,EAAQ,qBAKlF,sBAAUoF,GAAM7B,QAAY,KAAK6B,CAAC,EAAA,GAExB,QAAOC,EAChB,CAWS,CAZW,iBAAAC,KAAgB,CACpC9D,EAWSgB,EAAA,CAVP,MAAM,OACN,QAAQ,QACP,WAAO8C,EAAgB,CAAA,GAEb,OACT,IAGE,CAHF9D,EAGEW,EAAAoD,EAAA,EAAA,CAFA,MAAM,MACN,MAAA,CAAoD,MAAA,UAAA,eAAA,gBAAA,CAAA,qDAOhEvD,EAwBM,MAxBNO,GAwBM,CAvBJf,EASEgB,EAAA,CARA,MAAM,UACL,QAAKF,EAAA,CAAA,IAAAA,EAAA,CAAA,OAA6CY,EAAU,MAAA,GAAyBK,EAAW,MAAA,GAAyBlD,EAAI,SAAA,CAAA,KAQhImB,EAYEgB,EAAA,CAXA,QAAQ,QACP,MAAOsB,EAAK,MACZ,SAAUN,EAAY,MACtB,QAASE,EAAO,MAChB,QAAKpB,EAAA,CAAA,IAAAA,EAAA,CAAA,OAA6CoB,EAAO,MAAA,GAAwCW,IAAsBnB,EAAU,MAAA,EAAA,6uBCqBhJ,MAAM7C,EAAOC,EACPkF,EAAUtF,EAAYF,EAAA,SAAS,EAC/B,CAAE,MAAAyF,GAAUC,KACZ,CAAE,aAAAC,GAAiBC,KACf1F,EAAWF,EAAA,YAAC,EAEhB,MAAA6F,EAAiBzF,EAAI,IAAI,EACzB0F,EAAuB1F,EAAI,IAAI,EAC/B2F,EAAc3F,EAAI,IAAI,EACtB4F,EAAgB5F,EAAI,IAAI,EAE9B,SAAS6F,GAAiB,CACpBC,EAAe,QACjBA,EAAe,MAAQ,IAEZtF,EAAA,MAAQ,CAACA,EAAa,KACrC,CAEA,SAASuF,GAAmB,CACtBvF,EAAa,QACfA,EAAa,MAAQ,IAERsF,EAAA,MAAQ,CAACA,EAAe,KACzC,CAEA,SAASE,GAAc,CACjBP,EAAe,MAAM,cACvBxF,EAAK,QAAQ,CAEjB,CAEA,SAASgE,GAAgB,CACnByB,EAAqB,MAAM,iBAC7BzF,EAAK,QAAQ,CAEjB,CAEA,SAASgG,EAAcC,EAAwB,CACzC,OAAA,OAAOA,GAAQ,SACVA,EAAI,MAAM,GAAG,EAEfA,CACT,CAEA,SAASC,EAAaC,EAAc,CAClC5F,EAAa,MAAQ,GAErBiF,EAAe,MAAM,WACnBW,EAAK,QACLH,EAAcG,EAAK,EAAE,EACrBH,EAAcG,EAAK,EAAE,EACrBH,EAAcG,EAAK,GAAG,CAAA,CAE1B,CAyBA,OAAAvF,EACE,IAAML,EAAa,MAClBM,GAAU,WACLA,KACauF,GAAArF,GAAAL,EAAA8E,EAAA,QAAA,YAAA9E,EAAO,SAAP,YAAAK,EAAe,WAAf,MAAAqF,EAAyB,QAE5C,CAAA,EAGFxF,EACE,IAAMiF,EAAe,MACpBhF,GAAU,WACLA,KACmBuF,GAAArF,GAAAL,EAAA+E,EAAA,QAAA,YAAA/E,EAAO,SAAP,YAAAK,EAAe,WAAf,MAAAqF,EAAyB,QAElD,CAAA,EAGFC,GAAY,IAAK,IAAM,CACNT,GAAA,CAChB,EACDS,GAAY,IAAK,IAAM,CACJP,GAAA,CAClB,EAEY1B,EAAA,CACX,aAAA8B,EACA,eAAAN,EACA,iBAAAE,EACA,OAAQN,CAAA,CACT,EAEDc,GACEZ,EACA,IAAM,CACAnF,EAAa,QACfA,EAAa,MAAQ,GAEzB,EACA,CACE,OAAQ,CAAC,aAAc,gBAAgB,CACzC,CAAA,EAGF+F,GACEX,EACA,IAAM,CACAE,EAAe,QACjBA,EAAe,MAAQ,GAE3B,EACA,CACE,OAAQ,CAAC,aAAc,gBAAgB,CACzC,CAAA,8BA5OA,OAAAvE,EAAA,EAAAC,EA4FM,MA5FNC,GA4FM,CA3FJG,EA2BM,MA3BN8C,GA2BM,CAxBJ9C,EAuBM,MAvBNC,GAuBM,CAtBJT,EAUSgB,EAAA,CATP,IAAI,eACJ,QAAQ,QACR,MAAM,QACL,SAAQL,EAAYvB,CAAA,EAAA,kCAAA,EAAA,CAAA,EACpB,uBAAOqF,IAAc,GAEX,SACT,IAAyB,CAAzBzE,EAAyBW,EAAAyE,EAAA,EAAA,CAAd,MAAM,MAAK,CAAA,qBAG1BpF,EASSgB,EAAA,CARP,QAAQ,QACR,MAAM,UACL,SAAQL,EAAc+D,CAAA,EAAA,kCAAA,EAAA,CAAA,EACtB,uBAAOC,IAAgB,GAEb,SACT,IAA2B,CAA3B3E,EAA2BW,EAAA0E,EAAA,EAAA,CAAd,MAAM,MAAK,CAAA,qBAG5BrF,EAAwCW,EAAA2E,EAAA,EAAA,CAAtB,SAAU9G,EAAQ,QAAA,EAAA,KAAA,EAAA,CAAA,UAAA,CAAA,CAAA,QAGxCgC,EA8BM,MAAA,SA7BA,cAAJ,IAAI+D,EAEJ,MAAM,4CAC4BK,EAAW,CAAA,OAAA,MAAA,CAAA,EAAA,CAAA,OAAA,CAAA,MACXA,EAAW,CAAA,OAAA,MAAA,CAAA,EAAA,CAAA,OAAA,CAAA,KAE7C5E,EAsBEW,EAAA4E,EAAA,EAAA,SArBI,iBAAJ,IAAIlB,EACH,MAAkB1D,EAAAwD,CAAA,SAAwBxD,EAAKsD,CAAA,EAAA,eAAA,kBAGxC,QAASD,EAAO,wCAAPA,EAAO,MAAAjE,GACxB,YAAY,2CACX,SAAUvB,EAAQ,SAClB,YAAWA,EAAQ,SACnB,YAAWA,EAAQ,SACnB,aAAYA,EAAS,UACrB,SAAMsC,EAAA,CAAA,IAAAA,EAAA,CAAA,OAAiC1B,EAAY,MAAA,GAAsBP,EAAI,QAAA,CAAA,GAM7E,UAAOiC,EAAA,CAAA,IAAAA,EAAA,CAAA,OAAiC1B,EAAY,MAAA,EAAA,6FAtB/CuB,EAAYvB,CAAA,CAAA,CAAA,MA6BtBoB,EA+BM,MAAA,SA9BA,gBAAJ,IAAIgE,wBAE8B3B,EAAa,CAAA,OAAA,MAAA,CAAA,EAAA,CAAA,OAAA,CAAA,MACbA,EAAa,CAAA,OAAA,MAAA,CAAA,EAAA,CAAA,OAAA,CAAA,KAE/C7C,EAwBEW,EAAA6E,EAAA,EAAA,SAvBI,uBAAJ,IAAIlB,EACH,MAAkB3D,EAAYwD,CAAA,YAAuCxD,EAAKsD,CAAA,yCAO1E,SAAUzF,EAAQ,SAClB,SAAUmC,EAAc+D,CAAA,EACxB,QAASlG,EAAO,QACjB,YAAY,yCACX,SAAMsC,EAAA,CAAA,IAAAA,EAAA,CAAA,OAAiC4D,EAAc,MAAA,GAAsB7F,EAAI,QAAA,CAAA,GAM/E,UAAOiC,EAAA,CAAA,IAAAA,EAAA,CAAA,OAAiC4D,EAAc,MAAA,EAAA,mEAvBjD/D,EAAc+D,CAAA,CAAA,CAAA,6tBC+HtB,MAAA3B,EAAYnE,EAAI,IAAI,EACpB6G,EAAkC7G,EAAI,EAAK,EAE3CL,EAAQC,EAmCR8D,EAAQhD,EAAS,IACdoG,EAAS,QAAU,aAAenH,EAAM,KAChD,EAEKM,EAAOC,EAEP6G,EAAWhE,GAAW,kBAAoBpD,EAAM,SAAU,IAAI,EAC9D,CAAE,qBAAA6C,CAAA,EAAyBC,GAAc,UAAU,EACnD,CAAE,UAAAG,GAAcC,KAGhB,CAAE,WAAAG,EAAY,QAAAC,CAAA,EAAYC,GAAUvD,EAAM,QAAQ,EAElDwD,EAAcnD,EAAI,CAAA,CAAE,EACpBgH,EAAatG,EAAS,IACnB2C,GAAe0D,EAAS,KAAK,CACrC,EAGKlG,EAAAkG,EAAU,CAACxD,EAAUC,IAAa,CAClCD,IAAaC,GAAYD,GAChBP,GACb,CACD,EAEDS,GAAgB,IAAM,CACZR,GAAA,CACT,EAED,MAAMgE,EAAgBjH,EAAI,CAAC,GAAGL,EAAM,QAAQ,CAAC,EACvCuH,EAAgBlH,EAAI,CAAC,GAAGL,EAAM,QAAQ,CAAC,EACvCwH,EAAiBnH,EAAI,CAAC,GAAGL,EAAM,SAAS,CAAC,EACzCyH,EAASpH,EAAI,EAAK,EAClBqH,EAAUrH,EAAI,EAAK,EACnBsH,EAAK5G,EAAS,WAAO,UAAAC,EAAAuG,EAAc,QAAd,MAAAvG,EAAqB,QAAsB,EAChE4G,EAAM7G,EAAS,WAAO,UAAAC,EAAAwG,EAAe,QAAf,MAAAxG,EAAsB,QAAsB,EAClE6G,EAAUxH,EAAI,IAAI,EAClByH,EAAWzH,EAAI,IAAI,EAEzB,SAAS0H,EAAoB9G,EAAU,CACrCmG,EAAS,MAAQnG,EAAS,QAC1BiG,EAAgC,MAAQ,EAC1C,CAEA,MAAMC,EAAW5C,GAAe,CAC9B,IAAK,iBACL,WAAY,IAAO,SAAA,OACjB,GAAIvE,EAAM,QACV,GAAIA,EAAM,SACV,OAAQ,kBACR,KAAM,CACJ,YAAawD,EAAY,MAAM,IAAKwE,GAAMA,EAAE,IAAI,EAChD,GAAIV,EAAc,MAAM,KAAK,GAAG,EAChC,IAAItG,EAAAuG,EAAc,QAAd,YAAAvG,EAAqB,KAAK,KAC9B,KAAKK,EAAAmG,EAAe,QAAf,YAAAnG,EAAsB,KAAK,KAChC,QAAS+F,EAAS,KACpB,CAAA,GAEF,UAAW,IAAM,CACJa,KACX3H,EAAK,QAAQ,EAET2C,GACFJ,EAAqB,iBAAiB,CAE1C,EACA,SAAU,GAAA,CACX,EAED,SAASqF,IAAa,CAChB,GAAAxE,GAAe0D,EAAS,KAAK,EACxB,MAAA,GAEL,GAAA,CAACE,EAAc,MAAM,OACjB,OAAAa,GAAA,QACJ,mFAAA,EAEK,GAGThB,EAAS,OAAO,CAClB,CAEA,SAASiB,IAAW,CACXX,EAAA,MAAQ,CAACA,EAAO,MAEhBA,EAAA,OACLrG,EAAS,IAAM,CACbyG,EAAQ,MAAM,UAAS,CACxB,CACL,CAEA,SAASQ,IAAY,CACXX,EAAA,MAAQ,CAACA,EAAQ,MACjBA,EAAA,OACNtG,EAAS,IAAM,CACb0G,EAAS,MAAM,UAAS,CACzB,CACL,CAEA,eAAe5D,GAAiBC,EAAY,CAC1CX,EAAY,MAAQA,EAAY,MAAM,OAAQY,GAAMA,IAAMD,CAAU,EAC9D,MAAAE,GAA2BF,EAAW,IAAI,CAClD,CAEA,SAASmE,GACPC,EACAC,EACAC,EACAC,GACA,CACApB,EAAc,MAAQkB,EACtBjB,EAAc,MAAQkB,EACtBjB,EAAe,MAAQkB,GACblE,EAAA,MAAM,OACb,MACA,EAAA,eACA,cAAc+D,CAAI,EAClB,MAAM,KAAK,EACX,gBACA,gBAAgB,EAAG,CAAE,KAAM,YAAa,EACxC,MAAM,OAAO,EACb,KACL,CAEA,SAASN,IAAa,CACpBb,EAAS,MAAQ,KACjB5D,EAAY,MAAQ,EACtB,CAEA,SAASmF,IAAgB,CACvBnF,EAAY,MAAQ,GACpB4D,EAAS,MAAQ,KAEjBG,EAAc,MAAQ,GACtBC,EAAe,MAAQ,GACvBD,EAAc,MAAQ,GACtBE,EAAO,MAAQ,GACfC,EAAQ,MAAQ,GAEhBpH,EAAK,SAAS,CAChB,CAEM,MAAAmE,GAAS1D,EAAS,IACfyD,EAAU,MAAM,MACxB,EAEY,OAAAE,EAAA,CACX,WAAA4D,GACA,OAAA7D,GACA,WAAAyD,EAAA,CACD,uEA1XCzG,EAsJaW,EAAAC,EAAA,EAAA,SArJP,YAAJ,IAAImC,EACH,eAAY,sEAA6FpC,EAAAuC,EAAA,EAAcvC,EAAQgF,CAAA,CAAA,EAASnH,EAAQ,UAAA,iCAMhJ,QAASmC,EAAQgF,CAAA,EACjB,qBAAoB,CAAwC,QAAA,CAAA,OAAA,CAAA,EAAA,EAAA,EAAA,EAAA,CAAA,EAAA,EAC5D,YAAanH,EAAW,YACxB,SAAUA,EAAQ,SAClB,SAAQsC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAf,GAAAvB,EAAA,SAAYmH,EAAA,MAAW5F,EAAM,MACrC,YAAaY,EAAqBwC,EAAA,CAAA,EAClC,eAAiBC,GAAWzC,EAAA0C,EAAA,EAAeD,EAAM5E,EAAO,QAAEA,EAAQ,QAAA,CAAA,GAExD,MACT,IAkBM,CAlBNgC,EAkBM,MAlBNH,GAkBM,CAjBJS,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAN,EAA8C,OAAxC,CAAA,MAAM,yBAAwB,MAAG,EAAA,GACvCR,EAKEW,EAAAwG,EAAA,EAAA,YAJStB,EAAa,2CAAbA,EAAa,MAAA9F,GACtB,MAAM,SACL,SAAUY,EAAayG,EAAA,EACvB,gBAAgB1H,GAAK,GAAQA,CAAK,8BAAA,oDAErCM,EAIEgB,EAAA,CAHC,MAAO,KACP,SAAQkF,EAAE,MAAA,gCAAA,EAAA,CAAA,EACV,uBAAOS,yBAEV3G,EAIEgB,EAAA,CAHC,MAAO,MACP,SAAQmF,EAAG,MAAA,gCAAA,EAAA,CAAA,EACX,uBAAOS,2BAIJZ,EAAA,OAAUE,EAAE,WADpB9F,EAaM,MAAA,OAXJ,MAAMiH,EAAA,CAAA,uCACEnB,EAAA,OAAMF,EAAM,MAAA,WAAA,EAAA,CAAA,CAAA,GAEpBlF,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAN,EAA8C,OAAxC,CAAA,MAAM,yBAAwB,MAAG,EAAA,GACvCR,EAMEW,EAAAwG,EAAA,EAAA,SALI,UAAJ,IAAIf,aACKN,EAAa,2CAAbA,EAAa,MAAA/F,GACtB,MAAM,SACL,SAAUY,EAAayG,EAAA,EACvB,gBAAgB1H,GAAK,GAAQA,CAAK,8BAAA,kEAI/BuG,EAAA,OAAWE,EAAG,WADtB/F,EAaM,MAAA,OAXJ,MAAMiH,EAAA,CAAA,uCACElB,EAAA,OAAOF,EAAO,MAAA,WAAA,EAAA,CAAA,CAAA,GAEtBnF,EAAA,EAAA,IAAAA,EAAA,EAAA,EAAAN,EAA+C,OAAzC,CAAA,MAAM,yBAAwB,OAAI,EAAA,GACxCR,EAMEW,EAAAwG,EAAA,EAAA,SALI,WAAJ,IAAId,aACKN,EAAc,2CAAdA,EAAc,MAAAhG,GACvB,MAAM,SACL,SAAUY,EAAayG,EAAA,EACvB,gBAAgB1H,GAAK,GAAQA,CAAK,8BAAA,oEAU9B,SAET,IAeM,CAfNc,EAeM,MAfN8C,GAeM,QAdJlD,EAaiBE,EAAA,KAAAC,EAZHwB,EAAW,MAAhBY,QADT9C,EAaiBc,EAAA4C,EAAA,EAAA,CAXd,IAAKZ,EAAE,SACP,MAAOA,EAAE,UACT,IAAG,CAAA,MAAA,KAAA,EAAkB,SAASA,EAAE,SAAS,EAAc,KAAVA,EAAE,QAAQ,GAE7C,SACT,IAIE,CAJF3C,EAIEE,GAAA,CAHA,MAAM,QACN,KAAK,IACJ,QAAKsD,EAAAzD,IAAY0C,GAAiBE,CAAC,EAAA,CAAA,OAAA,MAAA,CAAA,8DAM5CnC,EA0DM,MA1DNC,GA0DM,CAvDJD,EAsCM,MAtCNK,GAsCM,CArCJL,EAmCM,MAnCNO,GAmCM,CAlCJf,EAsBeW,EAAAgD,EAAA,EAAA,CArBZ,cAAW,SAA6BnF,EAAO,gBAA2BA,EAAQ,qBAKlF,UAAOsC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAoB8C,GAAC,CAAoC7B,EAAA,MAAC,KAAK6B,CAAC,CAAA,KAM7D,QAAOC,EAChB,CAOS,CARW,iBAAAC,KAAgB,CACpC9D,EAOSgB,EAAA,CAPD,QAAQ,QAAS,YAAO8C,EAAgB,CAAA,GACnC,OACT,IAGE,CAHF9D,EAGEW,EAAAoD,EAAA,EAAA,CAFA,MAAM,MACN,MAAA,CAAoD,MAAA,UAAA,eAAA,gBAAA,CAAA,mDAM9D/D,EAUSgB,EAAA,CATP,QAAQ,QACP,uBAAOyE,EAA+B,MAAA,GAAA,GAE5B,OACT,IAGE,CAHFzF,EAGEW,EAAAyE,EAAA,EAAA,CAFA,MAAM,MACN,MAAA,CAAyC,MAAA,UAAA,eAAA,KAAA,CAAA,aAKjDpF,EAAqEW,EAAA8C,EAAA,EAAA,CAAhD,MAAM,OAAQ,QAAS9C,EAAqB+C,EAAA,yBAEnElD,EAeM,MAfN8G,GAeM,CAZJtH,EAAiDgB,EAAA,CAAzC,MAAM,UAAW,QAAOkG,EAAA,GAChClH,EAUEgB,EAAA,CATA,QAAQ,QACP,SAAU4E,EAAU,MACpB,QAASjF,EAAQ+E,CAAA,EAAC,QAClB,MAAOpD,EAAK,MACZ,QAAKxB,EAAA,CAAA,IAAAA,EAAA,CAAA,OAAmD2F,IAAA,2IAW3DhB,EAA+B,WADvC5F,EAKEc,EAAA4G,EAAA,EAAA,kBAHS9B,EAA+B,2CAA/BA,EAA+B,MAAA1F,GACvC,QAASvB,EAAO,QAChB,QAAO8H,CAAA,2gBCzDZ,MAAM/H,EAAQC,EAWRgJ,EAAS9I,gBAAY,EAErB+I,EAAS7I,EAAI,CAAA,CAAE,EACfG,EAASH,EAAI,IAAI,EACjB8I,EAAQ9I,EAAI,IAAI,EAChB+I,EAAQ/I,EAAI,EAAE,EACdgJ,EAAOhJ,EAAI,EAAE,EACbiJ,EAAcjJ,EAAI,EAAK,EAEvBkJ,EAAgBxI,EAAS,CAC7B,IAAK,IAAMqI,EAAM,OAAS,GAC1B,IAAMI,GAAQ,CACZJ,EAAM,MAAQ,GACVI,IACFF,EAAY,MAAQ,IAEjBE,GAAA,MAAAA,EAAA,OAASC,EAASD,EAAI,KAAK,CAClC,CAAA,CACD,EAEDE,GACEN,EACCI,GAAQ,CACPA,EAAMA,GAAO,GACTH,EAAK,QAAUG,IACnBH,EAAK,MAAQG,EACbG,EAAOH,CAAG,EACZ,EACA,CAAE,SAAU,IAAK,UAAW,EAAK,CAAA,EAGnC,MAAMI,EAAgBrF,GAAe,CACnC,IAAK,uCACL,OAAQ,MACR,MAAO,CAAC,UAAW8E,EAAK,KAAK,EAC7B,OAAQ,CACN,IAAKA,EAAK,KACZ,EACA,UAAY5C,GACHA,EAAK,IAAI,CAAC,CAAE,UAAAoD,EAAW,SAAAC,EAAU,KAAAC,MAAY,CAClD,MAAOF,GAAaE,GAAQD,EAC5B,MAAOA,CACP,EAAA,CACJ,CACD,EAEKE,EAAUjJ,EAAS,IAAM,CACzB,IAAAkJ,EAAmBL,EAAc,MAAQ,GAC7C,MAAI,CAACK,EAAiB,QAAUb,EAAM,OACpCa,EAAiB,KAAK,CACpB,MAAOb,EAAM,MACb,MAAOA,EAAM,KAAA,CACd,EAEIa,CAAA,CACR,EAED,SAASN,EAAOH,EAAK,CACnBI,EAAc,OAAO,CACnB,OAAQ,CACN,IAAKJ,CACP,CAAA,CACD,EACDI,EAAc,OAAO,CACvB,CAEM,MAAAH,EAAYtI,GAAU,CAC1BgI,EAAM,MAAQ,KACVhI,IACkBA,EAAM,MAAM,GAAG,EACvB,QAASA,GAAU,OAE7B,GADAA,EAAQA,EAAM,OACVA,GAEE,GAACH,EAAAiI,EAAO,QAAP,MAAAjI,EAAc,SAASG,IAAQ,CAElC,GAAIA,GAASnB,EAAM,UAAY,CAACA,EAAM,SAASmB,CAAK,EAAG,CAC/CgI,EAAA,MAAQnJ,EAAM,aAAamB,CAAK,EACtC,MACF,CAEK8H,EAAO,MAGHA,EAAA,MAAM,KAAK9H,CAAK,EAFhB8H,EAAA,MAAQ,CAAC9H,CAAK,EAIvBA,EAAQA,EAAM,QAAQA,EAAO,EAAE,CACjC,CACF,CACD,EACA,CAAAgI,EAAM,QAAUhI,EAAQ,IAC3B,EAGI+I,EAAe/I,GAAU,CAC7B8H,EAAO,MAAQA,EAAO,MAAM,OAAQkB,GAAMA,IAAMhJ,CAAK,CAAA,EAGjDiJ,EAAkB,IAAM,OAC5B,GAAIhB,EAAM,MAAO,OAEjB,IAAIiB,GAAWrJ,EAAAkI,EAAO,MAAMA,EAAO,MAAM,OAAS,CAAC,IAApC,YAAAlI,EAAuC,IAClD,SAAS,gBAAkBqJ,GAC7BpB,EAAO,MAAM,MACb7H,EAAS,IAAM,CACT6H,EAAO,MAAM,QACfoB,EAAWnB,EAAO,MAAMA,EAAO,MAAM,OAAS,CAAC,EAAE,IACjDmB,GAAA,MAAAA,EAAU,SAEDC,GACX,CACD,GAEDD,GAAA,MAAAA,EAAU,OACZ,EAGF,SAASC,GAAW,CACX9J,EAAA,MAAM,IAAI,OACnB,CAEa,OAAAkE,EAAA,CAAE,SAAA4F,EAAU,gFAtOvBzI,EAmFM,MAAA,KAAA,CAlFJI,EAgFM,MAhFNH,GAgFM,QA/EJD,EAiBSE,EAAA,KAAAC,EAhBSiH,EAAM,MAAf9H,QADTG,EAiBSmB,EAAA,oBAfH,SAAJ,IAAIyG,EACH,IAAK/H,EACL,MAAOA,EACR,MAAM,OACN,QAAQ,SACR,MAAM,oCACwBiJ,EAAe,CAAA,MAAA,CAAA,EAAA,CAAA,QAAA,CAAA,CAAA,GAElC,SACT,IAIE,CAJF3I,EAIEE,EAAA,CAHA,MAAM,QACN,KAAK,IACJ,QAAKsD,EAAAzD,GAAO0I,EAAY/I,CAAK,EAAA,CAAA,MAAA,CAAA,yEAIpCc,EA4DM,MA5DN8C,GA4DM,CA3DJtD,EA0DWW,EAAAmI,EAAA,EAAA,YA1DQhB,EAAa,2CAAbA,EAAa,MAAA/H,GAAE,SAAA,EAAA,aAChC,IAwDU,CAxDVC,EAwDUW,EAAAoI,EAAA,EAAA,CAxDO,KAAMlB,EAAW,qCAAXA,EAAW,MAAA9H,GAAE,MAAM,QAAA,GAC7B,OAAM8D,EACf,CAcE,CAfiB,cAAAmF,KAAa,CAChChJ,EAcEW,EAAAsI,EAAA,EAAA,SAbI,SAAJ,IAAIlK,EACJ,MAAM,gIACN,KAAK,OACJ,MAAO4I,EAAK,MACb,aAAa,MACZ,SAAM7G,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAsBoI,GAAC,CAA2BvB,EAAA,MAAQuB,EAAE,OAAO,MAA2BrB,EAAW,MAAA,EAAA,GAM/G,YAAamB,EAAa,uBACGL,EAAe,CAAA,MAAA,CAAA,EAAA,CAAA,QAAA,CAAA,CAAA,mDAGtC,KAAI9E,EACb,CAmCM,CApCW,OAAAsF,KAAM,IACvB3I,EAmCM,MAAA,KAAA,CAlCJA,EAiCM,MAjCNC,GAiCM,CAhCJT,EA+BkBW,EAAAyI,EAAA,EAAA,CA9BhB,MAAM,4CACN,OAAA,EAAA,aAGE,IAAyB,QAD3BhJ,EA0BiBE,EAAA,KAAAC,EAzBEgI,EAAO,MAAjBc,QADTxJ,EA0BiBc,EAAA2I,EAAA,EAAA,CAxBd,IAAKD,EAAO,MAEZ,MAAOA,CAAA,GAER,QAAAxF,EAAA,CAmBK,CAtBK,OAAA0F,KAAM,CAGhB/I,EAmBK,KAAA,CAlBF,MAAK6G,EAAA,+EAAyIkC,CAAM,CAAA,KAKrJvJ,EAIEW,EAAA6I,EAAA,EAAA,CAHA,MAAM,OACL,KAAMH,EAAO,MACd,KAAK,uBAEP7I,EAOM,MAPNK,GAOM,CANJL,EAEM,MAFNO,GACKL,GAAA2I,EAAO,KAAK,EAAA,CAAA,EAEjB7I,EAEM,MAFN8G,GACK5G,GAAA2I,EAAO,KAAK,EAAA,CAAA,CAAA,2DA5BhBF,CAAM,CAAA,mDAyCTzB,EAAK,WAAzB7H,EAAgE4J,EAAA,OAArC,MAAM,YAAa,QAAS/B,EAAK,KAAA,mPC9DhE,MAAMnJ,EAAQC,EAOR,CAAE,YAAAkL,EAAa,QAAA7H,CAAA,EAAYC,GAAUvD,EAAM,QAAQ,EAEnDoL,EAAgBrK,EAAS,IAAM,SACnC,MAAMsK,EAAQF,EAAY,OAC1B,GAAIE,IAAU,EAAU,OAAA,KAClB,KAAA,CAAE,QAAAC,GAAYC,KAChB,IAAAC,IAAYxK,EAAAsK,EAAQH,EAAY,CAAC,CAAC,IAAtB,YAAAnK,EAAyB,YAAamK,EAAY,CAAC,EAInE,OAHA,QAAQ,IAAIK,CAAS,EACrB,QAAQ,IAAIL,CAAW,EAEnBE,IAAU,EACLI,EAAE,MAAO,CAAE,MAAO,2BAA6B,CACpDA,EAAER,GAAY,CAAE,KAAME,EAAY,CAAC,EAAG,KAAM,KAAM,EAClDM,EAAE,OAAQ,CAAE,MAAO,6BAAA,EAAiCD,CAAS,EAC7DC,EAAE,OAAQ,CAAE,MAAO,iBAAA,EAAqB,YAAY,CAAA,CACrD,EACQJ,IAAU,EACZI,EAAE,MAAO,CAAE,MAAO,2BAA6B,CACpDA,EAAE,OAAQ,CAAE,MAAO,6BAAA,EAAiCD,CAAS,EAC7DC,EAAE,OAAQ,CAAE,MAAO,iBAAA,EAAqB,OAAO,EAC/CA,EACE,OACA,CAAE,MAAO,6BAA8B,GACvCpK,EAAAiK,EAAQH,EAAY,CAAC,CAAC,IAAtB,YAAA9J,EAAyB,SAC3B,EACAoK,EAAE,OAAQ,CAAE,MAAO,iBAAA,EAAqB,aAAa,CAAA,CACtD,EAEMA,EAAE,MAAO,CAAE,MAAO,2BAA6B,CACpDA,EAAE,OAAQ,CAAE,MAAO,6BAAA,EAAiCD,CAAS,EAC7DC,EAAE,OAAQ,CAAE,MAAO,iBAAA,EAAqB,OAAO,EAC/CA,EACE,OACA,CAAE,MAAO,6BAA8B,EACvC,GAAGJ,EAAQ,CAAC,SACd,EACAI,EAAE,OAAQ,CAAE,MAAO,iBAAA,EAAqB,aAAa,CAAA,CACtD,CACH,CACD,EAED,OAAA3H,GAAgB,IAAM,CACZR,GAAA,CACT,SAtEYlB,EAAA+I,CAAA,EAAY,OAAM,GAA7BvJ,IAAAC,EAWM,MAXNC,GAWM,CAVJG,EASM,MATN8C,GASM,CARJ9C,EAOM,MAPNC,GAOM,EANJN,EAAA,EAAAN,EAAiCoK,GAAjBN,EAAa,KAAA,CAAA,eAC7BnJ,EAIM,MAAA,CAJD,MAAM,eAAa,CACtBA,EAAa,MAAA,EACbA,EAAa,MAAA,EACbA,EAAa,MAAA,CAAA"}