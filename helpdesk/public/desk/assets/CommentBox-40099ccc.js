import{d as j,a as z,U as H,c as O,A as r,W as q,S as f,N as G,r as k,e as m,k as u,l as t,g as s,h as e,v as C,w as v,aI as L,a3 as P,a6 as W,y as w,ah as Z,aZ as J,b6 as K,F as D,G as Q,f as X,I as Y,aO as ee}from"./index-b4c863a6.js";import{_ as te}from"./AttachmentItem.vue_vue_type_script_setup_true_lang-b54cd9d5.js";import"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js";import"./dayjs-95f8111d.js";import{c as oe}from"./knowledgeBase-2d00b929.js";import{_ as ae}from"./Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js";import{D as se}from"./Dropdown-f79f7542.js";import{_ as ne}from"./file-to-base64-e61fad39.js";import"./popper-0aa08b12.js";import"./chevron-left-d60af664.js";import"./chevron-right-cd59273c.js";import"./plus-3c348a65.js";const le={class:"mb-1 ml-0.5 flex items-center justify-between"},ie={class:"text-gray-600 flex items-center gap-2"},re={class:"font-medium text-gray-800"},me={class:"flex items-center gap-1"},ce={class:"pl-0.5 text-sm text-gray-600"},ue={key:0},de=["id"],pe={class:"flex flex-row-reverse gap-2"},fe={key:0,class:"flex flex-wrap gap-2"},Se=j({__name:"CommentBox",props:{activity:{type:Object,required:!0}},emits:["update"],setup(B,{emit:S}){const F=z(),R=B,{getUser:T}=H(),{name:d,creation:_,content:c,commenter:x,commentedBy:b,attachments:V}=R.activity,E=O(()=>/has been merged with ticket #\d+/.test(c)),g=S,i=r(!1),o=r(!1),n=r(c),y=r(null),h=r(null);function A(){o.value=!0,h.value.editor.chain().focus("start")}function M(){n.value=c,o.value=!1}const N=q({url:"frappe.client.delete",makeParams:()=>({doctype:"HD Ticket Comment",name:d}),onSuccess(){g("update"),i.value=!1,f.success("Comment deleted")}});function U(){if(c===n.value){o.value=!1;return}if(ee(n.value)){f.error("Comment cannot be empty");return}oe.submit({doctype:"HD Ticket Comment",name:d,fieldname:"content",value:n.value},{onSuccess:()=>{o.value=!1,g("update"),f.success("Comment updated")}})}return G(()=>{y.value.style.width="0px"}),($,a)=>{const I=k("Tooltip"),p=k("Button");return m(),u(D,null,[t("div",{class:"flex-col text-base flex-1",ref_key:"commentBoxRef",ref:y},[t("div",le,[t("div",ie,[s(e(ae),{size:"md",label:e(x),image:e(T)(e(b)).user_image},null,8,["label","image"]),t("p",null,[t("span",re,C(e(x)),1),a[2]||(a[2]=t("span",null," added a",-1)),a[3]||(a[3]=t("span",{class:"max-w-xs truncate font-medium text-gray-800"}," comment ",-1))])]),t("div",me,[s(I,{text:e(P)(e(_),e(W))},{default:v(()=>[t("span",ce,C(e(L)(e(_))),1)]),_:1},8,["text"]),e(F).userId===e(b)&&!o.value?(m(),u("div",ue,[s(e(se),{placement:"right",options:[{label:"Edit",onClick:()=>A(),icon:"edit-2",condition:()=>!E.value},{label:"Delete",onClick:()=>i.value=!0,icon:"trash-2"}]},{default:v(()=>[s(p,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:1},8,["options"])])):w("",!0)])]),t("div",{id:`comment-${e(d)}`,class:"rounded bg-gray-50 transition-colors px-4 py-3"},[s(e(ne),{ref_key:"editorRef",ref:h,"editor-class":["prose-f shrink text-p-sm transition-all duration-300 ease-in-out block w-full content",e(J)(n.value)],content:n.value,editable:o.value,"bubble-menu":e(K),onChange:a[0]||(a[0]=l=>{n.value=l})},Z({_:2},[o.value?{name:"bottom",fn:v(()=>[t("div",pe,[s(p,{label:"Save",onClick:U,variant:"solid"}),s(p,{label:"Discard",onClick:M})])]),key:"0"}:void 0]),1032,["editor-class","content","editable","bubble-menu"]),o.value?w("",!0):(m(),u("div",fe,[(m(!0),u(D,null,Q(e(V),l=>(m(),X(e(te),{key:l.file_url,label:l.file_name,url:l.file_url},null,8,["label","url"]))),128))]))],8,de)],512),s(e(Y),{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=l=>i.value=l),options:{title:"Delete Comment",message:"Are you sure you want to confirm this action?",actions:[{label:"Cancel",onClick:()=>i.value=!1},{label:"Delete",onClick:()=>e(N).submit(),variant:"solid"}]}},null,8,["modelValue","options"])],64)}}});export{Se as default};
//# sourceMappingURL=CommentBox-40099ccc.js.map
