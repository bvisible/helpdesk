import{d as O,z as T,J as D,av as Et,aw as it,c as V,ax as ye,a7 as Re,M as ne,a3 as J,ai as Mt,ay as H,az as _e,aA as At,F as q,aB as rt,a5 as qe,$ as W,aC as Ft,aD as et,aE as Ie,aF as ee,aG as we,aH as Dt,aI as Pt,aJ as ce,aK as te,ap as se,e as u,f as S,w as C,k as h,E as Q,h as e,B as xe,ab as Ce,l as n,a8 as Z,v as Be,x as P,s as Le,t as B,m as le,n as oe,g as v,C as tt,D as lt,Y as ut,r as R,a as Ve,S as He,V as re,P as me,aL as fe,a2 as ie,a6 as be,ak as jt,aM as Ze,aN as Ke,H as Ge,aO as he,j as ae,aP as Rt,aQ as ct,au as We,y as Y,aR as dt,aS as mt,b as ft,aT as at,aq as Oe,ar as Ue,aU as de,Z as Je,aV as De,N as Ot,aW as Ut,G as Nt,aX as zt,aY as qt,aZ as Ht,a_ as Zt,a$ as Kt,b0 as Gt,L as pt,K as $e,q as vt,u as gt,Q as Wt,b1 as Jt,a9 as nt,af as st,b2 as Yt}from"./index-3194ec9b.js";import{s as K,a as yt,h as Ye,P as xt,i as Qt,f as G,b as ot,T as Xt,L as bt,t as Ne,j as ze}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-a9d0f8af.js";import"./dayjs-f66c5460.js";import{u as el}from"./LayoutHeader-3eb7ac7a.js";import{F as ht}from"./FileUploader-0835fb8b.js";import{_ as Ee,T as _t}from"./TextEditor.vue_vue_type_script_setup_true_lang-7cb9f49e.js";import{_ as Me}from"./AttachmentItem.vue_vue_type_script_setup_true_lang-858a5224.js";import{_ as Ae}from"./EmailIcon-159a6309.js";import{_ as Ct}from"./UserAvatar.vue_vue_type_script_setup_true_lang-95965310.js";import{_ as Qe}from"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";import{_ as tl,a as ll}from"./MultipleAvatar.vue_vue_type_script_setup_true_lang-7025dfbf.js";import{C as al,D as nl,s as sl,a as ol,b as il,_ as kt}from"./CallLogModal.vue_vue_type_script_setup_true_lang-9a8921a1.js";import{P as wt}from"./PhoneIcon-e1a2cab8.js";import{u as $t}from"./telephony-1c011c0c.js";import{D as Te}from"./Dropdown-c7dd9c29.js";import{_ as rl}from"./EmailContent-81cb3391.js";import{_ as ul}from"./StarRating.vue_vue_type_script_setup_true_lang-0c43ad36.js";import{D as cl,_ as dl}from"./DateTimePicker-8cacf145.js";import{_ as Pe}from"./Autocomplete-4c667766.js";import{a as ml}from"./Link-431cfb69.js";let fl=O({props:{onFocus:{type:Function,required:!0}},setup(t){let i=T(!0);return()=>i.value?D(it,{as:"button",type:"button",features:Et.Focusable,onFocus(f){f.preventDefault();let r,p=50;function c(){var s;if(p--<=0){r&&cancelAnimationFrame(r);return}if((s=t.onFocus)!=null&&s.call(t)){i.value=!1,cancelAnimationFrame(r);return}r=requestAnimationFrame(c)}r=requestAnimationFrame(c)}}):null}});var pl=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(pl||{}),vl=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(vl||{});let It=Symbol("TabsContext");function ke(t){let i=W(It,null);if(i===null){let f=new Error(`<${t} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(f,ke),f}return i}let Xe=Symbol("TabsSSRContext"),gl=O({name:"TabGroup",emits:{change:t=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(t,{slots:i,attrs:f,emit:r}){var p;let c=T((p=t.selectedIndex)!=null?p:t.defaultIndex),s=T([]),d=T([]),m=V(()=>t.selectedIndex!==null),b=V(()=>m.value?t.selectedIndex:c.value);function l(g){var I;let L=ye(a.tabs.value,H),o=ye(a.panels.value,H),x=L.filter(y=>{var _;return!((_=H(y))!=null&&_.hasAttribute("disabled"))});if(g<0||g>L.length-1){let y=Ie(c.value===null?0:Math.sign(g-c.value),{[-1]:()=>1,0:()=>Ie(Math.sign(g),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0}),_=Ie(y,{0:()=>L.indexOf(x[0]),1:()=>L.indexOf(x[x.length-1])});_!==-1&&(c.value=_),a.tabs.value=L,a.panels.value=o}else{let y=L.slice(0,g),_=[...L.slice(g),...y].find(E=>x.includes(E));if(!_)return;let j=(I=L.indexOf(_))!=null?I:a.selectedIndex.value;j===-1&&(j=a.selectedIndex.value),c.value=j,a.tabs.value=L,a.panels.value=o}}let a={selectedIndex:V(()=>{var g,I;return(I=(g=c.value)!=null?g:t.defaultIndex)!=null?I:null}),orientation:V(()=>t.vertical?"vertical":"horizontal"),activation:V(()=>t.manual?"manual":"auto"),tabs:s,panels:d,setSelectedIndex(g){b.value!==g&&r("change",g),m.value||l(g)},registerTab(g){var I;if(s.value.includes(g))return;let L=s.value[c.value];if(s.value.push(g),s.value=ye(s.value,H),!m.value){let o=(I=s.value.indexOf(L))!=null?I:c.value;o!==-1&&(c.value=o)}},unregisterTab(g){let I=s.value.indexOf(g);I!==-1&&s.value.splice(I,1)},registerPanel(g){d.value.includes(g)||(d.value.push(g),d.value=ye(d.value,H))},unregisterPanel(g){let I=d.value.indexOf(g);I!==-1&&d.value.splice(I,1)}};Re(It,a);let k=T({tabs:[],panels:[]}),w=T(!1);ne(()=>{w.value=!0}),Re(Xe,V(()=>w.value?null:k.value));let $=V(()=>t.selectedIndex);return ne(()=>{J([$],()=>{var g;return l((g=t.selectedIndex)!=null?g:t.defaultIndex)},{immediate:!0})}),Mt(()=>{if(!m.value||b.value==null||a.tabs.value.length<=0)return;let g=ye(a.tabs.value,H);g.some((I,L)=>H(a.tabs.value[L])!==H(I))&&a.setSelectedIndex(g.findIndex(I=>H(I)===H(a.tabs.value[b.value])))}),()=>{let g={selectedIndex:c.value};return D(q,[s.value.length<=0&&D(fl,{onFocus:()=>{for(let I of s.value){let L=H(I);if((L==null?void 0:L.tabIndex)===0)return L.focus(),!0}return!1}}),_e({theirProps:{...f,...At(t,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:g,slots:i,attrs:f,name:"TabGroup"})])}}}),yl=O({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(t,{attrs:i,slots:f}){let r=ke("TabList");return()=>{let p={selectedIndex:r.selectedIndex.value},c={role:"tablist","aria-orientation":r.orientation.value};return _e({ourProps:c,theirProps:t,slot:p,attrs:i,slots:f,name:"TabList"})}}}),xl=O({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(t,{attrs:i,slots:f,expose:r}){var p;let c=(p=t.id)!=null?p:`headlessui-tabs-tab-${rt()}`,s=ke("Tab"),d=T(null);r({el:d,$el:d}),ne(()=>s.registerTab(d)),qe(()=>s.unregisterTab(d));let m=W(Xe),b=V(()=>{if(m.value){let o=m.value.tabs.indexOf(c);return o===-1?m.value.tabs.push(c)-1:o}return-1}),l=V(()=>{let o=s.tabs.value.indexOf(d);return o===-1?b.value:o}),a=V(()=>l.value===s.selectedIndex.value);function k(o){var x;let y=o();if(y===we.Success&&s.activation.value==="auto"){let _=(x=Pt(d))==null?void 0:x.activeElement,j=s.tabs.value.findIndex(E=>H(E)===_);j!==-1&&s.setSelectedIndex(j)}return y}function w(o){let x=s.tabs.value.map(y=>H(y)).filter(Boolean);if(o.key===ee.Space||o.key===ee.Enter){o.preventDefault(),o.stopPropagation(),s.setSelectedIndex(l.value);return}switch(o.key){case ee.Home:case ee.PageUp:return o.preventDefault(),o.stopPropagation(),k(()=>ce(x,te.First));case ee.End:case ee.PageDown:return o.preventDefault(),o.stopPropagation(),k(()=>ce(x,te.Last))}if(k(()=>Ie(s.orientation.value,{vertical(){return o.key===ee.ArrowUp?ce(x,te.Previous|te.WrapAround):o.key===ee.ArrowDown?ce(x,te.Next|te.WrapAround):we.Error},horizontal(){return o.key===ee.ArrowLeft?ce(x,te.Previous|te.WrapAround):o.key===ee.ArrowRight?ce(x,te.Next|te.WrapAround):we.Error}}))===we.Success)return o.preventDefault()}let $=T(!1);function g(){var o;$.value||($.value=!0,!t.disabled&&((o=H(d))==null||o.focus({preventScroll:!0}),s.setSelectedIndex(l.value),Dt(()=>{$.value=!1})))}function I(o){o.preventDefault()}let L=Ft(V(()=>({as:t.as,type:i.type})),d);return()=>{var o,x;let y={selected:a.value,disabled:(o=t.disabled)!=null?o:!1},{..._}=t,j={ref:d,onKeydown:w,onMousedown:I,onClick:g,id:c,role:"tab",type:L.value,"aria-controls":(x=H(s.panels.value[l.value]))==null?void 0:x.id,"aria-selected":a.value,tabIndex:a.value?0:-1,disabled:t.disabled?!0:void 0};return _e({ourProps:j,theirProps:_,slot:y,attrs:i,slots:f,name:"Tab"})}}}),bl=O({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(t,{slots:i,attrs:f}){let r=ke("TabPanels");return()=>{let p={selectedIndex:r.selectedIndex.value};return _e({theirProps:t,ourProps:{},slot:p,attrs:f,slots:i,name:"TabPanels"})}}}),hl=O({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null},tabIndex:{type:Number,default:0}},setup(t,{attrs:i,slots:f,expose:r}){var p;let c=(p=t.id)!=null?p:`headlessui-tabs-panel-${rt()}`,s=ke("TabPanel"),d=T(null);r({el:d,$el:d}),ne(()=>s.registerPanel(d)),qe(()=>s.unregisterPanel(d));let m=W(Xe),b=V(()=>{if(m.value){let k=m.value.panels.indexOf(c);return k===-1?m.value.panels.push(c)-1:k}return-1}),l=V(()=>{let k=s.panels.value.indexOf(d);return k===-1?b.value:k}),a=V(()=>l.value===s.selectedIndex.value);return()=>{var k;let w={selected:a.value},{tabIndex:$,...g}=t,I={ref:d,id:c,role:"tabpanel","aria-labelledby":(k=H(s.tabs.value[l.value]))==null?void 0:k.id,tabIndex:a.value?$:-1};return!a.value&&t.unmount&&!t.static?D(it,{as:"span","aria-hidden":!0,...I}):_e({ourProps:I,theirProps:g,slot:w,attrs:i,slots:f,features:et.Static|et.RenderStrategy,visible:a.value,name:"TabPanel"})}}});const _l={__name:"TabList",setup(t){const i=W("tab"),f=T([]),r=T(null),p=V(()=>{var d;return(d=i.value.tabs.value)==null?void 0:d.length}),c=T("");function s(d){d>=p.value&&(d=p.value-1);const m=f.value[d].el;i.value.vertical.value?(r.value.style.height=`${m.offsetHeight}px`,r.value.style.top=`${m.offsetTop}px`):(r.value.style.width=`${m.offsetWidth}px`,r.value.style.left=`${m.offsetLeft}px`)}return J(()=>i.value.tabIndex.value,d=>{d>=p.value&&(i.value.tabIndex.value=p.value-1),c.value="transition-all duration-300 ease-in-out",se(()=>s(d))}),ne(()=>{se(()=>s(i.value.tabIndex.value)),setTimeout(()=>s(i.value.tabIndex.value),100)}),(d,m)=>(u(),S(e(yl),{class:Z(["relative flex",e(i).vertical?"flex-col border-r overflow-y-auto":"gap-7.5 border-b overflow-x-auto items-center px-5"])},{default:C(()=>[(u(!0),h(q,null,Q(e(i).tabs,(b,l)=>(u(),S(e(xl),{ref_for:!0,ref_key:"tabRef",ref:f,as:"template",key:l,class:"focus:outline-none focus:transition-none"},{default:C(({selected:a})=>[xe(d.$slots,"default",Ce({ref_for:!0},{tab:b,selected:a}),()=>[n("button",{class:Z(["flex items-center gap-1.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9",[a?"text-ink-gray-9":"",e(i).vertical?"py-2.5 px-4 border-r border-transparent hover:border-outline-gray-3":"py-3 border-b border-transparent hover:border-outline-gray-3"]])},[b.icon?(u(),S(Be(b.icon),{key:0,class:"size-4"})):P("",!0),Le(" "+B(b.label),1)],2)])]),_:2},1024))),128)),n("div",{ref_key:"indicator",ref:r,class:Z(["tab-indicator absolute bg-surface-gray-7",[e(i).vertical?"right-0 w-px":"bottom-0 h-px",c.value]])},null,2)]),_:3},8,["class"]))}},Cl={__name:"TabPanel",setup(t){const i=W("tab");return(f,r)=>(u(),S(e(bl),{class:"flex flex-1 overflow-hidden"},{default:C(()=>[(u(!0),h(q,null,Q(e(i).tabs,(p,c)=>(u(),S(e(hl),{class:"flex flex-1 flex-col overflow-y-auto focus:outline-none",key:c},{default:C(()=>[xe(f.$slots,"default",Ce({ref_for:!0},{tab:p}))]),_:2},1024))),128))]),_:3}))}},xs={__name:"Tabs",props:le({as:{type:String,default:"template"},tabs:{type:Array,required:!0},vertical:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const i=t,f=oe(t,"modelValue");return Re("tab",V(()=>({tabIndex:f,tabs:i.tabs,vertical:i.vertical}))),(r,p)=>(u(),S(e(gl),Ce(t.as!=="template"?{as:t.as,class:["flex flex-1 overflow-hidden",t.vertical?"":"flex-col "]}:{},{defaultIndex:f.value,selectedIndex:f.value,onChange:p[0]||(p[0]=c=>f.value=c)}),{default:C(()=>[xe(r.$slots,"default",{},()=>[v(_l,null,{default:C(({tab:c,selected:s})=>[xe(r.$slots,"tab-item",tt(lt({tab:c,selected:s})))]),_:3}),v(Cl,null,{default:C(({tab:c})=>[xe(r.$slots,"tab-panel",tt(lt({tab:c})))]),_:3})])]),_:3},16,["defaultIndex","selectedIndex"]))}},kl={key:0,class:"mt-2 grid max-h-[560px] grid-cols-1 md:grid-cols-3 gap-2 overflow-y-auto"},wl=["onClick"],$l={class:"border-b pb-2 text-base font-semibold"},Il={key:1,class:"mt-2"},Ll={class:"flex justify-end mt-4"},Tl={__name:"CannedResponseSelectorModal",props:le({doctype:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:le(["apply"],["update:modelValue"]),setup(t,{emit:i}){const f=t,r=oe(t,"modelValue"),p=T(""),c=i,s=T(""),d=ut({type:"list",doctype:"HD Canned Response",cache:["cannedResponses",f.doctype],fields:["title","message","modified"],orderBy:"modified desc",pageLength:99999});ne(()=>{d.data==null&&d.fetch()}),qe(()=>{K.value=!0});const m=V(()=>{var b;return((b=d.data)==null?void 0:b.filter(l=>l.title.toLowerCase().includes(s.value.toLowerCase())))??[]});return J(r,b=>b&&se(()=>{var l,a;return(a=(l=p.value)==null?void 0:l.el)==null?void 0:a.focus()})),(b,l)=>{const a=R("FeatherIcon"),k=R("TextInput"),w=R("Button"),$=R("Dialog");return u(),S($,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=g=>r.value=g),options:{title:"Canned Responses",size:"4xl"}},{"body-content":C(()=>[v(k,{ref_key:"searchInput",ref:p,modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=g=>s.value=g),type:"text",placeholder:"Site Down"},{prefix:C(()=>[v(a,{name:"search",class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"]),m.value.length?(u(),h("div",kl,[(u(!0),h(q,null,Q(m.value,g=>(u(),h("div",{key:g.name,class:"flex h-56 cursor-pointer flex-col gap-2 rounded-lg border p-3 hover:bg-gray-100",onClick:I=>c("apply",g)},[n("div",$l,B(g.title),1),g.message?(u(),S(e(Ee),{key:0,content:g.message,editable:!1,"editor-class":"!prose-sm max-w-none !text-sm text-gray-600 focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):P("",!0)],8,wl))),128))])):(u(),h("div",Il,[...l[3]||(l[3]=[n("div",{class:"flex h-56 flex-col items-center justify-center"},[n("div",{class:"text-lg text-gray-500"},B("No templates found"))],-1)])])),n("div",Ll,[v(w,{label:"New Canned Response",onClick:l[1]||(l[1]=()=>{b.$router.push("/canned-responses#new"),e(d).data=null})})])]),_:1},8,["modelValue"])}}},Sl={class:"mb-1 ml-0.5 flex items-center justify-between"},Bl={class:"text-gray-600 flex items-center gap-2"},Vl={class:"font-medium text-gray-800"},El={class:"flex items-center gap-1"},Ml={class:"pl-0.5 text-sm text-gray-600"},Al={key:0},Fl=["id"],Dl={class:"flex flex-row-reverse gap-2"},Pl={key:0,class:"flex flex-wrap gap-2"},jl=O({__name:"CommentBox",props:{activity:{type:Object,required:!0}},emits:["update"],setup(t,{emit:i}){const f=Ve(),r=t,{getUser:p}=He(),{name:c,creation:s,content:d,commenter:m,commentedBy:b,attachments:l}=r.activity,a=V(()=>/has been merged with ticket #\d+/.test(d)),k=i,w=T(!1),$=T(!1),g=T(d),I=T(null),L=T(null);function o(){$.value=!0,L.value.editor.chain().focus("start")}function x(){g.value=d,$.value=!1}const y=re({url:"frappe.client.delete",makeParams:()=>({doctype:"HD Ticket Comment",name:c}),onSuccess(){k("update"),w.value=!1,me.success("Comment deleted")}});function _(){if(d===g.value){$.value=!1;return}if(he(g.value)){me.error("Comment cannot be empty");return}el.submit({doctype:"HD Ticket Comment",name:c,fieldname:"content",value:g.value},{onSuccess:()=>{$.value=!1,k("update"),me.success("Comment updated")}})}return ne(()=>{I.value.style.width="0px"}),(j,E)=>{const A=R("Tooltip"),z=R("Button");return u(),h(q,null,[n("div",{class:"flex-col text-base flex-1",ref_key:"commentBoxRef",ref:I},[n("div",Sl,[n("div",Bl,[v(e(Qe),{size:"md",label:e(m),image:e(p)(e(b)).user_image},null,8,["label","image"]),n("p",null,[n("span",Vl,B(e(m)),1),E[2]||(E[2]=n("span",null," added a",-1)),E[3]||(E[3]=n("span",{class:"max-w-xs truncate font-medium text-gray-800"}," comment ",-1))])]),n("div",El,[v(A,{text:e(ie)(e(s),e(be))},{default:C(()=>[n("span",Ml,B(e(fe)(e(s))),1)]),_:1},8,["text"]),e(f).userId===e(b)&&!$.value?(u(),h("div",Al,[v(e(Te),{placement:"right",options:[{label:"Edit",onClick:()=>o(),icon:"edit-2",condition:()=>!a.value},{label:"Delete",onClick:()=>w.value=!0,icon:"trash-2"}]},{default:C(()=>[v(z,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:1},8,["options"])])):P("",!0)])]),n("div",{id:`comment-${e(c)}`,class:"rounded bg-gray-50 transition-colors px-4 py-3"},[v(e(Ee),{ref_key:"editorRef",ref:L,"editor-class":["prose-f shrink text-p-sm transition-all duration-300 ease-in-out block w-full content",e(Ze)(g.value)],content:g.value,editable:$.value,"bubble-menu":e(Ke),onChange:E[0]||(E[0]=U=>{g.value=U})},jt({_:2},[$.value?{name:"bottom",fn:C(()=>[n("div",Dl,[v(z,{label:"Save",onClick:_,variant:"solid"}),v(z,{label:"Discard",onClick:x})])]),key:"0"}:void 0]),1032,["editor-class","content","editable","bubble-menu"]),$.value?P("",!0):(u(),h("div",Pl,[(u(!0),h(q,null,Q(e(l),U=>(u(),S(e(Me),{key:U.file_url,label:U.file_name,url:U.file_url},null,8,["label","url"]))),128))]))],8,Fl)],512),v(e(Ge),{modelValue:w.value,"onUpdate:modelValue":E[1]||(E[1]=U=>w.value=U),options:{title:"Delete Comment",message:"Are you sure you want to confirm this action?",actions:[{label:"Cancel",onClick:()=>w.value=!1},{label:"Delete",onClick:()=>e(y).submit(),variant:"solid"}]}},null,8,["modelValue","options"])],64)}}}),Rl={},Ol={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ul(t,i){return u(),h("svg",Ol,[...i[0]||(i[0]=[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.29021 2.64272C6.68375 0.785763 9.33429 0.785757 9.72783 2.64272L10.3657 5.65238L13.3753 6.29021C15.2323 6.68375 15.2323 9.33429 13.3753 9.72783L10.3657 10.3657L9.72783 13.3753C9.33429 15.2323 6.68375 15.2323 6.29021 13.3753L5.65238 10.3657L2.64272 9.72783C0.785763 9.33429 0.785757 6.68375 2.64272 6.29021L5.65238 5.65238L6.29021 2.64272ZM8.74956 2.85004C8.58 2.04999 7.43804 2.04998 7.26848 2.85004L6.56324 6.17777L6.49584 6.49583L6.17777 6.56324L2.85004 7.26848C2.04999 7.43804 2.04998 8.58 2.85004 8.74956L6.17777 9.4548L6.49584 9.5222L6.56324 9.84027L7.26848 13.168C7.43804 13.9681 8.58 13.9681 8.74956 13.168L9.4548 9.84027L9.5222 9.5222L9.84027 9.4548L13.168 8.74956C13.9681 8.58 13.9681 7.43804 13.168 7.26848L9.84027 6.56324L9.5222 6.49583L9.4548 6.17777L8.74956 2.85004Z",fill:"currentColor"},null,-1)])])}const Nl=ae(Rl,[["render",Ul]]),zl={},ql={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Hl(t,i){return u(),h("svg",ql,[...i[0]||(i[0]=[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12.5684 2.50774C11.5403 1.49742 9.95026 1.49742 8.92215 2.50774L3.62404 7.71417C2.12532 9.18695 2.12532 11.669 3.62404 13.1418C5.12762 14.6194 7.66861 14.6194 9.17219 13.1418L12.1609 10.2049C12.3578 10.0113 12.6744 10.0141 12.8679 10.211C13.0615 10.408 13.0587 10.7246 12.8618 10.9181L9.8731 13.8551C7.98045 15.715 4.81578 15.715 2.92313 13.8551C1.02562 11.9904 1.02562 8.86558 2.92313 7.00091L8.22124 1.79449C9.63842 0.401838 11.8521 0.401838 13.2693 1.79449C14.6914 3.19191 14.6914 5.38225 13.2693 6.77968L13.2668 6.78213L13.2668 6.78212L8.37876 11.5189C8.37834 11.5193 8.37793 11.5197 8.37752 11.5201C7.51767 12.3638 6.11144 12.3939 5.29119 11.5097C4.43611 10.6596 4.40778 9.26893 5.30922 8.46081L7.33823 6.46692C7.53518 6.27337 7.85175 6.27613 8.04531 6.47309C8.23886 6.67005 8.23609 6.98662 8.03913 7.18017L6.0014 9.18264L5.99203 9.19185L5.98219 9.20055C5.5391 9.59243 5.5104 10.3231 6.0014 10.8056L6.01078 10.8148L6.01967 10.8245C6.42299 11.2649 7.18224 11.2926 7.67785 10.8056L7.68034 10.8032L7.68035 10.8032L12.5684 6.06643C12.5688 6.06604 12.5692 6.06565 12.5696 6.06526C13.5917 5.05969 13.5913 3.51289 12.5684 2.50774Z",fill:"currentColor"},null,-1)])])}const Lt=ae(zl,[["render",Hl]]),Zl={},Kl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Gl(t,i){return u(),h("svg",Kl,[...i[0]||(i[0]=[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 2.5C4.2911 2.5 1.5 4.84419 1.5 7.5C1.5 9.14452 2.54729 10.6518 4.25112 11.5816C4.50048 11.7177 4.758 12.0041 4.7326 12.4082C4.71107 12.7508 4.61659 13.2533 4.47175 13.6657C4.44071 13.7541 4.40789 13.8389 4.37434 13.9195C4.62005 13.8524 4.91964 13.7411 5.26646 13.5579C5.48882 13.4404 5.69385 13.2901 5.9102 13.1207C5.95058 13.089 5.9922 13.056 6.03481 13.0222C6.20816 12.8848 6.39803 12.7342 6.58835 12.6102C6.7875 12.4803 7.01146 12.4447 7.20831 12.4631C7.46767 12.4875 7.73186 12.5 8 12.5C11.7089 12.5 14.5 10.1558 14.5 7.5C14.5 4.84419 11.7089 2.5 8 2.5ZM0.5 7.5C0.5 4.08068 3.97691 1.5 8 1.5C12.0231 1.5 15.5 4.08068 15.5 7.5C15.5 10.9193 12.0231 13.5 8 13.5C7.70158 13.5 7.40709 13.4861 7.11751 13.459C6.97583 13.5528 6.83777 13.6621 6.67569 13.7905C6.62832 13.828 6.5789 13.8671 6.52674 13.908C6.30071 14.085 6.03818 14.2812 5.73354 14.4421C4.73389 14.9702 3.9948 15.0302 3.62977 15.0147C3.39759 15.0048 3.20936 14.8646 3.12194 14.6754C3.03801 14.4938 3.05143 14.2816 3.15736 14.1099C3.24804 13.963 3.40655 13.6808 3.52825 13.3343C3.62961 13.0457 3.70134 12.6878 3.72712 12.4347C1.81521 11.3748 0.5 9.58517 0.5 7.5Z",fill:"currentColor"},null,-1)])])}const Se=ae(Zl,[["render",Gl]]),Wl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Jl=["r"],Yl={__name:"DotIcon",props:{radius:{type:Number,default:3.5}},setup(t){return(i,f)=>(u(),h("svg",Wl,[n("circle",{cx:"8",cy:"8",r:t.radius,fill:"currentColor"},null,8,Jl)]))}},Ql={},Xl={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ea(t,i){return u(),h("svg",Xl,[...i[0]||(i[0]=[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.85355 3.14645C5.65829 2.95118 5.34171 2.95118 5.14645 3.14645L1.14645 7.14645C0.951184 7.34171 0.951184 7.65829 1.14645 7.85355L5.14645 11.8536C5.34171 12.0488 5.65829 12.0488 5.85355 11.8536C6.04882 11.6583 6.04882 11.3417 5.85355 11.1464L2.20711 7.5L5.85355 3.85355C6.04882 3.65829 6.04882 3.34171 5.85355 3.14645ZM10 8C11.933 8 13.5 9.567 13.5 11.5V12C13.5 12.2761 13.7239 12.5 14 12.5C14.2761 12.5 14.5 12.2761 14.5 12V11.5C14.5 9.01472 12.4853 7 10 7H6.6728L9.81924 3.85355C10.0145 3.65829 10.0145 3.34171 9.81924 3.14645C9.62398 2.95118 9.3074 2.95118 9.11214 3.14645L5.11214 7.14645C4.91688 7.34171 4.91688 7.65829 5.11214 7.85355L9.11214 11.8536C9.3074 12.0488 9.62398 12.0488 9.81924 11.8536C10.0145 11.6583 10.0145 11.3417 9.81924 11.1464L6.6728 8H10Z",fill:"currentColor"},null,-1)])])}const ta=ae(Ql,[["render",ea]]),la={},aa={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function na(t,i){return u(),h("svg",aa,[...i[0]||(i[0]=[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.64645 3.14645C5.84171 2.95118 6.15829 2.95118 6.35355 3.14645C6.54882 3.34171 6.54882 3.65829 6.35355 3.85355L3.20711 7H10C12.4853 7 14.5 9.01472 14.5 11.5V12C14.5 12.2761 14.2761 12.5 14 12.5C13.7239 12.5 13.5 12.2761 13.5 12V11.5C13.5 9.567 11.933 8 10 8H3.20711L6.35355 11.1464C6.54882 11.3417 6.54882 11.6583 6.35355 11.8536C6.15829 12.0488 5.84171 12.0488 5.64645 11.8536L1.64645 7.85355C1.45118 7.65829 1.45118 7.34171 1.64645 7.14645L5.64645 3.14645Z",fill:"currentColor"},null,-1)])])}const sa=ae(la,[["render",na]]),oa={},ia={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ra(t,i){return u(),h("svg",ia,[...i[0]||(i[0]=[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.85355 9.64645C5.65829 9.45118 5.34171 9.45118 5.14645 9.64645C4.95118 9.84171 4.95118 10.1583 5.14645 10.3536L7.64645 12.8536C7.84171 13.0488 8.15829 13.0488 8.35355 12.8536L10.8536 10.3536C11.0488 10.1583 11.0488 9.84171 10.8536 9.64645C10.6583 9.45118 10.3417 9.45118 10.1464 9.64645L8 11.7929L5.85355 9.64645ZM5.85355 6.35355C5.65829 6.54882 5.34171 6.54882 5.14645 6.35355C4.95118 6.15829 4.95118 5.84171 5.14645 5.64645L7.64645 3.14645C7.84171 2.95118 8.15829 2.95118 8.35355 3.14645L10.8536 5.64645C11.0488 5.84171 11.0488 6.15829 10.8536 6.35355C10.6583 6.54882 10.3417 6.54882 10.1464 6.35355L8 4.20711L5.85355 6.35355Z",fill:"currentColor"},null,-1)])])}const ua=ae(oa,[["render",ra]]),ca=Rt("agent",()=>{const t=ut({doctype:"HD Agent",fields:["name","agent_name","user","user.user_image"],filters:{is_active:1},pageLength:99999}),i=V(()=>{var r;return(r=t.data)==null?void 0:r.map(p=>({label:p.agent_name,value:p.name}))});function f(r){return t.data.filter(p=>{var c;return(c=p.user)==null?void 0:c.toLowerCase().includes(r.toLowerCase())})}return{dropdown:i,agents:t,searchAgents:f}}),da={key:0,class:"flex flex-col gap-2 px-6 md:pl-10 md:pr-9"},ma={class:"flex flex-wrap gap-2"},fa={class:"flex justify-between overflow-hidden border-t py-2.5"},pa={class:"flex items-center overflow-x-auto w-[60%]"},va={class:"flex items-center justify-end space-x-2 w-[40%]"},ga=O({__name:"CommentTextEditor",props:{ticketId:{type:String,default:null},placeholder:{type:String,default:null},label:{type:String,default:"Comment"},editable:{type:Boolean,default:!0},doctype:{type:String,default:"HD Ticket"}},emits:["submit","discard"],setup(t,{expose:i,emit:f}){const{updateOnboardingStep:r}=yt("helpdesk"),{agents:p}=ca(),{isManager:c}=Ve();ne(()=>{var y;p.loading||(y=p.data)!=null&&y.length||p.list.promise||p.fetch()});const s=t,d=f,m=ct("commentBoxContent"+s.ticketId,null),{onUserType:b,cleanup:l}=Ye(s.ticketId),a=T([]),k=V(()=>he(m.value)),w=T(!1);J(m,(y,_)=>{y!==_&&y&&b()}),We(()=>{l()});const $=V(()=>w.value?"Sending...":s.label),g=V(()=>{var y;return((y=p.data)==null?void 0:y.map(_=>({label:_.agent_name.trimEnd(),value:_.name})))||[]});function I(y){a.value=a.value.filter(_=>_!==y),mt(y.name)}async function L(){if(he(m.value))return!1;re({url:"run_doc_method",makeParams:()=>({dt:s.doctype,dn:s.ticketId,method:"new_comment",args:{content:m.value,attachments:a.value}}),onSuccess:()=>{c&&r("comment_on_ticket"),d("submit"),w.value=!1,a.value=[],m.value=null},onError:()=>{w.value=!1}}).submit()}const o=T(null),x=V(()=>{var y;return(y=o.value)==null?void 0:y.editor});return i({submitComment:L,editor:x}),(y,_)=>{const j=R("FeatherIcon"),E=R("Button");return e(p).data?(u(),S(e(Ee),{key:0,ref_key:"editorRef",ref:o,"editor-class":["prose-sm max-w-none",t.editable&&"min-h-[7rem] mx-6 md:ml-10 md:mr-9 max-h-[50vh] overflow-y-auto border-t py-3",e(Ze)(e(m))],content:e(m),"starterkit-options":{heading:{levels:[2,3,4,5,6]}},placeholder:t.placeholder,editable:t.editable,mentions:g.value,onChange:_[3]||(_[3]=A=>t.editable?m.value=A:null),extensions:[e(xt)],uploadFunction:A=>e(dt)(A,t.doctype,t.ticketId)},{bottom:C(()=>[t.editable?(u(),h("div",da,[n("div",ma,[(u(!0),h(q,null,Q(a.value,A=>(u(),S(e(Me),{key:A.file_url,label:A.file_name,url:["MOV","MP4"].includes(A.file_type)?null:A.file_url},{suffix:C(()=>[v(j,{class:"h-3.5",name:"x",onClick:Y(z=>I(A),["stop"])},null,8,["onClick"])]),_:2},1032,["label","url"]))),128))]),n("div",fa,[n("div",pa,[v(e(_t),{class:"-ml-1",buttons:e(Ke)},null,8,["buttons"]),v(e(ht),{"upload-args":{doctype:t.doctype,docname:t.ticketId,private:!0},onSuccess:_[0]||(_[0]=A=>a.value.push(A))},{default:C(({openFileSelector:A})=>[v(E,{theme:"gray",variant:"ghost",onClick:z=>A()},{icon:C(()=>[v(e(Lt),{class:"h-4",style:{color:"#000000","stroke-width":"1.5 !important"}})]),_:1},8,["onClick"])]),_:1},8,["upload-args"])]),n("div",va,[v(E,{label:"Discard",onClick:_[1]||(_[1]=()=>{m.value="",a.value=[],d("discard")})}),v(E,{variant:"solid",label:$.value,disabled:k.value,loading:w.value,onClick:_[2]||(_[2]=()=>{w.value=!0,L(),m.value=""})},null,8,["label","disabled","loading"])])])])):P("",!0)]),_:1},8,["editor-class","content","placeholder","editable","mentions","extensions","uploadFunction"])):P("",!0)}}}),ya={class:"comm-area"},xa={class:"flex justify-between gap-3 border-t px-6 md:px-10 py-4 md:py-2.5"},ba={class:"flex gap-1.5 items-center"},ha=["onKeydownCapture"],_a=["onKeydownCapture"],bs=O({__name:"CommunicationArea",props:le({doctype:{type:String,default:"HD Ticket"},ticketId:{type:String,default:null},toEmails:{type:Array,default:()=>[]},ccEmails:{type:Array,default:()=>[]},bccEmails:{type:Array,default:()=>[]}},{content:{},contentModifiers:{},modelValue:{},modelModifiers:{}}),emits:le(["update"],["update:content","update:modelValue"]),setup(t,{expose:i,emit:f}){const r=f,p=oe(t,"content"),{isMac:c}=Qt(),{isMobileView:s}=ft();oe(t,"modelValue");const d=T(null),m=T(null),b=T(null),l=T(null);function a(){G.value&&(G.value=!1),K.value=!K.value}function k(){K.value&&(K.value=!1),G.value=!G.value}function w(){d.value.submitMail()&&r("update")}function $(){m.value.submitComment()&&r("update")}function g(L){return typeof L=="string"?L.split(","):L}function I(L){K.value=!0,d.value.addToReply(L.content,g(L.to),g(L.cc),g(L.bcc))}return J(()=>K.value,L=>{var o,x,y;L&&((y=(x=(o=d.value)==null?void 0:o.editor)==null?void 0:x.commands)==null||y.focus())}),J(()=>G.value,L=>{var o,x,y;L&&((y=(x=(o=m.value)==null?void 0:o.editor)==null?void 0:x.commands)==null||y.focus())}),ot("r",()=>{a()}),ot("c",()=>{k()}),i({replyToEmail:I,toggleEmailBox:a,toggleCommentBox:k,editor:d}),at(b,()=>{K.value&&(K.value=!1)}),at(l,()=>{G.value&&(G.value=!1)}),(L,o)=>{const x=R("Button");return u(),h("div",ya,[n("div",xa,[n("div",ba,[v(x,{ref:"sendEmailRef",variant:"ghost",label:"Reply",class:Z([e(K)?"!bg-gray-300 hover:!bg-gray-200":""]),onClick:o[0]||(o[0]=y=>a())},{prefix:C(()=>[v(e(Ae),{class:"h-4"})]),_:1},8,["class"]),v(x,{variant:"ghost",label:"Comment",class:Z([e(G)?"!bg-gray-300 hover:!bg-gray-200":""]),onClick:o[1]||(o[1]=y=>k())},{prefix:C(()=>[v(e(Se),{class:"h-4"})]),_:1},8,["class"]),v(e(hn),{ticketId:t.ticketId},null,8,["ticketId"])])]),Oe(n("div",{ref_key:"emailBoxRef",ref:b,class:"flex gap-1.5 flex-1",onKeydownCapture:[de(Y(w,["ctrl","stop"]),["enter"]),de(Y(w,["meta","stop"]),["enter"])]},[v(e(Ya),{ref_key:"emailEditorRef",ref:d,label:e(s)?"Send":e(c)?"Send (⌘ + ⏎)":"Send (Ctrl + ⏎)",content:p.value,"onUpdate:content":o[2]||(o[2]=y=>p.value=y),placeholder:"Hi John, we are looking into this issue.",ticketId:t.ticketId,"to-emails":t.toEmails,"cc-emails":t.ccEmails,"bcc-emails":t.bccEmails,onSubmit:o[3]||(o[3]=()=>{K.value=!1,r("update")}),onDiscard:o[4]||(o[4]=()=>{K.value=!1})},null,8,["label","content","ticketId","to-emails","cc-emails","bcc-emails"])],40,ha),[[Ue,e(K)]]),Oe(n("div",{ref_key:"commentBoxRef",ref:l,onKeydownCapture:[de(Y($,["ctrl","stop"]),["enter"]),de(Y($,["meta","stop"]),["enter"])]},[v(e(ga),{ref_key:"commentTextEditorRef",ref:m,label:e(s)?"Comment":e(c)?"Comment (⌘ + ⏎)":"Comment (Ctrl + ⏎)",ticketId:t.ticketId,editable:e(G),doctype:t.doctype,placeholder:"@John could you please look into this?",onSubmit:o[5]||(o[5]=()=>{G.value=!1,r("update")}),onDiscard:o[6]||(o[6]=()=>{G.value=!1})},null,8,["label","ticketId","editable","doctype"])],40,_a),[[Ue,e(G)]])])}}}),Ca={class:"flex flex-col gap-4"},ka={class:"flex items-center gap-2 rounded-md p-2 ring-1 ring-gray-200"},wa=O({__name:"TicketSplitModal",props:le({ticket_id:{},communication_id:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:le(["update"],["update:modelValue"]),setup(t,{emit:i}){const f=t,r=oe(t,"modelValue"),p=T(null),c=re({url:"helpdesk.helpdesk.doctype.hd_ticket.api.split_ticket",makeParams({subject:d,communication_id:m}){return{subject:d,communication_id:m}},validate({subject:d,communication_id:m}){if(!d)throw{message:"Subject is required"};if(!m)throw{message:"Communication ID is required"}},onSuccess:d=>{me.success("Ticket split successfully"),r.value=!1,window.open(window.location.origin+"/helpdesk/tickets/"+d,"_blank"),window.location.reload()}});function s(){c.submit({subject:p.value,communication_id:f.communication_id})}return(d,m)=>{const b=R("FormControl"),l=R("Button");return u(),S(e(Ge),{options:{title:"Split ticket"},modelValue:r.value,"onUpdate:modelValue":m[1]||(m[1]=a=>r.value=a)},{"body-content":C(()=>[n("div",Ca,[m[3]||(m[3]=n("p",{class:"text-p-base text-ink-gray-8"},[Le(" All "),n("span",{class:"underline"},"emails/ comments"),Le(" from this email onwards will be moved to new ticket. ")],-1)),v(b,{label:"New Ticket Subject",type:"text",modelValue:p.value,"onUpdate:modelValue":m[0]||(m[0]=a=>p.value=a),placeholder:"Add a subject for the new ticket"},null,8,["modelValue"]),n("div",ka,[v(e(Xt),{class:"h-6 w-5 w-min-5 w-max-5 min-h-5 max-w-5 text-yellow-500"}),m[2]||(m[2]=n("div",{class:"text-wrap text-sm text-gray-700"}," This action is irreversible. ",-1))])])]),actions:C(()=>[v(l,{class:"w-full",variant:"solid",label:"Split into new ticket",loading:e(c).loading,"icon-left":e(bt),onClick:s},null,8,["loading","icon-left"])]),_:1},8,["modelValue"])}}}),$a=["id"],Ia={key:0,class:"flex items-center gap-2 text-sm"},La={class:"leading-tight"},Ta={class:"text-xs md:text-sm text-gray-600"},Sa={key:0,class:"sm:flex hidden text-sm text-gray-600"},Ba={key:1,class:"flex items-center gap-1"},Va={key:0,class:"sm:flex hidden text-sm text-gray-600"},Ea={class:"flex gap-0.5 items-center"},Ma={class:"text-xs md:text-sm text-gray-600"},Aa={class:"text-sm leading-5 text-gray-600"},Fa={key:0,class:"text-2xs mr-1 font-bold text-gray-500"},Da={key:1},Pa={key:2},ja={key:3,class:"text-2xs mr-1 font-bold text-gray-500"},Ra={key:4},Oa={key:5},Ua={key:6,class:"text-2xs mr-1 font-bold text-gray-500"},Na={key:7},za={class:"flex flex-wrap gap-2"},qa=O({__name:"EmailArea",props:{activity:{type:Object,required:!0},showSplitOption:{type:Boolean,default:!1}},emits:["reply"],setup(t,{emit:i}){const f=t,{sender:r,to:p,cc:c,bcc:s,creation:d,subject:m,attachments:b,content:l,name:a,deliveryStatus:k}=f.activity,w=i,$=Je(Ve()),{isMobileView:g}=ft(),I=T(!1),L=V(()=>{let y=k,_="red";return["Sent","Clicked"].includes(y)?_="green":["Sending","Scheduled"].includes(y)?_="orange":["Opened","Read"].includes(y)?_="blue":y=="Error"&&(_="red"),{label:y,color:_}}),o=()=>{const y=$.user.value;w("reply",{content:l,to:y===r.name?p:r.name})},x=()=>{const y=$.user.value,_=ve=>{let ge;return typeof ve=="string"?ge=ve.split(",").map(ue=>ue.trim()):ge=ve||[],ge.filter(ue=>ue!==y&&ue!==r.name)},j=_(p),E=_(c),A=_(s);let z,U,pe;y===r.name?(z=j.join(", "),U=E,pe=A):(z=r.name,U=[...j,...E],pe=A),w("reply",{content:l,to:z,cc:U.filter(Boolean),bcc:pe.filter(Boolean)})};return(y,_)=>{const j=R("Tooltip"),E=R("Badge"),A=R("Button"),z=rl;return u(),h(q,null,[n("div",Ce({id:`communication-${e(a)}`},y.$attrs,{class:"grow cursor-pointer border-transparent bg-white rounded-md shadow text-base leading-6 transition-all duration-300 ease-in-out"}),[n("div",{class:Z(["flex items-center justify-between gap-2",e(g)&&"items-start"])},[e(g)?(u(),h("div",Ia,[n("div",La,[n("p",null,B(e(r).full_name||"No name found"),1),v(j,{text:e(ie)(e(d),e(be))},{default:C(()=>[n("p",Ta,B(e(fe)(e(d))),1)]),_:1},8,["text"]),e(r).name?(u(),h("p",Sa,B("<"+e(r).name+">"),1)):P("",!0)])])):(u(),h("div",Ba,[n("span",null,B(e(r).full_name||"No name found"),1),e(r).name?(u(),h("span",Va,B("<"+e(r).name+">"),1)):P("",!0)])),n("div",Ea,[L.value.label?(u(),S(E,{key:0,label:y.__(L.value.label),variant:"subtle",theme:L.value.color,class:"mr-1.5"},null,8,["label","theme"])):P("",!0),e(g)?P("",!0):(u(),S(j,{key:1,text:e(ie)(e(d),e(be))},{default:C(()=>[n("p",Ma,B(e(fe)(e(d))),1)]),_:1},8,["text"])),v(A,{variant:"ghost",class:"text-gray-700",onClick:o},{default:C(()=>[v(e(sa),{class:"h-4 w-4"})]),_:1}),v(A,{variant:"ghost",class:"text-gray-700",onClick:x},{default:C(()=>[v(e(ta),{class:"h-4 w-4"})]),_:1}),t.showSplitOption?(u(),S(e(Te),{key:2,placement:"right",options:[{label:"Split Ticket",icon:e(bt),onClick:()=>I.value=!0}]},{default:C(()=>[v(A,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:1},8,["options"])):P("",!0)])],2),n("div",Aa,[e(p)?(u(),h("span",Fa,"TO:")):P("",!0),e(p)?(u(),h("span",Da,B(e(p)),1)):P("",!0),e(c)?(u(),h("span",Pa,", ")):P("",!0),e(c)?(u(),h("span",ja," CC: ")):P("",!0),e(c)?(u(),h("span",Ra,B(e(c)),1)):P("",!0),e(s)?(u(),h("span",Oa,", ")):P("",!0),e(s)?(u(),h("span",Ua," BCC: ")):P("",!0),e(s)?(u(),h("span",Na,B(e(s)),1)):P("",!0)]),_[1]||(_[1]=n("div",{class:"border-0 border-t my-3 border-outline-gray-modals"},null,-1)),v(z,{content:e(l)},null,8,["content"]),n("div",za,[(u(!0),h(q,null,Q(e(b),U=>(u(),S(e(Me),{key:U.file_url,label:U.file_name,url:U.file_url},null,8,["label","url"]))),128))])],16,$a),v(wa,{modelValue:I.value,"onUpdate:modelValue":_[0]||(_[0]=U=>I.value=U),ticket_id:e(a),communication_id:e(a)},null,8,["modelValue","ticket_id","communication_id"])],64)}}}),Ha={class:"mx-6 md:mx-10 flex items-center gap-2 border-y py-2.5"},Za={class:"flex flex-wrap gap-2 px-10"},Ka={class:"flex justify-between overflow-scroll pl-10 py-2.5 items-center"},Ga={class:"flex items-center overflow-x-auto w-[60%]"},Wa={class:"flex gap-1"},Ja={class:"flex items-center justify-end space-x-2 sm:mt-0 w-[40%] mr-9"},Ya=O({__name:"EmailEditor",props:{ticketId:{type:String,default:null},placeholder:{type:String,default:null},label:{type:String,default:"Send"},editable:{type:Boolean,default:!0},doctype:{type:String,default:"HD Ticket"},toEmails:{type:Array,default:()=>[]},ccEmails:{type:Array,default:()=>[]},bccEmails:{type:Array,default:()=>[]}},emits:["submit","discard"],setup(t,{expose:i,emit:f}){const r=T(null),p=T(!1),c=t,s=V(()=>z.loading?"Sending...":c.label),d=f,m=ct("emailBoxContent"+c.ticketId,null),{updateOnboardingStep:b}=yt("helpdesk"),{isManager:l}=Ve(),{onUserType:a,cleanup:k}=Ye(c.ticketId),w=T([]),$=V(()=>he(m.value));J(m,(N,M)=>{N!==M&&N&&a()}),We(()=>{k()});const g=T([...c.toEmails]),I=T([...c.ccEmails]),L=T([...c.bccEmails]),o=T(!1),x=T(!1),y=V(()=>{var N;return!!((N=I.value)!=null&&N.length)}),_=V(()=>{var N;return!!((N=L.value)!=null&&N.length)}),j=T(null),E=T(null);function A(N){m.value=N.message,p.value=!1}const z=re({url:"run_doc_method",makeParams:()=>{var N,M;return{dt:c.doctype,dn:c.ticketId,method:"reply_via_agent",args:{attachments:w.value.map(X=>X.name),to:g.value.join(","),cc:(N=I.value)==null?void 0:N.join(","),bcc:(M=L.value)==null?void 0:M.join(","),message:m.value}}},onSuccess:()=>{Tt(),d("submit"),l&&b("reply_on_ticket")},debounce:300});function U(){if(he(m.value))return!1;if(!g.value.length)return me.warning("Email has no recipients. Please add at least one email address in the 'TO' field."),!1;z.submit()}function pe(){o.value=!o.value,o.value&&se(()=>{j.value.setFocus()})}function ve(){x.value=!x.value,x.value&&se(()=>{E.value.setFocus()})}async function ge(N){w.value=w.value.filter(M=>M!==N),await mt(N.name)}function ue(N,M,X,Fe){g.value=M,I.value=X,L.value=Fe,r.value.editor.chain().clearContent().insertContent(N).focus("all").setBlockquote().insertContentAt(0,{type:"paragraph"}).focus("start").run()}function Tt(){m.value=null,w.value=[]}function St(){w.value=[],m.value=null,I.value=[],L.value=[],I.value=[],o.value=!1,x.value=!1,d("discard")}const Bt=V(()=>r.value.editor);return i({addToReply:ue,editor:Bt,submitMail:U}),(N,M)=>{const X=R("Button"),Fe=R("FeatherIcon");return u(),h(q,null,[v(e(Ee),{ref_key:"editorRef",ref:r,"editor-class":["prose-sm max-w-full mx-6 md:mx-10 max-h-[50vh] py-3","min-h-[7rem]",e(Ze)(e(m)),t.editable&&"!max-h-[35vh] overflow-y-auto"],content:e(m),"starterkit-options":{heading:{levels:[2,3,4,5,6]}},placeholder:t.placeholder,editable:t.editable,onChange:M[8]||(M[8]=F=>t.editable?m.value=F:null),extensions:[e(xt)],uploadFunction:F=>e(dt)(F,t.doctype,t.ticketId)},{top:C(()=>[n("div",Ha,[M[10]||(M[10]=n("span",{class:"text-xs text-gray-500"},"TO:",-1)),v(e(je),{modelValue:g.value,"onUpdate:modelValue":M[0]||(M[0]=F=>g.value=F),class:"flex-1",validate:e(De),"error-message":F=>`${F} is an invalid email address`},null,8,["modelValue","validate","error-message"]),v(X,{label:"CC",class:Z([y.value?"bg-gray-300 hover:bg-gray-200":""]),onClick:M[1]||(M[1]=F=>pe())},null,8,["class"]),v(X,{label:"BCC",class:Z([_.value?"bg-gray-300 hover:bg-gray-200":""]),onClick:M[2]||(M[2]=F=>ve())},null,8,["class"])]),o.value||y.value?(u(),h("div",{key:0,class:Z(["mx-10 flex items-center gap-2 py-2.5",y.value||o.value?"border-b":""])},[M[11]||(M[11]=n("span",{class:"text-xs text-gray-500"},"CC:",-1)),v(e(je),{ref_key:"ccInput",ref:j,modelValue:I.value,"onUpdate:modelValue":M[3]||(M[3]=F=>I.value=F),class:"flex-1",validate:e(De),"error-message":F=>`${F} is an invalid email address`},null,8,["modelValue","validate","error-message"])],2)):P("",!0),x.value||_.value?(u(),h("div",{key:1,class:Z(["mx-10 flex items-center gap-2 py-2.5",_.value||x.value?"border-b":""])},[M[12]||(M[12]=n("span",{class:"text-xs text-gray-500"},"BCC:",-1)),v(e(je),{ref_key:"bccInput",ref:E,modelValue:L.value,"onUpdate:modelValue":M[4]||(M[4]=F=>L.value=F),class:"flex-1",validate:e(De),"error-message":F=>`${F} is an invalid email address`},null,8,["modelValue","validate","error-message"])],2)):P("",!0)]),bottom:C(()=>[n("div",Za,[(u(!0),h(q,null,Q(w.value,F=>(u(),S(e(Me),{key:F.file_url,label:F.file_name,url:["MOV","MP4"].includes(F.file_type)?null:F.file_url},{suffix:C(()=>[v(Fe,{class:"h-3.5",name:"x",onClick:Y(Vt=>ge(F),["self","stop"])},null,8,["onClick"])]),_:2},1032,["label","url"]))),128))]),n("div",Ka,[n("div",Ga,[n("div",Wa,[v(e(ht),{"upload-args":{doctype:t.doctype,docname:t.ticketId,private:!0},onSuccess:M[5]||(M[5]=F=>{w.value.push(F)})},{default:C(({openFileSelector:F})=>[v(X,{variant:"ghost",onClick:Vt=>F()},{icon:C(()=>[v(e(Lt),{class:"h-4",style:{color:"#000000","stroke-width":"1.5 !important"}})]),_:1},8,["onClick"])]),_:1},8,["upload-args"]),v(X,{variant:"ghost",onClick:M[6]||(M[6]=F=>p.value=!0)},{icon:C(()=>[v(e(Ae),{class:"h-4",style:{color:"#000000","stroke-width":"1.2"}})]),_:1})]),v(e(_t),{class:"ml-1",buttons:e(Ke)},null,8,["buttons"])]),n("div",Ja,[v(X,{label:"Discard",onClick:St}),v(X,{variant:"solid",disabled:$.value,loading:e(z).loading,label:s.value,onClick:M[7]||(M[7]=()=>{U()})},null,8,["disabled","loading","label"])])])]),_:1},8,["editor-class","content","placeholder","editable","extensions","uploadFunction"]),p.value?(u(),S(e(Tl),{key:0,modelValue:p.value,"onUpdate:modelValue":M[9]||(M[9]=F=>p.value=F),doctype:t.doctype,onApply:A},null,8,["modelValue","doctype"])):P("",!0)],64)}}}),Qa={class:"flex-1"},Xa={class:"mt-1.5 flex justify-between text-base items-start md:items-center"},en={key:0,class:"inline-flex flex-wrap gap-1.5 text-ink-gray-8 font-medium w-4/5"},tn={key:1,class:"text-gray-600 w-4/6"},ln={class:"font-medium text-gray-800"},an={class:"text-gray-600 text-sm w-2/6 flex justify-end"},nn={key:0},sn={class:"text-gray-600 w-4/6"},on={class:"font-medium text-gray-800"},rn={class:"text-gray-600 text-sm w-2/6 flex justify-end"},un=O({__name:"HistoryBox",props:{activity:{type:Object,required:!0}},setup(t){const i=t,{user:f,content:r,creation:p,relatedActivities:c}=i.activity;let s=T(!1);return(d,m)=>{const b=R("Button"),l=R("Tooltip");return u(),h("div",Qa,[n("div",Xa,[e(c).length>1?(u(),h("div",en,[n("span",null,B(`${e(s)?"Hide ":"Show "}`),1),n("span",null,"+"+B(e(c).length),1),m[1]||(m[1]=n("span",null,"changes from ",-1)),n("span",null,B(e(f)),1),v(b,{class:"!size-4",variant:"ghost",onClick:m[0]||(m[0]=a=>Ot(s)?s.value=!e(s):s=!e(s))},{icon:C(()=>[v(e(ua))]),_:1})])):(u(),h("div",tn,[n("span",ln,B(e(f)),1),n("span",null,B(e(r)),1)])),v(l,{text:e(ie)(e(p),e(be))},{default:C(()=>[n("div",an,B(e(fe)(e(p))),1)]),_:1},8,["text"])]),e(s)?(u(),h("div",nn,[(u(!0),h(q,null,Q(e(c),a=>(u(),h("div",{key:a.creation,class:"mt-2 flex justify-between text-base"},[n("div",sn,[n("span",on,B(a.user),1),n("span",null,B(a.content),1)]),v(l,{text:e(ie)(a.creation,e(be))},{default:C(()=>[n("div",rn,B(e(fe)(a.creation)),1)]),_:2},1032,["text"])]))),128))])):P("",!0)])}}}),cn={class:"flex flex-wrap gap-1"},dn={class:"flex-1"},mn={class:"mt-1 rounded-lg bg-white py-1 text-base shadow-2xl"},fn={class:"flex flex-col gap-1 p-1 text-gray-800"},pn={class:"text-base font-medium"},vn={class:"text-sm text-gray-600"},je=O({__name:"MultiSelectInput",props:le({validate:{type:Function,default:null},errorMessage:{type:Function,default:t=>`${t} is an Invalid value`}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t,{expose:i}){const f=t,r=oe(t,"modelValue"),p=T([]),c=T(null),s=T(null),d=T(""),m=T(""),b=T(!1),l=V({get:()=>d.value||"",set:o=>{d.value="",o&&(b.value=!1),o!=null&&o.value&&$(o.value)}});Ut(d,o=>{o=o||"",m.value!==o&&(m.value=o,w(o))},{debounce:300,immediate:!0});const a=re({url:"helpdesk.api.contact.search_contacts",method:"GET",cache:["Contact",m.value],params:{txt:m.value},transform:o=>o.map(({full_name:x,email_id:y,name:_})=>({label:x||_||y,value:y}))}),k=V(()=>{let o=a.data||[];return!o.length&&d.value&&o.push({label:d.value,value:d.value}),o});function w(o){a.update({params:{txt:o}}),a.reload()}const $=o=>{s.value=null,o&&(o.split(",").forEach(y=>{var _;if(y=y.trim(),y&&!((_=r.value)!=null&&_.includes(y))){if(y&&f.validate&&!f.validate(y)){s.value=f.errorMessage(y);return}r.value?r.value.push(y):r.value=[y],y=y.replace(y,"")}}),!s.value&&(o=""))},g=o=>{r.value=r.value.filter(x=>x!==o)},I=()=>{var x;if(d.value)return;let o=(x=p.value[p.value.length-1])==null?void 0:x.$el;document.activeElement===o?(r.value.pop(),se(()=>{r.value.length?(o=p.value[p.value.length-1].$el,o==null||o.focus()):L()})):o==null||o.focus()};function L(){c.value.$el.focus()}return i({setFocus:L}),(o,x)=>{const y=R("FeatherIcon"),_=R("Button"),j=R("ErrorMessage");return u(),h("div",null,[n("div",cn,[(u(!0),h(q,null,Q(r.value,E=>(u(),S(_,{ref_for:!0,ref_key:"emails",ref:p,key:E,label:E,theme:"gray",variant:"subtle",class:"rounded-full",onKeydownCapture:de(Y(I,["stop"]),["delete"])},{suffix:C(()=>[v(y,{class:"h-3.5",name:"x",onClick:Y(A=>g(E),["stop"])},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),n("div",dn,[v(e(Zt),{modelValue:l.value,"onUpdate:modelValue":x[2]||(x[2]=E=>l.value=E),nullable:""},{default:C(()=>[v(e(Nt),{show:b.value,"onUpdate:show":x[1]||(x[1]=E=>b.value=E),class:"w-full"},{target:C(({togglePopover:E})=>[v(e(zt),{ref_key:"search",ref:c,class:"search-input form-input w-full border-none bg-white hover:bg-white focus:border-none focus:!shadow-none focus-visible:!ring-0",type:"text",value:d.value,autocomplete:"off",onChange:x[0]||(x[0]=A=>{d.value=A.target.value,b.value=!0}),onFocus:()=>E(),onKeydownCapture:de(Y(I,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:C(({isOpen:E})=>[Oe(n("div",null,[n("div",mn,[v(e(qt),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:C(()=>[(u(!0),h(q,null,Q(k.value,A=>(u(),S(e(Ht),{key:A.value,value:A},{default:C(({active:z})=>[n("li",{class:Z(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-gray-100":z}])},[v(e(Ct),{class:"mr-2",name:A.value,size:"lg"},null,8,["name"]),n("div",fn,[n("div",pn,B(A.label),1),n("div",vn,B(A.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[Ue,E]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])]),s.value?(u(),S(j,{key:0,class:"mt-2 pl-2",message:s.value},null,8,["message"])):P("",!0)])}}}),gn={key:0,class:"pl-2"},yn={class:"flex items-center gap-2 text-sm text-gray-600"},xn={class:"flex items-center gap-1.5"},bn=O({__name:"TypingIndicator",props:{ticketId:{type:String,required:!0}},setup(t){const i=t,{typingUsers:f,cleanup:r}=Ye(i.ticketId),p=V(()=>{var m,b;const c=f.length;if(c===0)return null;const{getUser:s}=He();let d=((m=s(f[0]))==null?void 0:m.full_name)||f[0];return console.log(d),console.log(f),c===1?D("div",{class:"flex items-center gap-1"},[D(Ct,{name:f[0],size:"sm"}),D("span",{class:"text-ink-gray-6 font-medium"},d),D("span",{class:"text-ink-gray-5"}," is typing")]):c===2?D("div",{class:"flex items-center gap-1"},[D("span",{class:"text-ink-gray-6 font-medium"},d),D("span",{class:"text-ink-gray-5"}," and "),D("span",{class:"text-ink-gray-6 font-medium"},(b=s(f[1]))==null?void 0:b.full_name),D("span",{class:"text-ink-gray-5"}," are typing")]):D("div",{class:"flex items-center gap-1"},[D("span",{class:"text-ink-gray-6 font-medium"},d),D("span",{class:"text-ink-gray-5"}," and "),D("span",{class:"text-ink-gray-6 font-medium"},`${c-1} others`),D("span",{class:"text-ink-gray-5"}," are typing")])});return We(()=>{r()}),(c,s)=>e(f).length>0?(u(),h("div",gn,[n("div",yn,[n("div",xn,[(u(),S(Be(p.value))),s[0]||(s[0]=n("div",{class:"typing-dots"},[n("span"),n("span"),n("span")],-1))])])])):P("",!0)}}),hn=ae(bn,[["__scopeId","data-v-3f215bd3"]]),_n={class:"text-base text-ink-gray-6"},Cn={class:"flex flex-col gap-2 mt-6"},hs=O({__name:"SetContactPhoneModal",props:le({name:{type:String,required:!0}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:le(["onUpdate"],["update:modelValue"]),setup(t,{emit:i}){const f=i,r=oe(t,"modelValue"),p=T(""),c=t,s=T({name:"",phone:""}),d=()=>{if(Kt().regex(/^\+(?:[0-9]){6,14}[0-9]$/).safeParse(s.value.phone).success)p.value="";else{p.value="Invalid phone number";return}re({url:"frappe.client.set_value",params:{doctype:"Contact",name:c.name,fieldname:"phone_nos",value:[{phone:s.value.phone,is_primary_phone:!0}]},auto:!0,onSuccess:()=>{f("onUpdate"),me.success("Contact updated"),r.value=!1}})};return J(r,m=>{m&&(s.value={name:c.name,phone:""})}),(m,b)=>{const l=R("FormControl");return u(),S(e(Ge),{modelValue:r.value,"onUpdate:modelValue":b[1]||(b[1]=a=>r.value=a),options:{title:"Set Phone Number",actions:[{label:"Set Phone Number",variant:"solid",onClick:d}]}},{"body-content":C(()=>[n("div",null,[n("div",_n,[n("b",null,B(s.value.name),1),b[2]||(b[2]=Le(" does not have a phone number, set one to call them. ",-1))]),n("div",Cn,[v(l,{modelValue:s.value.phone,"onUpdate:modelValue":b[0]||(b[0]=a=>s.value.phone=a),label:"Phone",type:"text",size:"sm",variant:"subtle",placeholder:"+918956895623",disabled:!1},null,8,["modelValue"]),v(e(Gt),{message:p.value},null,8,["message"])])])]),_:1},8,["modelValue","options"])}}}),kn={},wn={width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function $n(t,i){return u(),h("svg",wn,[...i[0]||(i[0]=[n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.76527 2.76476L3.76515 2.76469C3.76518 2.76471 3.76516 2.7647 3.76508 2.76466C3.76417 2.76417 3.75528 2.75942 3.73828 2.7571V9.24215C3.75528 9.23982 3.76418 9.23508 3.76508 9.23459C3.76516 9.23455 3.76518 9.23454 3.76515 9.23456L3.76527 9.23448L8.75611 5.99962L3.76527 2.76476ZM9.5471 6.67863L4.30917 10.0736C4.01166 10.2665 3.61363 10.2975 3.28101 10.1538C2.94839 10.01 2.73828 9.71611 2.73828 9.39463V2.60462C2.73828 2.28313 2.94839 1.98924 3.28101 1.84547C3.61363 1.7017 4.01166 1.73272 4.30917 1.92561L9.5471 5.32062C9.79432 5.48091 9.93982 5.73247 9.93982 5.99962C9.93982 6.26677 9.79432 6.51833 9.5471 6.67863Z",fill:"currentColor"},null,-1)])])}const In=ae(kn,[["render",$n]]),Ln={class:"w-full"},Tn={class:"mb-1 flex items-center justify-stretch gap-2 py-1 text-base"},Sn={class:"inline-flex items-center flex-wrap gap-1 text-ink-gray-5"},Bn={class:"font-medium text-ink-gray-8 ml-1"},Vn={class:"ml-auto whitespace-nowrap"},En={class:"text-sm text-ink-gray-5"},Mn={class:"flex items-center justify-between"},An={class:"inline-flex gap-2 items-center text-base font-medium"},Fn={class:"flex items-center flex-wrap gap-2"},Dn=O({__name:"CallArea",props:{activity:Object},setup(t){const i=t,f=T(!1),r=T(!1),p=W("refreshTicket");return(c,s)=>{var d,m,b,l,a,k;return u(),h("div",Ln,[n("div",Tn,[n("div",Sn,[v(e(Qe),{image:(m=(d=t.activity)==null?void 0:d._caller)==null?void 0:m.image,label:(l=(b=t.activity)==null?void 0:b._caller)==null?void 0:l.label,size:"md"},null,8,["image","label"]),n("span",Bn,B((k=(a=t.activity)==null?void 0:a._caller)==null?void 0:k.label),1),n("span",null,B(t.activity.call_type=="Incoming"?c.__("has reached out"):c.__("has made a call")),1)]),n("div",Vn,[v(e(pt),{text:e(ie)(t.activity.creation,"MMM D, dddd")},{default:C(()=>[n("div",En,B(c.__(e(fe)(t.activity.creation))),1)]),_:1},8,["text"])])]),n("div",{onClick:s[0]||(s[0]=w=>f.value=!0),class:"flex flex-col gap-2 cursor-pointer border-transparent shadow rounded-md bg-surface-cards px-3 py-2.5 text-ink-gray-9"},[n("div",Mn,[n("div",An,[n("div",null,B(t.activity.call_type=="Incoming"?c.__("Inbound Call"):c.__("Outbound Call")),1)]),n("div",null,[v(tl,{avatars:[{name:t.activity._caller.label,label:t.activity._caller.label,image:t.activity._caller.image},{name:t.activity._receiver.label,label:t.activity._receiver.label,image:t.activity._receiver.image}],size:"sm"},null,8,["avatars"])])]),n("div",Fn,[v(e($e),{label:e(ie)(t.activity.creation,"MMM D, dddd")},{prefix:C(()=>[v(al,{class:"size-3"})]),_:1},8,["label"]),t.activity.status=="Completed"?(u(),S(e($e),{key:0,label:t.activity.duration},{prefix:C(()=>[v(nl,{class:"size-3"})]),_:1},8,["label"])):P("",!0),t.activity.recording_url?(u(),S(e($e),{key:1,label:c.__("Listen"),class:"cursor-pointer"},{prefix:C(()=>[v(In,{class:"size-3"})]),_:1},8,["label"])):P("",!0),v(e($e),{label:e(sl)[t.activity.status],theme:e(ol)[t.activity.status]},null,8,["label","theme"])])]),v(il,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=w=>f.value=w),callLogModal:r.value,"onUpdate:callLogModal":s[2]||(s[2]=w=>r.value=w),callLogId:i.activity.name,hideTicket:!0},null,8,["modelValue","callLogModal","callLogId"]),v(kt,{modelValue:r.value,"onUpdate:modelValue":s[3]||(s[3]=w=>r.value=w),callLogId:i.activity.name,onAfterInsert:s[4]||(s[4]=w=>e(p)())},null,8,["modelValue","callLogId"])])}}}),Pn={class:"md:mx-10 md:my-4 flex items-center justify-between text-lg font-medium mx-6 mb-4 !mt-8"},jn={class:"flex h-8 items-center text-xl font-semibold text-gray-800"},Rn=O({__name:"ActivityHeader",props:{title:{type:String,required:!0}},setup(t){const i=W("communicationArea"),f=W("makeCall"),r=W("refreshTicket"),p=T(!1),{isCallingEnabled:c}=Je($t()),s=W("ticketId"),d=V(()=>{let b=[{icon:D(Ae,{class:"h-4 w-4"}),label:"Email",onClick:()=>{var l;return((l=i==null?void 0:i.value)==null?void 0:l.toggleEmailBox())??Ne()}},{icon:D(Se,{class:"h-4 w-4"}),label:"Comment",onClick:()=>{var l;return((l=i==null?void 0:i.value)==null?void 0:l.toggleCommentBox())??ze()}}];return c.value&&b.push(...m.value),b}),m=V(()=>[{icon:D(wt,{class:"h-4 w-4"}),label:"Make a Call",onClick:()=>f()},{icon:"edit-3",label:"Log a Call",onClick:()=>{p.value=!0}}]);return(b,l)=>{const a=R("FeatherIcon"),k=R("Button");return u(),h(q,null,[n("div",Pn,[n("div",jn,B(t.title),1),t.title=="Emails"?(u(),S(k,{key:0,variant:"solid",onClick:l[0]||(l[0]=w=>{var $;return(($=e(i))==null?void 0:$.toggleEmailBox())??e(Ne)()})},{prefix:C(()=>[v(a,{name:"plus",class:"h-4 w-4"})]),default:C(()=>[l[5]||(l[5]=n("span",null,B("New Email"),-1))]),_:1})):t.title=="Comments"?(u(),S(k,{key:1,variant:"solid",onClick:l[1]||(l[1]=w=>{var $;return(($=e(i))==null?void 0:$.toggleCommentBox())??e(ze)()})},{prefix:C(()=>[v(a,{name:"plus",class:"h-4 w-4"})]),default:C(()=>[l[6]||(l[6]=n("span",null,B("New Comment"),-1))]),_:1})):t.title=="Calls"?(u(),S(e(Te),{key:2,options:m.value,onClick:l[2]||(l[2]=Y(()=>{},["stop"]))},{default:C(({open:w})=>[v(k,{variant:"solid",class:"flex items-center gap-1"},{prefix:C(()=>[v(a,{name:"plus",class:"h-4 w-4"})]),suffix:C(()=>[v(a,{name:w?"chevron-up":"chevron-down",class:"h-4 w-4"},null,8,["name"])]),default:C(()=>[l[7]||(l[7]=n("span",null,B("New"),-1))]),_:2},1024)]),_:1},8,["options"])):(u(),S(e(Te),{key:3,options:d.value,onClick:l[3]||(l[3]=Y(()=>{},["stop"]))},{default:C(({open:w})=>[v(k,{variant:"solid",class:"flex items-center gap-1"},{prefix:C(()=>[v(a,{name:"plus",class:"h-4 w-4"})]),suffix:C(()=>[v(a,{name:w?"chevron-up":"chevron-down",class:"h-4 w-4"},null,8,["name"])]),default:C(()=>[l[8]||(l[8]=n("span",null,B("New"),-1))]),_:2},1024)]),_:1},8,["options"]))]),v(kt,{modelValue:p.value,"onUpdate:modelValue":l[4]||(l[4]=w=>p.value=w),ticketId:e(s),onAfterInsert:e(r)},null,8,["modelValue","ticketId","onAfterInsert"])],64)}}}),On={class:"text-base text-ink-gray-8 font-medium"},Un={key:0},Nn={class:"mt-2 text-sm text-gray-700"},zn=O({__name:"FeedbackBox",props:{activity:{type:Object,required:!0}},setup(t){const i=t,f=V(()=>i.activity.feedback_rating<=.4?["bg-surface-red-1","red"]:i.activity.feedback_rating<=.6?["bg-surface-amber-1","yellow"]:["bg-surface-green-1","yellow"]);return(r,p)=>(u(),h("div",{class:Z(["w-full p-4 rounded",f.value[0]])},[n("div",{class:Z(["flex mb-1.5 items-center",t.activity.feedback&&"gap-[9px]"])},[n("p",On,B(t.activity.feedback),1),v(ul,{rating:t.activity.feedback_rating},null,8,["rating"])],2),t.activity.feedback_extra?(u(),h("div",Un,[n("p",Nn,B(t.activity.feedback_extra),1)])):P("",!0)],2))}}),qn={key:0,class:"activities flex-1 h-full mt-1"},Hn={class:"w-full px-6 md:px-10 grid grid-cols-[30px_minmax(auto,_1fr)] gap-2 sm:gap-4"},Zn={key:1,class:"h-full flex flex-col items-center justify-center gap-3 text-xl font-medium text-gray-500"},_s=O({__name:"TicketAgentActivities",props:{activities:{type:Array,required:!0},title:{type:String,required:!0},ticketStatus:{type:String,default:""}},emits:["email:reply","update"],setup(t,{expose:i,emit:f}){const r=t,p=f,c=vt(),s=gt(),{getUser:d}=He(),m=W("communicationArea"),b=W("makeCall"),l=V(()=>{let $="No Activities";if(r.title=="Emails")$="No Email Communications";else{if(r.title=="Comments")return $="No Comments",$;if(r.title=="Calls")return $="No Calls",$}}),a=V(()=>{let $=Nl;return r.title=="Emails"?$=Ae:r.title=="Comments"?$=Se:r.title=="Calls"&&($=wt),D($,{class:"text-gray-500"})});function k(){if(c.hash){w();return}setTimeout(()=>{let $,g=document.getElementsByClassName("activity");$=g[g.length-1],$&&!Jt($)&&($.scrollIntoViewIfNeeded(),$.focus())},500)}function w(){const $=c.hash;if($){const g=$.substring(1);se(()=>{setTimeout(()=>{const I=document.getElementById(g);I&&(I.scrollIntoViewIfNeeded(),I.classList.add("bg-yellow-100"),setTimeout(()=>{I.classList.remove("bg-yellow-100"),s.replace({hash:""})},2e3))},1e3)})}}return J(()=>c.hash,()=>{k()}),J(()=>r.title,()=>{k()},{immediate:!0}),i({scrollToLatestActivity:k}),($,g)=>{const I=Rn,L=Dn,o=R("Button");return u(),h(q,null,[v(I,{title:t.title},null,8,["title"]),v(e(ll),{class:"flex flex-col flex-1 overflow-y-scroll","mask-length":20},{default:C(()=>[t.activities.length?(u(),h("div",qn,[(u(!0),h(q,null,Q(t.activities,(x,y)=>{var _,j;return u(),h("div",{key:x.key,class:"activity"},[n("div",Hn,[n("div",{class:Z(["relative flex justify-center after:absolute after:left-[50%] after:top-2 after:-z-10 after:border-l after:border-gray-200",[y!=t.activities.length-1?"after:h-full":"after:h-4"]])},[n("div",{class:Z(["z-1 flex h-7 w-7 items-center justify-center rounded-full bg-white",[["email","feedback"].includes(x.type)&&"mt-2"]])},[x.type==="email"||x.type==="feedback"?(u(),S(e(Qe),{key:0,size:"lg",label:(_=x.sender)==null?void 0:_.full_name,image:e(d)((j=x.sender)==null?void 0:j.name).user_image,class:"bg-white absolute left-[1px]"},null,8,["label","image"])):x.type==="comment"?(u(),S(e(Se),{key:1,class:"text-gray-600 absolute left-[7.5px]"})):x.type==="call"?(u(),S(e(Wt),{key:2,name:x.call_type==="Incoming"?"phone-incoming":"phone-outgoing",class:"text-gray-600 absolute left-[7.5px] size-4"},null,8,["name"])):(u(),S(e(Yl),{key:3,class:"text-gray-600 absolute left-[7.5px]"}))],2)],2),n("div",{class:Z(["mb-4 flex flex-1",[y==t.activities.length-1&&"mb-5"]])},[x.type==="email"?(u(),S(e(qa),{key:0,activity:x,"show-split-option":!x.isFirstEmail&&t.ticketStatus!=="Closed",class:"py-2 px-3",onReply:g[0]||(g[0]=E=>p("email:reply",E))},null,8,["activity","show-split-option"])):x.type==="comment"?(u(),S(e(jl),{key:1,activity:x,onUpdate:g[1]||(g[1]=()=>p("update"))},null,8,["activity"])):x.type==="call"?(u(),S(L,{key:2,activity:x},null,8,["activity"])):x.type==="feedback"?(u(),S(zn,{key:3,activity:x},null,8,["activity"])):(u(),S(e(un),{key:4,activity:x},null,8,["activity"]))],2)])])}),128))])):(u(),h("div",Zn,[(u(),S(Be(a.value),{class:"h-10 w-10"})),n("span",null,B(l.value),1),t.title=="Emails"?(u(),S(o,{key:0,label:"New Email",onClick:g[2]||(g[2]=x=>{var y;return((y=e(m))==null?void 0:y.toggleEmailBox())??e(Ne)()})})):t.title=="Comments"?(u(),S(o,{key:1,label:"New Comment",onClick:g[3]||(g[3]=x=>{var y;return((y=e(m))==null?void 0:y.toggleCommentBox())??e(ze)()})})):t.title=="Calls"?(u(),S(o,{key:2,label:"Make a Call",onClick:g[4]||(g[4]=x=>e(b)())})):P("",!0)]))]),_:1})],64)}}}),Kn={class:"flex gap-2 px-5 pb-1 leading-5 first:mt-3 items-center"},Gn={class:"w-[106px] shrink-0 truncate text-sm text-gray-600"},Wn={key:0,class:"text-red-500"},Jn={class:"-m-0.5 min-h-[28px] flex-1 items-center overflow-hidden p-0.5 text-base"},Yn=O({__name:"TicketField",props:{field:{},value:{type:[String,Number,Boolean,null]}},emits:["change"],setup(t,{emit:i}){const f=t,r=i,p=re({url:f.field.url_method,auto:!!f.field.url_method,transform:l=>l!=null&&l.length?l.filter(a=>!!a).map(a=>typeof a=="object"&&a.hasOwnProperty("label")&&a.hasOwnProperty("value")?a:{label:a==null?void 0:a.toString(),value:a})||[]:[]}),c=["Long Text","Small Text","Text","Text Editor","Data"],s=["Int","Float","Currency","Percent"],d=V(()=>f.field.url_method?D(Pe,{options:p.data}):f.field.fieldtype==="Link"&&f.field.options?D(ml,{doctype:f.field.options,hideMe:!0}):f.field.fieldtype==="Select"?D(Pe,{options:f.field.options.split(`
`).map(l=>({label:l,value:l}))}):f.field.fieldtype==="Check"?D(Pe,{options:[{label:"Yes",value:1},{label:"No",value:0}]}):c.includes(f.field.fieldtype)?D(nt,{type:"textarea",rows:f.field.fieldtype==="Data"?1:2}):f.field.fieldtype==="Datetime"?D(cl,{formatter:l=>l&&st(l).format(`${window.date_format.toUpperCase()} ${window.time_format}`)}):f.field.fieldtype==="Date"?D(dl,{id:f.field.fieldname}):D(nt)),m=V(()=>{const l=f.field.fieldtype;return l==="Check"?f.value?"Yes":"No":l==="Date"&&f.value?st(f.value).format(window.date_format.toUpperCase()):f.value});function b(l,a){r("change",{fieldname:l,value:a})}return(l,a)=>(u(),h("div",Kn,[n("div",Gn,[v(e(pt),{text:l.field.label},{default:C(()=>[n("span",null,B(l.field.label),1)]),_:1},8,["text"]),l.field.required?(u(),h("span",Wn," * ")):P("",!0)]),n("div",Jn,[(u(),S(Be(d.value),Ce({key:l.field.fieldname,readonly:l.field.readonly,disabled:l.field.disabled,class:"form-control",placeholder:l.field.placeholder||`Add ${l.field.label}`,"model-value":m.value,autocomplete:"off"},Yt([...c,...s].includes(l.field.fieldtype)?{blur:k=>{b(l.field.fieldname,k.target.value)}}:{"update:model-value":k=>{var w;b(l.field.fieldname,(k==null?void 0:k.value)||((w=k==null?void 0:k.target)==null?void 0:w.value)||k)}})),null,16,["readonly","disabled","placeholder","model-value"]))])]))}});const Cs=ae(Yn,[["__scopeId","data-v-5ac31bae"]]);function ks(t){const i=vt(),f=gt(),r=$t(),{isLoading:p}=Je(r),c=l=>{var a,k;m.value=l,l==0?f.replace({path:i.path}):s(((k=(a=t.value)==null?void 0:a[l])==null?void 0:k.name)||t.value[0].name)};function s(l){let a="#"+(l==null?void 0:l.toLowerCase());i.hash!==a&&f.push({hash:a,query:i.query})}function d(l){var a;return(a=t.value)==null?void 0:a.findIndex(k=>k.name.toLowerCase()===l)}const m=T(0),b=()=>{let l=i.hash.replace("#","");if(l){let a=d(l);if(a!==-1||a===0){m.value=a,s(t.value[a].name);return}}m.value=0,f.replace({path:i.path})};return J(()=>i.hash,l=>{let a=d(l.replace("#",""));a===-1&&(a=0),a==0&&f.replace({path:i.path}),m.value=a}),J([t,p],([l,a])=>{l!=null&&l.length&&(a||b())},{deep:!0,flush:"post"}),{tabIndex:m,changeTabTo:c}}export{Nl as A,Se as C,Cs as T,hs as _,_l as a,Cl as b,_s as c,xs as d,bs as e,ks as u};
//# sourceMappingURL=useActiveTabManager-44c673f3.js.map
