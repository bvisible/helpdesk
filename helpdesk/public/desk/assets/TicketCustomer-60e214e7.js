import{d as q,a0 as oe,c as w,a2 as D,r as H,e as c,k as f,l as i,g as m,h as t,w as k,v as h,M as R,y as b,F as P,G as z,f as C,a8 as N,u as ne,W as B,J as le,X as ie,S as T,q as _,A as $,b as re,V as ce,N as de,aM as O,O as ue,a1 as U,aF as L,z as K,aN as me,i as pe,a7 as _e,aO as fe,aP as be,_ as ke}from"./index-b4c863a6.js";import{_ as ve}from"./CustomActions-e59e4907.js";import{g as xe,d as ge}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js";import{d as u}from"./dayjs-95f8111d.js";import"./knowledgeBase-2d00b929.js";import{_ as ye}from"./LayoutHeader-0efddba1.js";import{u as he}from"./ticketStatus-60f6a20e.js";import{_ as Ce}from"./TicketFeedback.vue_vue_type_script_setup_true_lang-9b9a00e2.js";import{_ as we}from"./EmailIcon-c867fb48.js";import{I as G}from"./symbols-7dbf6ecf.js";import{_ as Te}from"./Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js";import{s as $e}from"./formCustomisation-8a41b461.js";import{_ as Ie}from"./TicketConversation.vue_vue_type_script_setup_true_lang-d77fd2de.js";import{_ as Se}from"./TicketCustomerTemplateFields.vue_vue_type_script_setup_true_lang-cef6c193.js";import{_ as Fe}from"./TicketFeedback.vue_vue_type_script_setup_true_lang-1c8e7a06.js";import{_ as De}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c05e3797.js";import"./Dropdown-f79f7542.js";import"./StarRating.vue_vue_type_script_setup_true_lang-4484b1d1.js";import"./TicketCommunication.vue_vue_type_script_setup_true_lang-613f0f77.js";import"./EmailContent.vue_vue_type_script_setup_true_lang-df9fb311.js";import"./dot-325d1522.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-b54cd9d5.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-e554c997.js";import"./index-cc785cd6.js";import"./index-6b12b9aa.js";import"./index-3720151f.js";const Be={class:"flex w-[382px] flex-col border-l gap-4"},Ae={class:"flex flex-col gap-4 pt-0 px-5 py-3 border-b"},Ee={class:"flex gap-2"},Ve={class:"flex items-center justify-between"},je={class:"w-[242px] truncate text-2xl font-medium"},Re={key:0,class:"flex gap-1.5"},Pe={class:"flex items-center text-base leading-5"},ze={class:"w-[126px] text-sm text-gray-600"},Me={class:"w-[126px] text-gray-600 text-sm"},He={class:"break-words text-base text-gray-800"},Ne={class:"flex flex-col gap-4 pt-0 px-5 py-3 overflow-y-scroll"},Oe={class:"flex items-center text-base leading-5"},Ue={class:"w-[126px] text-sm text-gray-600"},Le=q({__name:"TicketCustomerSidebar",emits:["open"],setup(M,{emit:A}){const I=A,e=oe(G),E=w(()=>{const s=l(),r=S();return[{title:"First Response",value:e.data.first_responded_on||e.data.response_by,label:s.label,theme:s.color},{title:"Resolution",value:e.data.resolution_date||e.data.resolution_by,label:r.label,theme:r.color}]});function l(){let s=null;return!e.data.first_responded_on&&u().isBefore(u(e.data.response_by))?s={label:`Due in ${D(u(e.data.response_by).diff(u(),"s"))}`,color:"orange"}:u(e.data.first_responded_on).isBefore(u(e.data.response_by))?s={label:`Fulfilled in ${D(u(e.data.first_responded_on).diff(u(e.data.creation),"s"))}`,color:"green"}:s={label:"Failed",color:"red"},s}function S(){let s=null;return!e.data.resolution_date&&u().isBefore(e.data.resolution_by)?s={label:`Due in ${D(u(e.data.resolution_by).diff(u(),"s"))}`,color:"orange"}:e.data.agreement_status==="Fulfilled"?s={label:`Fulfilled in ${D(u(e.data.resolution_time,"s"))}`,color:"green"}:s={label:"Failed",color:"red"},s}const v=w(()=>[{label:"Ticket ID",value:e.data.name},{label:"Status",value:e.data.status,bold:!0}]),x=w(()=>{const s=[{label:"Subject",value:e.data.subject},{label:"Team",value:e.data.agent_group||"-"},{label:"Priority",value:e.data.priority}],r=e.data.template.fields.filter(p=>!p.hide_from_customer&&["subject","team","priority"].indexOf(p.fieldname)===-1).map(p=>({label:p.label,value:e.data[p.fieldname]}));return[...s,...r]});return(s,r)=>{const p=we,F=H("Button"),g=H("Badge"),V=Ce;return c(),f("div",Be,[r[1]||(r[1]=i("div",{class:"flex items-center justify-between border-b px-5 py-3"},[i("span",{class:"cursor-copy text-lg font-semibold"},"Ticket details")],-1)),i("div",Ae,[i("div",Ee,[m(t(Te),{size:"2xl",image:t(e).data.contact.image,label:t(e).data.contact.name},null,8,["image","label"]),i("div",Ve,[m(t(R),{text:t(e).data.contact.name},{default:k(()=>[i("div",je,h(t(e).data.contact.name),1)]),_:1},8,["text"]),t(e).data.feedback_rating?b("",!0):(c(),f("div",Re,[m(t(R),{text:t(e).data.contact.email_id},{default:k(()=>[m(F,{class:"h-7 w-7",onClick:r[0]||(r[0]=n=>I("open"))},{icon:k(()=>[m(p,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])]))])]),(c(!0),f(P,null,z(v.value,n=>(c(),f("div",Pe,[i("span",ze,h(n.label),1),i("span",{class:N(["text-base text-gray-800 flex-1",!n.value&&"text-ink-gray-4"])},h(n.value||"—"),3)]))),256)),(c(!0),f(P,null,z(E.value,n=>(c(),f("div",{key:n.label,class:"flex items-center text-base"},[i("div",Me,h(n.title),1),i("div",He,[m(t(R),{text:t(u)(n.value).long()},{default:k(()=>[m(g,{label:n.label,theme:n.theme,variant:"subtle"},null,8,["label","theme"])]),_:2},1032,["text"])])]))),128))]),t(e).data.feedback_rating?(c(),C(V,{key:0,class:"border-b text-base text-gray-600",ticket:t(e).data},null,8,["ticket"])):b("",!0),i("div",Ne,[(c(!0),f(P,null,z(x.value,n=>(c(),f("div",Oe,[i("span",Ue,h(n.label),1),i("span",{class:N(["text-base text-gray-800 flex-1",!n.value&&"text-ink-gray-4"])},h(n.value||"—"),3)]))),256))])])}}}),Ke={key:0,class:"flex flex-col"},qe={class:"flex overflow-hidden h-full w-full"},Ge={class:"flex flex-col flex-1 w-full md:max-w-[calc(100%-382px)]"},Je=["onKeydownCapture"],yt=q({__name:"TicketCustomer",props:{ticketId:{}},setup(M){const A=pe(()=>ke(()=>import("./TicketTextEditor-7b93d888.js"),["assets/TicketTextEditor-7b93d888.js","assets/index-b4c863a6.js","assets/index-66cee687.css","assets/AttachmentItem.vue_vue_type_script_setup_true_lang-b54cd9d5.js","assets/TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js","assets/TypingIndicator-f6a7560f.css","assets/dayjs-95f8111d.js","assets/knowledgeBase-2d00b929.js","assets/UserAvatar.vue_vue_type_script_setup_true_lang-e554c997.js","assets/Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js","assets/file-to-base64-e61fad39.js","assets/popper-0aa08b12.js","assets/chevron-left-d60af664.js","assets/chevron-right-cd59273c.js","assets/plus-3c348a65.js","assets/file-to-base64-e1a7a8ca.css","assets/FileUploader-44680597.js"])),I=ne(),e=M,{getStatus:E}=he(),l=B({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_one",cache:["Ticket",e.ticketId],params:{name:e.ticketId,is_customer_portal:le.value},auto:!0,onSuccess:o=>{var a;o.status=(a=E(o.status))==null?void 0:a.label_customer,$e(l,{doc:o,call:ie,router:I,toast:T,$dialog:F,updateField:V,createToast:T.create})},onError:()=>{T.error(_("Ticket not found")),I.replace("/my-tickets")}});_e(G,l);const S=$(null),v=$(""),x=$([]),s=$(!1),r=$(!1),{isMobileView:p}=re(),{$dialog:F}=xe(),g=B({url:"run_doc_method",debounce:300,makeParams:()=>({dt:"HD Ticket",dn:e.ticketId,method:"create_communication_via_contact",args:{message:v.value,attachments:x.value}}),onSuccess:()=>{S.value.editor.commands.clearContent(!0),x.value=[],r.value=!1,l.reload()}});function V(o,a,y=()=>{}){J(o,a),y()}function n(){fe(v.value)||g.loading||g.submit()}function J(o,a){B({url:"frappe.client.set_value",params:{doctype:"HD Ticket",name:e.ticketId,fieldname:o,value:a},auto:!0,onSuccess:()=>{l.reload(),T.success(_("Ticket updated"))}})}function W(){te.value?s.value=!0:X()}function X(){F({title:_("Close Ticket"),message:_("Are you sure you want to close this ticket?"),actions:[{label:_("Confirm"),variant:"solid",onClick(o){l.data.status="Closed",Q.submit({fieldname:"status",value:"Closed"},{onSuccess:()=>{T.success(_("Ticket closed"))}}),o()}}]})}const Q=B({url:"frappe.client.set_value",debounce:300,makeParams:o=>({doctype:"HD Ticket",name:e.ticketId,fieldname:o.fieldname,value:o.value}),onSuccess:()=>{s.value=!1,l.reload()}}),Y=w(()=>{var a;let o=[{label:_("Tickets"),route:{name:"TicketsCustomer"}}];return o.push({label:(a=l.data)==null?void 0:a.subject,route:{name:"TicketCustomer"}}),o}),Z=w(()=>l.data.status!=="Closed"),{isFeedbackMandatory:ee}=ce(),te=w(()=>{var a,y;return((y=(a=l.data)==null?void 0:a.communications)==null?void 0:y.some(j=>j.sender!==l.data.raised_by))&&ee}),{startViewing:ae,stopViewing:se}=ge(e.ticketId);return de(()=>{ae(e.ticketId),document.title=e.ticketId,O.on("helpdesk:ticket-update",({ticket_id:o})=>{o===e.ticketId&&l.reload()})}),ue(()=>{se(e.ticketId),document.title="Helpdesk",O.off("helpdesk:ticket-update")}),(o,a)=>{const y=ve,j=be;return t(l).data?(c(),f("div",Ke,[m(t(ye),null,{"left-header":k(()=>[m(t(De),{items:Y.value},null,8,["items"])]),"right-header":k(()=>[t(l).data._customActions?(c(),C(y,{key:0,actions:t(l).data._customActions},null,8,["actions"])):b("",!0),t(l).data.status!=="Closed"?(c(),C(t(U),{key:1,label:t(_)("Close"),theme:"gray",variant:"solid",onClick:a[0]||(a[0]=d=>W())},{prefix:k(()=>[m(j,{class:"size-4"})]),_:1},8,["label"])):b("",!0)]),_:1}),i("div",qe,[i("section",Ge,[t(p)?(c(),C(Se,{key:0})):b("",!0),m(Ie,{class:"grow"}),i("div",{class:"w-full p-5",onKeydownCapture:[L(K(n,["ctrl","stop"]),["enter"]),L(K(n,["meta","stop"]),["enter"])]},[Z.value?(c(),C(t(A),{key:0,ref_key:"editor",ref:S,attachments:x.value,"onUpdate:attachments":a[1]||(a[1]=d=>x.value=d),content:v.value,"onUpdate:content":a[2]||(a[2]=d=>v.value=d),expand:r.value,"onUpdate:expand":a[3]||(a[3]=d=>r.value=d),placeholder:t(_)("Type a message"),autofocus:"",onClear:a[4]||(a[4]=()=>r.value=!1),uploadFunction:d=>t(me)(d,"HD Ticket",e.ticketId)},{"bottom-right":k(()=>{var d;return[m(t(U),{label:t(_)("Send"),theme:"gray",variant:"solid",disabled:((d=o.$refs.editor)==null?void 0:d.editor.isEmpty)||t(g).loading,loading:t(g).loading,onClick:n},null,8,["label","disabled","loading"])]}),_:1},8,["attachments","content","expand","placeholder","uploadFunction"])):b("",!0)],40,Je)]),t(p)?b("",!0):(c(),C(Le,{key:0,onOpen:a[5]||(a[5]=d=>r.value=!0)}))]),m(Fe,{open:s.value,"onUpdate:open":a[6]||(a[6]=d=>s.value=d)},null,8,["open"])])):b("",!0)}}});export{yt as default};
//# sourceMappingURL=TicketCustomer-60e214e7.js.map
