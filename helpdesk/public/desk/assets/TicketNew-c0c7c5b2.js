import{d as M,c as b,K as x,a9 as R,W as L,aK as Q,e as c,k as h,l as v,t as H,v as O,y as _,f as N,x as Z,s as ee,u as te,a as ae,A as U,p as le,J as g,al as z,q as p,N as se,g as k,w as $,h as l,F as oe,G as ie,a8 as ne,an as B,ao as P,a1 as j,aN as re,i as de,_ as ue,X as ce}from"./index-b4c863a6.js";import{_ as me}from"./CustomActions-e59e4907.js";import{g as pe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js";import"./dayjs-95f8111d.js";import"./knowledgeBase-2d00b929.js";import{_ as fe}from"./LayoutHeader-0efddba1.js";import{_ as E}from"./Autocomplete-3ef14fd0.js";import{a as ve}from"./Link-842a8a10.js";import{s as he,p as _e,h as ge,a as ke}from"./formCustomisation-8a41b461.js";import{s as q}from"./index-cc785cd6.js";import{_ as ye}from"./SearchArticles.vue_vue_type_script_setup_true_lang-d788ab03.js";import{u as be}from"./onboarding-89cf30fe.js";import{u as xe}from"./pageMeta-b63f711b.js";import{_ as Ce}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-c05e3797.js";import"./Dropdown-f79f7542.js";import"./index-6b12b9aa.js";import"./index-3720151f.js";const Te={key:0,class:"space-y-1.5"},we={class:"block text-sm text-gray-700"},Se={key:0,class:"place-self-center text-red-500"},Fe=M({__name:"UniInput",props:{field:{},value:{type:[String,Number,Boolean]}},emits:["change"],setup(f,{emit:C}){const s=f,T=C,A=b(()=>s.field.url_method?x(E,{options:D.data,size:"sm"}):s.field.fieldtype==="Link"&&s.field.options?x(ve,{doctype:s.field.options,filters:s.field.filters}):s.field.fieldtype==="Select"?x(E,{options:s.field.options.split(`
`).map(o=>({label:o,value:o})),size:"sm"}):s.field.fieldtype==="Check"?x(E,{options:[{label:"Yes",value:1},{label:"No",value:0}],size:"sm"}):x(R,{debounce:500})),D=L({url:s.field.url_method,auto:!!s.field.url_method,transform:o=>Q(o)}),w=b(()=>s.field.fieldtype==="Check"?s.value?"Yes":"No":s.value),S=b(()=>s.field.placeholder?s.field.placeholder:s.field.fieldtype==="Data"&&!s.field.url_method?"Type something":s.field.fieldtype==="Select"||s.field.fieldtype==="Link"?"Select an option":"Type something");function d(o,u){T("change",{fieldname:o,value:u})}return(o,u)=>f.field.display_via_depends_on?(c(),h("div",Te,[v("span",we,[H(O(f.field.label)+" ",1),f.field.required?(c(),h("span",Se," * ")):_("",!0)]),(c(),N(Z(A.value),{placeholder:S.value,value:w.value,disabled:f.field.disabled,"model-value":w.value,"onUpdate:modelValue":u[0]||(u[0]=i=>d(f.field.fieldname,i)),onChange:u[1]||(u[1]=i=>{var m;return d(f.field.fieldname,((m=i.target)==null?void 0:m.value)||i.value||i)})},null,40,["placeholder","value","disabled","model-value"]))])):_("",!0)}}),$e={class:"flex flex-col overflow-y-auto"},Ne={class:"flex flex-col gap-5 py-6 h-full flex-1 self-center overflow-auto mx-auto w-full max-w-4xl px-5"},Ae={key:0,class:""},De=["innerHTML"],Ve={key:1,class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Ie={class:"flex flex-col gap-2"},Ue={class:"block text-sm text-gray-700"},Ee={key:1},Le={key:2},et=M({__name:"TicketNew",props:{templateId:{default:""}},setup(f){const C=de(()=>ue(()=>import("./TicketTextEditor-7b93d888.js"),["assets/TicketTextEditor-7b93d888.js","assets/index-b4c863a6.js","assets/index-66cee687.css","assets/AttachmentItem.vue_vue_type_script_setup_true_lang-b54cd9d5.js","assets/TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js","assets/TypingIndicator-f6a7560f.css","assets/dayjs-95f8111d.js","assets/knowledgeBase-2d00b929.js","assets/UserAvatar.vue_vue_type_script_setup_true_lang-e554c997.js","assets/Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js","assets/file-to-base64-e61fad39.js","assets/popper-0aa08b12.js","assets/chevron-left-d60af664.js","assets/chevron-right-cd59273c.js","assets/plus-3c348a65.js","assets/file-to-base64-e1a7a8ca.css","assets/FileUploader-44680597.js"])),s=f;ee();const T=te(),{$dialog:A}=pe(),{updateOnboardingStep:D}=be("helpdesk"),{isManager:w,userId:S}=ae(),d=U(""),o=U(""),u=U([]),i=le({}),m=L({url:"helpdesk.helpdesk.doctype.hd_ticket_template.api.get_one",makeParams:()=>({name:s.templateId||"Default"}),auto:!0,onSuccess:e=>{o.value=e.description_template||"",V=window.structuredClone(e.fields||[]),he(m,{doc:i,call:ce,router:T,$dialog:A,applyFilters:Y}),K(e.fields)}});function K(e){e.forEach(a=>{i[a.fieldname]=""})}let V=[];function Y(e,a=null){const n=m.data.fields.find(r=>r.fieldname===e);n&&(n.fieldtype==="Select"?ge(n,e,a,i,V):n.fieldtype==="Link"&&ke(n,e,a,i,V))}const G=b(()=>{var e;return(e=m.data)==null?void 0:e._customOnChange}),I=b(()=>{var a,n;let e=(n=(a=m.data)==null?void 0:a.fields)==null?void 0:n.filter(r=>!g.value||!r.hide_from_customer);return e?e.map(r=>_e(r,i)):[]});function J(e,a,n){var t;i[a]=e.value;const r=(t=G.value)==null?void 0:t[a];r&&r.forEach(y=>{y(e.value,n)})}const F=L({url:"helpdesk.helpdesk.doctype.hd_ticket.api.new",debounce:300,makeParams:()=>({doc:{description:o.value,subject:d.value,template:s.templateId,...i},attachments:u.value}),validate:e=>{var r;const n=[...((r=I.value)==null?void 0:r.filter(t=>t.required))||[],"subject","description"];for(const t of n)if(!e.doc[t.fieldname||t])return`${t.label||t} is required`},onSuccess:e=>{T.push({name:g.value?"TicketCustomer":"TicketAgent",params:{ticketId:e.name}}),w&&D("create_first_ticket",!0,!1,()=>localStorage.setItem("firstTicket",e.name)),g.value&&z("new_ticket_submitted",{data:{user:S,ticketID:e.name,subject:d.value,description:o.value,customFields:i}})}});function W(e){return q(e,{allowedTags:q.defaults.allowedTags.concat(["img"])})}const X=b(()=>[{label:p("Tickets"),route:{name:g.value?"TicketsCustomer":"TicketsAgent"}},{label:p("New Ticket"),route:{name:"TicketNew"}}]);return xe(()=>({title:p("New Ticket")})),se(()=>{z("new_ticket_page",{data:{user:S}})}),(e,a)=>{var r;const n=me;return c(),h("div",$e,[k(l(fe),null,{"left-header":$(()=>[k(l(Ce),{items:X.value},null,8,["items"])]),"right-header":$(()=>{var t,y;return[(t=l(m).data)!=null&&t._customActions?(c(),N(n,{key:0,actions:(y=l(m).data)==null?void 0:y._customActions},null,8,["actions"])):_("",!0)]}),_:1}),v("div",Ne,[(r=l(m).data)!=null&&r.about?(c(),h("div",Ae,[v("div",{class:"prose-f",innerHTML:W(l(m).data.about)},null,8,De)])):_("",!0),I.value?(c(),h("div",Ve,[(c(!0),h(oe,null,ie(I.value,t=>(c(),N(l(Fe),{key:t.fieldname,field:t,value:i[t.fieldname],onChange:y=>J(y,t.fieldname,t.fieldtype)},null,8,["field","value","onChange"]))),128))])):_("",!0),v("div",{class:ne(["flex flex-col",(d.value.length>=2||o.value.length)&&"gap-5"])},[v("div",Ie,[v("span",Ue,[H(O(l(p)("Subject"))+" ",1),a[7]||(a[7]=v("span",{class:"place-self-center text-red-500"}," * ",-1))]),k(l(R),{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=t=>d.value=t),type:"text",placeholder:l(p)("A short description")},null,8,["modelValue","placeholder"])]),l(g)?(c(),N(ye,{key:0,query:d.value,class:"shadow"},null,8,["query"])):_("",!0),l(g)?(c(),h("div",Ee,[B(v("h4",{class:"text-p-sm text-gray-500 ml-1"},O(l(p)("Please enter a subject to continue")),513),[[P,d.value.length<=2&&o.value.length===0]]),B(k(l(C),{ref:"editor",attachments:u.value,"onUpdate:attachments":a[2]||(a[2]=t=>u.value=t),content:o.value,"onUpdate:content":a[3]||(a[3]=t=>o.value=t),placeholder:l(p)("Detailed explanation"),expand:"",uploadFunction:t=>l(re)(t)},{"bottom-right":$(()=>[k(l(j),{label:l(p)("Submit"),theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||l(F).loading||!d.value,onClick:a[1]||(a[1]=()=>l(F).submit())},null,8,["label","disabled"])]),_:1},8,["attachments","content","placeholder","uploadFunction"]),[[P,d.value.length>2||o.value.length>0]])])):_("",!0)],2),l(g)?_("",!0):(c(),h("div",Le,[k(l(C),{ref:"editor",attachments:u.value,"onUpdate:attachments":a[5]||(a[5]=t=>u.value=t),content:o.value,"onUpdate:content":a[6]||(a[6]=t=>o.value=t),placeholder:l(p)("Detailed explanation"),expand:""},{"bottom-right":$(()=>[k(l(j),{label:l(p)("Submit"),theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||l(F).loading||!d.value,onClick:a[4]||(a[4]=()=>l(F).submit())},null,8,["label","disabled"])]),_:1},8,["attachments","content","placeholder"])]))])])}}});export{et as default};
//# sourceMappingURL=TicketNew-c0c7c5b2.js.map
