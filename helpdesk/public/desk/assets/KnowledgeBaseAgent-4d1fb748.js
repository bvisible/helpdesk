import{_ as W}from"./plus-3c348a65.js";import{_ as j}from"./LayoutHeader-0efddba1.js";import{_ as z}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-2e0a7a26.js";import{d as D,m as V,n as M,c as H,A as p,a4 as J,e as S,f as E,w as h,l as k,an as X,b2 as Y,h as _,I,r as Z,t as $,v as N,g,u as ee,p as te,W as le,q as l,ad as ae,S as m,K as B,Q as oe,L as re,N as se,al as U,k as ie,a1 as ne}from"./index-b4c863a6.js";import{g as ue}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js";import"./dayjs-95f8111d.js";import{d as ce,a as de,m as me,n as ge,u as pe,b as fe}from"./knowledgeBase-2d00b929.js";import{a as ye}from"./Link-842a8a10.js";import{_ as ve}from"./MoveToCategoryModal.vue_vue_type_script_setup_true_lang-c6f2bc34.js";import{L as be}from"./merge-255e3c9f.js";import{u as Ce}from"./pageMeta-b63f711b.js";import{D as he}from"./Dropdown-f79f7542.js";import"./StarRating.vue_vue_type_script_setup_true_lang-4484b1d1.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-d7f22ac0.js";import"./utils-4e66359c.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-a14f638d.js";import"./EditIcon-f33e48c1.js";import"./portal-302b46c8.js";import"./popper-0aa08b12.js";import"./MultipleAvatar.vue_vue_type_script_setup_true_lang-20371312.js";import"./Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js";import"./ticketStatus-60f6a20e.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-eb9071a9.js";import"./index-3720151f.js";import"./TabButtons-928aa2d2.js";import"./description-c763d251.js";const _e={class:"flex flex-col flex-1 gap-3"},we=D({__name:"CategoryModal",props:V({title:{type:String,default:""},edit:{type:Boolean,default:!1}},{modelValue:{type:Boolean},modelModifiers:{},title:{},titleModifiers:{}}),emits:V(["update","create"],["update:modelValue","update:title"]),setup(f,{emit:v}){const b=f,a=v,d=M(f,"modelValue"),n=M(f,"title"),o=H(()=>b.edit?"Edit Category":"Create Category"),u=p(null);J(()=>u.value,i=>{i&&(u.value.style.height=(i.scrollHeight>i.clientHeight,i.scrollHeight+"px"))});function c(){const i=[];return b.edit?i.push({label:"Save",variant:"solid",onClick:()=>{a("update")}}):i.push({label:"Create",variant:"solid",onClick:()=>{a("create")}}),i}return(i,y)=>(S(),E(_(I),{modelValue:d.value,"onUpdate:modelValue":y[2]||(y[2]=C=>d.value=C),options:{title:o.value,actions:c()}},{"body-content":h(()=>[k("div",_e,[X(k("textarea",{class:"text-base rounded py-1.5 px-2 border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full block",ref_key:"titleRef",ref:u,placeholder:"Support Issues","onUpdate:modelValue":y[0]||(y[0]=C=>n.value=C),rows:1,maxlength:"50",autofocus:"",onInput:y[1]||(y[1]=C=>{const A=C.target;A.style.height=`${A.scrollHeight}px`})},null,544),[[Y,n.value]])])]),_:1},8,["modelValue","options"]))}}),ke={class:"text-p-base text-ink-gray-8 mb-4"},Ae={class:"whitespace-nowrap font-semibold"},xe=D({__name:"MergeCategoryModal",props:V({categoryId:{},categoryTitle:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:V(["merge"],["update:modelValue"]),setup(f,{emit:v}){const b=v,a=M(f,"modelValue"),d=p("");return(n,o)=>{const u=Z("Button");return S(),E(_(I),{options:{title:"Merge with another category"},onAfterLeave:o[2]||(o[2]=()=>{d.value=null}),modelValue:a.value,"onUpdate:modelValue":o[3]||(o[3]=c=>a.value=c)},{"body-content":h(()=>[k("p",ke,[o[4]||(o[4]=$(" This will move all articles of the ",-1)),k("span",Ae,N(f.categoryTitle),1),o[5]||(o[5]=$(" category to the selected category. This change is irreversible! ",-1))]),g(_(ye),{class:"form-control",doctype:"HD Article Category",placeholder:"Select Category",modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=c=>d.value=c),label:"Category","page-length":100},null,8,["modelValue"])]),actions:h(()=>[g(u,{class:"w-full",variant:"solid",label:"Merge",onClick:o[1]||(o[1]=c=>b("merge",f.categoryId,d.value))})]),_:1},8,["modelValue"])}}}),Ve={class:"flex flex-col"},Me={class:"text-lg font-medium text-gray-900"},et=D({__name:"KnowledgeBaseAgent",setup(f){const v=ee(),{$dialog:b}=ue(),a=te({title:"",id:""}),d=p(""),n=p(null),o=p(!1),u=p(!1),c=p(!1),i=p(!1),y=le({url:"helpdesk.api.knowledge_base.get_general_category",auto:!0,cache:["GeneralCategory"]}),C=[{label:l("Category"),icon:"folder",onClick:()=>{x(),o.value=!1,u.value=!0}},{label:l("Article"),icon:"file-text",onClick:()=>{v.push({name:"NewArticle",params:{id:y.data},query:{title:"General"}})}}],A=[{label:l("Add New Article"),icon:"plus",onClick:e=>{v.push({name:"NewArticle",params:{id:e.group.value},query:{title:e.group.label}})}},{label:l("Edit Title"),icon:"edit",onClick:e=>{o.value=!0,u.value=!0,a.title=e.group.label,a.id=e.group.value,d.value=e.group.label}},{label:l("Merge"),icon:be,onClick:e=>{i.value=!0,a.title=e.group.label,a.id=e.group.value}},{label:l("Share"),icon:"link",onClick:async({group:e})=>{const{label:t,value:s}=e,r=new URL(window.location.href);r.pathname=`/helpdesk/kb-public/${s}`,await ae(r.toString(),l("Category '{0}' link copied to clipboard",[t]))}},{label:l("Delete"),icon:"trash-2",onClick:e=>{P(e)}}],w=p(new Set),L=[{label:l("Move To"),icon:"corner-up-right",onClick:e=>{w.value=new Set(e),c.value=!0}},{label:l("Delete"),icon:"trash-2",onClick:e=>{w.value=e,b({title:l("Delete articles?"),message:l("Are you sure you want to delete these articles?"),actions:[{label:l("Confirm"),variant:"solid",onClick({close:t}){G(),t()}}]})}}];function R(e){me.submit({category:e,articles:Array.from(w.value)},{onSuccess:()=>{var t,s;c.value=!1,(t=n.value)==null||t.reload(),(s=n.value)==null||s.unselectAll(),w.value.clear(),m.success(l("Articles moved"))},onError:t=>{var r;const s=((r=t==null?void 0:t.messages)==null?void 0:r[0])||t.message;m.error(s),c.value=!1}})}function q(){ge.submit({title:a.title},{onSuccess:e=>{n.value.reload(),u.value=!1,v.push({name:"Article",params:{articleId:e.article},query:{category:e.category,title:a.title,isEdit:1}}),m.success(l("Category created")),U("category_created",{data:{category:a.title}}),x()},onError:e=>{m.error(e)}})}function K(){if(a.title===d.value){u.value=!1,o.value=!1;return}pe.submit({doctype:"HD Article Category",name:a.id,fieldname:"category_name",value:a.title},{onSuccess:()=>{n.value.reload(),u.value=!1,o.value=!1,m.success(l("Category updated")),x()},onError:e=>{m.error(e)}})}function P(e){b({title:l("Delete category?"),message:l("All articles from this category will move to General category."),actions:[{label:l("Confirm"),variant:"solid",onClick(t){ce.submit({doctype:"HD Article Category",name:e.group.value},{onSuccess:()=>{m.success(l("Category deleted")),n.value.reload()}}),t()}}]})}function G(){de.submit({articles:Array.from(w.value)},{onSuccess:()=>{var e,t,s;(e=n.value)==null||e.reload(),(t=n.value)==null||t.unselectAll(),(s=w.value)==null||s.clear(),m.success(l("Articles deleted"))}})}function F(e,t){fe.submit({source:e,target:t},{onSuccess:()=>{n.value.reload(),m.success(l("Category merged")),i.value=!1,x()},onError:s=>{var T;const r=((T=s==null?void 0:s.messages)==null?void 0:T[0])||s.message;m.error(r)}})}function x(){a.title="",a.id="",d.value=""}const O=H(()=>({doctype:"HD Article",selectable:!0,view:{view_type:"group_by",group_by_field:"category",label_doc:"HD Article Category",label_field:"category_name"},columnConfig:{title:{prefix:()=>B(oe,{name:"file-text",class:"h-4 w-4 flex-shrink-0 text-ink-gray-6"})},status:{custom:({item:e})=>B(re,{...Q[e]})}},rowRoute:{name:"Article",prop:"articleId"},groupByActions:A,showSelectBanner:!0,selectBannerActions:L,default_page_length:100})),Q={Published:{label:l("Published"),theme:"green"},Draft:{label:l("Draft"),theme:"orange"},Archived:{label:l("Archived"),theme:"gray"}};return se(()=>{U("kb_agent_page_viewed")}),Ce(()=>({title:l("Knowledge Base")})),(e,t)=>{const s=W;return S(),ie("div",Ve,[g(j,null,{"left-header":h(()=>[k("div",Me,N(_(l)("Knowledge Base")),1)]),"right-header":h(()=>[g(_(he),{options:C},{default:h(()=>[g(_(ne),{label:_(l)("Create"),variant:"solid"},{prefix:h(()=>[g(s,{class:"h-4 w-4"})]),_:1},8,["label"])]),_:1})]),_:1}),g(z,{ref_key:"listViewRef",ref:n,options:O.value,onRowClick:t[0]||(t[0]=r=>e.$router.push(`kb/articles/${r}`))},null,8,["options"]),g(we,{edit:o.value,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=r=>u.value=r),title:a.title,"onUpdate:title":t[2]||(t[2]=r=>a.title=r),onUpdate:K,onCreate:q},null,8,["edit","modelValue","title"]),g(ve,{modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=r=>c.value=r),onMove:R},null,8,["modelValue"]),g(xe,{categoryTitle:a.title,"category-id":a.id,modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=r=>i.value=r),onMerge:F},null,8,["categoryTitle","category-id","modelValue"])])}}});export{et as default};
//# sourceMappingURL=KnowledgeBaseAgent-4d1fb748.js.map
