import{j as w,k as v,l,e as d,d as G,m as A,n as R,z as h,a as K,V as H,c as ee,J as Q,Q as Z,T as te,am as se,aL as oe,bU as ne,a3 as j,f as k,w as z,r as P,t as y,h as c,x as N,g as n,E as le,v as ie,L as re,s as E,a8 as ue,F as ae,ap as ce,P as Y,bV as de,bW as I,bX as W,b0 as D,a9 as F,ab as ve,H as me}from"./index-3194ec9b.js";import{_ as X}from"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";import{a as pe}from"./Link-431cfb69.js";const ge={},fe={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function _e(p,i){return d(),v("svg",fe,[...i[0]||(i[0]=[l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.5 1C4.77614 1 5 1.22386 5 1.5V2.5L5 2.50056C5.15613 2.5 5.32244 2.5 5.5 2.5H10.5C10.6776 2.5 10.8439 2.5 11 2.50056C11 2.50037 11 2.50019 11 2.5V1.5C11 1.22386 11.2239 1 11.5 1C11.7761 1 12 1.22386 12 1.5V2.5C12 2.50803 11.9998 2.51602 11.9994 2.52395C12.49 2.55387 12.838 2.62116 13.135 2.77248C13.6054 3.01217 13.9878 3.39462 14.2275 3.86502C14.5 4.3998 14.5 5.09987 14.5 6.5V10.5C14.5 11.9001 14.5 12.6002 14.2275 13.135C13.9878 13.6054 13.6054 13.9878 13.135 14.2275C12.6002 14.5 11.9001 14.5 10.5 14.5H5.5C4.09987 14.5 3.3998 14.5 2.86502 14.2275C2.39462 13.9878 2.01217 13.6054 1.77248 13.135C1.5 12.6002 1.5 11.9001 1.5 10.5V6.5C1.5 5.09987 1.5 4.3998 1.77248 3.86502C2.01217 3.39462 2.39462 3.01217 2.86502 2.77248C3.16202 2.62116 3.51 2.55387 4.00056 2.52395C4.00019 2.51602 4 2.50803 4 2.5V1.5C4 1.22386 4.22386 1 4.5 1ZM5.5 3.5H10.5C11.2166 3.5 11.6938 3.50078 12.0606 3.53074C12.4156 3.55975 12.5781 3.61105 12.681 3.66349C12.9632 3.8073 13.1927 4.03677 13.3365 4.31901C13.389 4.42194 13.4403 4.5844 13.4693 4.93944C13.4916 5.21337 13.4977 5.54901 13.4994 6H2.50061C2.50226 5.54901 2.50836 5.21337 2.53074 4.93944C2.55975 4.5844 2.61105 4.42194 2.66349 4.31901C2.8073 4.03677 3.03677 3.8073 3.31901 3.66349C3.42194 3.61105 3.5844 3.55975 3.93944 3.53074C4.30615 3.50078 4.78343 3.5 5.5 3.5ZM2.5 7V10.5C2.5 11.2166 2.50078 11.6939 2.53074 12.0606C2.55975 12.4156 2.61105 12.5781 2.66349 12.681C2.8073 12.9632 3.03677 13.1927 3.31901 13.3365C3.42194 13.389 3.5844 13.4403 3.93944 13.4693C4.30615 13.4992 4.78343 13.5 5.5 13.5H10.5C11.2166 13.5 11.6938 13.4992 12.0606 13.4693C12.4156 13.4403 12.5781 13.389 12.681 13.3365C12.9632 13.1927 13.1927 12.9632 13.3365 12.681C13.389 12.5781 13.4403 12.4156 13.4693 12.0606C13.4992 11.6939 13.5 11.2166 13.5 10.5V7H2.5Z",fill:"currentColor"},null,-1)])])}const Ce=w(ge,[["render",_e]]),he={},ye={width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ke(p,i){return d(),v("svg",ye,[...i[0]||(i[0]=[l("g",{"clip-path":"url(#clip0_4750_5685)"},[l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.4375 6C10.4375 8.45076 8.45076 10.4375 6 10.4375C3.54924 10.4375 1.5625 8.45076 1.5625 6C1.5625 3.54924 3.54924 1.5625 6 1.5625C8.45076 1.5625 10.4375 3.54924 10.4375 6ZM11.4375 6C11.4375 9.00305 9.00305 11.4375 6 11.4375C2.99695 11.4375 0.5625 9.00305 0.5625 6C0.5625 2.99695 2.99695 0.5625 6 0.5625C9.00305 0.5625 11.4375 2.99695 11.4375 6ZM9.00005 5.50004C9.27619 5.50004 9.50004 5.72391 9.50004 6.00005C9.50004 6.27619 9.27618 6.50004 9.00003 6.50004L6.25001 6.5C5.8358 6.49999 5.50003 6.16421 5.50002 5.75L5.5 3C5.5 2.72386 5.72385 2.5 6 2.5C6.27614 2.5 6.5 2.72385 6.5 3L6.50002 5.5L9.00005 5.50004Z",fill:"currentColor"})],-1),l("defs",null,[l("clipPath",{id:"clip0_4750_5685"},[l("rect",{width:"12",height:"12",fill:"white"})])],-1)])])}const xe=w(he,[["render",ke]]),be={Completed:"green",Busy:"orange",Failed:"red",Initiated:"gray",Queued:"gray",Canceled:"gray",Ringing:"gray","No Answer":"red","In Progress":"blue"},we={Completed:"Completed",Initiated:"Initiated",Busy:"Declined",Failed:"Failed",Queued:"Queued",Canceled:"Canceled",Ringing:"Ringing","No Answer":"Missed Call","In Progress":"In Progress"},Le={},$e={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ve(p,i){return d(),v("svg",$e,[...i[0]||(i[0]=[l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.9998 3.5H4.92871C4.65257 3.5 4.42871 3.72386 4.42871 4C4.42871 4.27614 4.65257 4.5 4.92871 4.5H10.7929L3.64645 11.6464C3.45118 11.8417 3.45118 12.1583 3.64645 12.3536C3.84171 12.5488 4.15829 12.5488 4.35355 12.3536L11.4998 5.20733V11.0711C11.4998 11.3472 11.7236 11.5711 11.9998 11.5711C12.2759 11.5711 12.4998 11.3472 12.4998 11.0711V4.0149C12.5037 3.88202 12.455 3.74787 12.3536 3.64645C12.281 3.57388 12.1917 3.52828 12.098 3.50965C12.0813 3.50632 12.0643 3.50383 12.0471 3.50221C12.0336 3.50095 12.02 3.50022 12.0062 3.50004C12.0041 3.50001 12.0019 3.5 11.9998 3.5Z",fill:"currentColor"},null,-1)])])}const Me=w(Le,[["render",Ve]]),Ie={},De={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Se(p,i){return d(),v("svg",De,[...i[0]||(i[0]=[l("path",{d:"M9.02099 11.5599C10.662 11.5599 11.9923 10.2295 11.9923 8.58852C11.9923 6.9475 10.662 5.61719 9.02099 5.61719C7.37996 5.61719 6.04965 6.9475 6.04965 8.58852C6.04965 10.2295 7.37996 11.5599 9.02099 11.5599Z",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),l("path",{d:"M3.92462 15.2834C4.245 14.2791 4.85628 13.3883 5.68566 12.7269C6.63325 11.9711 7.80938 11.5596 9.02143 11.5596C10.2335 11.5596 11.4096 11.9711 12.3572 12.7269C13.1866 13.3883 13.7979 14.2791 14.1182 15.2834",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),l("rect",{x:"2.25",y:"2.25",width:"13.5",height:"13.5",rx:"2.5",stroke:"currentColor"},null,-1)])])}const Be=w(Ie,[["render",Se]]),Te={},He={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ne(p,i){return d(),v("svg",He,[...i[0]||(i[0]=[l("g",{"clip-path":"url(#clip0_3668_69185)"},[l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),l("defs",null,[l("clipPath",{id:"clip0_3668_69185"},[l("rect",{width:"16",height:"16",fill:"white"})])],-1)])])}const Pe=w(Te,[["render",Ne]]),Oe={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Ue={class:"mb-5 flex items-center justify-between"},qe={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},Ze={class:"flex items-center gap-1"},Fe={class:"flex flex-col gap-3.5"},Ae={class:"grid size-7 place-content-center"},Re={class:"flex min-h-7 w-full items-center gap-2"},je={key:0,class:"flex items-center gap-1"},ze={class:"ml-1 flex flex-col gap-1"},Je={class:"ml-1 flex flex-col gap-1"},Qe={key:2,class:"w-full"},Ee=["src"],Ye={key:3,class:"w-full"},We=["onClick"],Xe=G({__name:"CallLogDetailModal",props:A({callLogId:{type:String,default:""},hideTicket:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{},callLogModal:{},callLogModalModifiers:{}}),emits:["update:modelValue","update:callLogModal"],setup(p){const i=R(p,"modelValue"),f=h(null),{isManager:C}=K(),g=p,L=H({url:"telephony.api.get_call_log",onSuccess(e){f.value=e},auto:!1}),$=ee(()=>{var _;if(!f.value)return[];let e=JSON.parse(JSON.stringify(f.value));for(const a in e)e[a]=r(a,e);let s=[{icon:Q(Z,{name:e.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:e.type.label+" Call"},{icon:Be,name:"receiver",value:{receiver:e.receiver,caller:e.caller}},{icon:Ce,name:"creation",value:e.creation.label,tooltip:e.creation.label},{icon:xe,name:"duration",value:e.duration.label},{icon:Pe,name:"status",value:e.status.label,color:e.status.color},{icon:Q(Z,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:e.recording_url}];const m=(_=e.links)==null?void 0:_.find(a=>a.link_doctype=="HD Ticket");return m&&!g.hideTicket&&s.push({icon:te,name:"ticket",value:m.link_name,link:()=>{window.open(`/helpdesk/tickets/${m.link_name}`)}}),s.filter(a=>a.value)}),O=R(p,"callLogModal");function x(){O.value=!0,ce(()=>{i.value=!1})}function r(e,s,m=[]){var b,S,B,T,V;let _=s.type==="Incoming";if(e==="duration")return{label:s._duration,icon:"clock"};if(e==="caller")return{label:(b=s._caller)==null?void 0:b.label,image:(S=s._caller)==null?void 0:S.image};if(e==="receiver")return{label:(B=s._receiver)==null?void 0:B.label,image:(T=s._receiver)==null?void 0:T.image};if(e==="type")return{label:s.type,icon:_?"phone-incoming":"phone-outgoing"};if(e==="status")return{label:we[s.status],color:be[s.status]};if(["modified","creation"].includes(e))return{label:se(s[e]).format("ddd, MMM D, YYYY h:mm a"),timeAgo:oe(s[e])};let a=(V=m==null?void 0:m.find(M=>(M.key||M.value)==e))==null?void 0:V.type;return a&&["Date","Datetime"].includes(a)?ne(s[e],""):s[e]}return j(i,e=>{e&&g.callLogId&&L.submit({name:g.callLogId})}),(e,s)=>{const m=P("Button"),_=P("Dialog");return d(),k(_,{modelValue:i.value,"onUpdate:modelValue":s[1]||(s[1]=a=>i.value=a)},{body:z(()=>[l("div",Oe,[l("div",Ue,[l("div",null,[l("h3",qe,y(e.__("Call Details")),1)]),l("div",Ze,[c(C)?(d(),k(m,{key:0,variant:"ghost",class:"w-7",onClick:x,icon:"edit"})):N("",!0),n(m,{variant:"ghost",class:"w-7",onClick:s[0]||(s[0]=a=>i.value=!1),icon:"x"})])]),l("div",Fe,[(d(!0),v(ae,null,le($.value,a=>(d(),v("div",{key:a.name,class:"flex gap-2 text-base text-ink-gray-8"},[l("div",Ae,[(d(),k(ie(a.icon),{class:"size-4 text-ink-gray-8"}))]),l("div",Re,[a.name=="receiver"?(d(),v("div",je,[n(c(X),{image:a.value.caller.image,label:a.value.caller.label,size:"sm"},null,8,["image","label"]),l("div",ze,y(a.value.caller.label),1),n(c(Z),{name:"arrow-right",class:"mx-1 h-4 w-4 text-ink-gray-5"}),n(c(X),{image:a.value.receiver.image,label:a.value.receiver.label,size:"sm"},null,8,["image","label"]),l("div",Je,y(a.value.receiver.label),1)])):a.tooltip?(d(),k(c(re),{key:1,text:a.tooltip},{default:z(()=>[E(y(a.value),1)]),_:2},1032,["text"])):a.name=="recording_url"?(d(),v("div",Qe,[l("audio",{class:"audio-control w-full",controls:"",src:a.value},null,8,Ee)])):a.name=="ticket"?(d(),v("div",Ye,[l("div",{class:"flex items-center gap-1.5 cursor-pointer",onClick:()=>a.link()},[E(" #"+y(a.value)+" ",1),n(Me,{class:"h-4 w-4 shrink-0 cursor-pointer text-ink-gray-5 hover:text-ink-gray-8"})],8,We)])):(d(),v("div",{key:4,class:ue(a.color?`text-${a.color}-600`:"")},y(a.value),3))])]))),128))])])]),_:1},8,["modelValue"])}}});const yl=w(Xe,[["__scopeId","data-v-2efa0524"]]),Ge={class:"px-4 pt-5 bg-surface-modal sm:px-6"},Ke={class:"flex items-center justify-between mb-5"},el={class:"flex items-center gap-2"},ll={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},al={class:"flex items-center gap-1"},tl={class:"flex flex-col gap-4"},sl={class:"grid grid-cols-2 gap-4"},ol={class:"flex flex-col gap-1.5"},nl={class:"flex flex-col gap-1.5"},il={class:"grid grid-cols-2 gap-4"},rl={class:"flex flex-col gap-1.5"},ul={class:"flex flex-col gap-1.5"},cl={class:"grid grid-cols-2 gap-4"},dl={class:"flex flex-col gap-1.5"},vl={key:0,class:"flex flex-col gap-1.5"},ml={key:1,class:"flex flex-col gap-1.5"},pl={class:"flex flex-col gap-1.5"},gl={class:"px-4 pt-4 pb-7 sm:px-6"},fl={class:"space-y-2"},kl=G({__name:"CallLogModal",props:A({callLogId:{type:String,default:""},ticketId:{type:String,default:""}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:A(["afterInsert"],["update:modelValue"]),setup(p,{emit:i}){const f=R(p,"modelValue"),C=h(!1),g=h(!1),L=h(!1),$=h(""),O=i,{user:x}=K(),r=h({type:"",to:"",from:"",status:"",duration:""}),e=h({receiver:"",caller:"",type:"",to:"",from:"",status:"",duration:0,ticket:""}),s=p,m=H({url:"telephony.api.get_call_log",onSuccess(o){const t=o.links.find(U=>U.link_doctype=="HD Ticket");e.value={receiver:o.receiver,caller:o.caller,type:o.type,to:o.to,from:o.from,status:o.status,duration:o.duration||0,ticket:String((t==null?void 0:t.link_name)||"")},$.value=JSON.stringify(e.value)},auto:!1}),_=[{label:"",value:""},{label:"Incoming",value:"Incoming"},{label:"Outgoing",value:"Outgoing"}],a=[{label:"",value:""},{label:"Completed",value:"Completed"},{label:"Busy",value:"Busy"},{label:"Failed",value:"Failed"},{label:"Initiated",value:"Initiated"},{label:"Queued",value:"Queued"},{label:"Canceled",value:"Canceled"},{label:"Ringing",value:"Ringing"},{label:"No Answer",value:"No Answer"},{label:"In Progress",value:"In Progress"}],b=ee(()=>({title:C.value?"Edit Call Log":"New Call Log",size:"xl",actions:[{label:C.value?"Save":"Create",variant:"solid",onClick:()=>{C.value?B():T()},disabled:!L.value}]})),S=()=>{e.value={receiver:"",caller:"",type:"",to:"",from:"",status:"",duration:0,ticket:""},$.value=JSON.stringify(e.value),r.value={type:"",to:"",from:"",status:"",duration:""},g.value=!1};function B(){if(M(),Object.values(r.value).some(t=>t)){Y.error("Please fill all required fields");return}g.value=!0;const o=[];e.value.ticket&&o.push({link_doctype:"HD Ticket",link_name:e.value.ticket}),m.data.links.forEach(t=>{t.link_doctype!="HD Ticket"&&o.push(t)}),e.value.receiver=="@me"&&(e.value.receiver=x),e.value.caller=="@me"&&(e.value.caller=x),H({url:"frappe.client.set_value",params:{doctype:"TP Call Log",name:s.callLogId,fieldname:{...e.value,links:o}},auto:!0,onSuccess(t){g.value=!1,V(t)}})}function T(){if(M(),Object.values(r.value).some(t=>t)){Y.error("Please fill all required fields");return}g.value=!0;const o=[];e.value.ticket&&o.push({link_doctype:"HD Ticket",link_name:e.value.ticket}),e.value.receiver=="@me"&&(e.value.receiver=x),e.value.caller=="@me"&&(e.value.caller=x),H({url:"telephony.api.create_call_log",params:{id:de(12),telephony_medium:"Manual",from_number:e.value.from,to_number:e.value.to,duration:e.value.duration,status:e.value.status,call_type:e.value.type,caller:e.value.caller,receiver:e.value.receiver,ticket:e.value.ticket,links:o},auto:!0,onSuccess(t){g.value=!1,V(t)},onError(){g.value=!1}})}function V(o){f.value=!1,O("afterInsert",o)}const M=()=>{e.value.type?r.value.type="":r.value.type="Type is required",e.value.to?/^\+?\d{8,15}$/.test(e.value.to)?r.value.to="":r.value.to="Please enter a valid phone number":r.value.to="To is required",e.value.from?/^\+?\d{8,15}$/.test(e.value.from)?r.value.from="":r.value.from="Please enter a valid phone number":r.value.from="From is required",e.value.status?r.value.status="":r.value.status="Status is required",e.value.duration?r.value.duration="":r.value.duration="Duration is required"};return j(e,o=>{L.value=JSON.stringify(o)!==$.value},{deep:!0}),j(f,o=>{o&&s.callLogId?(C.value=!0,m.submit({name:s.callLogId})):C.value=!1,o&&s.ticketId&&(e.value.ticket=String(s.ticketId))}),(o,t)=>{const U=P("Badge"),J=P("Button"),q=pe;return d(),k(c(me),{modelValue:f.value,"onUpdate:modelValue":t[9]||(t[9]=u=>f.value=u),options:b.value,onAfterLeave:S},{body:z(()=>[l("div",Ge,[l("div",Ke,[l("div",el,[l("h3",ll,y(o.__(b.value.title)||o.__("Untitled")),1),L.value?(d(),k(U,{key:0,label:"Not Saved",theme:"orange"})):N("",!0)]),l("div",al,[n(J,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=u=>f.value=!1),icon:"x"})])]),l("div",tl,[l("div",sl,[l("div",ol,[n(c(I),{label:"Type",required:""}),n(c(W),{modelValue:e.value.type,"onUpdate:modelValue":t[1]||(t[1]=u=>e.value.type=u),options:_,placeholder:"Select"},null,8,["modelValue"]),n(c(D),{message:r.value.type},null,8,["message"])]),l("div",nl,[n(c(I),{label:"To",required:""}),n(c(F),{modelValue:e.value.to,"onUpdate:modelValue":t[2]||(t[2]=u=>e.value.to=u),type:"text",placeholder:"+18596748596"},null,8,["modelValue"]),n(c(D),{message:r.value.to},null,8,["message"])])]),l("div",il,[l("div",rl,[n(c(I),{label:"From",required:""}),n(c(F),{modelValue:e.value.from,"onUpdate:modelValue":t[3]||(t[3]=u=>e.value.from=u),type:"text",placeholder:"+19138276548"},null,8,["modelValue"]),n(c(D),{message:r.value.from},null,8,["message"])]),l("div",ul,[n(c(I),{label:"Status",required:""}),n(c(W),{modelValue:e.value.status,"onUpdate:modelValue":t[4]||(t[4]=u=>e.value.status=u),options:a,placeholder:"Select"},null,8,["modelValue"]),n(c(D),{message:r.value.status},null,8,["message"])])]),l("div",cl,[l("div",dl,[n(c(I),{label:"Duration",required:""}),n(c(F),{modelValue:e.value.duration,"onUpdate:modelValue":t[5]||(t[5]=u=>e.value.duration=u),type:"number",placeholder:"Duration",description:"Call duration in seconds"},null,8,["modelValue"]),n(c(D),{message:r.value.duration},null,8,["message"])]),e.value.type==="Incoming"?(d(),v("div",vl,[n(q,{value:e.value.receiver,doctype:"User",placeholder:"Select",label:"Call Received By",onChange:t[6]||(t[6]=u=>e.value.receiver=u)},null,8,["value"])])):N("",!0),e.value.type==="Outgoing"?(d(),v("div",ml,[n(q,{value:e.value.caller,doctype:"User",placeholder:"Select",label:"Caller",onChange:t[7]||(t[7]=u=>e.value.caller=u)},null,8,["value"])])):N("",!0),l("div",pl,[n(q,{value:e.value.ticket,doctype:"HD Ticket",placeholder:"Select",label:"Ticket","show-description":!0,onChange:t[8]||(t[8]=u=>e.value.ticket=String(u))},null,8,["value"])])])])]),l("div",gl,[l("div",fl,[(d(!0),v(ae,null,le(b.value.actions,u=>(d(),k(J,ve({class:"w-full",key:u.label},{ref_for:!0},u,{label:o.__(u.label),loading:g.value}),null,16,["label","loading"]))),128))])])]),_:1},8,["modelValue","options"])}}});export{Ce as C,xe as D,kl as _,be as a,yl as b,we as s};
//# sourceMappingURL=CallLogModal.vue_vue_type_script_setup_true_lang-9a8921a1.js.map
