{"version":3,"file":"notification-a08fd36e.js","sources":["../../../../desk/src/stores/notification.ts"],"sourcesContent":["import { useAuthStore } from \"@/stores/auth\";\nimport { Notification, Resource } from \"@/types\";\nimport { createListResource, createResource } from \"frappe-ui\";\nimport { defineStore } from \"pinia\";\nimport { computed, ref, watch } from \"vue\";\n\nexport const useNotificationStore = defineStore(\"notification\", () => {\n  const authStore = useAuthStore();\n\n  const visible = ref(false);\n  const resource: Resource<Array<Notification>> = createListResource({\n    doctype: \"HD Notification\",\n    cache: \"Notifications\",\n    fields: [\n      \"creation\",\n      \"name\",\n      \"notification_type\",\n      \"read\",\n      \"reference_comment\",\n      \"reference_ticket\",\n      \"user_from\",\n      \"user_to\",\n    ],\n    orderBy: \"creation desc\",\n  });\n  const clear = createResource({\n    url: \"helpdesk.helpdesk.doctype.hd_notification.utils.clear\",\n    auto: false,\n    onSuccess: () => resource.reload(),\n  });\n\n  const read = (ticket) => {\n    createResource({\n      url: \"helpdesk.helpdesk.doctype.hd_notification.utils.clear\",\n      auto: true,\n      params: {\n        ticket: ticket,\n      },\n      onSuccess: () => resource.reload(),\n    });\n  };\n\n  const data = computed(() => resource.data || []);\n  const unread = computed(() => data.value.filter((d) => !d.read).length);\n\n  function toggle() {\n    visible.value = !visible.value;\n  }\n\n  watch(\n    () => authStore.hasDeskAccess,\n    (newVal) => {\n      if (!newVal) return;\n      resource.filters = {\n        user_to: [\"=\", authStore.userId],\n      };\n      resource.reload();\n    },\n    { immediate: true }\n  );\n\n  return {\n    clear,\n    data,\n    toggle,\n    read,\n    unread,\n    visible,\n    resource,\n  };\n});\n"],"names":["useNotificationStore","defineStore","authStore","useAuthStore","visible","ref","resource","createListResource","clear","createResource","read","ticket","data","computed","unread","d","toggle","watch","newVal"],"mappings":"+EAMa,MAAAA,EAAuBC,EAAY,eAAgB,IAAM,CACpE,MAAMC,EAAYC,IAEZC,EAAUC,EAAI,EAAK,EACnBC,EAA0CC,EAAmB,CACjE,QAAS,kBACT,MAAO,gBACP,OAAQ,CACN,WACA,OACA,oBACA,OACA,oBACA,mBACA,YACA,SACF,EACA,QAAS,eAAA,CACV,EACKC,EAAQC,EAAe,CAC3B,IAAK,wDACL,KAAM,GACN,UAAW,IAAMH,EAAS,OAAO,CAAA,CAClC,EAEKI,EAAQC,GAAW,CACRF,EAAA,CACb,IAAK,wDACL,KAAM,GACN,OAAQ,CACN,OAAAE,CACF,EACA,UAAW,IAAML,EAAS,OAAO,CAAA,CAClC,CAAA,EAGGM,EAAOC,EAAS,IAAMP,EAAS,MAAQ,CAAE,CAAA,EACzCQ,EAASD,EAAS,IAAMD,EAAK,MAAM,OAAQG,GAAM,CAACA,EAAE,IAAI,EAAE,MAAM,EAEtE,SAASC,GAAS,CACRZ,EAAA,MAAQ,CAACA,EAAQ,KAC3B,CAEA,OAAAa,EACE,IAAMf,EAAU,cACfgB,GAAW,CACLA,IACLZ,EAAS,QAAU,CACjB,QAAS,CAAC,IAAKJ,EAAU,MAAM,CAAA,EAEjCI,EAAS,OAAO,EAClB,EACA,CAAE,UAAW,EAAK,CAAA,EAGb,CACL,MAAAE,EACA,KAAAI,EACA,OAAAI,EACA,KAAAN,EACA,OAAAI,EACA,QAAAV,EACA,SAAAE,CAAA,CAEJ,CAAC"}