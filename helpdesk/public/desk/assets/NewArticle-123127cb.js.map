{"version":3,"file":"NewArticle-123127cb.js","sources":["../../../../desk/src/pages/knowledge-base/NewArticle.vue"],"sourcesContent":["<template>\n  <div class=\"flex flex-col flex-1\">\n    <LayoutHeader>\n      <template #left-header>\n        <Breadcrumbs :items=\"breadcrumbs\" />\n      </template>\n      <template #right-header> </template>\n    </LayoutHeader>\n    <div class=\"pt-6 mx-auto w-full max-w-4xl px-5\">\n      <div class=\"flex flex-col gap-3 rounded-lg border w-full p-4\">\n        <div class=\"flex justify-between items-center mb-3\">\n          <!-- Author Info -->\n          <div\n            class=\"flex gap-1 items-center flex-1 mr-7 max-w-fit overflow-hidden\"\n          >\n            <UserAvatar :name=\"user.name\" :expand=\"true\" />\n            <span>{{ __(\"in\") }}</span>\n            <Link\n              class=\"form-control\"\n              doctype=\"HD Article Category\"\n              :placeholder=\"__('Select Category')\"\n              v-model=\"categoryId\"\n              :pageLength=\"100\"\n              :hide-clear-button=\"true\"\n            />\n          </div>\n          <!-- Action Buttons -->\n          <div class=\"flex gap-2\">\n            <Button :label=\"__('Discard')\" @click=\"handleArticleDiscard\" />\n            <Button\n              :label=\"__('Create')\"\n              variant=\"solid\"\n              @click=\"handleCreateArticle\"\n            />\n          </div>\n        </div>\n        <!-- Title -->\n        <textarea\n          class=\"w-full resize-none border-0 text-3xl font-bold placeholder-ink-gray-3 p-0 pb-3 border-b border-gray-200 focus:ring-0 focus:border-gray-200\"\n          v-model=\"title\"\n          :placeholder=\"__('Title')\"\n          rows=\"1\"\n          wrap=\"soft\"\n          maxlength=\"140\"\n          autofocus\n          @input=\"\n          (e: Event) => {\n            const target = e.target as HTMLTextAreaElement;\n            target.style.height = `${target.scrollHeight}px`;\n          }\n          \"\n        />\n        <!-- Article Content -->\n        <TextEditor\n          :content=\"content\"\n          @change=\"content = $event\"\n          :placeholder=\"__('Write your article here...')\"\n          editor-class=\"rounded-b-lg max-w-[unset] prose-sm h-[calc(100vh-340px)] sm:h-[calc(100vh-250px)] overflow-auto\"\n        >\n          <template #bottom>\n            <TextEditorFixedMenu\n              class=\"-ml-1 overflow-x-auto w-full\"\n              :buttons=\"textEditorMenuButtons\"\n            />\n          </template>\n        </TextEditor>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  Breadcrumbs,\n  TextEditor,\n  TextEditorFixedMenu,\n  toast,\n  usePageMeta,\n} from \"frappe-ui\";\nimport { useOnboarding } from \"frappe-ui/frappe\";\nimport { computed, ref } from \"vue\";\nimport { __ } from \"@/translation\";\n\nimport { LayoutHeader, UserAvatar } from \"@/components\";\nimport { useAuthStore } from \"@/stores/auth\";\nimport { globalStore } from \"@/stores/globalStore\";\nimport { newArticle } from \"@/stores/knowledgeBase\";\nimport { useUserStore } from \"@/stores/user\";\nimport { Article } from \"@/types\";\nimport { textEditorMenuButtons } from \"@/utils\";\nimport { useRoute, useRouter } from \"vue-router\";\n\nconst userStore = useUserStore();\nconst user = userStore.getUser();\nconst { $dialog } = globalStore();\nconst router = useRouter();\nconst route = useRoute();\nconst { updateOnboardingStep } = useOnboarding(\"helpdesk\");\nconst { isManager } = useAuthStore();\n\nconst title = ref(\"\");\nconst content = ref(\"\");\n\nconst props = defineProps({\n  id: {\n    type: String,\n    required: true,\n  },\n});\n\nconst categoryId = ref(props.id || null);\nconst categoryName = computed(() => (route.query.title as string) || \"\");\n\nfunction handleCreateArticle() {\n  newArticle.submit(\n    { title: title.value, content: content.value, category: categoryId.value },\n    {\n      onSuccess: (article: Article) => {\n        toast.success(__(\"Article created\"));\n        if (isManager) {\n          updateOnboardingStep(\"first_article\");\n        }\n        resetState();\n        router.push({\n          name: \"Article\",\n          params: {\n            articleId: article.name,\n          },\n        });\n      },\n      onError: (error: string) => {\n        toast.error(error);\n      },\n    }\n  );\n}\nfunction handleArticleDiscard() {\n  if (!title.value && !content.value) {\n    router.push({\n      name: \"AgentKnowledgeBase\",\n    });\n    return;\n  }\n  $dialog({\n    title: __(\"Discard Article\"),\n    message: __(\"Are you sure you want to discard this article?\"),\n    actions: [\n      {\n        label: __(\"Confirm\"),\n        variant: \"solid\",\n        onClick(close: Function) {\n          router.push({\n            name: \"AgentKnowledgeBase\",\n          });\n          resetState();\n          close();\n        },\n      },\n    ],\n  });\n}\n\nfunction resetState() {\n  title.value = \"\";\n  content.value = \"\";\n}\n\nconst breadcrumbs = computed(() => {\n  const options: Array<{ label: string; route?: { name: string } }> = [\n    {\n      label: __(\"Knowledge Base\"),\n      route: { name: \"AgentKnowledgeBase\" },\n    },\n  ];\n  if (categoryName.value) {\n    options.push({\n      label: categoryName.value,\n      route: { name: \"AgentKnowledgeBase\" },\n    });\n  }\n  options.push({\n    label: __(\"New Article\"),\n  });\n  return options;\n});\n\nusePageMeta(() => {\n  return {\n    title: __(\"New Article\"),\n  };\n});\n</script>\n"],"names":["user","useUserStore","$dialog","globalStore","router","useRouter","route","useRoute","updateOnboardingStep","useOnboarding","isManager","useAuthStore","title","ref","content","categoryId","__props","categoryName","computed","handleCreateArticle","newArticle","article","toast","__","resetState","error","handleArticleDiscard","close","breadcrumbs","options","usePageMeta","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_unref","LayoutHeader","Breadcrumbs","_cache","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","UserAvatar","_component_Link","$event","_hoisted_6","_component_Button","e","target","TextEditor","TextEditorFixedMenu","textEditorMenuButtons"],"mappings":"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"}