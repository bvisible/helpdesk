import{aP as Z,Y as z,c as w,d as M,z as k,V as ee,P as x,k as U,g as d,w as I,h as i,r as A,e as g,l as f,F as O,E as T,s as te,t as K,x as L,f as N,bf as W,bg as ae,b0 as le,H as Y,bh as j,bb as oe,a0 as ne,bi as se,aU as ie,a as re,at as ue,W as ce,J as de,N as me,R as pe}from"./index-3194ec9b.js";import{_ as Q}from"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";import{u as ve}from"./pageMeta-9b603434.js";import{a as fe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-a9d0f8af.js";import"./dayjs-f66c5460.js";import{L as _e}from"./LayoutHeader-3eb7ac7a.js";import{P as ge}from"./PhoneIcon-e1a2cab8.js";import{_ as ye}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-1a82bb67.js";import{F as Ce}from"./FileUploader-0835fb8b.js";import{a as he}from"./Link-431cfb69.js";import{s as $}from"./dialogState-245a3a78.js";import"./Dropdown-c7dd9c29.js";import"./TabButtons-439c1e4c.js";import"./description-9202ef38.js";import"./DateTimePicker-8cacf145.js";import"./useDatePicker-fa7d5592.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-7827f28c.js";import"./StarRating.vue_vue_type_script_setup_true_lang-0c43ad36.js";import"./NestedPopover-37db8746.js";import"./portal-4ee54923.js";import"./MultipleAvatar.vue_vue_type_script_setup_true_lang-7025dfbf.js";import"./ticketStatus-895288f5.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-946d36ad.js";const be=Z("contact",()=>{const _=z({doctype:"Contact",fields:["*"],auto:!0,pageLength:99999});return{options:w(()=>{var p;return((p=_.list)==null?void 0:p.data)||[]})}}),Ve={class:"space-y-4"},xe={class:"mb-2 block text-sm leading-4 text-gray-700"},ke={key:0,class:"place-self-center text-red-500"},Ne={class:"flex justify-end space-x-2"},Ee=M({__name:"NewContactDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","contactCreated"],setup(_,{emit:m}){const p=_,v=m,c=be(),l=k({emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null}),u=k({emailValidationError:"",firstNameValidationError:"",lastNameValidationError:"",phoneValidationError:"",customerValidationError:""}),V=[{label:"Email Id",value:"emailID",error:"emailValidationError",type:"input",required:!0,action:()=>R(l.value.emailID)},{label:"First Name",value:"firstName",error:"firstNameValidationError",type:"input",required:!0,action:()=>q(l.value.firstName)},{label:"Last Name",value:"lastName",error:"lastNameValidationError",type:"input",required:!1},{label:"Phone",value:"phone",error:"phoneValidationError",type:"input",required:!1,action:()=>H(l.value.phone)},{label:"Customer",value:"selectedCustomer",error:"customerValidationError",type:"autocomplete",required:!1}],r=w({get:()=>p.modelValue,set:o=>{v("update:modelValue",o),o||v("close")}}),s=z({doctype:"HD Customer",fields:["name"],cache:"customers",transform:o=>o.map(e=>({label:e.name,value:e.name})),auto:!0}),a=ee({url:"frappe.client.insert",onSuccess:()=>{l.value={emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null},x.success("Contact created"),v("contactCreated")}});function E(){if(F())return;let o={doctype:"Contact",first_name:l.value.firstName,last_name:l.value.lastName,email_ids:[{email_id:l.value.emailID,is_primary:!0}],links:[],phone_nos:[]};l.value.phone&&(o.phone_nos=[{phone:l.value.phone}]),l.value.selectedCustomer&&o.links.push({link_doctype:"HD Customer",link_name:l.value.selectedCustomer}),a.submit({doc:o})}function h(o){!o||o.label==="No label"?l.value.selectedCustomer=null:l.value.selectedCustomer=o.value}function F(){let o=R(l.value.emailID);return o+=q(l.value.firstName),o+=H(l.value.phone),o}function R(o){u.value.emailValidationError="";const e=j.string().email().safeParse(o).success;return o?e?P(c.options).includes(o)&&(u.value.emailValidationError="Contact with email already exists"):u.value.emailValidationError="Enter a valid email":u.value.emailValidationError="Email should not be empty",u.value.emailValidationError}function q(o){return u.value.firstNameValidationError="",(!o||o.trim()==="")&&(u.value.firstNameValidationError="First name should not be empty"),u.value.firstNameValidationError}function H(o){return u.value.phoneValidationError="",o&&(!/[0-9]+/.test(o)||o.length<10)&&(u.value.phoneValidationError="Enter a valid phone number"),u.value.phoneValidationError}function P(o){return o.map(e=>e.email_id)}return(o,e)=>{const t=A("Button");return g(),U("div",null,[d(i(Y),{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=n=>r.value=n),options:{title:"Create New Contact"}},{"body-content":I(()=>[f("div",Ve,[(g(),U(O,null,T(V,n=>f("div",{key:n.label,class:"flex flex-col gap-1"},[f("span",xe,[te(K(n.label)+" ",1),n.required?(g(),U("span",ke," * ")):L("",!0)]),n.type==="input"?(g(),N(i(W),{key:0,modelValue:l.value[n.value],"onUpdate:modelValue":y=>l.value[n.value]=y,type:"text",onBlur:n.action},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(g(),N(i(ae),{key:1,modelValue:l.value[n.value],"onUpdate:modelValue":[y=>l.value[n.value]=y,h],options:i(s).data},null,8,["modelValue","onUpdate:modelValue","options"])),d(i(le),{message:u.value[n.error]},null,8,["message"])])),64)),f("div",Ne,[d(t,{label:"Create",loading:i(a).loading,theme:"gray",variant:"solid",onClick:e[0]||(e[0]=n=>E())},null,8,["loading"])])])]),_:1},8,["modelValue"])])}}}),De={__name:"Pill",props:{label:{type:String,default:"Button",require:!0},disabled:{type:Boolean,default:!1}},emits:["click"],setup(_,{emit:m}){const p=m,v=c=>{p("click",c)};return(c,l)=>(g(),N(i(ne),{key:_.label,theme:"gray",variant:"outline",label:_.label,disabled:_.disabled},{suffix:I(()=>[d(i(oe),{class:"h-3 w-3",onClick:l[0]||(l[0]=u=>v(_.label))})]),_:1},8,["label","disabled"]))}},$e={class:"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2"},J=M({__name:"MultiSelect",props:{items:{type:Array,required:!0},placeholder:{type:String,required:!1,default:"Type..."},validate:{type:Function,required:!1,default:()=>!1}},emits:["update:items"],setup(_,{emit:m}){const p=_,v=m,{items:c}=se(p),l=k("");function u(r){const s=p.validate(r);if(s){x.error(s);return}const a=[...c.value,r];v("update:items",a),l.value=""}function V(r){const s=c.value.filter(a=>a.value!==r);v("update:items",s)}return(r,s)=>(g(),U("div",$e,[(g(!0),U(O,null,T(i(c),a=>(g(),N(De,{key:a.value,label:a.label,onClick:s[0]||(s[0]=E=>V(E))},null,8,["label"]))),128)),d(i(W),{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=a=>l.value=a),class:"w-full",placeholder:_.placeholder,onKeyup:s[2]||(s[2]=ie(a=>u({label:l.value,value:l.value}),["enter"]))},null,8,["modelValue","placeholder"])]))}}),we={class:"flex flex-col items-center gap-4 p-6"},Ie={class:"text-xl font-medium text-gray-900"},Pe={class:"flex gap-2"},Ue={class:"w-full space-y-2 text-sm text-gray-700"},Se={class:"space-y-1"},Be={class:"space-y-1"},Fe={class:"space-y-1"},Re=M({__name:"ContactDialog",props:{name:{}},emits:["contactUpdated"],setup(_,{emit:m}){const p=_,v=m,c=k(!1),l=w({get(){var t;return(((t=a.doc)==null?void 0:t.email_ids)||[]).map(n=>({label:n.email_id,value:n.email_id}))},set(e){if(e.length===0){x.error("At least one email is required");return}e.length!==a.doc.email_ids.length&&(c.value=!0),a.doc.email_ids=e.map(t=>({email_id:t.value}))}}),u=w({get(){var t;return(((t=a.doc)==null?void 0:t.phone_nos)||[]).map(n=>({label:n.phone,value:n.phone}))},set(e){e.length!==a.doc.phone_nos.length&&(c.value=!0),a.doc.phone_nos=e.map(t=>({phone:t.value}))}}),V=w({get(){var t,n;const e=(n=(t=a.doc)==null?void 0:t.links)==null?void 0:n.find(y=>y.link_doctype==="HD Customer");return(e==null?void 0:e.link_name)||null},set(e){var n,y,D,S,B;const t=(D=(y=(n=a.doc)==null?void 0:n.links)==null?void 0:y.find(b=>b.link_doctype==="HD Customer"))==null?void 0:D.link_name;if(e!==t){if(e){const b=(S=a.doc.links)==null?void 0:S.findIndex(C=>C.link_doctype==="HD Customer");b!==-1?a.doc.links[b].link_name=e:a.doc.links.push({link_doctype:"HD Customer",link_name:e})}else a.doc.links=(B=a.doc.links)==null?void 0:B.filter(b=>b.link_doctype!=="HD Customer");c.value=!0}}});z({doctype:"HD Customer",fields:["name"],cache:"customers",transform:e=>e.map(t=>({label:t.name,value:t.name})),auto:!0});const{updateOnboardingStep:r}=fe("helpdesk"),{isManager:s}=re(),a=ue({doctype:"Contact",name:p.name,auto:!0,setValue:{onSuccess(){v("contactUpdated")}}}),E=w(()=>{var e;return{title:(e=a.doc)==null?void 0:e.name,actions:[{label:"Save",theme:"gray",variant:"solid",onClick:()=>h()}]}});function h(){if(!c.value){x.error("No changes to save");return}a.setValue.submit({email_ids:l.value.map(e=>({email_id:e.value,is_primary:e.value===a.doc.email_id})),phone_nos:u.value.map(e=>({phone:e.value,is_primary_phone:e.value===a.doc.phone,is_primary_mobile:e.value===a.doc.phone})),links:a.doc.links}),c.value=!1,v("contactUpdated")}function F(e){a.setValue.submit({image:(e==null?void 0:e.file_url)||null}),c.value=!0}function R(e){if(!j.string().email().safeParse(e.value).success)return"Invalid email"}function q(e){if(!j.string().regex(/^\+[1-9]\d{1,14}$/).min(10).max(15).safeParse(e.value).success)return"Invalid phone number"}function H(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return x.error("Invalid file type, only PNG and JPG images are allowed"),"Invalid file type, only PNG and JPG images are allowed"}const P=k(!1);async function o(){var e;try{P.value=!0;const t=await ce("frappe.contacts.doctype.contact.contact.invite_user",{contact:a.doc.name});x.success("Contact invited successfully"),await a.setValue.submit({user:t}),r("add_invite_contact")}catch(t){P.value=!1;const D=new DOMParser().parseFromString(((e=t.messages)==null?void 0:e[0])||t.message,"text/html").body.innerText;x.error(D)}finally{P.value=!1}}return(e,t)=>{const n=A("Button");return g(),N(i(Y),{options:E.value},{"body-main":I(()=>{var y,D,S,B,b;return[f("div",we,[f("div",Ie,K((y=i(a).doc)==null?void 0:y.full_name),1),d(i(Q),{size:"2xl",label:(D=i(a).doc)==null?void 0:D.full_name,image:(S=i(a).doc)==null?void 0:S.image,class:"cursor-pointer hover:opacity-80"},null,8,["label","image"]),f("div",Pe,[d(i(Ce),{"validate-file":H,onSuccess:t[0]||(t[0]=C=>F(C))},{default:I(({uploading:C,openFileSelector:X})=>{var G;return[d(n,{label:(G=i(a).doc)!=null&&G.image?"Change photo":"Upload photo",loading:C,onClick:X},null,8,["label","loading","onClick"])]}),_:1}),(B=i(a).doc)!=null&&B.image?(g(),N(n,{key:0,label:"Remove photo",onClick:t[1]||(t[1]=C=>F(null))})):L("",!0),!((b=i(a).doc)!=null&&b.user)&&i(s)?(g(),N(n,{key:1,label:"Invite as user",onClick:o,loading:P.value},null,8,["loading"])):L("",!0)]),f("div",Ue,[f("div",Se,[t[5]||(t[5]=f("div",{class:"text-xs"},"Emails",-1)),d(J,{items:l.value,"onUpdate:items":t[2]||(t[2]=C=>l.value=C),placeholder:"john.doe@example.com",validate:R},null,8,["items"])]),f("div",Be,[t[6]||(t[6]=f("div",{class:"text-xs"},"Phone Nos",-1)),d(J,{items:u.value,"onUpdate:items":t[3]||(t[3]=C=>u.value=C),placeholder:"+91 98765 43210",validate:q},null,8,["items"])]),f("div",Fe,[t[7]||(t[7]=f("div",{class:"text-xs"},"Customer",-1)),d(he,{doctype:"HD Customer",class:"form-control flex-1",placeholder:"Link to a customer",modelValue:V.value,"onUpdate:modelValue":t[4]||(t[4]=C=>V.value=C),"hide-me":!0},null,8,["modelValue"])])])])]}),_:1},8,["options"])}}}),qe={class:"flex flex-col"},it=M({__name:"Contacts",setup(_){const m=k(!1),p=k(null),v=k(null),c=w(()=>({doctype:"Contact",selectable:!0,showSelectBanner:!0,columnConfig:{full_name:{prefix:({row:r})=>de(Q,{shape:"circle",image:r.image,label:r.name,size:"sm"})},mobile_no:{prefix:ge}},emptyState:{title:"No Contacts Found"}}));function l(){var r;$.value=!1,(r=v.value)==null||r.reload()}function u(r){p.value=r,m.value=!0}function V(){var r;x.success("Contact updated"),m.value=!m.value,(r=v.value)==null||r.reload()}return ve(()=>({title:"Contacts"})),(r,s)=>{const a=pe,E=A("Button");return g(),U("div",qe,[d(i(_e),null,{"left-header":I(()=>[...s[4]||(s[4]=[f("div",{class:"text-lg font-medium text-gray-900"},"Contacts",-1)])]),"right-header":I(()=>[d(E,{label:"New contact",theme:"gray",variant:"solid",onClick:s[0]||(s[0]=h=>$.value=!i($))},{prefix:I(()=>[d(a,{class:"h-4 w-4"})]),_:1})]),_:1}),d(i(ye),{ref_key:"listViewRef",ref:v,options:c.value,onRowClick:u,onEmptyStateAction:s[1]||(s[1]=h=>$.value=!0)},null,8,["options"]),d(Ee,{modelValue:i($),"onUpdate:modelValue":s[2]||(s[2]=h=>me($)?$.value=h:null),onContactCreated:l},null,8,["modelValue"]),m.value?(g(),N(Re,{key:p.value,modelValue:m.value,"onUpdate:modelValue":s[3]||(s[3]=h=>m.value=h),name:p.value,onContactUpdated:V},null,8,["modelValue","name"])):L("",!0)])}}});export{it as default};
//# sourceMappingURL=Contacts-78b9f181.js.map
