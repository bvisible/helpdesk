async function _(n,a){let e=n.data??n;if(!e)return;if(!e._form_script)return[];let t=[],s={};if(Array.isArray(e._form_script))for(const r of e._form_script){const o=await u(r,a);t=t.concat(o.actions),o.onChange&&l(s,o.onChange)}else{const r=await u(e._form_script,a);t=r.actions,r.onChange&&l(s,r.onChange)}e._customActions=t,Object.keys(s).length&&(e._customOnChange=s)}function l(n,a){for(const[e,t]of Object.entries(a))n[e]||(n[e]=new Set),n[e].add(t)}async function u(n,a){const t=await new Function(n+`
return setupForm`)()(a);return{actions:(t==null?void 0:t.actions)||[],onChange:(t==null?void 0:t.onChange)||null}}function d(n,a,e,t,s){!e||!e.length?(n.options=s.find(r=>r.fieldname===a).options,n.disabled=!0):(n.options=e.join(`
`),n.disabled=!1),t[a]=""}function p(n,a,e,t,s){if(!e||!e.length){n.link_filters=s.find(r=>r.fieldname===a).link_filters,n.disabled=!0;return}n.link_filters=JSON.stringify([[n.options,"name","in",e]]),n.disabled=!1,t[a]=""}function h(n,a){return{display_via_depends_on:i(n==null?void 0:n.depends_on,a),...n,required:n.required||n.mandatory_depends_on&&i(n.mandatory_depends_on,a),filters:n.link_filters&&JSON.parse(n.link_filters),disabled:n.disabled,readonly:n.readonly||n.read_only_depends_on&&i(n.read_only_depends_on,a)}}function i(n,a){if(!n)return!0;let e=null;if(n.substr(0,5)=="eval:")try{e=c(n.substr(5),{doc:a})}catch{e=!0}else if(n.substr(0,4)=="doc.")e=a[n.substr(4)];else{let t=a[n];Array.isArray(t)?e=!!t.length:e=!!t}return e}function c(n,a={}){let e=Object.keys(a),t=Object.values(a);n=`let out = ${n}; return out`;try{return new Function(...e,n)(...t)}catch(s){throw console.log("Error evaluating the following expression:"),console.error(n),s}}export{p as a,d as h,h as p,_ as s};
//# sourceMappingURL=formCustomisation-8a41b461.js.map
