{"version":3,"file":"EmailContent.vue_vue_type_script_setup_true_lang-df9fb311.js","sources":["../../../../desk/src/components/EmailContent.vue"],"sourcesContent":["<template>\n  <iframe\n    ref=\"iframeRef\"\n    :srcdoc=\"htmlContent\"\n    class=\"prose-f block h-10 max-h-[500px] w-full\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { getFontFamily } from \"@/utils\";\nimport { computed, ref, watch } from \"vue\";\n\nconst props = defineProps({\n  content: {\n    type: String,\n    required: true,\n  },\n});\n\nconst iframeRef = ref<HTMLIFrameElement | null>(null);\nconst _content = ref(props.content);\n\n// Get CSS path - in dev Vite serves it directly, in prod we need the built path\nconst cssHref = computed(() => {\n  if (import.meta.env.DEV) {\n    return \"/src/index.css\";\n  }\n  // In production, find the built CSS file from the document\n  const links = document.querySelectorAll('link[rel=\"stylesheet\"]');\n  for (const link of links) {\n    const href = link.getAttribute(\"href\");\n    if (href?.includes(\"/assets/helpdesk/desk/\") && href.endsWith(\".css\")) {\n      return href;\n    }\n  }\n  // Fallback to a reasonable path\n  return \"/assets/helpdesk/desk/index.css\";\n});\n\nconst parser = new DOMParser();\nconst doc = parser.parseFromString(_content.value, \"text/html\");\n\nconst gmailReplyToContent = doc.querySelectorAll(\"div.gmail_quote\");\nconst outlookReplyToContent = doc.querySelectorAll(\"div#appendonsend\");\nconst replyToContent = doc.querySelectorAll(\"p.reply-to-content\");\n\nif (gmailReplyToContent.length) {\n  _content.value = parseReplyToContent(doc, \"div.gmail_quote\", true);\n} else if (outlookReplyToContent.length) {\n  _content.value = parseReplyToContent(doc, \"div#appendonsend\");\n} else if (replyToContent.length) {\n  _content.value = parseReplyToContent(doc, \"p.reply-to-content\");\n}\n\nfunction parseReplyToContent(\n  doc: Document,\n  selector: string,\n  forGmail = false\n) {\n  function handleAllInstances(doc: Document) {\n    const replyToContentElements = doc.querySelectorAll(selector);\n    if (replyToContentElements.length === 0) return;\n    const replyToContentElement = replyToContentElements[0];\n    replaceReplyToContent(replyToContentElement, forGmail);\n    handleAllInstances(doc);\n  }\n\n  handleAllInstances(doc);\n  return doc.body.innerHTML;\n}\n\nfunction replaceReplyToContent(\n  replyToContentElement: Element,\n  forGmail: boolean\n) {\n  if (!replyToContentElement) return;\n  const randomId = Math.random().toString(36).substring(2, 7);\n  const wrapper = doc.createElement(\"div\");\n  wrapper.classList.add(\"replied-content\");\n\n  const collapseLabel = doc.createElement(\"label\");\n  collapseLabel.classList.add(\"collapse\");\n  collapseLabel.setAttribute(\"for\", randomId);\n  collapseLabel.innerHTML = \"...\";\n  wrapper.appendChild(collapseLabel);\n\n  const collapseInput = doc.createElement(\"input\");\n  collapseInput.setAttribute(\"id\", randomId);\n  collapseInput.setAttribute(\"class\", \"replyCollapser\");\n  collapseInput.setAttribute(\"type\", \"checkbox\");\n  wrapper.appendChild(collapseInput);\n\n  if (forGmail) {\n    const prevSibling = replyToContentElement.previousElementSibling;\n    if (prevSibling && prevSibling.tagName === \"BR\") {\n      prevSibling.remove();\n    }\n    const cloned = replyToContentElement.cloneNode(true) as Element;\n    cloned.classList.remove(\"gmail_quote\");\n    wrapper.appendChild(cloned);\n  } else {\n    const allSiblings = Array.from(\n      replyToContentElement.parentElement?.children || []\n    );\n    const replyToContentIndex = allSiblings.indexOf(replyToContentElement);\n    const followingSiblings = allSiblings.slice(replyToContentIndex + 1);\n\n    if (followingSiblings.length === 0) return;\n\n    const clonedFollowingSiblings = followingSiblings.map((sibling) =>\n      sibling.cloneNode(true)\n    );\n\n    const div = doc.createElement(\"div\");\n    div.append(...clonedFollowingSiblings);\n    wrapper.append(div);\n\n    for (let i = replyToContentIndex + 1; i < allSiblings.length; i++) {\n      replyToContentElement.parentElement?.removeChild(allSiblings[i]);\n    }\n  }\n\n  replyToContentElement.parentElement?.replaceChild(\n    wrapper,\n    replyToContentElement\n  );\n}\n\nconst htmlContent = computed(\n  () => `\n  <!DOCTYPE html>\n  <html>\n  <head>\n    <link rel=\"stylesheet\" href=\"${cssHref.value}\" />\n    <base target=\"_blank\" />\n    <style>\n      .replied-content .collapse {\n        margin: 10px 0 10px 0;\n        visibility: visible;\n        cursor: pointer;\n        display: flex;\n        font-size: larger;\n        font-weight: 700;\n        height: 12px;\n        line-height: 0.1;\n        background: #e8eaed;\n        width: 23px;\n        justify-content: center;\n        border-radius: 5px;\n      }\n      .replied-content .collapse:hover {\n        background: #dadce0;\n      }\n      .replied-content .collapse + input {\n        display: none;\n      }\n      .replied-content .collapse + input + div {\n        display: none;\n      }\n      .replied-content .collapse + input:checked + div {\n        display: block;\n      }\n      .email-content {\n        word-break: break-word;\n      }\n      .email-content :is(:where(table):not(:where([class~='not-prose'], [class~='not-prose'] *))) {\n        table-layout: auto;\n      }\n      .email-content :where(table):not(:where([class~='not-prose'], [class~='not-prose'] *)) {\n        width: unset;\n        table-layout: auto;\n        text-align: unset;\n        margin-top: unset;\n        margin-bottom: unset;\n        font-size: unset;\n        line-height: unset;\n      }\n      .email-content :where(tbody tr):not(:where([class~='not-prose'], [class~='not-prose'] *)) {\n        border-bottom-width: 0;\n        border-bottom-color: transparent;\n      }\n      .email-content :is(:where(td):not(:where([class~='not-prose'], [class~='not-prose'] *))) {\n        position: unset;\n        border-width: 0;\n        border-color: transparent;\n        padding: 0;\n      }\n      .email-content :where(tbody td):not(:where([class~='not-prose'], [class~='not-prose'] *)) {\n        vertical-align: revert;\n      }\n      .email-content :is(:where(img):not(:where([class~='not-prose'], [class~='not-prose'] *))) {\n        border-width: 0;\n      }\n      .email-content :where(img):not(:where([class~='not-prose'], [class~='not-prose'] *)) {\n        margin: 0;\n      }\n      .email-content :where(blockquote p:first-of-type):not(:where([class~='not-prose'], [class~='not-prose'] *))::before {\n        content: none;\n      }\n      .email-content :where(blockquote p:last-of-type):not(:where([class~='not-prose'], [class~='not-prose'] *))::after {\n        content: none;\n      }\n    </style>\n  </head>\n  <body>\n    <div class=\"email-content prose-f\">${_content.value}</div>\n  </body>\n  </html>\n  `\n);\n\nwatch(iframeRef, (iframe) => {\n  if (iframe) {\n    iframe.onload = () => {\n      const emailContent =\n        iframe.contentWindow?.document.querySelector(\".email-content\");\n      if (!emailContent) return;\n\n      const parent = emailContent.closest(\"html\");\n      if (!parent) return;\n\n      emailContent.classList.add(getFontFamily(_content.value));\n      iframe.style.height = parent.offsetHeight + 1 + \"px\";\n\n      const replyCollapsers = emailContent.querySelectorAll(\".replyCollapser\");\n      if (replyCollapsers.length) {\n        replyCollapsers.forEach((replyCollapser) => {\n          replyCollapser.addEventListener(\"change\", () => {\n            iframe.style.height = parent.offsetHeight + 1 + \"px\";\n          });\n        });\n      }\n    };\n  }\n});\n</script>\n"],"names":["props","__props","iframeRef","ref","_content","cssHref","computed","links","link","href","doc","gmailReplyToContent","outlookReplyToContent","replyToContent","parseReplyToContent","selector","forGmail","handleAllInstances","replyToContentElements","replyToContentElement","replaceReplyToContent","randomId","wrapper","collapseLabel","collapseInput","prevSibling","cloned","allSiblings","_a","replyToContentIndex","followingSiblings","clonedFollowingSiblings","sibling","div","i","_b","_c","htmlContent","watch","iframe","emailContent","parent","getFontFamily","replyCollapsers","replyCollapser","_createElementBlock"],"mappings":"qLAYA,MAAMA,EAAQC,EAORC,EAAYC,EAA8B,IAAI,EAC9CC,EAAWD,EAAIH,EAAM,OAAO,EAG5BK,EAAUC,EAAS,IAAM,CAKvB,MAAAC,EAAQ,SAAS,iBAAiB,wBAAwB,EAChE,UAAWC,KAAQD,EAAO,CAClB,MAAAE,EAAOD,EAAK,aAAa,MAAM,EACrC,GAAIC,GAAA,MAAAA,EAAM,SAAS,2BAA6BA,EAAK,SAAS,MAAM,EAC3D,OAAAA,CAEX,CAEO,MAAA,iCAAA,CACR,EAGKC,EADS,IAAI,YACA,gBAAgBN,EAAS,MAAO,WAAW,EAExDO,EAAsBD,EAAI,iBAAiB,iBAAiB,EAC5DE,EAAwBF,EAAI,iBAAiB,kBAAkB,EAC/DG,EAAiBH,EAAI,iBAAiB,oBAAoB,EAE5DC,EAAoB,OACtBP,EAAS,MAAQU,EAAoBJ,EAAK,kBAAmB,EAAI,EACxDE,EAAsB,OACtBR,EAAA,MAAQU,EAAoBJ,EAAK,kBAAkB,EACnDG,EAAe,SACfT,EAAA,MAAQU,EAAoBJ,EAAK,oBAAoB,GAGhE,SAASI,EACPJ,EACAK,EACAC,EAAW,GACX,CACA,SAASC,EAAmBP,EAAe,CACnC,MAAAQ,EAAyBR,EAAI,iBAAiBK,CAAQ,EAC5D,GAAIG,EAAuB,SAAW,EAAG,OACnC,MAAAC,EAAwBD,EAAuB,CAAC,EACtDE,EAAsBD,EAAuBH,CAAQ,EACrDC,EAAmBP,CAAG,CACxB,CAEA,OAAAO,EAAmBP,CAAG,EACfA,EAAI,KAAK,SAClB,CAES,SAAAU,EACPD,EACAH,EACA,WACA,GAAI,CAACG,EAAuB,OACtB,MAAAE,EAAW,KAAK,SAAS,SAAS,EAAE,EAAE,UAAU,EAAG,CAAC,EACpDC,EAAUZ,EAAI,cAAc,KAAK,EAC/BY,EAAA,UAAU,IAAI,iBAAiB,EAEjC,MAAAC,EAAgBb,EAAI,cAAc,OAAO,EACjCa,EAAA,UAAU,IAAI,UAAU,EACxBA,EAAA,aAAa,MAAOF,CAAQ,EAC1CE,EAAc,UAAY,MAC1BD,EAAQ,YAAYC,CAAa,EAE3B,MAAAC,EAAgBd,EAAI,cAAc,OAAO,EAM/C,GALcc,EAAA,aAAa,KAAMH,CAAQ,EAC3BG,EAAA,aAAa,QAAS,gBAAgB,EACtCA,EAAA,aAAa,OAAQ,UAAU,EAC7CF,EAAQ,YAAYE,CAAa,EAE7BR,EAAU,CACZ,MAAMS,EAAcN,EAAsB,uBACtCM,GAAeA,EAAY,UAAY,MACzCA,EAAY,OAAO,EAEf,MAAAC,EAASP,EAAsB,UAAU,EAAI,EAC5CO,EAAA,UAAU,OAAO,aAAa,EACrCJ,EAAQ,YAAYI,CAAM,CAAA,KACrB,CACL,MAAMC,EAAc,MAAM,OACxBC,EAAAT,EAAsB,gBAAtB,YAAAS,EAAqC,WAAY,CAAC,CAAA,EAE9CC,EAAsBF,EAAY,QAAQR,CAAqB,EAC/DW,EAAoBH,EAAY,MAAME,EAAsB,CAAC,EAEnE,GAAIC,EAAkB,SAAW,EAAG,OAEpC,MAAMC,EAA0BD,EAAkB,IAAKE,GACrDA,EAAQ,UAAU,EAAI,CAAA,EAGlBC,EAAMvB,EAAI,cAAc,KAAK,EAC/BuB,EAAA,OAAO,GAAGF,CAAuB,EACrCT,EAAQ,OAAOW,CAAG,EAElB,QAASC,EAAIL,EAAsB,EAAGK,EAAIP,EAAY,OAAQO,KAC5DC,EAAAhB,EAAsB,gBAAtB,MAAAgB,EAAqC,YAAYR,EAAYO,CAAC,EAElE,EAEAE,EAAAjB,EAAsB,gBAAtB,MAAAiB,EAAqC,aACnCd,EACAH,EAEJ,CAEA,MAAMkB,EAAc/B,EAClB,IAAM;AAAA;AAAA;AAAA;AAAA,mCAI2BD,EAAQ,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAwEPD,EAAS,KAAK;AAAA;AAAA;AAAA,GAAA,EAMjD,OAAAkC,EAAApC,EAAYqC,GAAW,CACvBA,IACFA,EAAO,OAAS,IAAM,OACpB,MAAMC,GACJZ,EAAAW,EAAO,gBAAP,YAAAX,EAAsB,SAAS,cAAc,kBAC/C,GAAI,CAACY,EAAc,OAEb,MAAAC,EAASD,EAAa,QAAQ,MAAM,EAC1C,GAAI,CAACC,EAAQ,OAEbD,EAAa,UAAU,IAAIE,EAActC,EAAS,KAAK,CAAC,EACxDmC,EAAO,MAAM,OAASE,EAAO,aAAe,EAAI,KAE1C,MAAAE,EAAkBH,EAAa,iBAAiB,iBAAiB,EACnEG,EAAgB,QACFA,EAAA,QAASC,GAAmB,CAC3BA,EAAA,iBAAiB,SAAU,IAAM,CAC9CL,EAAO,MAAM,OAASE,EAAO,aAAe,EAAI,IAAA,CACjD,CAAA,CACF,CACH,EAEJ,CACD,cAzOCI,EAIE,SAAA,SAHI,YAAJ,IAAI3C,EACH,OAAQmC,EAAW,MACpB,MAAM,yCAAA"}