{"version":3,"mappings":"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","names":["props","__props","emit","__emit","component","computed","h","Autocomplete","apiOptions","Link","FormControl","createResource","data","parseApiOptions","transValue","placeholder","emitUpdate","fieldname","value","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createBlock","_resolveDynamicComponent","$event","_cache","_a","TicketTextEditor","defineAsyncComponent","useRoute","router","useRouter","$dialog","globalStore","updateOnboardingStep","useOnboarding","isManager","userID","useAuthStore","subject","ref","description","attachments","templateFields","reactive","template","oldFields","setupCustomizations","call","applyFilters","setupTemplateFields","fields","field","filters","f","handleSelectFieldUpdate","handleLinkFieldUpdate","customOnChange","visibleFields","_fields","_b","isCustomerPortal","parseField","handleOnFieldChange","fieldtype","fieldDependentFns","fn","ticket","params","toVerify","capture","sanitize","html","sanitizeHtml","breadcrumbs","__","usePageMeta","onMounted","_createVNode","_unref","LayoutHeader","Breadcrumbs","_component_CustomActions","_hoisted_5","_Fragment","_renderList","UniInput","e","_normalizeClass","_hoisted_6","_hoisted_7","_createTextVNode","_toDisplayString","SearchArticles","_hoisted_8","_withDirectives","_vShow","file","uploadFunction","Button","$refs","_hoisted_9"],"sources":["../../../../desk/src/components/UniInput.vue","../../../../desk/src/pages/ticket/TicketNew.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-1.5\" v-if=\"field.display_via_depends_on\">\n    <span class=\"block text-sm text-gray-700\">\n      {{ field.label }}\n      <span v-if=\"field.required\" class=\"place-self-center text-red-500\">\n        *\n      </span>\n    </span>\n    <component\n      :is=\"component\"\n      :placeholder=\"placeholder\"\n      :value=\"transValue\"\n      :disabled=\"field.disabled\"\n      :model-value=\"transValue\"\n      @update:model-value=\"emitUpdate(field.fieldname, $event)\"\n      @change=\"\n        emitUpdate(\n          field.fieldname,\n          $event.target?.value || $event.value || $event\n        )\n      \"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { Autocomplete, Link } from \"@/components\";\nimport { APIOptions, Field } from \"@/types\";\nimport { parseApiOptions } from \"@/utils\";\nimport { createResource, FormControl } from \"frappe-ui\";\nimport { computed, h } from \"vue\";\n\ntype Value = string | number | boolean;\n\ninterface P {\n  field: Field;\n  value: Value;\n}\n\ninterface R {\n  fieldname: Field[\"fieldname\"];\n  value: Value;\n}\n\ninterface E {\n  (event: \"change\", value: R);\n}\n\nconst props = defineProps<P>();\nconst emit = defineEmits<E>();\n\nconst component = computed(() => {\n  if (props.field.url_method) {\n    return h(Autocomplete, {\n      options: apiOptions.data,\n      size: \"sm\",\n    });\n  } else if (props.field.fieldtype === \"Link\" && props.field.options) {\n    return h(Link, {\n      doctype: props.field.options,\n      filters: props.field.filters,\n    });\n  } else if (props.field.fieldtype === \"Select\") {\n    return h(Autocomplete, {\n      options: props.field.options\n        .split(\"\\n\")\n        .map((o) => ({ label: o, value: o })),\n      size: \"sm\",\n    });\n  } else if (props.field.fieldtype === \"Check\") {\n    return h(Autocomplete, {\n      options: [\n        {\n          label: \"Yes\",\n          value: 1,\n        },\n        {\n          label: \"No\",\n          value: 0,\n        },\n      ],\n      size: \"sm\",\n    });\n  } else {\n    return h(FormControl, {\n      debounce: 500,\n    });\n  }\n});\n\nconst apiOptions = createResource({\n  url: props.field.url_method,\n  auto: !!props.field.url_method,\n  transform: (data: APIOptions) => {\n    return parseApiOptions(data);\n  },\n});\n\nconst transValue = computed(() => {\n  if (props.field.fieldtype === \"Check\") {\n    return props.value ? \"Yes\" : \"No\";\n  }\n  return props.value;\n});\n\nconst placeholder = computed(() => {\n  if (props.field.placeholder) {\n    return props.field.placeholder;\n  }\n  if (props.field.fieldtype === \"Data\" && !props.field.url_method) {\n    return \"Type something\";\n  } else if (\n    props.field.fieldtype === \"Select\" ||\n    props.field.fieldtype === \"Link\"\n  ) {\n    return \"Select an option\";\n  }\n  return \"Type something\";\n});\n\nfunction emitUpdate(fieldname: Field[\"fieldname\"], value: Value) {\n  emit(\"change\", { fieldname, value });\n}\n</script>\n","<template>\n  <div class=\"flex flex-col overflow-y-auto\">\n    <LayoutHeader>\n      <template #left-header>\n        <Breadcrumbs :items=\"breadcrumbs\" />\n      </template>\n      <template #right-header>\n        <CustomActions\n          v-if=\"template.data?._customActions\"\n          :actions=\"template.data?._customActions\"\n        />\n      </template>\n    </LayoutHeader>\n    <!-- Container -->\n    <div\n      class=\"flex flex-col gap-5 py-6 h-full flex-1 self-center overflow-auto mx-auto w-full max-w-4xl px-5\"\n    >\n      <!-- custom fields descriptions -->\n      <div v-if=\"Boolean(template.data?.about)\" class=\"\">\n        <div class=\"prose-f\" v-html=\"sanitize(template.data.about)\" />\n      </div>\n      <!-- custom fields -->\n      <div\n        class=\"grid grid-cols-1 gap-4 sm:grid-cols-3\"\n        v-if=\"Boolean(visibleFields)\"\n      >\n        <UniInput\n          v-for=\"field in visibleFields\"\n          :key=\"field.fieldname\"\n          :field=\"field\"\n          :value=\"templateFields[field.fieldname]\"\n          @change=\"\n            (e) => handleOnFieldChange(e, field.fieldname, field.fieldtype)\n          \"\n        />\n      </div>\n      <!-- existing fields -->\n      <div\n        class=\"flex flex-col\"\n        :class=\"(subject.length >= 2 || description.length) && 'gap-5'\"\n      >\n        <div class=\"flex flex-col gap-2\">\n          <span class=\"block text-sm text-gray-700\">\n            {{ __(\"Subject\") }}\n            <span class=\"place-self-center text-red-500\"> * </span>\n          </span>\n          <FormControl\n            v-model=\"subject\"\n            type=\"text\"\n            :placeholder=\"__('A short description')\"\n          />\n        </div>\n        <SearchArticles\n          v-if=\"isCustomerPortal\"\n          :query=\"subject\"\n          class=\"shadow\"\n        />\n        <div v-if=\"isCustomerPortal\">\n          <h4\n            v-show=\"subject.length <= 2 && description.length === 0\"\n            class=\"text-p-sm text-gray-500 ml-1\"\n          >\n            {{ __(\"Please enter a subject to continue\") }}\n          </h4>\n          <TicketTextEditor\n            v-show=\"subject.length > 2 || description.length > 0\"\n            ref=\"editor\"\n            v-model:attachments=\"attachments\"\n            v-model:content=\"description\"\n            :placeholder=\"__('Detailed explanation')\"\n            expand\n            :uploadFunction=\"(file:any)=>uploadFunction(file)\"\n          >\n            <template #bottom-right>\n              <Button\n                :label=\"__('Submit')\"\n                theme=\"gray\"\n                variant=\"solid\"\n                :disabled=\"\n                  $refs.editor.editor.isEmpty || ticket.loading || !subject\n                \"\n                @click=\"() => ticket.submit()\"\n              />\n            </template>\n          </TicketTextEditor>\n        </div>\n      </div>\n\n      <!-- for agent portal -->\n      <div v-if=\"!isCustomerPortal\">\n        <TicketTextEditor\n          ref=\"editor\"\n          v-model:attachments=\"attachments\"\n          v-model:content=\"description\"\n          :placeholder=\"__('Detailed explanation')\"\n          expand\n        >\n          <template #bottom-right>\n            <Button\n              :label=\"__('Submit')\"\n              theme=\"gray\"\n              variant=\"solid\"\n              :disabled=\"\n                $refs.editor.editor.isEmpty || ticket.loading || !subject\n              \"\n              @click=\"() => ticket.submit()\"\n            />\n          </template>\n        </TicketTextEditor>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { LayoutHeader, UniInput } from \"@/components\";\nimport {\n  handleLinkFieldUpdate,\n  handleSelectFieldUpdate,\n  parseField,\n  setupCustomizations,\n} from \"@/composables/formCustomisation\";\nimport { useAuthStore } from \"@/stores/auth\";\nimport { globalStore } from \"@/stores/globalStore\";\nimport { capture } from \"@/telemetry\";\nimport { Field } from \"@/types\";\nimport { isCustomerPortal, uploadFunction } from \"@/utils\";\nimport {\n  Breadcrumbs,\n  Button,\n  call,\n  createResource,\n  FormControl,\n  usePageMeta,\n} from \"frappe-ui\";\nimport { __ } from \"@/translation\";\nimport { useOnboarding } from \"frappe-ui/frappe\";\nimport sanitizeHtml from \"sanitize-html\";\nimport { computed, defineAsyncComponent, onMounted, reactive, ref } from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport SearchArticles from \"../../components/SearchArticles.vue\";\nconst TicketTextEditor = defineAsyncComponent(\n  () => import(\"./TicketTextEditor.vue\")\n);\n\ninterface P {\n  templateId?: string;\n}\n\nconst props = withDefaults(defineProps<P>(), {\n  templateId: \"\",\n});\n\nconst route = useRoute();\nconst router = useRouter();\nconst { $dialog } = globalStore();\nconst { updateOnboardingStep } = useOnboarding(\"helpdesk\");\nconst { isManager, userId: userID } = useAuthStore();\n\nconst subject = ref(\"\");\nconst description = ref(\"\");\nconst attachments = ref([]);\nconst templateFields = reactive({});\n\nconst template = createResource({\n  url: \"helpdesk.helpdesk.doctype.hd_ticket_template.api.get_one\",\n  makeParams: () => ({\n    name: props.templateId || \"Default\",\n  }),\n  auto: true,\n  onSuccess: (data) => {\n    description.value = data.description_template || \"\";\n    oldFields = window.structuredClone(data.fields || []);\n    setupCustomizations(template, {\n      doc: templateFields,\n      call,\n      router,\n      $dialog,\n      applyFilters,\n    });\n    setupTemplateFields(data.fields);\n  },\n});\n\nfunction setupTemplateFields(fields) {\n  fields.forEach((field: Field) => {\n    templateFields[field.fieldname] = \"\";\n  });\n}\n\nlet oldFields = [];\n\nfunction applyFilters(fieldname: string, filters: any = null) {\n  const f: Field = template.data.fields.find((f) => f.fieldname === fieldname);\n  if (!f) return;\n  if (f.fieldtype === \"Select\") {\n    handleSelectFieldUpdate(f, fieldname, filters, templateFields, oldFields);\n  } else if (f.fieldtype === \"Link\") {\n    handleLinkFieldUpdate(f, fieldname, filters, templateFields, oldFields);\n  }\n}\n\nconst customOnChange = computed(() => template.data?._customOnChange);\n\nconst visibleFields = computed(() => {\n  let _fields = template.data?.fields?.filter(\n    (f) => !isCustomerPortal.value || !f.hide_from_customer\n  );\n  if (!_fields) return [];\n  return _fields.map((field) => parseField(field, templateFields));\n});\n\nfunction handleOnFieldChange(e: any, fieldname: string, fieldtype: string) {\n  templateFields[fieldname] = e.value;\n  const fieldDependentFns = customOnChange.value?.[fieldname];\n  if (fieldDependentFns) {\n    fieldDependentFns.forEach((fn: Function) => {\n      fn(e.value, fieldtype);\n    });\n  }\n}\n\nconst ticket = createResource({\n  url: \"helpdesk.helpdesk.doctype.hd_ticket.api.new\",\n  debounce: 300,\n  makeParams: () => ({\n    doc: {\n      description: description.value,\n      subject: subject.value,\n      template: props.templateId,\n      ...templateFields,\n    },\n    attachments: attachments.value,\n  }),\n  validate: (params) => {\n    const fields = visibleFields.value?.filter((f) => f.required) || [];\n    const toVerify = [...fields, \"subject\", \"description\"];\n    for (const field of toVerify) {\n      if (!params.doc[field.fieldname || field]) {\n        return `${field.label || field} is required`;\n      }\n    }\n  },\n  onSuccess: (data) => {\n    router.push({\n      name: isCustomerPortal.value ? \"TicketCustomer\" : \"TicketAgent\",\n      params: {\n        ticketId: data.name,\n      },\n    });\n    if (isManager) {\n      updateOnboardingStep(\"create_first_ticket\", true, false, () =>\n        localStorage.setItem(\"firstTicket\", data.name)\n      );\n    }\n    // only capture telemetry for customer portal\n    if (isCustomerPortal.value) {\n      capture(\"new_ticket_submitted\", {\n        data: {\n          user: userID,\n          ticketID: data.name,\n          subject: subject.value,\n          description: description.value,\n          customFields: templateFields,\n        },\n      });\n    }\n  },\n});\n\nfunction sanitize(html: string) {\n  return sanitizeHtml(html, {\n    allowedTags: sanitizeHtml.defaults.allowedTags.concat([\"img\"]),\n  });\n}\n\nconst breadcrumbs = computed(() => {\n  const items = [\n    {\n      label: __(\"Tickets\"),\n      route: {\n        name: isCustomerPortal.value ? \"TicketsCustomer\" : \"TicketsAgent\",\n      },\n    },\n    {\n      label: __(\"New Ticket\"),\n      route: {\n        name: \"TicketNew\",\n      },\n    },\n  ];\n  return items;\n});\n\nusePageMeta(() => ({\n  title: __(\"New Ticket\"),\n}));\n\nonMounted(() => {\n  capture(\"new_ticket_page\", {\n    data: {\n      user: userID,\n    },\n  });\n});\n</script>\n"],"file":"assets/TicketNew-c0c7c5b2.js"}