import{_ as K}from"./CustomActions-de732add.js";import{d as O,c as k,J as y,a9 as P,V as E,e as m,k as f,l as p,s as H,t as Q,x as v,f as T,v as X,q as Z,u as ee,a as te,z as U,p as ae,I as h,ao as L,M as le,g as _,w as S,h as i,F as se,E as oe,a8 as ie,aq as j,ar as q,W as ne,a0 as A,aR as re}from"./index-3194ec9b.js";import{_ as de}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-add081d8.js";import{u as ue}from"./pageMeta-9b603434.js";import{g as ce,a as me}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-a9d0f8af.js";import"./dayjs-f66c5460.js";import{L as pe}from"./LayoutHeader-3eb7ac7a.js";import{_ as z}from"./Autocomplete-4c667766.js";import{a as fe}from"./Link-431cfb69.js";import{s as ve,p as he,h as _e,a as ge}from"./formCustomisation-8a41b461.js";import{l as ke}from"./lodash-f704bb91.js";import{s as B}from"./index-a7e5685b.js";import{_ as be}from"./SearchArticles.vue_vue_type_script_setup_true_lang-c464183c.js";import{_ as M}from"./TicketTextEditor.vue_vue_type_script_setup_true_lang-ce04207f.js";import"./Dropdown-c7dd9c29.js";import"./FileUploader-0835fb8b.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-858a5224.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-7cb9f49e.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-95965310.js";import"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";const ye={key:0,class:"space-y-1.5"},xe={class:"block text-sm text-gray-700"},Ce={key:0,class:"place-self-center text-red-500"},we=O({__name:"UniInput",props:{field:{},value:{type:[String,Number,Boolean]}},emits:["change"],setup(F,{emit:x}){const o=F,$=x,N=k(()=>o.field.url_method?y(z,{options:V.data,size:"sm"}):o.field.fieldtype==="Link"&&o.field.options?y(fe,{doctype:o.field.options,filters:o.field.filters}):o.field.fieldtype==="Select"?y(z,{options:o.field.options.split(`
`).map(s=>({label:s,value:s})),size:"sm"}):o.field.fieldtype==="Check"?y(z,{options:[{label:"Yes",value:1},{label:"No",value:0}],size:"sm"}):y(P,{debounce:500})),V=E({url:o.field.url_method,auto:!!o.field.url_method,transform:s=>(s==null?void 0:s.map(l=>typeof l=="object"&&l.label&&l.value?l:{label:l==null?void 0:l.toString(),value:l}))||[]}),b=k(()=>o.field.fieldtype==="Check"?o.value?"Yes":"No":o.value),c=k(()=>o.field.placeholder?o.field.placeholder:o.field.fieldtype==="Data"&&!o.field.url_method?"Type something":"Select an option");function u(s,l){$("change",{fieldname:s,value:l})}return(s,l)=>s.field.display_via_depends_on?(m(),f("div",ye,[p("span",xe,[H(Q(s.field.label)+" ",1),s.field.required?(m(),f("span",Ce," * ")):v("",!0)]),(m(),T(X(N.value),{placeholder:c.value,value:b.value,disabled:s.field.disabled,"model-value":b.value,"onUpdate:modelValue":l[0]||(l[0]=n=>u(s.field.fieldname,n)),onChange:l[1]||(l[1]=n=>{var C;return u(s.field.fieldname,((C=n.target)==null?void 0:C.value)||n.value||n)})},null,40,["placeholder","value","disabled","model-value"]))])):v("",!0)}}),Se={class:"flex flex-col overflow-y-auto"},Te={class:"flex flex-col gap-5 py-6 h-full flex-1 self-center overflow-auto mx-auto w-full max-w-4xl px-5"},Fe={key:0,class:""},$e=["innerHTML"],Ne={key:1,class:"grid grid-cols-1 gap-4 sm:grid-cols-3"},Ve={class:"flex flex-col gap-2"},De={key:1},Ie={class:"text-p-sm text-gray-500 ml-1"},Ue={key:2},et=O({__name:"TicketNew",props:{templateId:{default:""}},setup(F){const x=F;Z();const o=ee(),{$dialog:$}=ce(),{updateOnboardingStep:N}=me("helpdesk"),{isManager:V,userId:b}=te(),c=U(""),u=U(""),s=U([]),l=ae({}),n=E({url:"helpdesk.helpdesk.doctype.hd_ticket_template.api.get_one",makeParams:()=>({name:x.templateId||"Default"}),auto:!0,onSuccess:e=>{u.value=e.description_template||"",D=window.structuredClone(e.fields||[]),ve(n,{doc:l,call:ne,router:o,$dialog:$,applyFilters:R}),C(e.fields)}});function C(e){e.forEach(a=>{l[a.fieldname]=""})}let D=[];function R(e,a=null){const r=n.data.fields.find(d=>d.fieldname===e);r&&(r.fieldtype==="Select"?_e(r,e,a,l,D):r.fieldtype==="Link"&&ge(r,e,a,l,D))}const Y=k(()=>{var e;return(e=n.data)==null?void 0:e._customOnChange}),I=k(()=>{var a,r;let e=(r=(a=n.data)==null?void 0:a.fields)==null?void 0:r.filter(d=>!h.value||!d.hide_from_customer);return e?e.map(d=>he(d,l)):[]});function J(e,a,r){var t;l[a]=e.value;const d=(t=Y.value)==null?void 0:t[a];d&&d.forEach(g=>{g(e.value,r)})}const w=E({url:"helpdesk.helpdesk.doctype.hd_ticket.api.new",debounce:300,makeParams:()=>({doc:{description:u.value,subject:c.value,template:x.templateId,...l},attachments:s.value}),validate:e=>{var d;const r=[...((d=I.value)==null?void 0:d.filter(t=>t.required))||[],"subject","description"];for(const t of r)if(ke.isEmpty(e.doc[t.fieldname||t]))return`${t.label||t} is required`},onSuccess:e=>{o.push({name:h.value?"TicketCustomer":"TicketAgent",params:{ticketId:e.name}}),V&&N("create_first_ticket",!0,!1,()=>localStorage.setItem("firstTicket",e.name)),h.value&&L("new_ticket_submitted",{data:{user:b,ticketID:e.name,subject:c.value,description:u.value,customFields:l}})}});function W(e){return B(e,{allowedTags:B.defaults.allowedTags.concat(["img"])})}const G=k(()=>[{label:"Tickets",route:{name:h.value?"TicketsCustomer":"TicketsAgent"}},{label:"New Ticket",route:{name:"TicketNew"}}]);return ue(()=>({title:"New Ticket"})),le(()=>{L("new_ticket_page",{data:{user:b}})}),(e,a)=>{var d;const r=K;return m(),f("div",Se,[_(i(pe),null,{"left-header":S(()=>[_(i(de),{items:G.value},null,8,["items"])]),"right-header":S(()=>{var t,g;return[(t=i(n).data)!=null&&t._customActions?(m(),T(r,{key:0,actions:(g=i(n).data)==null?void 0:g._customActions},null,8,["actions"])):v("",!0)]}),_:1}),p("div",Te,[(d=i(n).data)!=null&&d.about?(m(),f("div",Fe,[p("div",{class:"prose-f",innerHTML:W(i(n).data.about)},null,8,$e)])):v("",!0),I.value?(m(),f("div",Ne,[(m(!0),f(se,null,oe(I.value,t=>(m(),T(i(we),{key:t.fieldname,field:t,value:l[t.fieldname],onChange:g=>J(g,t.fieldname,t.fieldtype)},null,8,["field","value","onChange"]))),128))])):v("",!0),p("div",{class:ie(["flex flex-col",(c.value.length>=2||u.value.length)&&"gap-5"])},[p("div",Ve,[a[7]||(a[7]=p("span",{class:"block text-sm text-gray-700"},[H(" Subject "),p("span",{class:"place-self-center text-red-500"}," * ")],-1)),_(i(P),{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t),type:"text",placeholder:"A short description"},null,8,["modelValue"])]),i(h)?(m(),T(be,{key:0,query:c.value,class:"shadow"},null,8,["query"])):v("",!0),i(h)?(m(),f("div",De,[j(p("h4",Ie," Please enter a subject to continue ",512),[[q,c.value.length<=2&&u.value.length===0]]),j(_(M,{ref:"editor",attachments:s.value,"onUpdate:attachments":a[2]||(a[2]=t=>s.value=t),content:u.value,"onUpdate:content":a[3]||(a[3]=t=>u.value=t),placeholder:"Detailed explanation",expand:"",uploadFunction:t=>i(re)(t)},{"bottom-right":S(()=>[_(i(A),{label:"Submit",theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||i(w).loading||!c.value,onClick:a[1]||(a[1]=()=>i(w).submit())},null,8,["disabled"])]),_:1},8,["attachments","content","uploadFunction"]),[[q,c.value.length>2||u.value.length>0]])])):v("",!0)],2),i(h)?v("",!0):(m(),f("div",Ue,[_(M,{ref:"editor",attachments:s.value,"onUpdate:attachments":a[5]||(a[5]=t=>s.value=t),content:u.value,"onUpdate:content":a[6]||(a[6]=t=>u.value=t),placeholder:"Detailed explanation",expand:""},{"bottom-right":S(()=>[_(i(A),{label:"Submit",theme:"gray",variant:"solid",disabled:e.$refs.editor.editor.isEmpty||i(w).loading||!c.value,onClick:a[4]||(a[4]=()=>i(w).submit())},null,8,["disabled"])]),_:1},8,["attachments","content"])]))])])}}});export{et as default};
//# sourceMappingURL=TicketNew-e1a8a6d5.js.map
