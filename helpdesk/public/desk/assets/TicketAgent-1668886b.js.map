{"version":3,"mappings":"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","names":["_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","_unref","isEmoji","__props","_normalizeProps","_mergeProps","$attrs","_toDisplayString","_createBlock","_component_FeatherIcon","_resolveDynamicComponent","props","emit","__emit","showDialog","_useModel","getDefaultFilters","filters","targetTicket","ref","subject","mergeTicket","createResource","source","target","toast","getTicketSubject","createListResource","data","watch","newValue","handleTicketMerge","Dialog","$event","_hoisted_2","_hoisted_3","_createVNode","Link","_component_FormControl","_hoisted_4","TriangleAlert","_component_Button","LucideMerge","CommunicationArea","defineAsyncComponent","__vitePreload","ticket","inject","TicketSymbol","activities","ActivitiesSymbol","ticketAgentActivitiesRef","communicationAreaRef","telephonyStore","useTelephonyStore","isCallingEnabled","storeToRefs","tabs","computed","_tabs","ActivityIcon","EmailIcon","CommentIcon","PhoneIcon","tabIndex","changeTabTo","useActiveTabManager","_activities","_a","emailProps","_c","_b","email","idx","commentProps","comment","historyProps","h","callProps","call","sorted","a","b","i","currentActivity","j","nextActivity","feedbackActivity","_d","_e","_f","_g","_h","filterActivities","eventType","activity","Tabs","_withCtx","tab","TicketAgentActivities","e","LoadingIndicator","currentTicketIndex","ticketsToNavigate","useTicketNavigation","router","useRouter","route","useRoute","goToNextTicket","nextTicketId","navigateToTicket","goToPreviousTicket","prevTicketId","getCurrentTicket","getNextTicket","getPreviousTicket","ticketId","view","routeToNavigate","disableLeftCondition","disableRightCondition","onMounted","useShortcut","_component_Tooltip","LucideChevronLeft","LucideChevronRight","firstResponse","dayjs","formatTimeShort","resolutionBy","timeLeft","formatTime","_i","_j","_k","_l","_m","_n","_o","_p","_q","_r","_s","date","end","_date","duration","days","hours","minutes","copyToClipboard","_Teleport","_component_GlobeIcon","_component_EmailIcon","_hoisted_5","Tooltip","dateFormat","dateTooltipFormat","Badge","_hoisted_6","_normalizeClass","showSubjectDialog","renameSubject","isLoading","handleRename","_component_Dialog","findView","useView","ticketStatusStore","useTicketStatusStore","customizations","CustomizationSymbol","notifyTicketUpdate","useNotifyTicketUpdate","statusDropdown","s","o","IndicatorIcon","breadcrumbs","items","__","currView","getIcon","updateField","fieldname","value","callback","showMergeModal","showMergeOption","defaultActions","actions","normalActions","action","groupedWithLabelActions","_actions","groupIndex","groupedActions","customizationCtx","globalStore","watchEffect","setupCustomizations","statusRef","useTemplateRef","LayoutHeader","Breadcrumbs","item","_component_Icon","TicketSLA","MultipleAvatar","TicketNavigation","_Fragment","_renderList","_createSlots","g","Dropdown","open","TicketMergeModal","TicketSubjectModal","sidebarResizing","sidebarWidth","startResize","resize","el","gap","distance","range","_renderSlot","_guardReactiveProps","contact","TicketContactSymbol","recentSimilarTickets","RecentSimilarTicketsSymbol","getStatus","colorMap","getStatusColor","status","color","sections","recentTickets","similarTickets","_sections","formatDate","openTicket","name","url","Avatar","CopyIcon","_hoisted_7","_hoisted_8","section","_hoisted_9","Section","opened","hide","toggle","_hoisted_10","_hoisted_11","_component_LucideChevronDown","_hoisted_13","_hoisted_14","_hoisted_15","_createTextVNode","_hoisted_16","assignees","oldAssignees","assignToMe","error","users","getUser","useUserStore","removeValue","assignee","addValue","obj","val","user","updateAssignees","_assignees","_oldAssignees","removedAssignees","addedAssignees","logMessage","addAssignees","removeAssignees","capture","targetRef","nextTick","option","$refs","togglePopover","UserAvatar","_withModifiers","Switch","AssigneeSymbol","saveAssignees","assignToRef","Popover","close","LucideChevronDown","isOpen","AssignToBody","showPhoneModal","contactImage","openContact","callContact","ExternalLinkIcon","Button","toggleEmailBox","SetContactPhoneModal","getFields","getField","getMeta","coreFields","fieldsMeta","_coreFields","f","parseField","getFieldInFormat","customFields","fieldMeta","fieldTemplate","handleFieldUpdate","isCoreFieldUpdated","label","fieldRefs","setFieldRef","TicketContact","index","field","AssignTo","TicketField","currentTab","Resizer","TabButtons","TicketDetailsTab","TicketContactTab","ticketMap","reactive","useTicket","err","createDocumentResource","msg","reloadTicket","ticketData","$socket","ticketComposable","provide","viewerComposable","useActiveViewers","viewers","startViewing","stopViewing","newTicketId","oldTicketId","onBeforeUnmount","showEmailBox","showCommentBox","usePageMeta","TicketHeader","TicketActivityPanel","TicketSidebar"],"sources":["../../../../desk/src/components/icons/CopyIcon.vue","../../../../desk/src/components/icons/ExternalLinkIcon.vue","../../../../desk/src/components/icons/GlobeIcon.vue","../../../../desk/src/components/Icon.vue","../../../../desk/src/components/ticket/TicketMergeModal.vue","../../../../desk/src/components/ticket-agent/TicketActivityPanel.vue","../../../../desk/src/composables/useTicketNavigation.ts","../../../../desk/src/components/ticket-agent/TicketNavigation.vue","../../../../desk/src/components/ticket-agent/TicketSLA.vue","../../../../desk/src/components/ticket-agent/TicketSubjectModal.vue","../../../../desk/src/components/ticket-agent/TicketHeader.vue","../../../../desk/src/components/Resizer.vue","../../../../desk/src/components/ticket-agent/TicketContactTab.vue","../../../../desk/src/components/ticket-agent/AssignToBody.vue","../../../../desk/src/components/ticket-agent/AssignTo.vue","../../../../desk/src/components/ticket-agent/TicketContact.vue","../../../../desk/src/components/ticket-agent/TicketDetailsTab.vue","../../../../desk/src/components/ticket-agent/TicketSidebar.vue","../../../../desk/src/composables/useTicket.ts","../../../../desk/src/pages/ticket/TicketAgent.vue"],"sourcesContent":["<template>\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M13.9996 3.54443V8.771C13.9994 9.32318 13.5518 9.771 12.9996 9.771H12.1802C11.9041 9.771 11.6802 9.99485 11.6802 10.271C11.6803 10.547 11.9042 10.771 12.1802 10.771H12.9996C14.104 10.771 14.9994 9.87546 14.9996 8.771V3.54443C14.9996 2.43986 14.1041 1.54443 12.9996 1.54443H6.72124C5.61667 1.54443 4.72124 2.43986 4.72124 3.54443V4.37158C4.72124 4.64772 4.94509 4.87158 5.22124 4.87158C5.49738 4.87158 5.72124 4.64772 5.72124 4.37158V3.54443C5.72124 2.99215 6.16895 2.54443 6.72124 2.54443H12.9996C13.5518 2.54443 13.9996 2.99215 13.9996 3.54443ZM9.27832 6.22928C9.8306 6.22928 10.2783 6.67699 10.2783 7.22928V12.4558C10.2782 13.008 9.83053 13.4558 9.27832 13.4558H3C2.44779 13.4558 2.00012 13.008 2 12.4558V7.22928C2 6.67699 2.44772 6.22928 3 6.22928H9.27832ZM9.27832 14.4558C10.3828 14.4558 11.2782 13.5603 11.2783 12.4558V7.22928C11.2783 6.12471 10.3829 5.22928 9.27832 5.22928H3C1.89543 5.22928 1 6.12471 1 7.22928V12.4558C1.00012 13.5603 1.89551 14.4558 3 14.4558H9.27832Z\"\n      fill=\"#525252\"\n    />\n  </svg>\n</template>\n","<template>\n  <svg\n    width=\"16\"\n    height=\"17\"\n    viewBox=\"0 0 16 17\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M5.66406 2.25C5.94021 2.25 6.16406 2.47386 6.16406 2.75C6.16406 3.02614 5.94021 3.25 5.66406 3.25H4.25C3.42157 3.25 2.75 3.92157 2.75 4.75V12.25L2.75781 12.4033C2.83461 13.1597 3.47334 13.75 4.25 13.75H11.75C12.5784 13.75 13.25 13.0784 13.25 12.25V10.8359C13.25 10.5598 13.4739 10.3359 13.75 10.3359C14.0261 10.3359 14.25 10.5598 14.25 10.8359V12.25C14.25 13.6307 13.1307 14.75 11.75 14.75H4.25C2.95566 14.75 1.89082 13.7664 1.7627 12.5059L1.75 12.25V4.75C1.75 3.36929 2.86929 2.25 4.25 2.25H5.66406ZM13.75 2.25C13.7827 2.25 13.8155 2.25243 13.8477 2.25879C13.8574 2.26071 13.8665 2.2651 13.876 2.26758C13.9592 2.28923 14.0383 2.33126 14.1035 2.39648C14.2012 2.49413 14.25 2.62202 14.25 2.75V7.25C14.25 7.52608 14.0261 7.74994 13.75 7.75C13.4739 7.75 13.25 7.52611 13.25 7.25V3.95703L6.81152 10.3955C6.61626 10.5908 6.29975 10.5908 6.10449 10.3955C5.90923 10.2002 5.90923 9.88374 6.10449 9.68848L12.543 3.25H9.25C8.97388 3.25 8.75003 3.02611 8.75 2.75C8.75 2.47386 8.97386 2.25 9.25 2.25H13.75Z\"\n      fill=\"#525252\"\n    />\n  </svg>\n</template>\n","<template>\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_11163_86342)\">\n      <path\n        d=\"M8 0.75C12.0041 0.75 15.25 3.99594 15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75ZM9.83691 4.24902C9.83246 4.31586 9.82822 4.40482 9.80762 4.49316C9.79115 4.5636 9.76659 4.63202 9.73535 4.69727C9.69606 4.77931 9.64388 4.85125 9.60547 4.90625L9.57715 4.94727C9.53169 5.01237 9.47353 5.10016 9.39648 5.1748C9.33512 5.23421 9.26581 5.2852 9.19141 5.32715C9.09793 5.37982 8.99723 5.41143 8.92188 5.43652L7.01367 6.07227C6.96479 6.08854 6.93927 6.09602 6.92188 6.10254L6.9209 6.10449C6.90952 6.11925 6.89436 6.14042 6.86426 6.18262L6.30859 6.96094C6.25045 7.04245 6.17582 7.15257 6.07422 7.24023C5.99357 7.30979 5.9021 7.36646 5.80371 7.40723C5.67989 7.45842 5.54801 7.47592 5.44922 7.49121L5.38574 7.50098C5.29011 7.51579 5.16346 7.53843 5.03418 7.52832C4.93128 7.52017 4.82895 7.4961 4.7334 7.45703C4.61327 7.40776 4.51037 7.32967 4.43164 7.27344L2.19727 5.67773C1.90962 6.39582 1.75 7.17915 1.75 8C1.75 11.4518 4.54822 14.25 8 14.25C11.4518 14.25 14.25 11.4518 14.25 8C14.25 5.2413 12.4623 2.90124 9.98242 2.07227L9.83691 4.24902ZM7.12207 8.18945C7.27526 7.95989 7.58574 7.89776 7.81543 8.05078L10.6025 9.9082C10.7167 9.98443 10.7942 10.1049 10.8174 10.2402C10.8406 10.3756 10.8069 10.5151 10.7246 10.625L9.33203 12.4824C9.23768 12.6082 9.08888 12.6825 8.93164 12.6826H7.07422C6.83589 12.6826 6.63074 12.514 6.58398 12.2803L6.11914 9.95801C6.09321 9.82809 6.1199 9.69327 6.19336 9.58301L7.12207 8.18945ZM7.13965 9.96484L7.48438 11.6826H8.68164L9.60742 10.4463L7.67676 9.15918L7.13965 9.96484ZM8 1.75C5.72993 1.75 3.74217 2.96003 2.64746 4.77051L5.0127 6.45996C5.06466 6.49708 5.09177 6.51562 5.11133 6.52832L5.1123 6.5293H5.11426C5.13745 6.52677 5.16993 6.52251 5.2334 6.5127L5.2959 6.50293C5.3614 6.49279 5.39526 6.48721 5.41895 6.48242L5.41992 6.48145L5.42188 6.48047C5.4368 6.46146 5.45658 6.43391 5.49512 6.37988L6.0498 5.60156C6.09519 5.53793 6.15408 5.45185 6.23047 5.37891C6.29114 5.32101 6.35945 5.27146 6.43262 5.23047C6.52471 5.17891 6.6241 5.14773 6.69824 5.12305L8.60645 4.4873C8.65567 4.47091 8.68058 4.46266 8.69824 4.45605L8.7002 4.45508L8.70117 4.4541C8.71253 4.43905 8.72714 4.41753 8.75684 4.375L8.78613 4.33398C8.81121 4.29807 8.82337 4.27987 8.83203 4.2666V4.26465L8.83301 4.26367C8.83455 4.24789 8.83595 4.22533 8.83887 4.18164L8.99609 1.83008C8.67167 1.77811 8.33907 1.75 8 1.75Z\"\n        fill=\"#7C7C7C\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_11163_86342\">\n        <rect width=\"16\" height=\"16\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n</template>\n","<template>\n  <div v-if=\"isEmoji(icon)\" v-bind=\"$attrs\">\n    {{ icon }}\n  </div>\n  <FeatherIcon\n    v-else-if=\"typeof icon == 'string'\"\n    :name=\"icon\"\n    v-bind=\"$attrs\"\n  />\n  <component v-else :is=\"icon\" v-bind=\"$attrs\" />\n</template>\n<script setup>\nimport { isEmoji } from \"@/utils\";\n\nconst props = defineProps({\n  icon: {\n    type: [String, Object],\n    required: true,\n  },\n});\n</script>\n","<template>\n  <Dialog\n    :options=\"{ title: `Merge with another ticket` }\"\n    v-model=\"showDialog\"\n  >\n    <template #body-content>\n      <div class=\"flex flex-col gap-4\">\n        <p class=\"text-p-base text-ink-gray-8\">\n          All comments and emails of the ticket\n          <span class=\"whitespace-nowrap font-semibold\"\n            >#{{ ticket.name }}</span\n          >\n          will be moved to the selected ticket.\n        </p>\n        <Link\n          class=\"form-control\"\n          doctype=\"HD Ticket\"\n          placeholder=\"Select Ticket\"\n          :filters=\"getDefaultFilters()\"\n          label=\"Ticket\"\n          :page-length=\"10\"\n          :value=\"targetTicket\"\n          :show-description=\"true\"\n          @change=\"targetTicket = String($event)\"\n        />\n        <FormControl\n          v-if=\"targetTicket\"\n          label=\"Ticket Subject\"\n          type=\"text\"\n          v-model=\"subject\"\n          :disabled=\"true\"\n        />\n        <!-- banner -->\n        <div\n          class=\"flex items-center gap-2 rounded-md p-2 ring-1 ring-gray-200\"\n        >\n          <TriangleAlert\n            class=\"h-6 w-5 w-min-5 w-max-5 min-h-5 max-w-5 text-yellow-500\"\n          />\n\n          <div class=\"text-wrap text-sm text-gray-700\">\n            This action is irreversible.\n          </div>\n        </div>\n      </div>\n    </template>\n    <template #actions>\n      <Button\n        class=\"w-full\"\n        variant=\"solid\"\n        :label=\"\n          targetTicket ? `Merge with ticket #${targetTicket} ` : 'Select Ticket'\n        \"\n        :loading=\"mergeTicket.loading\"\n        :icon-left=\"targetTicket && LucideMerge\"\n        @click=\"handleTicketMerge\"\n      />\n    </template>\n  </Dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { Link } from \"@/components\";\nimport { HDTicket } from \"@/types/doctypes\";\nimport { Dialog, createListResource, createResource, toast } from \"frappe-ui\";\nimport { ref, watch } from \"vue\";\nimport LucideMerge from \"~icons/lucide/merge\";\nimport TriangleAlert from \"~icons/lucide/triangle-alert\";\n// interface P\ninterface Props {\n  ticket: HDTicket;\n}\n\ninterface E {\n  (event: \"update\"): void;\n  //   (event: \"rowClick\", row: any): void;\n}\n\nconst props = defineProps<Props>();\nconst emit = defineEmits<E>();\nconst showDialog = defineModel<boolean>();\n\ninterface Filter {\n  status_category: [string, string[] | string];\n  is_merged: number;\n  name: string[];\n  customer?: any;\n  raised_by?: [string, string[] | string];\n}\n\nfunction getDefaultFilters() {\n  const filters: Filter = {\n    status_category: [\"in\", [\"Open\", \"Paused\"]],\n    is_merged: 0,\n    name: [\"!=\", props.ticket.name],\n  };\n  // if part of an organization show all tickets of the organization\n  if (props.ticket.customer) {\n    filters.customer = props.ticket.customer;\n  }\n  //  show all tickets of the person who raised the ticket\n  if (props.ticket.raised_by) {\n    filters.raised_by = [\"like\", `%${props.ticket.raised_by}%`];\n  }\n  return filters;\n}\n\nconst targetTicket = ref(null);\nconst subject = ref(null);\n\nconst mergeTicket = createResource({\n  url: \"helpdesk.helpdesk.doctype.hd_ticket.api.merge_ticket\",\n  makeParams({ source, target }) {\n    return {\n      source,\n      target,\n    };\n  },\n  validate({ source, target }) {\n    if (!source) throw { message: \"Category is required\" };\n    if (!target) throw { message: \"Ticket to merged with is required\" };\n  },\n  onSuccess: () => {\n    toast.success(\"Ticket merged successfully\");\n    emit(\"update\");\n\n    showDialog.value = false;\n    // open the target Ticket\n    window.open(\n      window.location.origin + \"/helpdesk/tickets/\" + targetTicket.value,\n      \"_blank\"\n    );\n    targetTicket.value = null;\n  },\n});\n\nconst getTicketSubject = createListResource({\n  doctype: \"HD Ticket\",\n  filters: {\n    name: [\"=\", targetTicket],\n  },\n  fields: [\"subject\"],\n  onSuccess: (data: any) => {\n    if (data.length > 0) {\n      subject.value = data[0].subject;\n    }\n  },\n});\n\nwatch(\n  () => targetTicket.value,\n  (newValue) => {\n    if (newValue) {\n      getTicketSubject.update({\n        filters: {\n          name: [\"=\", newValue],\n        },\n      });\n      getTicketSubject.reload();\n    }\n  }\n);\n\nfunction handleTicketMerge() {\n  mergeTicket.submit({\n    source: props.ticket.name,\n    target: targetTicket.value,\n  });\n}\n</script>\n\n<style scoped></style>\n","<template>\n  <Tabs\n    :modelValue=\"tabIndex\"\n    :tabs=\"tabs\"\n    @update:modelValue=\"changeTabTo\"\n    class=\"[&_[role='tab']]:px-0 [&_[role='tablist']]:px-5 [&_[role='tablist']]:gap-7.5\"\n  >\n    <template #tab-panel=\"{ tab }\">\n      <TicketAgentActivities\n        v-if=\"Boolean(activities.data)\"\n        ref=\"ticketAgentActivitiesRef\"\n        :activities=\"filterActivities(tab.name as TicketTab)\"\n        :title=\"tab.label\"\n        :ticket-status=\"ticket.doc.status\"\n        @email:reply=\"\n          (e) => {\n            communicationAreaRef.replyToEmail(e);\n          }\n        \"\n        @update=\"\n          () => {\n            activities.reload();\n            ticketAgentActivitiesRef.scrollToLatestActivity();\n          }\n        \"\n      />\n      <div v-else class=\"flex items-center justify-center flex-col mt-20\">\n        <LoadingIndicator :scale=\"8\" class=\"text-ink-gray-5\" />\n        <p class=\"text-xl font-medium text-ink-gray-5 absolute top-[50%]\">\n          Loading...\n        </p>\n      </div>\n    </template>\n  </Tabs>\n  <!-- Comm Area -->\n  <CommunicationArea\n    ref=\"communicationAreaRef\"\n    :ticketId=\"String(ticket.doc?.name)\"\n    :to-emails=\"[ticket.doc?.raised_by]\"\n    :cc-emails=\"[]\"\n    :bcc-emails=\"[]\"\n    :key=\"ticket.doc?.name\"\n    @update=\"\n      () => {\n        activities.reload();\n        ticketAgentActivitiesRef.scrollToLatestActivity();\n      }\n    \"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  ActivityIcon,\n  CommentIcon,\n  EmailIcon,\n  PhoneIcon,\n} from \"@/components/icons\";\nimport { useActiveTabManager } from \"@/composables/useActiveTabManager\";\nimport { useTelephonyStore } from \"@/stores/telephony\";\nimport {\n  ActivitiesSymbol,\n  FeedbackActivity,\n  TabObject,\n  TicketSymbol,\n  TicketTab,\n} from \"@/types\";\nimport { LoadingIndicator, Tabs } from \"frappe-ui\";\nimport { storeToRefs } from \"pinia\";\nimport { computed, ComputedRef, defineAsyncComponent, inject, ref } from \"vue\";\nimport TicketAgentActivities from \"../ticket/TicketAgentActivities.vue\";\n\nconst CommunicationArea = defineAsyncComponent(\n  () => import(\"@/components/CommunicationArea.vue\")\n);\n\nconst ticket = inject(TicketSymbol);\nconst activities = inject(ActivitiesSymbol);\n\nconst ticketAgentActivitiesRef = ref(null);\nconst communicationAreaRef = ref(null);\nconst telephonyStore = useTelephonyStore();\nconst { isCallingEnabled } = storeToRefs(telephonyStore);\n\nconst tabs: ComputedRef<TabObject[]> = computed(() => {\n  const _tabs: TabObject[] = [\n    {\n      name: \"activity\",\n      label: \"Activity\",\n      icon: ActivityIcon,\n    },\n    {\n      name: \"email\",\n      label: \"Emails\",\n      icon: EmailIcon,\n    },\n    {\n      name: \"comment\",\n      label: \"Comments\",\n      icon: CommentIcon,\n    },\n  ];\n\n  if (isCallingEnabled.value) {\n    _tabs.push({\n      name: \"call\",\n      label: \"Calls\",\n      icon: PhoneIcon,\n    });\n  }\n  return _tabs;\n});\n\nconst { tabIndex, changeTabTo } = useActiveTabManager(tabs);\n\n// TODO: refactor for pagination\n// can be done once we sort out the backend\nconst _activities = computed(() => {\n  if (!activities.value?.data) {\n    return [];\n  }\n\n  const emailProps = activities.value?.data?.communications.map(\n    (email, idx: number) => {\n      return {\n        subject: email.subject,\n        content: email.content,\n        sender: { name: email.user.email, full_name: email.user.name },\n        to: email.recipients,\n        type: \"email\",\n        key: email.creation,\n        cc: email.cc,\n        bcc: email.bcc,\n        creation: email.communication_date || email.creation,\n        attachments: email.attachments,\n        name: email.name,\n        deliveryStatus: email.delivery_status,\n        isFirstEmail: idx === 0,\n      };\n    }\n  );\n\n  const commentProps = activities.value.data.comments.map((comment) => {\n    return {\n      name: comment.name,\n      type: \"comment\",\n      key: comment.creation,\n      commentedBy: comment.commented_by,\n      commenter: comment.user.name,\n      creation: comment.creation,\n      content: comment.content,\n      attachments: comment.attachments,\n    };\n  });\n\n  const historyProps = [\n    ...activities.value.data.history,\n    ...activities.value.data.views,\n  ].map((h) => {\n    return {\n      type: \"history\",\n      key: h.creation,\n      content: h.action ? h.action : \"viewed this\",\n      creation: h.creation,\n      user: h.user.name + \" \",\n    };\n  });\n\n  const callProps = activities.value.data.calls.map((call) => {\n    return {\n      ...call,\n      type: \"call\",\n      name: call.name,\n      key: call.creation,\n      call_type: call.type,\n      content: `${call.caller || \"Unknown\"} made a call to ${\n        call.receiver || \"Unknown\"\n      }`,\n      duration: call.duration ? call.duration + \"s\" : \"0s\",\n    };\n  });\n\n  const sorted = [\n    ...emailProps,\n    ...commentProps,\n    ...historyProps,\n    ...callProps,\n  ].sort((a, b) => new Date(a.creation) - new Date(b.creation));\n  const data = [];\n  let i = 0;\n\n  while (i < sorted.length) {\n    const currentActivity = sorted[i];\n\n    if (currentActivity.type === \"history\") {\n      currentActivity.relatedActivities = [currentActivity];\n      for (let j = i + 1; j < sorted.length + 1; j++) {\n        const nextActivity = sorted[j];\n\n        if (\n          nextActivity &&\n          nextActivity.user === currentActivity.user &&\n          nextActivity.content !== \"viewed this\" &&\n          !nextActivity.content.includes(\"assigned\") &&\n          !nextActivity.content.includes(\"unassigned\")\n        ) {\n          currentActivity.relatedActivities.push(nextActivity);\n        } else {\n          data.push(currentActivity);\n          i = j - 1;\n          break;\n        }\n      }\n    } else {\n      data.push(currentActivity);\n    }\n    i++;\n  }\n  // add feedback data at the last always\n  // name is email\n  // full_name is name\n\n  if (ticket.value.doc.feedback_rating === 0) {\n    return data;\n  }\n  let feedbackActivity: FeedbackActivity[] = [\n    {\n      type: \"feedback\",\n      key: \"feedback-activity\",\n      feedback_rating: ticket.value?.doc.feedback_rating,\n      feedback_extra: ticket.value?.doc.feedback_extra,\n      feedback: ticket.value?.doc.feedback,\n      sender: {\n        name: ticket.value?.doc.raised_by,\n        full_name: ticket.value?.doc.contact,\n      },\n    },\n  ];\n  data.push(...feedbackActivity);\n\n  return data;\n});\n\nfunction filterActivities(eventType: TicketTab) {\n  if (eventType === \"activity\") {\n    return _activities.value;\n  }\n  return _activities.value.filter((activity) => activity.type === eventType);\n}\n</script>\n\n<style scoped></style>\n","import { createResource } from \"frappe-ui\";\nimport { ref } from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\n\nexport const currentTicketIndex = ref(0);\n\nexport const ticketsToNavigate = createResource({\n  url: \"helpdesk.helpdesk.doctype.hd_ticket.api.get_navigation_tickets\",\n  cache: [\"ticketsToNavigate\"],\n});\n\nexport function useTicketNavigation() {\n  const router = useRouter();\n  const route = useRoute();\n\n  function goToNextTicket() {\n    if (currentTicketIndex.value < ticketsToNavigate.data.length - 1) {\n      currentTicketIndex.value += 1;\n      const nextTicketId = ticketsToNavigate.data[currentTicketIndex.value];\n      navigateToTicket(nextTicketId);\n      return nextTicketId;\n    }\n    return null;\n  }\n\n  function goToPreviousTicket() {\n    if (currentTicketIndex.value > 0) {\n      currentTicketIndex.value -= 1;\n      const prevTicketId = ticketsToNavigate.data[currentTicketIndex.value];\n      navigateToTicket(prevTicketId);\n      return prevTicketId;\n    }\n    return null;\n  }\n\n  function getCurrentTicket() {\n    return ticketsToNavigate.data[currentTicketIndex.value];\n  }\n\n  function getNextTicket() {\n    if (!ticketsToNavigate.data) return null;\n    if (currentTicketIndex.value < ticketsToNavigate.data.length - 1) {\n      return ticketsToNavigate.data[currentTicketIndex.value + 1];\n    }\n    return null;\n  }\n\n  function getPreviousTicket() {\n    if (!ticketsToNavigate.data) return null;\n    if (currentTicketIndex.value > 0) {\n      return ticketsToNavigate.data[currentTicketIndex.value - 1];\n    }\n    return null;\n  }\n\n  function navigateToTicket(ticketId: string) {\n    let view = route.query.view as string;\n    let routeToNavigate: any = {\n      name: \"TicketAgent\",\n      params: { ticketId },\n      hash: \"\",\n    };\n    if (view) {\n      routeToNavigate[\"query\"] = { view };\n    }\n    router.push(routeToNavigate);\n  }\n\n  // Remove the watcher that was causing conflicts\n\n  return {\n    currentTicketIndex,\n    ticketsToNavigate,\n    goToNextTicket,\n    goToPreviousTicket,\n    getCurrentTicket,\n    getNextTicket,\n    getPreviousTicket,\n    navigateToTicket,\n  };\n}\n","<template>\n  <div class=\"flex gap-1\">\n    <Tooltip\n      :text=\"\n        getPreviousTicket()\n          ? `Go to previous ticket: #${getPreviousTicket()}`\n          : 'No previous ticket'\n      \"\n      :disabled=\"disableLeftCondition\"\n    >\n      <Button\n        :icon=\"LucideChevronLeft\"\n        variant=\"ghost\"\n        :disabled=\"disableLeftCondition\"\n        @click=\"goToPreviousTicket()\"\n      />\n    </Tooltip>\n    <Tooltip\n      :text=\"\n        getNextTicket()\n          ? `Go to next ticket: #${getNextTicket()}`\n          : 'No next ticket'\n      \"\n      :disabled=\"disableRightCondition\"\n    >\n      <Button\n        :icon=\"LucideChevronRight\"\n        variant=\"ghost\"\n        :disabled=\"disableRightCondition\"\n        @click=\"goToNextTicket()\"\n      />\n    </Tooltip>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useShortcut } from \"@/composables/shortcuts\";\nimport {\n  ticketsToNavigate,\n  useTicketNavigation,\n} from \"@/composables/useTicketNavigation\";\nimport { computed, onMounted, ref } from \"vue\";\nimport LucideChevronLeft from \"~icons/lucide/chevron-left\";\nimport LucideChevronRight from \"~icons/lucide/chevron-right\";\n\nconst {\n  currentTicketIndex,\n  goToNextTicket,\n  goToPreviousTicket,\n  getNextTicket,\n  getPreviousTicket,\n} = useTicketNavigation();\n\nconst leftArrowRef = ref(null);\nconst rightArrowRef = ref(null);\n\nconst disableLeftCondition = computed(() => {\n  if (ticketsToNavigate.loading || !ticketsToNavigate.data?.length) return true;\n\n  return currentTicketIndex.value == 0;\n});\n\nconst disableRightCondition = computed(() => {\n  if (ticketsToNavigate.loading || !ticketsToNavigate.data?.length) return true;\n  if (ticketsToNavigate.data.length <= 1) return true;\n  return currentTicketIndex.value >= ticketsToNavigate.data.length - 1;\n});\n\nonMounted(() => {\n  // Register shortcuts and store cleanup functions\n  useShortcut({ key: \">\", shift: true }, () => {\n    if (!disableRightCondition.value) {\n      goToNextTicket();\n    }\n  });\n\n  useShortcut({ key: \"<\", shift: true }, () => {\n    if (!disableLeftCondition.value) {\n      goToPreviousTicket();\n    }\n  });\n});\n</script>\n","<template>\n  <!-- Teleport to App Header -->\n  <teleport to=\"#app-header\">\n    <div\n      class=\"flex items-center mx-5 md:mr-0 text-p-sm gap-3 text-[14px] mb-[13px]\"\n    >\n      <!-- Source -->\n      <div class=\"flex items-center gap-1\">\n        <p\n          @click=\"\n            copyToClipboard(\n              ticket.doc.name,\n              `Ticket #${ticket.doc.name} copied to clipboard`\n            )\n          \"\n          class=\"cursor-copy\"\n        >\n          #{{ ticket.doc.name }}\n        </p>\n        <!-- Via Email -->\n        <div\n          v-if=\"!ticket.doc.via_customer_portal\"\n          class=\"text-ink-gray-4 flex items-center\"\n        >\n          <span class=\"text-ink-gray-4 mr-[6px]\">via</span>\n          <EmailIcon class=\"size-4 inline-block mr-1\" />\n          <span class=\"\">Email</span>\n        </div>\n        <!-- Via Portal -->\n        <div v-else class=\"text-ink-gray-4 flex items-center\">\n          <span class=\"text-ink-gray-4 mr-[6px]\">via</span>\n          <GlobeIcon class=\"size-4 inline-block mr-1\" />\n          <span class=\"font-medium\">Portal</span>\n        </div>\n      </div>\n      <!-- divider -->\n      <div class=\"border-l border-outline-gray-2 h-[13px]\" />\n      <!-- First Response -->\n      <div class=\"flex items-center gap-1\">\n        <span>First Response</span>\n        <Tooltip\n          :text=\"dateFormat(firstResponse.date, dateTooltipFormat)\"\n          :hover-delay=\"0.25\"\n          :placement=\"'top'\"\n        >\n          <Badge\n            :label=\"firstResponse.label\"\n            variant=\"subtle\"\n            :theme=\"firstResponse.color\"\n          />\n        </Tooltip>\n      </div>\n      <!-- divider -->\n      <div class=\"border-l border-outline-gray-2 h-[13px]\" />\n      <!-- Resolution by -->\n      <div class=\"flex items-center gap-1\">\n        <span>Resolution </span>\n        <Tooltip\n          :text=\"dateFormat(resolutionBy.date, dateTooltipFormat)\"\n          :hover-delay=\"0.25\"\n          :placement=\"'top'\"\n        >\n          <Badge\n            v-if=\"resolutionBy\"\n            :label=\"resolutionBy.label\"\n            variant=\"subtle\"\n            :theme=\"resolutionBy.color !== 'purple' && resolutionBy.color\"\n            :class=\"\n              resolutionBy.color === 'purple' && '!text-[#6B46C1] !bg-[#F3E8FF]'\n            \"\n          />\n        </Tooltip>\n      </div>\n    </div>\n  </teleport>\n</template>\n\n<script setup lang=\"ts\">\nimport { useShortcut } from \"@/composables/shortcuts\";\nimport { TicketSymbol } from \"@/types\";\nimport {\n  copyToClipboard,\n  dateFormat,\n  dateTooltipFormat,\n  formatTime,\n} from \"@/utils\";\nimport { Badge, dayjs, Tooltip } from \"frappe-ui\";\nimport { computed, inject } from \"vue\";\n\nconst ticket = inject(TicketSymbol);\n\nconst firstResponse = computed(() => {\n  if (ticket.value?.get?.loading) return { label: \"\", color: \"\", date: \"\" };\n  if (\n    !ticket.value.doc.first_responded_on &&\n    dayjs().isBefore(dayjs(ticket.value.doc.response_by))\n  ) {\n    let responseBy = formatTimeShort(ticket.value.doc.response_by);\n    return {\n      label: `Due in ${responseBy}`,\n      color: \"orange\",\n      date: ticket.value.doc.response_by,\n    };\n  } else if (\n    dayjs(ticket.value.doc.first_responded_on).isBefore(\n      dayjs(ticket.value.doc.response_by)\n    )\n  ) {\n    let responseBy = formatTimeShort(\n      ticket.value.doc.first_responded_on,\n      ticket.value.doc.creation\n    );\n    return {\n      label: `Fulfilled in ${responseBy}`,\n      color: \"green\",\n      date: ticket.value.doc.first_responded_on,\n    };\n  } else {\n    let responseBy = formatTimeShort(\n      String(new Date()),\n      ticket.value.doc.response_by\n    );\n    return {\n      label: `Failed by ${responseBy}`,\n      color: \"red\",\n      date: ticket.value.doc.response_by,\n    };\n  }\n});\n\nconst resolutionBy = computed(() => {\n  if (ticket.value?.get?.loading) return { label: \"\", color: \"\", date: \"\" };\n\n  if (\n    ticket.value.doc?.status_category === \"Paused\" &&\n    ticket.value.doc?.on_hold_since &&\n    dayjs(ticket.value.doc?.resolution_by).isAfter(\n      dayjs(ticket.value.doc?.on_hold_since)\n    )\n  ) {\n    let timeLeft = dayjs(ticket.value.doc?.resolution_by).diff(dayjs(), \"s\");\n    return {\n      label: `${formatTime(timeLeft)} left (On Hold)`,\n      color: \"blue\",\n      date: ticket.value.doc?.on_hold_since,\n    };\n  } else if (\n    !ticket.value.doc?.resolution_date &&\n    dayjs().isBefore(dayjs(ticket.value.doc?.resolution_by))\n  ) {\n    let resolutionBy = formatTimeShort(ticket.value.doc?.resolution_by);\n    return {\n      label: `Due in ${resolutionBy}`,\n      color: \"purple\",\n      date: ticket.value.doc?.resolution_by,\n    };\n  } else if (\n    dayjs(ticket.value.doc?.resolution_date).isBefore(\n      dayjs(ticket.value.doc?.resolution_by)\n    )\n  ) {\n    let resolutionBy = formatTimeShort(\n      ticket.value.doc?.resolution_date,\n      ticket.value.doc?.creation\n    );\n    return {\n      label: `Fulfilled in ${resolutionBy}`,\n      color: \"green\",\n      date: ticket.value.doc?.resolution_date,\n    };\n  } else {\n    let resolutionBy = formatTimeShort(\n      String(new Date()),\n      ticket.value.doc?.resolution_by\n    );\n    return {\n      label: `Failed by ${resolutionBy}`,\n      color: \"red\",\n      date: ticket.value.doc?.resolution_by,\n    };\n  }\n});\n\nfunction formatTimeShort(date: string, end?: string): string {\n  if (!end) {\n    end = dayjs().toString();\n  }\n  let _date = dayjs(date);\n  let duration = dayjs.duration(_date.diff(dayjs(end)));\n\n  let days = duration.days();\n  let hours = duration.hours();\n  let minutes = duration.minutes();\n\n  if (days > 0) {\n    return `${days}d ${hours}h`;\n  } else if (hours > 0) {\n    return `${hours}h ${minutes}m`;\n  } else {\n    return `${minutes}m`;\n  }\n}\n\nuseShortcut({ meta: true, shift: true, key: \".\" }, () => {\n  copyToClipboard(window.location.href, `Ticket URL copied to clipboard`);\n});\n\nuseShortcut({ meta: true, key: \".\" }, () => {\n  copyToClipboard(\n    ticket.value.doc.name,\n    `Ticket #${ticket.value.doc.name} copied to clipboard`\n  );\n});\n</script>\n","<template>\n  <Dialog v-model=\"showSubjectDialog\" :options=\"{ title: 'Rename Subject' }\">\n    <template #body-content>\n      <div class=\"flex flex-col flex-1 gap-3\">\n        <FormControl\n          v-model=\"renameSubject\"\n          type=\"textarea\"\n          size=\"sm\"\n          variant=\"subtle\"\n          :disabled=\"false\"\n        />\n        <Button\n          variant=\"solid\"\n          :loading=\"isLoading\"\n          label=\"Rename\"\n          @click=\"handleRename\"\n        />\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { TicketSymbol } from \"@/types\";\nimport { inject, ref } from \"vue\";\n\nconst ticket = inject(TicketSymbol);\nconst showSubjectDialog = defineModel();\nconst renameSubject = ref(ticket.value?.doc?.subject || \"\");\nconst isLoading = ref(false);\n\nfunction handleRename() {\n  isLoading.value = true;\n  ticket.value.setValue.submit(\n    {\n      subject: renameSubject.value,\n    },\n    {\n      onSuccess() {\n        isLoading.value = false;\n        showSubjectDialog.value = false;\n      },\n    }\n  );\n}\n</script>\n\n<style scoped></style>\n","<template>\n  <LayoutHeader>\n    <template #left-header>\n      <div class=\"flex flex-col truncate\">\n        <Breadcrumbs :items=\"breadcrumbs\" class=\"breadcrumbs\">\n          <template #prefix=\"{ item }\">\n            <Icon\n              v-if=\"item.icon\"\n              :icon=\"item.icon\"\n              class=\"mr-1 h-4 flex items-center justify-center self-center\"\n            />\n          </template>\n        </Breadcrumbs>\n        <TicketSLA />\n      </div>\n    </template>\n    <template #right-header>\n      <div class=\"flex gap-2 items-center\">\n        <MultipleAvatar\n          :avatars=\"JSON.stringify(viewers)\"\n          size=\"md\"\n          :hide-name=\"true\"\n        />\n        <!-- Navigation -->\n        <TicketNavigation :key=\"ticket.name\" />\n        <!-- Custom Actions -->\n        <div v-if=\"normalActions.length\" class=\"flex gap-2\">\n          <Button\n            v-for=\"action in normalActions\"\n            :key=\"action.label\"\n            :label=\"action.label\"\n            @click=\"action.onClick()\"\n            v-bind=\"action\"\n          >\n            <template v-if=\"action.icon\" #prefix>\n              <FeatherIcon :name=\"action.icon\" class=\"h-4 w-4\" />\n            </template>\n          </Button>\n        </div>\n        <div v-if=\"groupedWithLabelActions.length\">\n          <div v-for=\"g in groupedWithLabelActions\" :key=\"g.label\">\n            <Dropdown v-slot=\"{ open }\" :options=\"g.action\">\n              <Button :label=\"g.label\">\n                <template #suffix>\n                  <FeatherIcon\n                    :name=\"open ? 'chevron-up' : 'chevron-down'\"\n                    class=\"h-4\"\n                  />\n                </template>\n              </Button>\n            </Dropdown>\n          </div>\n        </div>\n        <!-- Status -->\n        <Dropdown :options=\"statusDropdown\" placement=\"right\">\n          <template #default=\"{ open }\">\n            <Button :label=\"ticket.doc.status\" ref=\"statusRef\">\n              <template #prefix>\n                <IndicatorIcon\n                  :class=\"\n                    ticketStatusStore.getStatus(ticket.doc.status)?.parsed_color\n                  \"\n                />\n              </template>\n            </Button>\n          </template>\n        </Dropdown>\n        <!-- Core Actions + Custom Actions -->\n        <Dropdown\n          v-if=\"groupedActions.length\"\n          :options=\"groupedActions\"\n          placement=\"right\"\n        >\n          <Button icon=\"more-horizontal\" />\n        </Dropdown>\n      </div>\n    </template>\n  </LayoutHeader>\n  <TicketMergeModal\n    :ticket=\"ticket.doc\"\n    v-if=\"showMergeModal\"\n    v-model=\"showMergeModal\"\n    @update=\"ticket.reload()\"\n  />\n  <TicketSubjectModal v-if=\"showSubjectDialog\" v-model=\"showSubjectDialog\" />\n</template>\n\n<script setup lang=\"ts\">\nimport { MultipleAvatar } from \"@/components\";\nimport LayoutHeader from \"@/components/LayoutHeader.vue\";\nimport TicketMergeModal from \"@/components/ticket/TicketMergeModal.vue\";\nimport { setupCustomizations } from \"@/composables/formCustomisation\";\nimport { useNotifyTicketUpdate } from \"@/composables/realtime\";\nimport { useShortcut } from \"@/composables/shortcuts\";\nimport { useView } from \"@/composables/useView\";\nimport { globalStore } from \"@/stores/globalStore\";\nimport { useTicketStatusStore } from \"@/stores/ticketStatus\";\nimport {\n  ActivitiesSymbol,\n  CustomizationSymbol,\n  TicketSymbol,\n  View,\n} from \"@/types\";\nimport { HDTicketStatus } from \"@/types/doctypes\";\nimport { getIcon } from \"@/utils\";\nimport { Breadcrumbs, call, Dropdown, toast } from \"frappe-ui\";\nimport { __ } from \"@/translation\";\nimport {\n  computed,\n  ComputedRef,\n  h,\n  inject,\n  onMounted,\n  PropType,\n  ref,\n  useTemplateRef,\n  watchEffect,\n} from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport LucideMerge from \"~icons/lucide/merge\";\nimport { IndicatorIcon } from \"../icons\";\nimport TicketNavigation from \"./TicketNavigation.vue\";\nimport TicketSLA from \"./TicketSLA.vue\";\nimport TicketSubjectModal from \"./TicketSubjectModal.vue\";\n\ndefineProps({\n  viewers: {\n    type: Array as PropType<string[]>,\n    required: true,\n  },\n});\n\nconst route = useRoute();\nconst router = useRouter();\nconst { findView } = useView(\"HD Ticket\");\nconst ticketStatusStore = useTicketStatusStore();\n\nconst ticket = inject(TicketSymbol);\nconst customizations = inject(CustomizationSymbol);\nconst activities = inject(ActivitiesSymbol);\n\nconst showSubjectDialog = ref(false);\n\nconst { notifyTicketUpdate } = useNotifyTicketUpdate(ticket.value?.name);\nconst statusDropdown = computed(() => {\n  const statuses =\n    ticketStatusStore.statuses.data?.filter((s) => s.enabled) || [];\n  return statuses.map((o: HDTicketStatus) => ({\n    label: o.label_agent,\n    value: o.label_agent,\n    onClick: () => {\n      notifyTicketUpdate(\"Status\", o.label_agent);\n      if (ticket.value.doc.status === o.label_agent) return;\n      ticket.value.setValue.submit(\n        { status: o.label_agent },\n        {\n          onSuccess() {\n            activities.value.reload();\n          },\n        }\n      );\n    },\n    icon: () =>\n      h(IndicatorIcon, {\n        class: o.parsed_color,\n      }),\n  }));\n});\nconst breadcrumbs = computed(() => {\n  let items = [{ label: __(\"Tickets\"), route: { name: \"TicketsAgent\" } }];\n  if (route.query.view) {\n    const currView: ComputedRef<View> = findView(route.query.view as string);\n    if (currView) {\n      items.push({\n        label: currView.value?.label,\n        icon: getIcon(currView.value?.icon),\n        route: { name: \"TicketsAgent\", query: { view: currView.value?.name } },\n      });\n    }\n  }\n  items.push({\n    label: ticket.value.doc?.subject,\n    onClick: () => {\n      showSubjectDialog.value = true;\n    },\n  });\n  return items;\n});\n\nfunction updateField(fieldname: string, value: string, callback = () => {}) {\n  const doc = ticket.value;\n  doc.setValue.submit({\n    [fieldname]: value,\n  });\n  callback();\n}\n\nconst showMergeModal = ref(false);\nconst showMergeOption = computed(() => {\n  return (\n    !ticket.value.doc.is_merged &&\n    [\"Open\", \"Paused\"].includes(ticket.value.doc.status_category)\n  );\n});\nconst defaultActions = computed(() => {\n  let items = [];\n\n  if (showMergeOption.value) {\n    items.push({\n      label: __(\"Merge Ticket\"),\n      icon: LucideMerge,\n      condition: () => !ticket.value.doc.is_merged,\n      onClick: () => (showMergeModal.value = true),\n    });\n  }\n  return [\n    {\n      group: __(\"Default actions\"),\n      hideLabel: true,\n      items,\n    },\n  ];\n});\nconst actions = ref([]);\nconst normalActions = computed(() => {\n  return actions.value.filter((action) => !action.group);\n});\n\nconst groupedWithLabelActions = computed(() => {\n  let _actions = [];\n\n  actions.value\n    .filter((action) => action.buttonLabel && action.group)\n    .forEach((action) => {\n      let groupIndex = _actions.findIndex(\n        (a) => a.label === action.buttonLabel\n      );\n      if (groupIndex > -1) {\n        _actions[groupIndex].action.push(action);\n      } else {\n        _actions.push({\n          label: action.buttonLabel,\n          action: [action],\n        });\n      }\n    });\n  return _actions;\n});\n\nconst groupedActions = computed(() => {\n  let _actions = [];\n  _actions = _actions.concat(\n    actions.value.filter((action) => action.group && !action.buttonLabel)\n  );\n  return _actions;\n});\n\nconst customizationCtx = computed(() => ({\n  doc: ticket?.value?.doc,\n  call,\n  router,\n  toast,\n  $dialog: globalStore().$dialog,\n  updateField,\n  createToast: toast.create,\n}));\n\n// to manage the correct  customization context for actions, happens because of navigation between tickets using buttons\nwatchEffect(async () => {\n  if (customizations.value?.data) {\n    await setupCustomizations(\n      customizations.value.data,\n      customizationCtx.value\n    );\n\n    actions.value = [\n      ...defaultActions.value,\n      ...(customizations.value?.data?._customActions || []),\n    ];\n  }\n});\n\nconst statusRef = useTemplateRef(\"statusRef\");\n\nonMounted(() => {\n  useShortcut(\"s\", () => {\n    statusRef.value?.$el?.nextElementSibling?.click();\n  });\n});\n</script>\n\n<style>\n.breadcrumbs button {\n  background-color: inherit !important;\n  &:hover,\n  &:focus {\n    background-color: inherit !important;\n  }\n}\n</style>\n","<template>\n  <div class=\"relative\" :style=\"{ width: `${sidebarWidth}px` }\">\n    <slot v-bind=\"{ sidebarResizing, sidebarWidth }\" />\n    <div\n      class=\"absolute z-1 h-full w-1 cursor-col-resize bg-surface-gray-4 opacity-0 transition-opacity hover:opacity-100\"\n      :class=\"{\n        'opacity-100': sidebarResizing,\n        'left-0': side == 'right',\n        'right-0': side == 'left',\n      }\"\n      @mousedown=\"startResize\"\n    />\n  </div>\n</template>\n<script setup>\nimport { ref } from \"vue\";\n\nconst props = defineProps({\n  defaultWidth: {\n    type: Number,\n    default: 352,\n  },\n  minWidth: {\n    type: Number,\n    default: 16 * 16,\n  },\n  maxWidth: {\n    type: Number,\n    default: 30 * 16,\n  },\n  side: {\n    type: String,\n    default: \"left\",\n  },\n  parent: {\n    type: Object,\n    default: null,\n  },\n});\n\nconst sidebarResizing = ref(false);\nconst sidebarWidth = ref(props.defaultWidth);\n\nfunction startResize() {\n  document.addEventListener(\"mousemove\", resize);\n  document.addEventListener(\"mouseup\", () => {\n    document.body.classList.remove(\"select-none\");\n    document.body.classList.remove(\"cursor-col-resize\");\n    document.querySelectorAll(\".select-text1\").forEach((el) => {\n      el.classList.remove(\"select-text1\");\n      el.classList.add(\"select-text\");\n    });\n    localStorage.setItem(\"sidebarWidth\", sidebarWidth.value);\n    sidebarResizing.value = false;\n    document.removeEventListener(\"mousemove\", resize);\n  });\n}\nfunction resize(e) {\n  sidebarResizing.value = true;\n  document.body.classList.add(\"select-none\");\n  document.body.classList.add(\"cursor-col-resize\");\n  document.querySelectorAll(\".select-text\").forEach((el) => {\n    el.classList.remove(\"select-text\");\n    el.classList.add(\"select-text1\");\n  });\n  sidebarWidth.value =\n    props.side == \"left\" ? e.clientX : window.innerWidth - e.clientX;\n\n  let gap = props.parent ? distance() : 0;\n  sidebarWidth.value = sidebarWidth.value - gap;\n\n  // snap to props.defaultWidth\n  let range = [props.defaultWidth - 10, props.defaultWidth + 10];\n  if (sidebarWidth.value > range[0] && sidebarWidth.value < range[1]) {\n    sidebarWidth.value = props.defaultWidth;\n  }\n\n  if (sidebarWidth.value < props.minWidth) {\n    sidebarWidth.value = props.minWidth;\n  }\n  if (sidebarWidth.value > props.maxWidth) {\n    sidebarWidth.value = props.maxWidth;\n  }\n}\nfunction distance() {\n  if (!props.parent) return 0;\n  const rect = props.parent.getBoundingClientRect();\n  return rect[props.side];\n}\n</script>\n","<template>\n  <!-- TODO: handle ellipsis -->\n  <div>\n    <!-- Contact -->\n    <div v-if=\"!contact.loading\">\n      <div class=\"flex gap-3 items-center px-5 py-2.5\">\n        <Avatar\n          :label=\"contact.data.name\"\n          :image=\"contact.data.image\"\n          size=\"2xl\"\n        />\n        <p class=\"text-ink-gray-8 font-medium text-xl max-w-full truncate\">\n          {{ contact.data.name }}\n        </p>\n      </div>\n      <div class=\"px-5 text-ink-gray-5 pb-2\">\n        <!-- Email Id -->\n        <div class=\"flex gap-2 items-center p-1.5\">\n          <EmailIcon class=\"size-4\" />\n          <p class=\"text-p-sm text-ink-gray-6 hover:underline cursor-pointer\">\n            {{ contact.data.email_id }}\n          </p>\n          <CopyIcon\n            class=\"size-4 cursor-pointer\"\n            @click=\"\n              copyToClipboard(\n                contact.data.email_id,\n                `'${contact.data.email_id}' copied to clipboard`\n              )\n            \"\n          />\n        </div>\n        <!-- Mobile Number -->\n        <div\n          class=\"flex gap-2 items-center p-1.5\"\n          v-if=\"\n            isCallingEnabled && (contact.data.mobile_no || contact.data.phone)\n          \"\n        >\n          <PhoneIcon class=\"size-4\" />\n          <p class=\"text-p-sm text-ink-gray-6 hover:underline cursor-pointer\">\n            {{ contact.data.mobile_no || contact.data.phone }}\n          </p>\n          <CopyIcon\n            class=\"size-4 cursor-pointer\"\n            v-if=\"contact.data.mobile_no || contact.data.phone\"\n            @click=\"\n              copyToClipboard(\n                contact.data.mobile_no || contact.data.phone,\n                `'${\n                  contact.data.mobile_no || contact.data.phone\n                }' copied to clipboard`\n              )\n            \"\n          />\n        </div>\n      </div>\n    </div>\n\n    <!-- Recent / Similar Tickets -->\n    <template v-if=\"!recentSimilarTickets.loading\">\n      <div class=\"px-5 border-t pb-2.5\" v-for=\"section in sections\">\n        <Section\n          :key=\"section.label\"\n          :label=\"section.label\"\n          :hideLabel=\"section.hideLabel\"\n          :opened=\"section.opened\"\n        >\n          <template #header=\"{ opened, hide, toggle }\">\n            <div class=\"flex gap-2.5 items-center py-[13px] justify-between\">\n              <Tooltip :text=\"section.tooltipMessage\">\n                <span\n                  class=\"text-ink-gray-8 font-medium text-base cursor-pointer select-none\"\n                  @click=\"toggle\"\n                >\n                  {{ section.label }}\n                </span>\n              </Tooltip>\n              <LucideChevronDown\n                class=\"size-4 text-ink-gray-6 cursor-pointer\"\n                :class=\"{ 'rotate-180': opened }\"\n                @click=\"toggle\"\n              />\n            </div>\n          </template>\n          <ul>\n            <li\n              v-for=\"ticket in section.tickets\"\n              :key=\"ticket.name\"\n              class=\"py-2.5 cursor-pointer\"\n              @click=\"openTicket(ticket.name)\"\n            >\n              <p class=\"text-base text-ink-gray-8 max-w-[60%] truncate\">\n                {{ ticket.subject }}\n              </p>\n              <div class=\"flex items-end justify-between\">\n                <p class=\"text-base text-ink-gray-5\">\n                  {{ formatDate(ticket.creation) + \" &#183; \" }}\n                  <span class=\"transition duration-400 hover:underline\">\n                    {{ \"#\" + ticket.name }}\n                  </span>\n                </p>\n                <p\n                  class=\"px-1.5 py-[3px] text-sm rounded-sm max-w-[80px] text-center truncate h-5\"\n                  :class=\"getStatusColor(ticket.status)\"\n                >\n                  {{ ticket.status }}\n                </p>\n              </div>\n            </li>\n          </ul>\n        </Section>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useTelephonyStore } from \"@/stores/telephony\";\nimport { useTicketStatusStore } from \"@/stores/ticketStatus\";\nimport { RecentSimilarTicketsSymbol, TicketContactSymbol } from \"@/types\";\nimport { copyToClipboard } from \"@/utils\";\nimport dayjs from \"dayjs\";\nimport { Avatar, Tooltip } from \"frappe-ui\";\nimport { storeToRefs } from \"pinia\";\nimport { computed, inject } from \"vue\";\nimport { CopyIcon } from \"../icons\";\nimport EmailIcon from \"../icons/EmailIcon.vue\";\nimport PhoneIcon from \"../icons/PhoneIcon.vue\";\nimport Section from \"../Section.vue\";\nconst telephonyStore = useTelephonyStore();\nconst { isCallingEnabled } = storeToRefs(telephonyStore);\n\nconst contact = inject(TicketContactSymbol);\nconst recentSimilarTickets = inject(RecentSimilarTicketsSymbol);\nconst dateFormat = window.date_format;\n\nconst { getStatus, colorMap } = useTicketStatusStore();\n\nfunction getStatusColor(status: string) {\n  let { color } = getStatus(status);\n\n  if (colorMap[color]) {\n    return colorMap[color];\n  } else {\n    return colorMap[\"Default\"];\n  }\n}\n\nconst sections = computed(() => {\n  if (recentSimilarTickets.value.loading || !recentSimilarTickets.value.data) {\n    return [];\n  }\n  const recentTickets = recentSimilarTickets.value?.data?.recent_tickets || [];\n  const similarTickets =\n    recentSimilarTickets.value?.data?.similar_tickets || [];\n  const _sections = [];\n  if (recentTickets.length) {\n    _sections.push({\n      label: \"Recent Tickets\",\n      tooltipMessage: \"Tickets recently raised by this contact/customer\",\n      hideLabel: false,\n      opened: true,\n      tickets: recentTickets,\n    });\n  }\n  if (similarTickets.length) {\n    _sections.push({\n      label: \"Similar Tickets\",\n      tooltipMessage: \"Tickets with similar queries\",\n      hideLabel: false,\n      opened: true,\n      tickets: similarTickets,\n    });\n  }\n  return _sections;\n});\n\nfunction formatDate(date: string) {\n  return dayjs(date).format(dateFormat.toUpperCase());\n}\n\nfunction openTicket(name: string) {\n  let url = window.location.origin + \"/helpdesk/tickets/\" + name;\n\n  window.open(url, \"_blank\");\n}\n// v-if=\"(false && contact.data.mobile_no) || contact.data.phone\"\n</script>\n\n<style scoped></style>\n","<template>\n  <div\n    class=\"flex flex-col gap-2 my-2 w-[470px] rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black p-3 ring-opacity-5 focus:outline-none\"\n  >\n    <div class=\"text-base text-ink-gray-5\">{{ __(\"Assign to\") }}</div>\n    <Link\n      class=\"form-control\"\n      value=\"\"\n      doctype=\"HD Agent\"\n      @change=\"(option) => addValue(option) && ($refs.input.value = '')\"\n      :placeholder=\"__('John Doe')\"\n      :filters=\"{\n        is_active: true,\n        name: ['not in', assignees.map((a) => a.name)],\n      }\"\n      :hideMe=\"true\"\n    >\n      <template #target=\"{ togglePopover }\">\n        <div\n          class=\"w-full min-h-12 flex flex-wrap items-center gap-1.5 p-1.5 pb-5 rounded-lg bg-surface-gray-2 cursor-text\"\n          @click.stop=\"togglePopover\"\n          ref=\"input\"\n        >\n          <Tooltip\n            :text=\"assignee.name\"\n            v-for=\"assignee in assignees\"\n            :key=\"assignee.name\"\n            @click.stop\n          >\n            <div\n              class=\"flex items-center text-sm p-0.5 text-ink-gray-6 border border-outline-gray-1 bg-surface-modal rounded-full cursor-pointer\"\n              @click.stop\n            >\n              <UserAvatar :name=\"assignee.name\" size=\"sm\" />\n              <div class=\"ml-1\">{{ getUser(assignee.name).full_name }}</div>\n              <Button\n                variant=\"ghost\"\n                class=\"rounded-full !size-4 m-1\"\n                @click.stop=\"removeValue(assignee.name)\"\n              >\n                <template #icon>\n                  <FeatherIcon name=\"x\" class=\"h-3 w-3 text-ink-gray-6\" />\n                </template>\n              </Button>\n            </div>\n          </Tooltip>\n        </div>\n      </template>\n      <template #item-prefix=\"{ option }\">\n        <UserAvatar class=\"mr-2\" :name=\"option.value\" size=\"sm\" />\n      </template>\n      <template #item-label=\"{ option }\">\n        <Tooltip :text=\"option.value\">\n          <div class=\"cursor-pointer text-ink-gray-9\">\n            {{ getUser(option.value).full_name }}\n          </div>\n        </Tooltip>\n      </template>\n    </Link>\n    <div class=\"flex items-center justify-between gap-2\">\n      <div\n        class=\"text-base text-ink-gray-5 cursor-pointer select-none\"\n        @click=\"assignToMe = !assignToMe\"\n      >\n        {{ __(\"Assign to me\") }}\n      </div>\n      <Switch v-model=\"assignToMe\" @click.stop />\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport UserAvatar from \"@/components/UserAvatar.vue\";\nimport Link from \"@/components/frappe-ui/Link.vue\";\nimport { useUserStore } from \"@/stores/user\";\nimport { capture } from \"@/telemetry\";\nimport { Tooltip, Switch, createResource, call } from \"frappe-ui\";\nimport { ref, watch, useTemplateRef, nextTick } from \"vue\";\n\nconst props = defineProps({\n  doctype: {\n    type: String,\n    default: \"\",\n  },\n  docname: {\n    type: String,\n    default: null,\n  },\n  open: {\n    type: Boolean,\n    default: false,\n  },\n  onUpdate: {\n    type: Function,\n    default: null,\n  },\n});\n\nconst assignees = defineModel();\nconst oldAssignees = ref([]);\nconst assignToMe = ref(false);\n\nconst error = ref(\"\");\n\nconst { users, getUser } = useUserStore();\n\nconst removeValue = (value) => {\n  if (value === getUser(\"\").name) {\n    assignToMe.value = false;\n  }\n\n  assignees.value = assignees.value.filter(\n    (assignee) => assignee.name !== value\n  );\n};\n\nconst addValue = (value) => {\n  if (!value) return;\n\n  if (value === getUser(\"\").name) {\n    assignToMe.value = true;\n  }\n\n  error.value = \"\";\n  let obj = {\n    name: value,\n    image: getUser(value).user_image,\n    label: getUser(value).full_name,\n  };\n  if (!assignees.value.find((assignee) => assignee.name === value)) {\n    assignees.value.push(obj);\n  }\n};\n\nwatch(assignToMe, (val) => {\n  let user = getUser(\"\");\n  if (val) {\n    addValue(user.name);\n  } else {\n    removeValue(user.name);\n  }\n});\n\nwatch(\n  () => props.open,\n  (val) => {\n    if (val) {\n      oldAssignees.value = [...(assignees.value || [])];\n      assignToMe.value = assignees.value.some(\n        (assignee) => assignee.name === getUser(\"\").name\n      );\n    } else {\n      updateAssignees();\n    }\n  },\n  { immediate: true }\n);\n\nasync function updateAssignees() {\n  const _assignees = assignees.value.map((a) => a.name);\n  const _oldAssignees = oldAssignees.value.map((a) => a.name);\n  if (JSON.stringify(_oldAssignees) === JSON.stringify(_assignees)) return;\n\n  const removedAssignees = oldAssignees.value\n    .filter(\n      (assignee) => !assignees.value.find((a) => a.name === assignee.name)\n    )\n    .map((assignee) => assignee.name);\n\n  const addedAssignees = assignees.value\n    .filter(\n      (assignee) => !oldAssignees.value.find((a) => a.name === assignee.name)\n    )\n    .map((assignee) => assignee.name);\n\n  if (addedAssignees.length || removedAssignees.length) {\n    let logMessage = `${\n      addedAssignees.length ? `assigned ${addedAssignees.join(\", \")}` : \"\"\n    } ${addedAssignees.length && removedAssignees.length ? \" & \" : \"\"} ${\n      removedAssignees.length ? `unassigned ${removedAssignees.join(\", \")}` : \"\"\n    }`;\n    call(\"frappe.client.insert\", {\n      doc: {\n        doctype: \"HD Ticket Activity\",\n        ticket: props.docname,\n        action: logMessage,\n      },\n    });\n  }\n  if (props.onUpdate) {\n    props.onUpdate(\n      addedAssignees,\n      removedAssignees,\n      addAssignees,\n      removeAssignees\n    );\n  } else {\n    if (removedAssignees.length) {\n      await removeAssignees.submit(removedAssignees);\n    }\n    if (addedAssignees.length) {\n      await addAssignees.submit(addedAssignees);\n    }\n  }\n}\n\nconst addAssignees = createResource({\n  url: \"frappe.desk.form.assign_to.add\",\n  makeParams: (addedAssignees) => ({\n    doctype: props.doctype,\n    name: props.docname,\n    assign_to: addedAssignees,\n  }),\n  onSuccess: () => {\n    capture(\"assign_to\", { doctype: props.doctype });\n  },\n});\n\nconst removeAssignees = createResource({\n  url: \"helpdesk.api.doc.remove_assignments\",\n  makeParams: (removedAssignees) => ({\n    doctype: props.doctype,\n    name: props.docname,\n    assignees: removedAssignees,\n  }),\n});\n\nconst targetRef = useTemplateRef(\"input\");\nnextTick(() => {\n  targetRef.value.click();\n});\n</script>\n","<template>\n  <Popover class=\"flex w-full\" placement=\"bottom-end\">\n    <template #target=\"{ open, close, togglePopover }\">\n      <div class=\"flex flex-col gap-1.5 w-full\">\n        <span class=\"block text-xs text-gray-600\">Assignee</span>\n        <Button\n          variant=\"outline\"\n          class=\"!flex !justify-start w-full active:!bg-inherit hover:shadow-sm\"\n          ref=\"assigneeButton\"\n          @click=\"togglePopover()\"\n        >\n          <p v-if=\"assignees.loading || assignees.data?.length === 0\">\n            {{ __(\"No assignees\") }}\n          </p>\n          <div\n            v-else-if=\"assignees.data?.length >= 1\"\n            class=\"flex gap-1.5 items-center\"\n          >\n            <MultipleAvatar\n              :avatars=\"assignees.data.map((a) => a.name)\"\n              size=\"sm\"\n            />\n            <p\n              v-if=\"assignees.data?.length > 1\"\n              class=\"ml-2 text-sm text-ink-gray-8\"\n            >\n              {{ assignees.data?.length }} assignees\n            </p>\n          </div>\n          <template #suffix>\n            <Icon\n              :icon=\"LucideChevronDown\"\n              class=\"h-4 w-4 ml-auto text-ink-gray-5\"\n            />\n          </template>\n        </Button>\n      </div>\n    </template>\n    <template #body=\"{ isOpen }\">\n      <AssignToBody\n        v-show=\"isOpen\"\n        v-model=\"assignees.data\"\n        doctype=\"HD Ticket\"\n        :docname=\"ticket.name\"\n        :open=\"isOpen\"\n        :onUpdate=\"saveAssignees\"\n      />\n    </template>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport { useShortcut } from \"@/composables/shortcuts\";\nimport { ActivitiesSymbol, AssigneeSymbol, TicketSymbol } from \"@/types\";\nimport { Popover } from \"frappe-ui\";\nimport { inject, useTemplateRef } from \"vue\";\nimport LucideChevronDown from \"~icons/lucide/chevron-down\";\nimport MultipleAvatar from \"../MultipleAvatar.vue\";\nimport AssignToBody from \"./AssignToBody.vue\";\nconst ticket = inject(TicketSymbol);\nconst assignees = inject(AssigneeSymbol);\nconst activities = inject(ActivitiesSymbol);\nasync function saveAssignees(\n  addedAssignees,\n  removedAssignees,\n  addAssignees,\n  removeAssignees\n) {\n  removedAssignees.length && (await removeAssignees.submit(removedAssignees));\n  addedAssignees.length && (await addAssignees.submit(addedAssignees));\n  activities.value.reload();\n}\n\nconst assignToRef = useTemplateRef(\"assigneeButton\");\n\nuseShortcut(\"a\", () => {\n  (assignToRef.value?.$el as HTMLElement)?.nextElementSibling?.click();\n});\n</script>\n","<template>\n  <div\n    v-if=\"!contact.loading\"\n    class=\"my-4 flex items-center justify-start gap-5\"\n  >\n    <Avatar :label=\"contact.data.name\" :image=\"contactImage\" size=\"2xl\" />\n    <div class=\"flex flex-col gap-1.5\">\n      <Tooltip :text=\"contact.data.name || contact.data.email_id\">\n        <div class=\"flex gap-2.5 items-center\">\n          <p class=\"text-ink-gray-8 font-medium text-xl max-w-[170px] truncate\">\n            {{ contact.data.name || contact.data.email_id }}\n          </p>\n          <ExternalLinkIcon\n            class=\"size-4 text-ink-gray-6 cursor-pointer\"\n            @click=\"openContact(contact.data.name)\"\n          />\n        </div>\n      </Tooltip>\n      <div class=\"flex gap-1.5\">\n        <Tooltip :text=\"contact.data.email_id\">\n          <!-- Email Button -->\n          <Button size=\"sm\" @click=\"toggleEmailBox()\">\n            <template #icon>\n              <EmailIcon class=\"size-4\" />\n            </template>\n          </Button>\n          <!-- Call Button -->\n          <Button size=\"sm\" v-if=\"isCallingEnabled\" @click=\"callContact\">\n            <template #icon>\n              <PhoneIcon class=\"size-4\" />\n            </template>\n          </Button>\n        </Tooltip>\n      </div>\n    </div>\n    <SetContactPhoneModal\n      v-model=\"showPhoneModal\"\n      :name=\"contact.data.name\"\n      @onUpdate=\"contact.reload\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { toggleEmailBox } from \"@/pages/ticket/modalStates\";\nimport { useTelephonyStore } from \"@/stores/telephony\";\nimport { useUserStore } from \"@/stores/user\";\nimport { TicketContactSymbol, TicketSymbol } from \"@/types\";\nimport { Avatar, Button, Tooltip } from \"frappe-ui\";\nimport { storeToRefs } from \"pinia\";\nimport { computed, inject, ref } from \"vue\";\nimport { ExternalLinkIcon } from \"../icons\";\nimport EmailIcon from \"../icons/EmailIcon.vue\";\nimport PhoneIcon from \"../icons/PhoneIcon.vue\";\nimport SetContactPhoneModal from \"../ticket/SetContactPhoneModal.vue\";\n\nconst telephonyStore = useTelephonyStore();\nconst { getUser } = useUserStore();\nconst { isCallingEnabled } = storeToRefs(telephonyStore);\nconst showPhoneModal = ref(false);\n\nconst ticket = inject(TicketSymbol);\n\nconst contact = inject(TicketContactSymbol);\nconst contactImage = computed(() => {\n  return (\n    contact.value?.data?.image ||\n    getUser(contact.value?.data?.email_id)?.user_image ||\n    null\n  );\n});\n\nfunction openContact(name: string) {\n  let url = window.location.origin + \"/app/contact/\" + name;\n  window.open(url, \"_blank\");\n}\n\nconst callContact = () => {\n  if (!contact.value.data.mobile_no && !contact.value.data.phone) {\n    showPhoneModal.value = true;\n    return;\n  }\n  telephonyStore.makeCall({\n    number: contact.value.data.mobile_no || contact.value.data.phone,\n    doctype: \"HD Ticket\",\n    docname: ticket.value.name,\n  });\n};\n</script>\n\n<style scoped></style>\n","<template>\n  <div\n    class=\"h-full overflow-y-hidden flex flex-1 flex-col justify-between overflow-hidden max-h-full\"\n  >\n    <div class=\"px-5 pb-4 flex flex-col\">\n      <!-- User avatar with buttons -->\n      <TicketContact />\n      <!-- Core Fields -->\n      <div>\n        <div\n          v-for=\"(section, index) in coreFields\"\n          :key=\"index\"\n          :class=\"\n            section.group ? 'flex gap-2 items-center w-full mb-3' : 'mb-3'\n          \"\n        >\n          <template v-for=\"field in section.fields\">\n            <Link\n              v-if=\"field.visible\"\n              :key=\"field.fieldname\"\n              :ref=\"(el) => setFieldRef(field.fieldname, el)\"\n              class=\"form-control-core\"\n              :id=\"field.fieldname\"\n              :class=\"section.group ? 'flex-1' : 'w-full'\"\n              :page-length=\"10\"\n              :label=\"field.label\"\n              :placeholder=\"field.placeholder\"\n              :doctype=\"field.doctype\"\n              :modelValue=\"field.value\"\n              :required=\"field.required\"\n              @update:model-value=\"\n              (val:string) => handleFieldUpdate(field.fieldname, val,true)\n            \"\n            />\n          </template>\n        </div>\n\n        <!-- Assignee component -->\n        <AssignTo />\n      </div>\n    </div>\n\n    <!-- Additional Fields -->\n    <div class=\"border-t flex flex-col flex-1 h-full pb-3 overflow-y-hidden\">\n      <!-- TODO: Hack of 80 % for now, will refactor -->\n      <div class=\"overflow-y-scroll max-h-[80%]\">\n        <template v-for=\"field in customFields\">\n          <TicketField\n            v-if=\"field.visible\"\n            :key=\"field.fieldname\"\n            :field=\"field\"\n            :value=\"field.value\"\n            @change=\"\n              ({ fieldname, value }) => handleFieldUpdate(fieldname, value)\n            \"\n          />\n        </template>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { Link } from \"@/components\";\nimport { parseField } from \"@/composables/formCustomisation\";\nimport { useNotifyTicketUpdate } from \"@/composables/realtime\";\nimport { useShortcut } from \"@/composables/shortcuts\";\nimport { getMeta } from \"@/stores/meta\";\nimport {\n  ActivitiesSymbol,\n  AssigneeSymbol,\n  CustomizationSymbol,\n  FieldValue,\n  TicketSymbol,\n} from \"@/types\";\nimport { computed, inject, ref } from \"vue\";\nimport TicketField from \"../TicketField.vue\";\nimport AssignTo from \"./AssignTo.vue\";\nimport TicketContact from \"./TicketContact.vue\";\n\nconst ticket = inject(TicketSymbol);\nconst assignees = inject(AssigneeSymbol);\nconst customizations = inject(CustomizationSymbol);\nconst activities = inject(ActivitiesSymbol);\nconst { getFields, getField } = getMeta(\"HD Ticket\");\nconst { notifyTicketUpdate } = useNotifyTicketUpdate(ticket.value?.name);\n\n// ticket_type, priority, customer, agent_group\nconst coreFields = computed(() => {\n  // TODO: to confirm whether customizations should apply to core fields as well\n  const fieldsMeta = getFields();\n  if (!fieldsMeta || fieldsMeta.length === 0) {\n    return [];\n  }\n  const _coreFields = [\n    { group: true, fields: [getField(\"ticket_type\"), getField(\"priority\")] },\n    { group: false, fields: [getField(\"customer\")] },\n    { group: true, fields: [getField(\"agent_group\")] },\n  ];\n\n  _coreFields.forEach((section) => {\n    section.fields = section.fields.map((f) => {\n      f = parseField(f, ticket.value.doc);\n\n      // cant handle required depends on as we directly set the value in DB on change\n      f[\"required\"] = f.reqd;\n      f[\"ref\"] = f.fieldname;\n\n      f = getFieldInFormat(f, f);\n      f[\"visible\"] = true;\n      return f;\n    });\n  });\n  return _coreFields;\n});\n\nconst customFields = computed(() => {\n  const fieldsMeta = getFields();\n  if (!fieldsMeta || fieldsMeta.length === 0) {\n    return [];\n  }\n\n  if (!customizations.value.data || customizations.value.loading) return [];\n  let customFields = customizations.value.data?.custom_fields || [];\n  const _coreFields = [\n    \"ticket_type\",\n    \"priority\",\n    \"customer\",\n    \"agent_group\",\n    \"subject\",\n    \"status\",\n  ];\n  customFields = customFields.filter((f) => !_coreFields.includes(f.fieldname));\n  let _customFields = customFields.map((f) => {\n    let fieldMeta = getField(f.fieldname);\n\n    fieldMeta = parseField(fieldMeta, ticket.value.doc);\n    // cant handle required depends on as we directly set the value in DB\n    fieldMeta[\"required\"] = fieldMeta.reqd || f.required;\n\n    return getFieldInFormat(f, fieldMeta);\n  });\n  return _customFields;\n});\n\nfunction getFieldInFormat(fieldTemplate, fieldMeta) {\n  return {\n    label: fieldMeta?.label || fieldTemplate.fieldname,\n    value: ticket.value.doc[fieldTemplate.fieldname],\n    fieldtype: fieldMeta?.fieldtype,\n    doctype: fieldMeta?.options || \"\",\n    options: fieldMeta?.options || \"\",\n    placeholder:\n      fieldTemplate.placeholder ||\n      `Enter ${fieldMeta?.label || fieldTemplate.fieldname}`,\n    readonly: Boolean(fieldMeta.read_only),\n    disabled: Boolean(fieldMeta.read_only),\n    url_method: fieldTemplate.url_method || \"\",\n    fieldname: fieldTemplate.fieldname,\n    required: fieldTemplate.required || fieldMeta?.required || false,\n    visible: fieldMeta.display_via_depends_on && !fieldMeta.hidden,\n  };\n}\n\nfunction handleFieldUpdate(\n  fieldname: string,\n  value: FieldValue,\n  isCoreFieldUpdated = false\n) {\n  if (ticket.value.doc[fieldname] == value) return;\n  if (isCoreFieldUpdated) {\n    const label = getField(fieldname)?.label || fieldname;\n    notifyTicketUpdate(label, value as string);\n  }\n  ticket.value.setValue.submit(\n    { [fieldname]: value },\n    {\n      onSuccess: () => {\n        // TODO: emit the event for notification to listeners\n        if (fieldname === \"agent_group\") {\n          assignees.value.reload();\n        }\n        activities.value.reload();\n      },\n    }\n\n    //show error toast\n  );\n}\n\nconst fieldRefs = ref<Record<string, any>>({});\n\nconst setFieldRef = (fieldname: string, el: any) => {\n  if (el) {\n    fieldRefs.value[fieldname] = el;\n  }\n};\n\nuseShortcut(\"t\", () => {\n  fieldRefs.value?.ticket_type?.$el?.querySelector(\"button\")?.click();\n});\n\nuseShortcut(\"p\", () => {\n  fieldRefs.value?.priority?.$el?.querySelector(\"button\")?.click();\n});\n\nuseShortcut({ key: \"t\", shift: true }, () => {\n  fieldRefs.value?.agent_group?.$el?.querySelector(\"button\")?.click();\n});\n</script>\n\n<style scoped>\n:deep(.form-control-core button) {\n  @apply text-base rounded h-7 py-1.5 border border-outline-gray-2 bg-surface-white placeholder-ink-gray-4 hover:border-outline-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-0 text-ink-gray-8 transition-colors w-full dark:[color-scheme:dark];\n}\n:deep(.form-control-core button > div) {\n  @apply truncate;\n}\n\n:deep(.form-control-core div) {\n  width: 100%;\n  display: flex;\n}\n</style>\n","<template>\n  <Resizer class=\"flex flex-col justify-between border-l\" side=\"right\">\n    <TabButtons\n      :buttons=\"tabs\"\n      v-model=\"currentTab\"\n      class=\"tab-buttons mb-1 px-5 mt-3.5\"\n    />\n    <div class=\"flex-1 max-h-full\">\n      <TicketDetailsTab v-if=\"currentTab === 'details'\" />\n      <TicketContactTab v-else />\n    </div>\n  </Resizer>\n</template>\n\n<script setup lang=\"ts\">\nimport { TabButtons } from \"frappe-ui\";\nimport { ref } from \"vue\";\nimport Resizer from \"../Resizer.vue\";\nimport TicketContactTab from \"./TicketContactTab.vue\";\nimport TicketDetailsTab from \"./TicketDetailsTab.vue\";\n\nconst currentTab = ref(\"details\");\nconst tabs = [\n  {\n    label: \"Details\",\n    value: \"details\",\n  },\n  {\n    label: \"Contact\",\n    value: \"contact\",\n  },\n];\n</script>\n\n<style>\n.tab-buttons div,\n.tab-buttons button {\n  width: 100%;\n  flex: 1;\n}\n</style>\n","import type {\n  DocumentResource,\n  RecentSimilarTicket,\n  Resource,\n  TicketActivities,\n  TicketContact,\n} from \"@/types\";\nimport type { HDTicket } from \"@/types/doctypes\";\nimport { createDocumentResource, createResource, toast } from \"frappe-ui\";\nimport { reactive } from \"vue\";\n\ninterface MapValue {\n  ticket: DocumentResource<HDTicket>;\n  assignees: Resource<Record<\"name\", string>[]>;\n  contact: Resource<TicketContact>;\n  recentSimilarTickets: Resource<RecentSimilarTicket>;\n  activities: Resource<TicketActivities>;\n}\n\nconst ticketMap: Record<string, MapValue> = reactive({});\n\nexport const useTicket = (ticketId: string): MapValue => {\n  let err = false;\n  if (!ticketMap[ticketId]) {\n    ticketMap[ticketId] = {\n      ticket: createDocumentResource<HDTicket>({\n        doctype: \"HD Ticket\",\n        name: ticketId,\n        whitelistedMethods: {\n          markSeen: \"mark_seen\",\n        },\n        setValue: {\n          onSuccess: () => {\n            toast.success(__(\"Ticket updated\"));\n            err = false;\n          },\n          onError: (error) => {\n            if (err) return;\n            err = true;\n            const msg = error.exc_type\n              ? (error.messages || error.message || []).join(\", \")\n              : error.message;\n            toast.error(msg);\n          },\n        },\n      }),\n      assignees: createResource({\n        url: \"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_assignees\",\n        params: { ticket: ticketId },\n        auto: true,\n        transform: (data: string) => {\n          return JSON.parse(data).map((name: string) => ({ name })) as Record<\n            \"name\",\n            string\n          >[];\n        },\n      }),\n      contact: createResource({\n        url: \"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_contact\",\n        params: { ticket: ticketId },\n        auto: true,\n      }),\n      recentSimilarTickets: createResource({\n        url: \"helpdesk.helpdesk.doctype.hd_ticket.api.get_recent_similar_tickets\",\n        params: { ticket: ticketId },\n        auto: true,\n      }),\n      activities: createResource({\n        url: \"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_activities\",\n        params: { ticket: ticketId },\n        auto: true,\n      }),\n    };\n  }\n\n  return ticketMap[ticketId];\n};\n\nexport function reloadTicket(ticketId: string) {\n  const ticketData = ticketMap[ticketId];\n  if (!ticketData) return;\n  ticketData.ticket.reload();\n  ticketData.assignees.reload();\n  ticketData.activities.reload();\n}\n","<template>\n  <div v-if=\"ticket.doc?.name\" class=\"flex-1\">\n    <TicketHeader :viewers=\"viewers\" />\n    <div class=\"h-full flex overflow-hidden\">\n      <div class=\"flex-1 flex flex-col overflow-hidden\">\n        <!-- Tabs & Communication Area -->\n        <TicketActivityPanel />\n      </div>\n\n      <!-- Sidepanel with Resizer -->\n      <TicketSidebar />\n    </div>\n    <SetContactPhoneModal\n      v-model=\"showPhoneModal\"\n      :name=\"ticket.data?.contact?.name\"\n      @onUpdate=\"ticket.reload\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport TicketActivityPanel from \"@/components/ticket-agent/TicketActivityPanel.vue\";\nimport TicketHeader from \"@/components/ticket-agent/TicketHeader.vue\";\nimport TicketSidebar from \"@/components/ticket-agent/TicketSidebar.vue\";\nimport SetContactPhoneModal from \"@/components/ticket/SetContactPhoneModal.vue\";\nimport { useActiveViewers } from \"@/composables/realtime\";\nimport { reloadTicket, useTicket } from \"@/composables/useTicket\";\nimport { ticketsToNavigate } from \"@/composables/useTicketNavigation\";\nimport { globalStore } from \"@/stores/globalStore\";\nimport { useTelephonyStore } from \"@/stores/telephony\";\nimport {\n  ActivitiesSymbol,\n  AssigneeSymbol,\n  Customizations,\n  CustomizationSymbol,\n  RecentSimilarTicketsSymbol,\n  Resource,\n  TicketContactSymbol,\n  TicketSymbol,\n} from \"@/types\";\nimport { createResource, toast, usePageMeta } from \"frappe-ui\";\nimport { computed, onBeforeUnmount, onMounted, provide, ref, watch } from \"vue\";\nimport { useRoute } from \"vue-router\";\nimport { showCommentBox, showEmailBox } from \"./modalStates\";\n\nconst telephonyStore = useTelephonyStore();\nconst { $socket } = globalStore();\n\nconst props = defineProps({\n  ticketId: {\n    type: String,\n    required: true,\n  },\n});\nconst route = useRoute();\nconst showPhoneModal = ref(false);\n\nconst ticketComposable = computed(() => useTicket(props.ticketId));\nconst ticket = computed(() => ticketComposable.value.ticket);\nconst customizations: Resource<Customizations> = createResource({\n  url: \"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_customizations\",\n  cache: [\"HD Ticket\", \"customizations\"],\n  auto: true,\n});\n\nprovide(TicketSymbol, ticket);\n\nprovide(\n  AssigneeSymbol,\n  computed(() => ticketComposable.value.assignees)\n);\nprovide(\n  TicketContactSymbol,\n  computed(() => ticketComposable.value.contact)\n);\nprovide(\n  CustomizationSymbol,\n  computed(() => customizations)\n);\nprovide(\n  RecentSimilarTicketsSymbol,\n  computed(() => ticketComposable.value.recentSimilarTickets)\n);\nprovide(\n  ActivitiesSymbol,\n  computed(() => ticketComposable.value.activities)\n);\nprovide(\"makeCall\", () => {\n  if (\n    !ticketComposable.value.contact.data?.mobile_no &&\n    !ticketComposable.value.contact.data?.phone\n  ) {\n    showPhoneModal.value = true;\n    return;\n  }\n  telephonyStore.makeCall({\n    number:\n      ticketComposable.value.contact.data?.phone ||\n      ticketComposable.value.contact.data?.mobile_no,\n    doctype: \"HD Ticket\",\n    docname: props.ticketId,\n  });\n});\nconst viewerComposable = computed(() => useActiveViewers(ticket.value.name));\nconst viewers = computed(\n  () => viewerComposable.value.currentViewers[props.ticketId] || []\n);\nconst { startViewing, stopViewing } = viewerComposable.value;\n\n// handling for faster navigation between tickets\nwatch(\n  () => route.params.ticketId,\n  (newTicketId, oldTicketId) => {\n    if (newTicketId === oldTicketId) return;\n\n    if (oldTicketId) stopViewing(oldTicketId as string);\n    startViewing(newTicketId as string);\n  },\n  { immediate: true }\n);\n\ntype TicketUpdateData = {\n  ticket_id: string;\n  user: string;\n  field: string;\n  value: string;\n};\n\nonMounted(() => {\n  ticketsToNavigate.update({\n    params: {\n      ticket: props.ticketId,\n      current_view: route.query.view as string,\n    },\n  });\n  ticketsToNavigate.reload();\n  ticket.value.markSeen.reload();\n\n  $socket.on(\"ticket_update\", (data: TicketUpdateData) => {\n    if (data.ticket_id === ticket.value?.name) {\n      // Notify the user about the update\n      toast.info(`User ${data.user} updated ${data.field} to ${data.value}`);\n    }\n  });\n\n  $socket.on(\"helpdesk:ticket-comment\", (data: { ticket_id: string }) => {\n    if (data.ticket_id == props.ticketId) {\n      ticketComposable.value.activities.reload();\n    }\n  });\n\n  $socket.on(\"helpdesk:ticket-update\", (data: { ticket_id: string }) => {\n    if (data.ticket_id == props.ticketId) {\n      reloadTicket(props.ticketId);\n    }\n  });\n});\n\nonBeforeUnmount(() => {\n  stopViewing(props.ticketId);\n  showEmailBox.value = false;\n  showCommentBox.value = false;\n\n  $socket.off(\"ticket_update\");\n  $socket.off(\"helpdesk:ticket-comment\");\n  $socket.off(\"helpdesk:ticket-update\");\n});\n\nusePageMeta(() => {\n  return {\n    title: props.ticketId,\n  };\n});\n</script>\n\n<style>\n.breadcrumbs button {\n  background-color: inherit !important;\n  &:hover,\n  &:focus {\n    background-color: inherit !important;\n  }\n}\n</style>\n"],"file":"assets/TicketAgent-1668886b.js"}