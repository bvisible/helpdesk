import{_ as te}from"./plus-3c348a65.js";import{b8 as ae,Z as z,c as P,d as M,A as N,q as r,W as oe,S as E,b9 as j,r as K,e as h,k as U,g as m,w as S,l as _,F as J,G as X,h as o,I as W,t as le,v as L,y as R,f as D,b7 as Z,aG as ne,b0 as se,a1 as re,ay as ie,aF as ue,a as ce,aq as de,X as me,K as pe,P as ve}from"./index-b4c863a6.js";import"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-c8d975a4.js";import"./dayjs-95f8111d.js";import"./knowledgeBase-2d00b929.js";import{P as fe}from"./PhoneIcon-ea7dd5f1.js";import{_ as _e}from"./LayoutHeader-0efddba1.js";import{_ as ye}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-2e0a7a26.js";import{a as Q}from"./Link-842a8a10.js";import{u as ge}from"./onboarding-89cf30fe.js";import{_ as Y}from"./Avatar.vue_vue_type_script_setup_true_lang-89128cfb.js";import{F as he}from"./FileUploader-44680597.js";import{s as w}from"./dialogState-773daca3.js";import{u as Ce}from"./pageMeta-b63f711b.js";import"./StarRating.vue_vue_type_script_setup_true_lang-4484b1d1.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-d7f22ac0.js";import"./utils-4e66359c.js";import"./DateTimePicker.vue_vue_type_script_setup_true_lang-a14f638d.js";import"./EditIcon-f33e48c1.js";import"./portal-302b46c8.js";import"./popper-0aa08b12.js";import"./MultipleAvatar.vue_vue_type_script_setup_true_lang-20371312.js";import"./ticketStatus-60f6a20e.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-eb9071a9.js";import"./Dropdown-f79f7542.js";import"./index-3720151f.js";import"./TabButtons-928aa2d2.js";import"./description-c763d251.js";import"./index-6b12b9aa.js";const be=ae("contact",()=>{const y=z({doctype:"Contact",fields:["*"],auto:!0,pageLength:99999});return{options:P(()=>{var v;return((v=y.list)==null?void 0:v.data)||[]})}}),ke={class:"space-y-4"},Ve={class:"mb-2 block text-sm leading-4 text-gray-700"},xe={key:0,class:"place-self-center text-red-500"},Ee={class:"flex justify-end space-x-2"},Ne=M({__name:"NewContactDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","contactCreated"],setup(y,{emit:p}){const v=y,f=p,d=be(),l=N({emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null}),c=N({emailValidationError:"",firstNameValidationError:"",lastNameValidationError:"",phoneValidationError:"",customerValidationError:""}),x=[{label:r("Email Id"),value:"emailID",error:"emailValidationError",type:"input",required:!0,action:()=>B(l.value.emailID)},{label:r("First Name"),value:"firstName",error:"firstNameValidationError",type:"input",required:!0,action:()=>H(l.value.firstName)},{label:r("Last Name"),value:"lastName",error:"lastNameValidationError",type:"input",required:!1},{label:r("Phone"),value:"phone",error:"phoneValidationError",type:"input",required:!1,action:()=>G(l.value.phone)},{label:r("Customer"),value:"selectedCustomer",error:"customerValidationError",type:"Link",doctype:"HD Customer",required:!1}],u=P({get:()=>v.modelValue,set:s=>{f("update:modelValue",s),s||f("close")}}),i=z({doctype:"HD Customer",fields:["name"],cache:"customers",transform:s=>s.map(g=>({label:g.name,value:g.name})),auto:!0}),t=oe({url:"frappe.client.insert",onSuccess:()=>{l.value={emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:null},E.success(r("Contact created")),f("contactCreated")}});function $(){if(k())return;let s={doctype:"Contact",first_name:l.value.firstName,last_name:l.value.lastName,email_ids:[{email_id:l.value.emailID,is_primary:!0}],links:[],phone_nos:[]};l.value.phone&&(s.phone_nos=[{phone:l.value.phone}]),l.value.selectedCustomer&&s.links.push({link_doctype:"HD Customer",link_name:l.value.selectedCustomer}),t.submit({doc:s})}function k(){let s=B(l.value.emailID);return s+=H(l.value.firstName),s+=G(l.value.phone),s}function B(s){c.value.emailValidationError="";const g=j.string().email().safeParse(s).success;return s?g?A(d.options).includes(s)&&(c.value.emailValidationError=r("Contact with email already exists")):c.value.emailValidationError=r("Enter a valid email"):c.value.emailValidationError=r("Email should not be empty"),c.value.emailValidationError}function H(s){return c.value.firstNameValidationError="",(!s||s.trim()==="")&&(c.value.firstNameValidationError=r("First name should not be empty")),c.value.firstNameValidationError}function G(s){return c.value.phoneValidationError="",s&&(!/[0-9]+/.test(s)||s.length<10)&&(c.value.phoneValidationError=r("Enter a valid phone number")),c.value.phoneValidationError}function A(s){return s.map(g=>g.email_id)}return(s,g)=>{const e=Q,a=K("Button");return h(),U("div",null,[m(o(W),{modelValue:u.value,"onUpdate:modelValue":g[1]||(g[1]=n=>u.value=n),options:{title:o(r)("Create New Contact")}},{"body-content":S(()=>[_("div",ke,[(h(),U(J,null,X(x,n=>_("div",{key:n.label,class:"flex flex-col gap-1"},[_("span",Ve,[le(L(n.label)+" ",1),n.required?(h(),U("span",xe," * ")):R("",!0)]),n.type==="input"?(h(),D(o(Z),{key:0,modelValue:l.value[n.value],"onUpdate:modelValue":C=>l.value[n.value]=C,type:"text",onBlur:n.action},null,8,["modelValue","onUpdate:modelValue","onBlur"])):n.type==="Link"?(h(),D(e,{key:1,doctype:n.doctype,modelValue:l.value[n.value],"onUpdate:modelValue":C=>l.value[n.value]=C,options:o(i).data,class:"form-control flex-1",placeholder:o(r)("Link to a customer record"),"hide-me":!0},null,8,["doctype","modelValue","onUpdate:modelValue","options","placeholder"])):R("",!0),m(o(ne),{message:c.value[n.error]},null,8,["message"])])),64)),_("div",Ee,[m(a,{label:o(r)("Create"),loading:o(t).loading,theme:"gray",variant:"solid",onClick:g[0]||(g[0]=n=>$())},null,8,["label","loading"])])])]),_:1},8,["modelValue","options"])])}}}),De={__name:"Pill",props:{label:{type:String,default:"Button",require:!0},disabled:{type:Boolean,default:!1}},emits:["click"],setup(y,{emit:p}){const v=p,f=d=>{v("click",d)};return(d,l)=>(h(),D(o(re),{key:y.label,theme:"gray",variant:"outline",label:y.label,disabled:y.disabled},{suffix:S(()=>[m(o(se),{class:"h-3 w-3",onClick:l[0]||(l[0]=c=>f(y.label))})]),_:1},8,["label","disabled"]))}},$e={class:"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2"},T=M({__name:"MultiSelect",props:{items:{type:Array,required:!0},placeholder:{type:String,required:!1,default:"Type..."},validate:{type:Function,required:!1,default:()=>!1}},emits:["update:items"],setup(y,{emit:p}){const v=y,f=p,{items:d}=ie(v),l=N("");function c(u){const i=v.validate(u);if(i){E.error(i);return}const t=[...d.value,u];f("update:items",t),l.value=""}function x(u){const i=d.value.filter(t=>t.value!==u);f("update:items",i)}return(u,i)=>(h(),U("div",$e,[(h(!0),U(J,null,X(o(d),t=>(h(),D(De,{key:t.value,label:t.label,onClick:i[0]||(i[0]=$=>x($))},null,8,["label"]))),128)),m(o(Z),{modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=t=>l.value=t),class:"w-full",placeholder:y.placeholder,onKeyup:i[2]||(i[2]=ue(t=>c({label:l.value,value:l.value}),["enter"]))},null,8,["modelValue","placeholder"])]))}}),Ie={class:"flex flex-col items-center gap-4 p-6"},we={class:"text-xl font-medium text-gray-900"},Pe={class:"flex gap-2"},Se={class:"w-full space-y-2 text-sm text-gray-700"},Ue={class:"space-y-1"},Be={class:"text-xs"},qe={class:"space-y-1"},Fe={class:"text-xs"},Le={class:"space-y-1"},Re={class:"text-xs"},He=M({__name:"ContactDialog",props:{name:{}},emits:["contactUpdated"],setup(y,{emit:p}){const v=y,f=p,d=N(!1),l=P({get(){var a;return(((a=t.doc)==null?void 0:a.email_ids)||[]).map(n=>({label:n.email_id,value:n.email_id}))},set(e){if(e.length===0){E.error(r("At least one email is required"));return}e.length!==t.doc.email_ids.length&&(d.value=!0),t.doc.email_ids=e.map(a=>({email_id:a.value}))}}),c=P({get(){var a;return(((a=t.doc)==null?void 0:a.phone_nos)||[]).map(n=>({label:n.phone,value:n.phone}))},set(e){e.length!==t.doc.phone_nos.length&&(d.value=!0),t.doc.phone_nos=e.map(a=>({phone:a.value}))}}),x=P({get(){var a,n;const e=(n=(a=t.doc)==null?void 0:a.links)==null?void 0:n.find(C=>C.link_doctype==="HD Customer");return(e==null?void 0:e.link_name)||null},set(e){var n,C,I,q,F;const a=(I=(C=(n=t.doc)==null?void 0:n.links)==null?void 0:C.find(V=>V.link_doctype==="HD Customer"))==null?void 0:I.link_name;if(e!==a){if(e){const V=(q=t.doc.links)==null?void 0:q.findIndex(b=>b.link_doctype==="HD Customer");V!==-1?t.doc.links[V].link_name=e:t.doc.links.push({link_doctype:"HD Customer",link_name:e})}else t.doc.links=(F=t.doc.links)==null?void 0:F.filter(V=>V.link_doctype!=="HD Customer");d.value=!0}}});z({doctype:"HD Customer",fields:["name"],cache:"customers",transform:e=>e.map(a=>({label:a.name,value:a.name})),auto:!0});const{updateOnboardingStep:u}=ge("helpdesk"),{isManager:i}=ce(),t=de({doctype:"Contact",name:v.name,auto:!0,setValue:{onSuccess(){f("contactUpdated")}}}),$=P(()=>{var e;return{title:(e=t.doc)==null?void 0:e.name,actions:[{label:r("Save"),theme:"gray",variant:"solid",onClick:()=>k()}]}});function k(){if(!d.value){E.error(r("No changes to save"));return}t.setValue.submit({email_ids:l.value.map(e=>({email_id:e.value,is_primary:e.value===t.doc.email_id})),phone_nos:c.value.map(e=>({phone:e.value,is_primary_phone:e.value===t.doc.phone,is_primary_mobile:e.value===t.doc.phone})),links:t.doc.links}),d.value=!1,f("contactUpdated")}function B(e){t.setValue.submit({image:(e==null?void 0:e.file_url)||null}),d.value=!0}function H(e){if(!j.string().email().safeParse(e.value).success)return r("Invalid email")}function G(e){if(!j.string().regex(/^\+[1-9]\d{1,14}$/).min(10).max(15).safeParse(e.value).success)return r("Invalid phone number")}function A(e){let a=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(a))return E.error(r("Invalid file type, only PNG and JPG images are allowed")),r("Invalid file type, only PNG and JPG images are allowed")}const s=N(!1);async function g(){var e;try{s.value=!0;const a=await me("frappe.contacts.doctype.contact.contact.invite_user",{contact:t.doc.name});E.success(r("Contact invited successfully")),await t.setValue.submit({user:a}),u("add_invite_contact")}catch(a){s.value=!1;const I=new DOMParser().parseFromString(((e=a.messages)==null?void 0:e[0])||a.message,"text/html").body.innerText;E.error(I)}finally{s.value=!1}}return(e,a)=>{const n=K("Button");return h(),D(o(W),{options:$.value},{"body-main":S(()=>{var C,I,q,F,V;return[_("div",Ie,[_("div",we,L((C=o(t).doc)==null?void 0:C.full_name),1),m(o(Y),{size:"2xl",label:(I=o(t).doc)==null?void 0:I.full_name,image:(q=o(t).doc)==null?void 0:q.image,class:"cursor-pointer hover:opacity-80"},null,8,["label","image"]),_("div",Pe,[m(o(he),{"validate-file":A,onSuccess:a[0]||(a[0]=b=>B(b))},{default:S(({uploading:b,openFileSelector:ee})=>{var O;return[m(n,{label:(O=o(t).doc)!=null&&O.image?o(r)("Change photo"):o(r)("Upload photo"),loading:b,onClick:ee},null,8,["label","loading","onClick"])]}),_:1}),(F=o(t).doc)!=null&&F.image?(h(),D(n,{key:0,label:o(r)("Remove photo"),onClick:a[1]||(a[1]=b=>B(null))},null,8,["label"])):R("",!0),!((V=o(t).doc)!=null&&V.user)&&o(i)?(h(),D(n,{key:1,label:o(r)("Invite as user"),onClick:g,loading:s.value},null,8,["label","loading"])):R("",!0)]),_("div",Se,[_("div",Ue,[_("div",Be,L(o(r)("Emails")),1),m(T,{items:l.value,"onUpdate:items":a[2]||(a[2]=b=>l.value=b),placeholder:"john.doe@example.com",validate:H},null,8,["items"])]),_("div",qe,[_("div",Fe,L(o(r)("Phone Nos")),1),m(T,{items:c.value,"onUpdate:items":a[3]||(a[3]=b=>c.value=b),placeholder:"+91 98765 43210",validate:G},null,8,["items"])]),_("div",Le,[_("div",Re,L(o(r)("Customer")),1),m(Q,{doctype:"HD Customer",class:"form-control flex-1",placeholder:o(r)("Link to a customer"),modelValue:x.value,"onUpdate:modelValue":a[4]||(a[4]=b=>x.value=b),"hide-me":!0},null,8,["placeholder","modelValue"])])])])]}),_:1},8,["options"])}}}),Ge={class:"flex flex-col"},_t=M({__name:"Contacts",setup(y){const p=N(!1),v=N(null),f=N(null),d=P(()=>({doctype:"Contact",selectable:!0,showSelectBanner:!0,columnConfig:{full_name:{prefix:({row:u})=>pe(Y,{shape:"circle",image:u.image,label:u.name,size:"sm"})},mobile_no:{prefix:fe}},emptyState:{title:"No Contacts Found"}}));function l(){var u;w.value=!1,(u=f.value)==null||u.reload()}function c(u){v.value=u,p.value=!0}function x(){var u;E.success("Contact updated"),p.value=!p.value,(u=f.value)==null||u.reload()}return Ce(()=>({title:"Contacts"})),(u,i)=>{const t=te,$=K("Button");return h(),U("div",Ge,[m(o(_e),null,{"left-header":S(()=>[...i[4]||(i[4]=[_("div",{class:"text-lg font-medium text-gray-900"},"Contacts",-1)])]),"right-header":S(()=>[m($,{label:"Create",theme:"gray",variant:"solid",onClick:i[0]||(i[0]=k=>w.value=!o(w))},{prefix:S(()=>[m(t,{class:"h-4 w-4"})]),_:1})]),_:1}),m(o(ye),{ref_key:"listViewRef",ref:f,options:d.value,onRowClick:c,onEmptyStateAction:i[1]||(i[1]=k=>w.value=!0)},null,8,["options"]),m(Ne,{modelValue:o(w),"onUpdate:modelValue":i[2]||(i[2]=k=>ve(w)?w.value=k:null),onContactCreated:l},null,8,["modelValue"]),p.value?(h(),D(He,{key:v.value,modelValue:p.value,"onUpdate:modelValue":i[3]||(i[3]=k=>p.value=k),name:v.value,onContactUpdated:x},null,8,["modelValue","name"])):R("",!0)])}}});export{_t as default};
//# sourceMappingURL=Contacts-c4191a41.js.map
