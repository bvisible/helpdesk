import{d as M,m as x,n as V,c as H,z as m,a3 as J,f as U,w as b,h as _,e as D,l as w,aq as O,b9 as Q,H as E,r as j,s as T,t as F,g,u as W,p as X,V as Y,J as $,K as Z,M as ee,ao as B,k as te,ag as le,P as d,Q as ae,a0 as oe,R as se}from"./index-3194ec9b.js";import{L as re,m as ie,n as ne,a as ue,d as ce,b as de,c as ge}from"./LayoutHeader-3eb7ac7a.js";import{_ as me}from"./ListViewBuilder.vue_vue_type_script_setup_true_lang-1a82bb67.js";import{g as pe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-a9d0f8af.js";import"./dayjs-f66c5460.js";import{a as fe}from"./Link-431cfb69.js";import{_ as ye}from"./MoveToCategoryModal.vue_vue_type_script_setup_true_lang-314bbd82.js";import{D as ve}from"./Dropdown-c7dd9c29.js";import{u as be}from"./pageMeta-9b603434.js";import{L as Ce}from"./merge-f6d6ce12.js";import"./TabButtons-439c1e4c.js";import"./description-9202ef38.js";import"./DateTimePicker-8cacf145.js";import"./useDatePicker-fa7d5592.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-7827f28c.js";import"./StarRating.vue_vue_type_script_setup_true_lang-0c43ad36.js";import"./NestedPopover-37db8746.js";import"./portal-4ee54923.js";import"./MultipleAvatar.vue_vue_type_script_setup_true_lang-7025dfbf.js";import"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";import"./ticketStatus-895288f5.js";import"./EmptyState.vue_vue_type_script_setup_true_lang-946d36ad.js";const he={class:"flex flex-col flex-1 gap-3"},_e=M({__name:"CategoryModal",props:x({title:{type:String,default:""},edit:{type:Boolean,default:!1}},{modelValue:{type:Boolean},modelModifiers:{},title:{},titleModifiers:{}}),emits:x(["update","create"],["update:modelValue","update:title"]),setup(C,{emit:f}){const y=C,l=f,c=V(C,"modelValue"),r=V(C,"title"),a=H(()=>y.edit?"Edit Category":"Create Category"),n=m(null);J(()=>n.value,i=>{i&&(n.value.style.height=(i.scrollHeight>i.clientHeight,i.scrollHeight+"px"))});function u(){const i=[];return y.edit?i.push({label:"Save",variant:"solid",onClick:()=>{l("update")}}):i.push({label:"Create",variant:"solid",onClick:()=>{l("create")}}),i}return(i,p)=>(D(),U(_(E),{modelValue:c.value,"onUpdate:modelValue":p[2]||(p[2]=v=>c.value=v),options:{title:a.value,actions:u()}},{"body-content":b(()=>[w("div",he,[O(w("textarea",{class:"text-base rounded py-1.5 px-2 border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full block",ref_key:"titleRef",ref:n,placeholder:"Support Issues","onUpdate:modelValue":p[0]||(p[0]=v=>r.value=v),rows:1,maxlength:"50",autofocus:"",onInput:p[1]||(p[1]=v=>{const k=v.target;k.style.height=`${k.scrollHeight}px`})},null,544),[[Q,r.value]])])]),_:1},8,["modelValue","options"]))}}),we={class:"text-p-base text-ink-gray-8 mb-4"},ke={class:"whitespace-nowrap font-semibold"},Ae=M({__name:"MergeCategoryModal",props:x({categoryId:{},categoryTitle:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:x(["merge"],["update:modelValue"]),setup(C,{emit:f}){const y=f,l=V(C,"modelValue"),c=m("");return(r,a)=>{const n=j("Button");return D(),U(_(E),{options:{title:"Merge with another category"},onAfterLeave:a[2]||(a[2]=()=>{c.value=null}),modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=u=>l.value=u)},{"body-content":b(()=>[w("p",we,[a[4]||(a[4]=T(" This will move all articles of the ",-1)),w("span",ke,F(r.categoryTitle),1),a[5]||(a[5]=T(" category to the selected category. This change is irreversible! ",-1))]),g(_(fe),{class:"form-control",doctype:"HD Article Category",placeholder:"Select Category",modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=u=>c.value=u),label:"Category","page-length":100},null,8,["modelValue"])]),actions:b(()=>[g(n,{class:"w-full",variant:"solid",label:"Merge",onClick:a[1]||(a[1]=u=>y("merge",r.categoryId,c.value))})]),_:1},8,["modelValue"])}}}),xe={class:"flex flex-col"},je=M({__name:"KnowledgeBaseAgent",setup(C){const f=W(),{$dialog:y}=pe(),l=X({title:"",id:""}),c=m(""),r=m(null),a=m(!1),n=m(!1),u=m(!1),i=m(!1),p=Y({url:"helpdesk.api.knowledge_base.get_general_category",auto:!0,cache:["GeneralCategory"]}),v=[{label:"Category",icon:"folder",onClick:()=>{A(),a.value=!1,n.value=!0}},{label:"Article",icon:"file-text",onClick:()=>{f.push({name:"NewArticle",params:{id:p.data},query:{title:"General"}})}}],k=[{label:"Add New Article",icon:"plus",onClick:e=>{f.push({name:"NewArticle",params:{id:e.group.value},query:{title:e.group.label}})}},{label:"Edit Title",icon:"edit",onClick:e=>{a.value=!0,n.value=!0,l.title=e.group.label,l.id=e.group.value,c.value=e.group.label}},{label:"Merge",icon:Ce,onClick:e=>{i.value=!0,l.title=e.group.label,l.id=e.group.value}},{label:"Share",icon:"link",onClick:async({group:e})=>{const{label:t,value:s}=e,o=new URL(window.location.href);o.pathname=`/helpdesk/kb-public/${s}`,await le(o.toString(),`Category <u>'${t}'</u> link copied to clipboard`)}},{label:"Delete",icon:"trash-2",onClick:e=>{P(e)}}],h=m(new Set),L=[{label:"Move To",icon:"corner-up-right",onClick:e=>{h.value=new Set(e),u.value=!0}},{label:"Delete",icon:"trash-2",onClick:e=>{h.value=e,y({title:"Delete articles?",message:"Are you sure you want to delete these articles?",actions:[{label:"Confirm",variant:"solid",onClick({close:t}){q(),t()}}]})}}];function R(e){ie.submit({category:e,articles:Array.from(h.value)},{onSuccess:()=>{var t,s;u.value=!1,(t=r.value)==null||t.reload(),(s=r.value)==null||s.unselectAll(),h.value.clear(),d.success("Articles moved")},onError:t=>{var o;const s=((o=t==null?void 0:t.messages)==null?void 0:o[0])||t.message;d.error(s),u.value=!1}})}function I(){ne.submit({title:l.title},{onSuccess:e=>{r.value.reload(),n.value=!1,f.push({name:"Article",params:{articleId:e.article},query:{category:e.category,title:l.title,isEdit:1}}),d.success("Category created"),B("category_created",{data:{category:l.title}}),A()},onError:e=>{d.error(e)}})}function N(){if(l.title===c.value){n.value=!1,a.value=!1;return}ue.submit({doctype:"HD Article Category",name:l.id,fieldname:"category_name",value:l.title},{onSuccess:()=>{r.value.reload(),n.value=!1,a.value=!1,d.success("Category updated"),A()},onError:e=>{d.error(e)}})}function P(e){y({title:"Delete category?",message:"All articles from this category will move to General category.",actions:[{label:"Confirm",variant:"solid",onClick(t){ce.submit({doctype:"HD Article Category",name:e.group.value},{onSuccess:()=>{d.success("Category deleted"),r.value.reload()}}),t()}}]})}function q(){de.submit({articles:Array.from(h.value)},{onSuccess:()=>{var e,t,s;(e=r.value)==null||e.reload(),(t=r.value)==null||t.unselectAll(),(s=h.value)==null||s.clear(),d.success("Articles deleted")}})}function K(e,t){ge.submit({source:e,target:t},{onSuccess:()=>{r.value.reload(),d.success("Category merged"),i.value=!1,A()},onError:s=>{var S;const o=((S=s==null?void 0:s.messages)==null?void 0:S[0])||s.message;d.error(o)}})}function A(){l.title="",l.id="",c.value=""}const G=H(()=>({doctype:"HD Article",selectable:!0,view:{view_type:"group_by",group_by_field:"category",label_doc:"HD Article Category",label_field:"category_name"},columnConfig:{title:{prefix:()=>$(ae,{name:"file-text",class:"h-4 w-4 flex-shrink-0 text-ink-gray-6"})},status:{custom:({item:e})=>$(Z,{...z[e]})}},rowRoute:{name:"Article",prop:"articleId"},groupByActions:k,showSelectBanner:!0,selectBannerActions:L,default_page_length:100})),z={Published:{label:"Published",theme:"green"},Draft:{label:"Draft",theme:"orange"},Archived:{label:"Archived",theme:"gray"}};return ee(()=>{B("kb_agent_page_viewed")}),be(()=>({title:"Knowledge Base"})),(e,t)=>{const s=se;return D(),te("div",xe,[g(re,null,{"left-header":b(()=>[...t[5]||(t[5]=[w("div",{class:"text-lg font-medium text-gray-900"},"Knowledge Base",-1)])]),"right-header":b(()=>[g(_(ve),{options:v},{default:b(()=>[g(_(oe),{label:"Add new",variant:"solid"},{prefix:b(()=>[g(s,{class:"h-4 w-4"})]),_:1})]),_:1})]),_:1}),g(me,{ref_key:"listViewRef",ref:r,options:G.value,onRowClick:t[0]||(t[0]=o=>e.$router.push(`kb/articles/${o}`))},null,8,["options"]),g(_e,{edit:a.value,modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value=o),title:l.title,"onUpdate:title":t[2]||(t[2]=o=>l.title=o),onUpdate:N,onCreate:I},null,8,["edit","modelValue","title"]),g(ye,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=o=>u.value=o),onMove:R},null,8,["modelValue"]),g(Ae,{categoryTitle:l.title,"category-id":l.id,modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=o=>i.value=o),onMerge:K},null,8,["categoryTitle","category-id","modelValue"])])}}});export{je as default};
//# sourceMappingURL=KnowledgeBaseAgent-ea39cca7.js.map
