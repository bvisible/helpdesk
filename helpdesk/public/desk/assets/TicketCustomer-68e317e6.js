import{_ as Z}from"./CustomActions-de732add.js";import{d as K,$ as ee,c as $,a1 as B,k as _,l as r,g as u,h as a,w as k,x as b,F as R,E as A,f as w,r as V,e as c,t as C,L as U,a8 as z,u as te,V as E,I as ae,W as se,P as I,z as S,b as oe,U as le,M as ne,b3 as M,a5 as ie,aU as P,y as L,a7 as re,a0 as N,aR as ce,aO as de}from"./index-3194ec9b.js";import{_ as ue}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-add081d8.js";import{g as me,I as pe}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-a9d0f8af.js";import{d}from"./dayjs-f66c5460.js";import{L as fe}from"./LayoutHeader-3eb7ac7a.js";import{u as _e}from"./ticketStatus-895288f5.js";import{_ as be}from"./TicketFeedback.vue_vue_type_script_setup_true_lang-2ffb32e9.js";import{_ as ke}from"./EmailIcon-159a6309.js";import{I as O}from"./symbols-7dbf6ecf.js";import{_ as ve}from"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";import{s as xe}from"./formCustomisation-8a41b461.js";import{_ as ge}from"./TicketCustomerTemplateFields.vue_vue_type_script_setup_true_lang-513b64d2.js";import{_ as ye}from"./TicketConversation.vue_vue_type_script_setup_true_lang-dbb0d455.js";import{_ as he}from"./TicketFeedback.vue_vue_type_script_setup_true_lang-61cfd4e7.js";import{_ as Ce}from"./TicketTextEditor.vue_vue_type_script_setup_true_lang-ce04207f.js";import"./Dropdown-c7dd9c29.js";import"./StarRating.vue_vue_type_script_setup_true_lang-0c43ad36.js";import"./lodash-f704bb91.js";import"./TicketCommunication.vue_vue_type_script_setup_true_lang-b994cd08.js";import"./EmailContent-81cb3391.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-858a5224.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-95965310.js";import"./index-a7e5685b.js";import"./FileUploader-0835fb8b.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-7cb9f49e.js";const we={class:"flex w-[382px] flex-col border-l gap-4"},$e={class:"flex flex-col gap-4 pt-0 px-5 py-3 border-b"},Te={class:"flex gap-2"},Ie={class:"flex items-center justify-between"},Se={class:"w-[242px] truncate text-2xl font-medium"},Fe={key:0,class:"flex gap-1.5"},De={class:"flex items-center text-base leading-5"},Be={class:"w-[126px] text-sm text-gray-600"},Ee={class:"w-[126px] text-gray-600 text-sm"},je={class:"break-words text-base text-gray-800"},Re={class:"flex flex-col gap-4 pt-0 px-5 py-3 overflow-y-scroll"},Ae={class:"flex items-center text-base leading-5"},Ue={class:"w-[126px] text-sm text-gray-600"},He=K({__name:"TicketCustomerSidebar",emits:["open"],setup(H,{emit:F}){const p=F,e=ee(O),l=$(()=>{const s=D(),m=v();return[{title:"First Response",value:e.data.first_responded_on||e.data.response_by,label:s.label,theme:s.color},{title:"Resolution",value:e.data.resolution_date||e.data.resolution_by,label:m.label,theme:m.color}]});function D(){let s=null;return!e.data.first_responded_on&&d().isBefore(d(e.data.response_by))?s={label:`Due in ${B(d(e.data.response_by).diff(d(),"s"))}`,color:"orange"}:d(e.data.first_responded_on).isBefore(d(e.data.response_by))?s={label:`Fulfilled in ${B(d(e.data.first_responded_on).diff(d(e.data.creation),"s"))}`,color:"green"}:s={label:"Failed",color:"red"},s}function v(){let s=null;return!e.data.resolution_date&&d().isBefore(e.data.resolution_by)?s={label:`Due in ${B(d(e.data.resolution_by).diff(d(),"s"))}`,color:"orange"}:e.data.agreement_status==="Fulfilled"?s={label:`Fulfilled in ${B(d(e.data.resolution_time,"s"))}`,color:"green"}:s={label:"Failed",color:"red"},s}const x=$(()=>[{label:"Ticket ID",value:e.data.name},{label:"Status",value:e.data.status,bold:!0}]),g=$(()=>{const s=[{label:"Subject",value:e.data.subject},{label:"Team",value:e.data.agent_group||"-"},{label:"Priority",value:e.data.priority}],m=e.data.template.fields.filter(f=>!f.hide_from_customer&&["subject","team","priority"].indexOf(f.fieldname)===-1).map(f=>({label:f.label,value:e.data[f.fieldname]}));return[...s,...m]});return(s,m)=>{const f=ke,y=V("Button"),j=V("Badge"),T=be;return c(),_("div",we,[m[1]||(m[1]=r("div",{class:"flex items-center justify-between border-b px-5 py-3"},[r("span",{class:"cursor-copy text-lg font-semibold"},"Ticket details")],-1)),r("div",$e,[r("div",Te,[u(a(ve),{size:"2xl",image:a(e).data.contact.image,label:a(e).data.contact.name},null,8,["image","label"]),r("div",Ie,[u(a(U),{text:a(e).data.contact.name},{default:k(()=>[r("div",Se,C(a(e).data.contact.name),1)]),_:1},8,["text"]),a(e).data.feedback_rating?b("",!0):(c(),_("div",Fe,[u(a(U),{text:a(e).data.contact.email_id},{default:k(()=>[u(y,{class:"h-7 w-7",onClick:m[0]||(m[0]=n=>p("open"))},{icon:k(()=>[u(f,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])]))])]),(c(!0),_(R,null,A(x.value,n=>(c(),_("div",De,[r("span",Be,C(n.label),1),r("span",{class:z(["text-base text-gray-800 flex-1",!n.value&&"text-ink-gray-4"])},C(n.value||"—"),3)]))),256)),(c(!0),_(R,null,A(l.value,n=>(c(),_("div",{key:n.label,class:"flex items-center text-base"},[r("div",Ee,C(n.title),1),r("div",je,[u(a(U),{text:a(d)(n.value).long()},{default:k(()=>[u(j,{label:n.label,theme:n.theme,variant:"subtle"},null,8,["label","theme"])]),_:2},1032,["text"])])]))),128))]),a(e).data.feedback_rating?(c(),w(T,{key:0,class:"border-b text-base text-gray-600",ticket:a(e).data},null,8,["ticket"])):b("",!0),r("div",Re,[(c(!0),_(R,null,A(g.value,n=>(c(),_("div",Ae,[r("span",Ue,C(n.label),1),r("span",{class:z(["text-base text-gray-800 flex-1",!n.value&&"text-ink-gray-4"])},C(n.value||"—"),3)]))),256))])])}}}),Ve={key:0,class:"flex flex-col"},ze={class:"flex overflow-hidden h-full w-full"},Me={class:"flex flex-col flex-1 w-full md:max-w-[calc(100%-382px)]"},Pe=["onKeydownCapture"],ft=K({__name:"TicketCustomer",props:{ticketId:{}},setup(H){const F=te(),p=H,{getStatus:e}=_e(),l=E({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_one",cache:["Ticket",p.ticketId],params:{name:p.ticketId,is_customer_portal:ae.value},auto:!0,onSuccess:o=>{var t;o.status=(t=e(o.status))==null?void 0:t.label_customer,xe(l,{doc:o,call:se,router:F,toast:I,$dialog:f,updateField:j,createToast:I.create})},onError:()=>{I.error("Ticket not found"),F.replace("/my-tickets")}});re(O,l);const D=S(null),v=S(""),x=S([]),g=S(!1),s=S(!1),{isMobileView:m}=oe(),{$dialog:f}=me(),y=E({url:"run_doc_method",debounce:300,makeParams:()=>({dt:"HD Ticket",dn:p.ticketId,method:"create_communication_via_contact",args:{message:v.value,attachments:x.value}}),onSuccess:()=>{D.value.editor.commands.clearContent(!0),x.value=[],s.value=!1,l.reload()}});function j(o,t,h=()=>{}){n(o,t),h()}function T(){de(v.value)||y.loading||y.submit()}function n(o,t){E({url:"frappe.client.set_value",params:{doctype:"HD Ticket",name:p.ticketId,fieldname:o,value:t},auto:!0,onSuccess:()=>{l.reload(),I.success("Ticket updated")}})}function W(){Y.value?g.value=!0:q()}function q(){f({title:"Close Ticket",message:"Are you sure you want to close this ticket?",actions:[{label:"Confirm",variant:"solid",onClick(o){l.data.status="Closed",G.submit({fieldname:"status",value:"Closed"},{onSuccess:()=>{I.success("Ticket closed")}}),o()}}]})}const G=E({url:"frappe.client.set_value",debounce:300,makeParams:o=>({doctype:"HD Ticket",name:p.ticketId,fieldname:o.fieldname,value:o.value}),onSuccess:()=>{g.value=!1,l.reload()}}),J=$(()=>{var t;let o=[{label:"Tickets",route:{name:"TicketsCustomer"}}];return o.push({label:(t=l.data)==null?void 0:t.subject,route:{name:"TicketCustomer"}}),o}),Q=$(()=>l.data.status!=="Closed"),{isFeedbackMandatory:X}=le(),Y=$(()=>{var t,h;return((h=(t=l.data)==null?void 0:t.communications)==null?void 0:h.some(i=>i.sender!==l.data.raised_by))&&X});return ne(()=>{document.title=p.ticketId,M.on("helpdesk:ticket-update",o=>{o===Number(p.ticketId)&&l.reload()})}),ie(()=>{document.title="Helpdesk",M.off("helpdesk:ticket-update")}),(o,t)=>{const h=Z;return a(l).data?(c(),_("div",Ve,[u(a(fe),null,{"left-header":k(()=>[u(a(ue),{items:J.value},null,8,["items"])]),"right-header":k(()=>[a(l).data._customActions?(c(),w(h,{key:0,actions:a(l).data._customActions},null,8,["actions"])):b("",!0),a(l).data.status!=="Closed"?(c(),w(a(N),{key:1,label:"Close",theme:"gray",variant:"solid",onClick:t[0]||(t[0]=i=>W())},{prefix:k(()=>[u(a(pe),{icon:"lucide:check"})]),_:1})):b("",!0)]),_:1}),r("div",ze,[r("section",Me,[a(m)?(c(),w(ge,{key:0})):b("",!0),u(ye,{class:"grow"}),r("div",{class:"w-full p-5",onKeydownCapture:[P(L(T,["ctrl","stop"]),["enter"]),P(L(T,["meta","stop"]),["enter"])]},[Q.value?(c(),w(Ce,{key:0,ref_key:"editor",ref:D,attachments:x.value,"onUpdate:attachments":t[1]||(t[1]=i=>x.value=i),content:v.value,"onUpdate:content":t[2]||(t[2]=i=>v.value=i),expand:s.value,"onUpdate:expand":t[3]||(t[3]=i=>s.value=i),placeholder:"Type a message",autofocus:"",onClear:t[4]||(t[4]=()=>s.value=!1),uploadFunction:i=>a(ce)(i,"HD Ticket",p.ticketId)},{"bottom-right":k(()=>{var i;return[u(a(N),{label:"Send",theme:"gray",variant:"solid",disabled:((i=o.$refs.editor)==null?void 0:i.editor.isEmpty)||a(y).loading,loading:a(y).loading,onClick:T},null,8,["disabled","loading"])]}),_:1},8,["attachments","content","expand","uploadFunction"])):b("",!0)],40,Pe)]),a(m)?b("",!0):(c(),w(He,{key:0,onOpen:t[5]||(t[5]=i=>s.value=!0)}))]),u(he,{open:g.value,"onUpdate:open":t[6]||(t[6]=i=>g.value=i)},null,8,["open"])])):b("",!0)}}});export{ft as default};
//# sourceMappingURL=TicketCustomer-68e317e6.js.map
