import{j as ie,e as v,k as w,l as m,r as I,h as t,aa as Me,t as F,C as pe,ab as ue,f as A,v as Oe,d as N,m as ve,n as fe,z,V as Z,P as ee,Y as Ze,a3 as le,w as S,s as _e,g as _,x as D,H as Je,$ as U,Z as ge,c as B,ac as Ge,F as P,u as ze,q as ke,M as be,ad as Xe,ae as Ke,af as q,ag as se,K as Te,a8 as Y,ah as Ye,J as Qe,O as et,W as De,ai as tt,aj as ye,E as G,ak as at,B as st,D as nt,al as ot,L as ne,am as lt,an as je,S as Fe,ao as it,ap as rt,y as ae,aq as ct,G as ut,ar as dt,a0 as Se,as as mt,p as pt,at as vt,a7 as K,au as _t}from"./index-3194ec9b.js";import{u as ft,a as gt,b as kt,c as bt,d as yt,e as ht,A as xt,C as Ct,_ as Ue,T as wt}from"./useActiveTabManager-44c673f3.js";import{T as $t,b as J,u as Tt,d as Re,g as He,t as St,e as Vt,s as Lt,f as Bt}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-a9d0f8af.js";import"./dayjs-f66c5460.js";import{L as At}from"./LayoutHeader-3eb7ac7a.js";import{_ as re}from"./EmailIcon-159a6309.js";import{P as he}from"./PhoneIcon-e1a2cab8.js";import{u as ce}from"./telephony-1c011c0c.js";import{_ as zt}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-add081d8.js";import{D as de}from"./Dropdown-c7dd9c29.js";import{I as Ve}from"./IndicatorIcon-423c4b7a.js";import{u as qe}from"./ticketStatus-895288f5.js";import{_ as Ie}from"./MultipleAvatar.vue_vue_type_script_setup_true_lang-7025dfbf.js";import{a as xe}from"./Link-431cfb69.js";import{L as Ee}from"./merge-f6d6ce12.js";import{s as Dt,p as Le}from"./formCustomisation-8a41b461.js";import{T as jt}from"./TabButtons-439c1e4c.js";import{_ as Pe}from"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";import{_ as Ft}from"./Section-5334216a.js";import{_ as Be}from"./UserAvatar.vue_vue_type_script_setup_true_lang-95965310.js";import{_ as Ut}from"./Switch.vue_vue_type_script_setup_true_lang-ad313234.js";import{u as Rt}from"./pageMeta-9b603434.js";import"./FileUploader-0835fb8b.js";import"./TextEditor.vue_vue_type_script_setup_true_lang-7cb9f49e.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-858a5224.js";import"./CallLogModal.vue_vue_type_script_setup_true_lang-9a8921a1.js";import"./EmailContent-81cb3391.js";import"./StarRating.vue_vue_type_script_setup_true_lang-0c43ad36.js";import"./DateTimePicker-8cacf145.js";import"./useDatePicker-fa7d5592.js";import"./Autocomplete-4c667766.js";import"./description-9202ef38.js";const Ht={},qt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function It(x,e){return v(),w("svg",qt,[...e[0]||(e[0]=[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.9996 3.54443V8.771C13.9994 9.32318 13.5518 9.771 12.9996 9.771H12.1802C11.9041 9.771 11.6802 9.99485 11.6802 10.271C11.6803 10.547 11.9042 10.771 12.1802 10.771H12.9996C14.104 10.771 14.9994 9.87546 14.9996 8.771V3.54443C14.9996 2.43986 14.1041 1.54443 12.9996 1.54443H6.72124C5.61667 1.54443 4.72124 2.43986 4.72124 3.54443V4.37158C4.72124 4.64772 4.94509 4.87158 5.22124 4.87158C5.49738 4.87158 5.72124 4.64772 5.72124 4.37158V3.54443C5.72124 2.99215 6.16895 2.54443 6.72124 2.54443H12.9996C13.5518 2.54443 13.9996 2.99215 13.9996 3.54443ZM9.27832 6.22928C9.8306 6.22928 10.2783 6.67699 10.2783 7.22928V12.4558C10.2782 13.008 9.83053 13.4558 9.27832 13.4558H3C2.44779 13.4558 2.00012 13.008 2 12.4558V7.22928C2 6.67699 2.44772 6.22928 3 6.22928H9.27832ZM9.27832 14.4558C10.3828 14.4558 11.2782 13.5603 11.2783 12.4558V7.22928C11.2783 6.12471 10.3829 5.22928 9.27832 5.22928H3C1.89543 5.22928 1 6.12471 1 7.22928V12.4558C1.00012 13.5603 1.89551 14.4558 3 14.4558H9.27832Z",fill:"#525252"},null,-1)])])}const Ae=ie(Ht,[["render",It]]),Et={},Pt={width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Nt(x,e){return v(),w("svg",Pt,[...e[0]||(e[0]=[m("path",{d:"M5.66406 2.25C5.94021 2.25 6.16406 2.47386 6.16406 2.75C6.16406 3.02614 5.94021 3.25 5.66406 3.25H4.25C3.42157 3.25 2.75 3.92157 2.75 4.75V12.25L2.75781 12.4033C2.83461 13.1597 3.47334 13.75 4.25 13.75H11.75C12.5784 13.75 13.25 13.0784 13.25 12.25V10.8359C13.25 10.5598 13.4739 10.3359 13.75 10.3359C14.0261 10.3359 14.25 10.5598 14.25 10.8359V12.25C14.25 13.6307 13.1307 14.75 11.75 14.75H4.25C2.95566 14.75 1.89082 13.7664 1.7627 12.5059L1.75 12.25V4.75C1.75 3.36929 2.86929 2.25 4.25 2.25H5.66406ZM13.75 2.25C13.7827 2.25 13.8155 2.25243 13.8477 2.25879C13.8574 2.26071 13.8665 2.2651 13.876 2.26758C13.9592 2.28923 14.0383 2.33126 14.1035 2.39648C14.2012 2.49413 14.25 2.62202 14.25 2.75V7.25C14.25 7.52608 14.0261 7.74994 13.75 7.75C13.4739 7.75 13.25 7.52611 13.25 7.25V3.95703L6.81152 10.3955C6.61626 10.5908 6.29975 10.5908 6.10449 10.3955C5.90923 10.2002 5.90923 9.88374 6.10449 9.68848L12.543 3.25H9.25C8.97388 3.25 8.75003 3.02611 8.75 2.75C8.75 2.47386 8.97386 2.25 9.25 2.25H13.75Z",fill:"#525252"},null,-1)])])}const Wt=ie(Et,[["render",Nt]]),Mt={},Ot={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Zt(x,e){return v(),w("svg",Ot,[...e[0]||(e[0]=[m("g",{"clip-path":"url(#clip0_11163_86342)"},[m("path",{d:"M8 0.75C12.0041 0.75 15.25 3.99594 15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75ZM9.83691 4.24902C9.83246 4.31586 9.82822 4.40482 9.80762 4.49316C9.79115 4.5636 9.76659 4.63202 9.73535 4.69727C9.69606 4.77931 9.64388 4.85125 9.60547 4.90625L9.57715 4.94727C9.53169 5.01237 9.47353 5.10016 9.39648 5.1748C9.33512 5.23421 9.26581 5.2852 9.19141 5.32715C9.09793 5.37982 8.99723 5.41143 8.92188 5.43652L7.01367 6.07227C6.96479 6.08854 6.93927 6.09602 6.92188 6.10254L6.9209 6.10449C6.90952 6.11925 6.89436 6.14042 6.86426 6.18262L6.30859 6.96094C6.25045 7.04245 6.17582 7.15257 6.07422 7.24023C5.99357 7.30979 5.9021 7.36646 5.80371 7.40723C5.67989 7.45842 5.54801 7.47592 5.44922 7.49121L5.38574 7.50098C5.29011 7.51579 5.16346 7.53843 5.03418 7.52832C4.93128 7.52017 4.82895 7.4961 4.7334 7.45703C4.61327 7.40776 4.51037 7.32967 4.43164 7.27344L2.19727 5.67773C1.90962 6.39582 1.75 7.17915 1.75 8C1.75 11.4518 4.54822 14.25 8 14.25C11.4518 14.25 14.25 11.4518 14.25 8C14.25 5.2413 12.4623 2.90124 9.98242 2.07227L9.83691 4.24902ZM7.12207 8.18945C7.27526 7.95989 7.58574 7.89776 7.81543 8.05078L10.6025 9.9082C10.7167 9.98443 10.7942 10.1049 10.8174 10.2402C10.8406 10.3756 10.8069 10.5151 10.7246 10.625L9.33203 12.4824C9.23768 12.6082 9.08888 12.6825 8.93164 12.6826H7.07422C6.83589 12.6826 6.63074 12.514 6.58398 12.2803L6.11914 9.95801C6.09321 9.82809 6.1199 9.69327 6.19336 9.58301L7.12207 8.18945ZM7.13965 9.96484L7.48438 11.6826H8.68164L9.60742 10.4463L7.67676 9.15918L7.13965 9.96484ZM8 1.75C5.72993 1.75 3.74217 2.96003 2.64746 4.77051L5.0127 6.45996C5.06466 6.49708 5.09177 6.51562 5.11133 6.52832L5.1123 6.5293H5.11426C5.13745 6.52677 5.16993 6.52251 5.2334 6.5127L5.2959 6.50293C5.3614 6.49279 5.39526 6.48721 5.41895 6.48242L5.41992 6.48145L5.42188 6.48047C5.4368 6.46146 5.45658 6.43391 5.49512 6.37988L6.0498 5.60156C6.09519 5.53793 6.15408 5.45185 6.23047 5.37891C6.29114 5.32101 6.35945 5.27146 6.43262 5.23047C6.52471 5.17891 6.6241 5.14773 6.69824 5.12305L8.60645 4.4873C8.65567 4.47091 8.68058 4.46266 8.69824 4.45605L8.7002 4.45508L8.70117 4.4541C8.71253 4.43905 8.72714 4.41753 8.75684 4.375L8.78613 4.33398C8.81121 4.29807 8.82337 4.27987 8.83203 4.2666V4.26465L8.83301 4.26367C8.83455 4.24789 8.83595 4.22533 8.83887 4.18164L8.99609 1.83008C8.67167 1.77811 8.33907 1.75 8 1.75Z",fill:"#7C7C7C"})],-1),m("defs",null,[m("clipPath",{id:"clip0_11163_86342"},[m("rect",{width:"16",height:"16",fill:"white"})])],-1)])])}const Jt=ie(Mt,[["render",Zt]]),Ne={__name:"Icon",props:{icon:{type:[String,Object],required:!0}},setup(x){return(e,i)=>{const o=I("FeatherIcon");return t(Me)(x.icon)?(v(),w("div",pe(ue({key:0},e.$attrs)),F(x.icon),17)):typeof x.icon=="string"?(v(),A(o,ue({key:1,name:x.icon},e.$attrs),null,16,["name"])):(v(),A(Oe(x.icon),pe(ue({key:2},e.$attrs)),null,16))}}},Gt={class:"flex flex-col gap-4"},Xt={class:"text-p-base text-ink-gray-8"},Kt={class:"whitespace-nowrap font-semibold"},Yt={class:"flex items-center gap-2 rounded-md p-2 ring-1 ring-gray-200"},Qt=N({__name:"TicketMergeModal",props:ve({ticket:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ve(["update"],["update:modelValue"]),setup(x,{emit:e}){const i=x,o=e,g=fe(x,"modelValue");function k(){const y={status_category:["in",["Open","Paused"]],is_merged:0,name:["!=",i.ticket.name]};return i.ticket.customer&&(y.customer=i.ticket.customer),i.ticket.raised_by&&(y.raised_by=["like",`%${i.ticket.raised_by}%`]),y}const a=z(null),r=z(null),b=Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.merge_ticket",makeParams({source:y,target:u}){return{source:y,target:u}},validate({source:y,target:u}){if(!y)throw{message:"Category is required"};if(!u)throw{message:"Ticket to merged with is required"}},onSuccess:()=>{ee.success("Ticket merged successfully"),o("update"),g.value=!1,window.open(window.location.origin+"/helpdesk/tickets/"+a.value,"_blank"),a.value=null}}),h=Ze({doctype:"HD Ticket",filters:{name:["=",a]},fields:["subject"],onSuccess:y=>{y.length>0&&(r.value=y[0].subject)}});le(()=>a.value,y=>{y&&(h.update({filters:{name:["=",y]}}),h.reload())});function C(){b.submit({source:i.ticket.name,target:a.value})}return(y,u)=>{const p=I("FormControl"),d=I("Button");return v(),A(t(Je),{options:{title:"Merge with another ticket"},modelValue:g.value,"onUpdate:modelValue":u[2]||(u[2]=n=>g.value=n)},{"body-content":S(()=>[m("div",Gt,[m("p",Xt,[u[3]||(u[3]=_e(" All comments and emails of the ticket ",-1)),m("span",Kt,"#"+F(y.ticket.name),1),u[4]||(u[4]=_e(" will be moved to the selected ticket. ",-1))]),_(t(xe),{class:"form-control",doctype:"HD Ticket",placeholder:"Select Ticket",filters:k(),label:"Ticket","page-length":10,value:a.value,"show-description":!0,onChange:u[0]||(u[0]=n=>a.value=String(n))},null,8,["filters","value"]),a.value?(v(),A(p,{key:0,label:"Ticket Subject",type:"text",modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=n=>r.value=n),disabled:!0},null,8,["modelValue"])):D("",!0),m("div",Yt,[_(t($t),{class:"h-6 w-5 w-min-5 w-max-5 min-h-5 max-w-5 text-yellow-500"}),u[5]||(u[5]=m("div",{class:"text-wrap text-sm text-gray-700"}," This action is irreversible. ",-1))])])]),actions:S(()=>[_(d,{class:"w-full",variant:"solid",label:a.value?`Merge with ticket #${a.value} `:"Select Ticket",loading:t(b).loading,"icon-left":a.value&&t(Ee),onClick:C},null,8,["label","loading","icon-left"])]),_:1},8,["modelValue"])}}}),X=Symbol("ticket"),Ce=Symbol("assignees"),we=Symbol("customizations"),$e=Symbol("ticketContact"),We=Symbol("recentSimilarTickets"),oe=Symbol("activities"),ea={key:1,class:"flex items-center justify-center flex-col mt-20"},ta=N({__name:"TicketActivityPanel",setup(x){const e=U(X),i=U(oe),o=z(null),g=z(null),k=ce(),{isCallingEnabled:a}=ge(k),r=B(()=>{const u=[{name:"activity",label:"Activity",icon:xt},{name:"email",label:"Emails",icon:re},{name:"comment",label:"Comments",icon:Ct}];return a.value&&u.push({name:"call",label:"Calls",icon:he}),u}),{tabIndex:b,changeTabTo:h}=ft(r),C=B(()=>{var R,W,te,V,T,L,M,O;if(!((R=i.value)!=null&&R.data))return[];const u=(te=(W=i.value)==null?void 0:W.data)==null?void 0:te.communications.map((c,H)=>({subject:c.subject,content:c.content,sender:{name:c.user.email,full_name:c.user.name},to:c.recipients,type:"email",key:c.creation,cc:c.cc,bcc:c.bcc,creation:c.communication_date||c.creation,attachments:c.attachments,name:c.name,deliveryStatus:c.delivery_status,isFirstEmail:H===0})),p=i.value.data.comments.map(c=>({name:c.name,type:"comment",key:c.creation,commentedBy:c.commented_by,commenter:c.user.name,creation:c.creation,content:c.content,attachments:c.attachments})),d=[...i.value.data.history,...i.value.data.views].map(c=>({type:"history",key:c.creation,content:c.action?c.action:"viewed this",creation:c.creation,user:c.user.name+" "})),n=i.value.data.calls.map(c=>({...c,type:"call",name:c.name,key:c.creation,call_type:c.type,content:`${c.caller||"Unknown"} made a call to ${c.receiver||"Unknown"}`,duration:c.duration?c.duration+"s":"0s"})),s=[...u,...p,...d,...n].sort((c,H)=>new Date(c.creation)-new Date(H.creation)),f=[];let l=0;for(;l<s.length;){const c=s[l];if(c.type==="history"){c.relatedActivities=[c];for(let H=l+1;H<s.length+1;H++){const Q=s[H];if(Q&&Q.user===c.user&&Q.content!=="viewed this"&&!Q.content.includes("assigned")&&!Q.content.includes("unassigned"))c.relatedActivities.push(Q);else{f.push(c),l=H-1;break}}}else f.push(c);l++}if(e.value.doc.feedback_rating===0)return f;let $=[{type:"feedback",key:"feedback-activity",feedback_rating:(V=e.value)==null?void 0:V.doc.feedback_rating,feedback_extra:(T=e.value)==null?void 0:T.doc.feedback_extra,feedback:(L=e.value)==null?void 0:L.doc.feedback,sender:{name:(M=e.value)==null?void 0:M.doc.raised_by,full_name:(O=e.value)==null?void 0:O.doc.contact}}];return f.push(...$),f});function y(u){return u==="activity"?C.value:C.value.filter(p=>p.type===u)}return(u,p)=>{var d,n,s;return v(),w(P,null,[_(t(yt),{modelValue:t(b),tabs:r.value,"onUpdate:modelValue":t(h)},{default:S(()=>[_(t(gt)),_(t(kt),{class:"flex-1"},{default:S(({tab:f})=>[t(i).data?(v(),A(bt,{key:0,ref_key:"ticketAgentActivitiesRef",ref:o,activities:y(f.name),title:f.label,"ticket-status":t(e).doc.status,"onEmail:reply":p[0]||(p[0]=l=>{g.value.replyToEmail(l)}),onUpdate:p[1]||(p[1]=()=>{t(i).reload(),o.value.scrollToLatestActivity()})},null,8,["activities","title","ticket-status"])):(v(),w("div",ea,[_(t(Ge),{scale:8,class:"text-ink-gray-5"}),p[3]||(p[3]=m("p",{class:"text-xl font-medium text-ink-gray-5 absolute top-[50%]"}," Loading... ",-1))]))]),_:1})]),_:1},8,["modelValue","tabs","onUpdate:modelValue"]),(v(),A(t(ht),{ref_key:"communicationAreaRef",ref:g,ticketId:String((d=t(e).doc)==null?void 0:d.name),"to-emails":[(n=t(e).doc)==null?void 0:n.raised_by],"cc-emails":[],"bcc-emails":[],key:(s=t(e).doc)==null?void 0:s.name,onUpdate:p[2]||(p[2]=()=>{t(i).reload(),o.value.scrollToLatestActivity()})},null,8,["ticketId","to-emails"]))],64)}}}),E=z(0),j=Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_navigation_tickets",cache:["ticketsToNavigate"]});function aa(){const x=ze(),e=ke();function i(){if(E.value<j.data.length-1){E.value+=1;const b=j.data[E.value];return r(b),b}return null}function o(){if(E.value>0){E.value-=1;const b=j.data[E.value];return r(b),b}return null}function g(){return j.data[E.value]}function k(){return j.data&&E.value<j.data.length-1?j.data[E.value+1]:null}function a(){return j.data&&E.value>0?j.data[E.value-1]:null}function r(b){let h=e.query.view,C={name:"TicketAgent",params:{ticketId:b},hash:""};h&&(C.query={view:h}),x.push(C)}return{currentTicketIndex:E,ticketsToNavigate:j,goToNextTicket:i,goToPreviousTicket:o,getCurrentTicket:g,getNextTicket:k,getPreviousTicket:a,navigateToTicket:r}}const sa={class:"flex gap-1"},na=N({__name:"TicketNavigation",setup(x){const{currentTicketIndex:e,goToNextTicket:i,goToPreviousTicket:o,getNextTicket:g,getPreviousTicket:k}=aa();z(null),z(null);const a=B(()=>{var b;return j.loading||!((b=j.data)!=null&&b.length)?!0:e.value==0}),r=B(()=>{var b;return j.loading||!((b=j.data)!=null&&b.length)||j.data.length<=1?!0:e.value>=j.data.length-1});return be(()=>{J({key:">",shift:!0},()=>{r.value||i()}),J({key:"<",shift:!0},()=>{a.value||o()})}),(b,h)=>{const C=I("Button"),y=I("Tooltip");return v(),w("div",sa,[_(y,{text:t(k)()?`Go to previous ticket: #${t(k)()}`:"No previous ticket",disabled:a.value},{default:S(()=>[_(C,{icon:t(Xe),variant:"ghost",disabled:a.value,onClick:h[0]||(h[0]=u=>t(o)())},null,8,["icon","disabled"])]),_:1},8,["text","disabled"]),_(y,{text:t(g)()?`Go to next ticket: #${t(g)()}`:"No next ticket",disabled:r.value},{default:S(()=>[_(C,{icon:t(Ke),variant:"ghost",disabled:r.value,onClick:h[1]||(h[1]=u=>t(i)())},null,8,["icon","disabled"])]),_:1},8,["text","disabled"])])}}}),oa={class:"flex items-center mx-5 md:mr-0 text-p-sm gap-3 text-[14px] mb-[13px]"},la={class:"flex items-center gap-1"},ia={key:0,class:"text-ink-gray-4 flex items-center"},ra={key:1,class:"text-ink-gray-4 flex items-center"},ca={class:"flex items-center gap-1"},ua={class:"flex items-center gap-1"},da=N({__name:"TicketSLA",setup(x){const e=U(X),i=B(()=>{var k,a;return(a=(k=e.value)==null?void 0:k.get)!=null&&a.loading?{label:"",color:""}:!e.value.doc.first_responded_on&&q().isBefore(q(e.value.doc.response_by))?{label:`Due in ${g(e.value.doc.response_by)}`,color:"orange"}:q(e.value.doc.first_responded_on).isBefore(q(e.value.doc.response_by))?{label:`Fulfilled in ${g(e.value.doc.first_responded_on,e.value.doc.creation)}`,color:"green"}:{label:`Failed by ${g(String(new Date),e.value.doc.response_by)}`,color:"red"}}),o=B(()=>{var k,a,r,b,h,C,y,u,p,d,n,s,f,l;return(a=(k=e.value)==null?void 0:k.get)!=null&&a.loading?{label:"",color:""}:((r=e.value.doc)==null?void 0:r.status_category)==="Paused"&&((b=e.value.doc)!=null&&b.on_hold_since)&&q((h=e.value.doc)==null?void 0:h.resolution_by).isAfter(q((C=e.value.doc)==null?void 0:C.on_hold_since))?{label:"On Hold",color:"blue"}:!((y=e.value.doc)!=null&&y.resolution_date)&&q().isBefore(q((u=e.value.doc)==null?void 0:u.resolution_by))?{label:`Due in ${g((p=e.value.doc)==null?void 0:p.resolution_by)}`,color:"purple"}:q((d=e.value.doc)==null?void 0:d.resolution_date).isBefore(q((n=e.value.doc)==null?void 0:n.resolution_by))?{label:`Fulfilled in ${g((s=e.value.doc)==null?void 0:s.resolution_date,(f=e.value.doc)==null?void 0:f.creation)}`,color:"green"}:{label:`Failed by ${g(String(new Date),(l=e.value.doc)==null?void 0:l.resolution_by)}`,color:"red"}});function g(k,a){a||(a=q().toString());let r=q(k),b=q.duration(r.diff(q(a))),h=b.days(),C=b.hours(),y=b.minutes();return h>0?`${h}d ${C}h`:C>0?`${C}h ${y}m`:`${y}m`}return J({meta:!0,shift:!0,key:"."},()=>{se(window.location.href,"Ticket URL copied to clipboard")}),J({meta:!0,key:"."},()=>{se(e.value.doc.name,`Ticket #${e.value.doc.name} copied to clipboard`)}),(k,a)=>{const r=re,b=Jt;return v(),A(Ye,{to:"#app-header"},[m("div",oa,[m("div",la,[m("p",{onClick:a[0]||(a[0]=h=>t(se)(t(e).doc.name,`Ticket #${t(e).doc.name} copied to clipboard`)),class:"cursor-copy"}," #"+F(t(e).doc.name),1),t(e).doc.via_customer_portal?(v(),w("div",ra,[a[3]||(a[3]=m("span",{class:"text-ink-gray-4 mr-[6px]"},"via",-1)),_(b,{class:"size-4 inline-block mr-1"}),a[4]||(a[4]=m("span",{class:"font-medium"},"Portal",-1))])):(v(),w("div",ia,[a[1]||(a[1]=m("span",{class:"text-ink-gray-4 mr-[6px]"},"via",-1)),_(r,{class:"size-4 inline-block mr-1"}),a[2]||(a[2]=m("span",{class:""},"Email",-1))]))]),a[7]||(a[7]=m("div",{class:"border-l border-outline-gray-2 h-[13px]"},null,-1)),m("div",ca,[a[5]||(a[5]=m("span",null,"First Response",-1)),_(Te,{label:i.value.label,variant:"subtle",theme:i.value.color},null,8,["label","theme"])]),a[8]||(a[8]=m("div",{class:"border-l border-outline-gray-2 h-[13px]"},null,-1)),m("div",ua,[a[6]||(a[6]=m("span",null,"Resolution ",-1)),o.value?(v(),A(Te,{key:0,label:o.value.label,variant:"subtle",theme:o.value.color!=="purple"&&o.value.color,class:Y(o.value.color==="purple"&&"!text-[#6B46C1] !bg-[#F3E8FF]")},null,8,["label","theme","class"])):D("",!0)])])])}}}),ma={class:"flex flex-col flex-1 gap-3"},pa=N({__name:"TicketSubjectModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){var a,r;const e=U(X),i=fe(x,"modelValue"),o=z(((r=(a=e.value)==null?void 0:a.doc)==null?void 0:r.subject)||""),g=z(!1);function k(){g.value=!0,e.value.setValue.submit({subject:o.value},{onSuccess(){g.value=!1,i.value=!1}})}return(b,h)=>{const C=I("FormControl"),y=I("Button"),u=I("Dialog");return v(),A(u,{modelValue:i.value,"onUpdate:modelValue":h[1]||(h[1]=p=>i.value=p),options:{title:"Rename Subject"}},{"body-content":S(()=>[m("div",ma,[_(C,{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=p=>o.value=p),type:"textarea",size:"sm",variant:"subtle",disabled:!1},null,8,["modelValue"]),_(y,{variant:"solid",loading:g.value,label:"Rename",onClick:k},null,8,["loading"])])]),_:1},8,["modelValue"])}}}),va={class:"flex flex-col truncate"},_a={class:"flex gap-2 items-center"},fa={key:0,class:"flex gap-2"},ga={key:1},ka=N({__name:"TicketHeader",props:{viewers:{type:Array,required:!0}},setup(x){var te;const e=ke(),i=ze(),{findView:o}=Tt("HD Ticket"),g=qe(),k=U(X),a=U(we),r=U(oe),b=z(!1),{notifyTicketUpdate:h}=Re((te=k.value)==null?void 0:te.name),C=B(()=>{var T;return(((T=g.statuses.data)==null?void 0:T.filter(L=>L.enabled))||[]).map(L=>({label:L.label_agent,value:L.label_agent,onClick:()=>{h("Status",L.label_agent),k.value.doc.status!==L.label_agent&&k.value.setValue.submit({status:L.label_agent},{onSuccess(){r.value.reload()}})},icon:()=>Qe(Ve,{class:L.parsed_color})}))}),y=B(()=>{var T,L,M,O;let V=[{label:"Tickets",route:{name:"TicketsAgent"}}];if(e.query.view){const c=o(e.query.view);c&&V.push({label:(T=c.value)==null?void 0:T.label,icon:et((L=c.value)==null?void 0:L.icon),route:{name:"TicketsAgent",query:{view:(M=c.value)==null?void 0:M.name}}})}return V.push({label:(O=k.value.doc)==null?void 0:O.subject,onClick:()=>{b.value=!0}}),V});function u(V,T,L=()=>{}){k.value.setValue.submit({[V]:T}),L()}const p=z(!1),d=B(()=>!k.value.doc.is_merged&&["Open","Paused"].includes(k.value.doc.status_category)),n=B(()=>{let V=[];return d.value&&V.push({label:"Merge Ticket",icon:Ee,condition:()=>!k.value.doc.is_merged,onClick:()=>p.value=!0}),[{group:"Default actions",hideLabel:!0,items:V}]}),s=z([]),f=B(()=>s.value.filter(V=>!V.group)),l=B(()=>{let V=[];return s.value.filter(T=>T.buttonLabel&&T.group).forEach(T=>{let L=V.findIndex(M=>M.label===T.buttonLabel);L>-1?V[L].action.push(T):V.push({label:T.buttonLabel,action:[T]})}),V}),$=B(()=>{let V=[];return V=V.concat(s.value.filter(T=>T.group&&!T.buttonLabel)),V}),R=B(()=>{var V;return{doc:(V=k==null?void 0:k.value)==null?void 0:V.doc,call:De,router:i,toast:ee,$dialog:He().$dialog,updateField:u,createToast:ee.create}});tt(async()=>{var V,T,L;(V=a.value)!=null&&V.data&&(await Dt(a.value.data,R.value),s.value=[...n.value,...((L=(T=a.value)==null?void 0:T.data)==null?void 0:L._customActions)||[]])});const W=ye("statusRef");return be(()=>{J("s",()=>{var V,T,L;(L=(T=(V=W.value)==null?void 0:V.$el)==null?void 0:T.nextElementSibling)==null||L.click()})}),(V,T)=>{const L=Ne,M=I("FeatherIcon"),O=I("Button");return v(),w(P,null,[_(At,null,{"left-header":S(()=>[m("div",va,[_(t(zt),{items:y.value,class:"breadcrumbs"},{prefix:S(({item:c})=>[c.icon?(v(),A(L,{key:0,icon:c.icon,class:"mr-1 h-4 flex items-center justify-center self-center"},null,8,["icon"])):D("",!0)]),_:1},8,["items"]),_(da)])]),"right-header":S(()=>[m("div",_a,[_(t(Ie),{avatars:JSON.stringify(x.viewers),size:"md","hide-name":!0},null,8,["avatars"]),(v(),A(na,{key:t(k).name})),f.value.length?(v(),w("div",fa,[(v(!0),w(P,null,G(f.value,c=>(v(),A(O,{key:c.label,label:c.label,onClick:H=>c.onClick()},at({_:2},[c.icon?{name:"prefix",fn:S(()=>[_(M,{name:c.icon,class:"h-4 w-4"},null,8,["name"])]),key:"0"}:void 0]),1032,["label","onClick"]))),128))])):D("",!0),l.value.length?(v(),w("div",ga,[(v(!0),w(P,null,G(l.value,c=>(v(),w("div",{key:c.label},[_(t(de),{options:c.action},{default:S(({open:H})=>[_(O,{label:c.label},{suffix:S(()=>[_(M,{name:H?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:2},1032,["options"])]))),128))])):D("",!0),_(t(de),{options:C.value,placement:"right"},{default:S(({open:c})=>[_(O,{label:t(k).doc.status,ref_key:"statusRef",ref:W},{prefix:S(()=>{var H;return[_(t(Ve),{class:Y((H=t(g).getStatus(t(k).doc.status))==null?void 0:H.parsed_color)},null,8,["class"])]}),_:1},8,["label"])]),_:1},8,["options"]),$.value.length?(v(),A(t(de),{key:2,options:$.value,placement:"right"},{default:S(()=>[_(O,{icon:"more-horizontal"})]),_:1},8,["options"])):D("",!0)])]),_:1}),p.value?(v(),A(Qt,{key:0,ticket:t(k).doc,modelValue:p.value,"onUpdate:modelValue":T[0]||(T[0]=c=>p.value=c),onUpdate:T[1]||(T[1]=c=>t(k).reload())},null,8,["ticket","modelValue"])):D("",!0),b.value?(v(),A(pa,{key:1,modelValue:b.value,"onUpdate:modelValue":T[2]||(T[2]=c=>b.value=c)},null,8,["modelValue"])):D("",!0)],64)}}});const ba={__name:"Resizer",props:{defaultWidth:{type:Number,default:352},minWidth:{type:Number,default:16*16},maxWidth:{type:Number,default:30*16},side:{type:String,default:"left"},parent:{type:Object,default:null}},setup(x){const e=x,i=z(!1),o=z(e.defaultWidth);function g(){document.addEventListener("mousemove",k),document.addEventListener("mouseup",()=>{document.body.classList.remove("select-none"),document.body.classList.remove("cursor-col-resize"),document.querySelectorAll(".select-text1").forEach(r=>{r.classList.remove("select-text1"),r.classList.add("select-text")}),localStorage.setItem("sidebarWidth",o.value),i.value=!1,document.removeEventListener("mousemove",k)})}function k(r){i.value=!0,document.body.classList.add("select-none"),document.body.classList.add("cursor-col-resize"),document.querySelectorAll(".select-text").forEach(C=>{C.classList.remove("select-text"),C.classList.add("select-text1")}),o.value=e.side=="left"?r.clientX:window.innerWidth-r.clientX;let b=e.parent?a():0;o.value=o.value-b;let h=[e.defaultWidth-10,e.defaultWidth+10];o.value>h[0]&&o.value<h[1]&&(o.value=e.defaultWidth),o.value<e.minWidth&&(o.value=e.minWidth),o.value>e.maxWidth&&(o.value=e.maxWidth)}function a(){return e.parent?e.parent.getBoundingClientRect()[e.side]:0}return(r,b)=>(v(),w("div",{class:"relative",style:ot({width:`${o.value}px`})},[st(r.$slots,"default",pe(nt({sidebarResizing:i.value,sidebarWidth:o.value}))),m("div",{class:Y(["absolute z-1 h-full w-1 cursor-col-resize bg-surface-gray-4 opacity-0 transition-opacity hover:opacity-100",{"opacity-100":i.value,"left-0":x.side=="right","right-0":x.side=="left"}]),onMousedown:g},null,34)],4))}},ya={key:0},ha={class:"flex gap-3 items-center px-5 py-2.5"},xa={class:"text-ink-gray-8 font-medium text-xl max-w-full truncate"},Ca={class:"px-5 text-ink-gray-5 pb-2"},wa={class:"flex gap-2 items-center p-1.5"},$a={class:"text-p-sm text-ink-gray-6 hover:underline cursor-pointer"},Ta={key:0,class:"flex gap-2 items-center p-1.5"},Sa={class:"text-p-sm text-ink-gray-6 hover:underline cursor-pointer"},Va={class:"px-5 border-t pb-2.5"},La={class:"flex gap-2.5 items-center py-[13px] justify-between"},Ba=["onClick"],Aa=["onClick"],za={class:"text-base text-ink-gray-8 max-w-[60%] truncate"},Da={class:"flex items-end justify-between"},ja={class:"text-base text-ink-gray-5"},Fa={class:"transition duration-400 hover:underline"},Ua=N({__name:"TicketContactTab",setup(x){const e=ce(),{isCallingEnabled:i}=ge(e),o=U($e),g=U(We),k=window.date_format,{getStatus:a,colorMap:r}=qe();function b(u){let{color:p}=a(u);return r[p]?r[p]:r.Default}const h=B(()=>{var n,s,f,l;if(g.value.loading||!g.value.data)return[];const u=((s=(n=g.value)==null?void 0:n.data)==null?void 0:s.recent_tickets)||[],p=((l=(f=g.value)==null?void 0:f.data)==null?void 0:l.similar_tickets)||[],d=[];return u.length&&d.push({label:"Recent Tickets",tooltipMessage:"Tickets recently raised by this contact/customer",hideLabel:!1,opened:!0,tickets:u}),p.length&&d.push({label:"Similar Tickets",tooltipMessage:"Tickets with similar queries",hideLabel:!1,opened:!0,tickets:p}),d});function C(u){return lt(u).format(k.toUpperCase())}function y(u){let p=window.location.origin+"/helpdesk/tickets/"+u;window.open(p,"_blank")}return(u,p)=>{const d=je;return v(),w("div",null,[t(o).loading?D("",!0):(v(),w("div",ya,[m("div",ha,[_(t(Pe),{label:t(o).data.name,image:t(o).data.image,size:"2xl"},null,8,["label","image"]),m("p",xa,F(t(o).data.name),1)]),m("div",Ca,[m("div",wa,[_(re,{class:"size-4"}),m("p",$a,F(t(o).data.email_id),1),_(t(Ae),{class:"size-4 cursor-pointer",onClick:p[0]||(p[0]=n=>t(se)(t(o).data.email_id,`'${t(o).data.email_id}' copied to clipboard`))})]),t(i)&&(t(o).data.mobile_no||t(o).data.phone)?(v(),w("div",Ta,[_(he,{class:"size-4"}),m("p",Sa,F(t(o).data.mobile_no||t(o).data.phone),1),t(o).data.mobile_no||t(o).data.phone?(v(),A(t(Ae),{key:0,class:"size-4 cursor-pointer",onClick:p[1]||(p[1]=n=>t(se)(t(o).data.mobile_no||t(o).data.phone,`'${t(o).data.mobile_no||t(o).data.phone}' copied to clipboard`))})):D("",!0)])):D("",!0)])])),t(g).loading?D("",!0):(v(!0),w(P,{key:1},G(h.value,n=>(v(),w("div",Va,[(v(),A(Ft,{key:n.label,label:n.label,hideLabel:n.hideLabel,opened:n.opened},{header:S(({opened:s,hide:f,toggle:l})=>[m("div",La,[_(t(ne),{text:n.tooltipMessage},{default:S(()=>[m("span",{class:"text-ink-gray-8 font-medium text-base cursor-pointer select-none",onClick:l},F(n.label),9,Ba)]),_:2},1032,["text"]),_(d,{class:Y(["size-4 text-ink-gray-6 cursor-pointer",{"rotate-180":s}]),onClick:l},null,8,["class","onClick"])])]),default:S(()=>[m("ul",null,[(v(!0),w(P,null,G(n.tickets,s=>(v(),w("li",{key:s.name,class:"py-2.5 cursor-pointer",onClick:f=>y(s.name)},[m("p",za,F(s.subject),1),m("div",Da,[m("p",ja,[_e(F(C(s.creation)+" Â· ")+" ",1),m("span",Fa,F("#"+s.name),1)]),m("p",{class:Y(["px-1.5 py-[3px] text-sm rounded-sm max-w-[80px] text-center truncate h-5",b(s.status)])},F(s.status),3)])],8,Aa))),128))])]),_:2},1032,["label","hideLabel","opened"]))]))),256))])}}}),Ra={class:"flex flex-col gap-2 my-2 w-[470px] rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black p-3 ring-opacity-5 focus:outline-none"},Ha={class:"text-base text-ink-gray-5"},qa=["onClick"],Ia={class:"ml-1"},Ea={class:"cursor-pointer text-ink-gray-9"},Pa={class:"flex items-center justify-between gap-2"},Na={__name:"AssignToBody",props:ve({doctype:{type:String,default:""},docname:{type:String,default:null},open:{type:Boolean,default:!1},onUpdate:{type:Function,default:null}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const e=x,i=fe(x,"modelValue"),o=z([]),g=z(!1),k=z(""),{users:a,getUser:r}=Fe(),b=d=>{d===r("").name&&(g.value=!1),i.value=i.value.filter(n=>n.name!==d)},h=d=>{if(!d)return;d===r("").name&&(g.value=!0),k.value="";let n={name:d,image:r(d).user_image,label:r(d).full_name};i.value.find(s=>s.name===d)||i.value.push(n)};le(g,d=>{let n=r("");d?h(n.name):b(n.name)}),le(()=>e.open,d=>{d?(o.value=[...i.value||[]],g.value=i.value.some(n=>n.name===r("").name)):C()},{immediate:!0});async function C(){const d=i.value.map(l=>l.name),n=o.value.map(l=>l.name);if(JSON.stringify(n)===JSON.stringify(d))return;const s=o.value.filter(l=>!i.value.find($=>$.name===l.name)).map(l=>l.name),f=i.value.filter(l=>!o.value.find($=>$.name===l.name)).map(l=>l.name);if(f.length||s.length){let l=`${f.length?`assigned ${f.join(", ")}`:""} ${f.length&&s.length?" & ":""} ${s.length?`unassigned ${s.join(", ")}`:""}`;De("frappe.client.insert",{doc:{doctype:"HD Ticket Activity",ticket:e.docname,action:l}})}e.onUpdate?e.onUpdate(f,s,y,u):(s.length&&await u.submit(s),f.length&&await y.submit(f))}const y=Z({url:"frappe.desk.form.assign_to.add",makeParams:d=>({doctype:e.doctype,name:e.docname,assign_to:d}),onSuccess:()=>{it("assign_to",{doctype:e.doctype})}}),u=Z({url:"helpdesk.api.doc.remove_assignments",makeParams:d=>({doctype:e.doctype,name:e.docname,assignees:d})}),p=ye("input");return rt(()=>{p.value.click()}),(d,n)=>{const s=I("FeatherIcon"),f=I("Button");return v(),w("div",Ra,[m("div",Ha,F(d.__("Assign to")),1),_(xe,{class:"form-control",value:"",doctype:"HD Agent",onChange:n[2]||(n[2]=l=>h(l)&&(d.$refs.input.value="")),placeholder:d.__("John Doe"),filters:{is_active:!0,name:["not in",i.value.map(l=>l.name)]},hideMe:!0},{target:S(({togglePopover:l})=>[m("div",{class:"w-full min-h-12 flex flex-wrap items-center gap-1.5 p-1.5 pb-5 rounded-lg bg-surface-gray-2 cursor-text",onClick:ae(l,["stop"]),ref:"input"},[(v(!0),w(P,null,G(i.value,$=>(v(),A(t(ne),{text:$.name,key:$.name,onClick:n[1]||(n[1]=ae(()=>{},["stop"]))},{default:S(()=>[m("div",{class:"flex items-center text-sm p-0.5 text-ink-gray-6 border border-outline-gray-1 bg-surface-modal rounded-full cursor-pointer",onClick:n[0]||(n[0]=ae(()=>{},["stop"]))},[_(Be,{name:$.name,size:"sm"},null,8,["name"]),m("div",Ia,F(t(r)($.name).full_name),1),_(f,{variant:"ghost",class:"rounded-full !size-4 m-1",onClick:ae(R=>b($.name),["stop"])},{icon:S(()=>[_(s,{name:"x",class:"h-3 w-3 text-ink-gray-6"})]),_:1},8,["onClick"])])]),_:2},1032,["text"]))),128))],8,qa)]),"item-prefix":S(({option:l})=>[_(Be,{class:"mr-2",name:l.value,size:"sm"},null,8,["name"])]),"item-label":S(({option:l})=>[_(t(ne),{text:l.value},{default:S(()=>[m("div",Ea,F(t(r)(l.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["placeholder","filters"]),m("div",Pa,[m("div",{class:"text-base text-ink-gray-5 cursor-pointer select-none",onClick:n[3]||(n[3]=l=>g.value=!g.value)},F(d.__("Assign to me")),1),_(t(Ut),{modelValue:g.value,"onUpdate:modelValue":n[4]||(n[4]=l=>g.value=l),onClick:n[5]||(n[5]=ae(()=>{},["stop"]))},null,8,["modelValue"])])])}}},Wa={class:"flex flex-col gap-1.5 w-full"},Ma={key:0},Oa={key:1,class:"flex gap-1.5 items-center"},Za={key:0,class:"ml-2 text-sm text-ink-gray-8"},Ja=N({__name:"AssignTo",setup(x){const e=U(X),i=U(Ce),o=U(oe);async function g(a,r,b,h){r.length&&await h.submit(r),a.length&&await b.submit(a),o.value.reload()}const k=ye("assigneeButton");return J("a",()=>{var a,r,b;(b=(r=(a=k.value)==null?void 0:a.$el)==null?void 0:r.nextElementSibling)==null||b.click()}),(a,r)=>{const b=Ne,h=I("Button");return v(),A(t(ut),{class:"flex w-full",placement:"bottom-end"},{target:S(({open:C,close:y,togglePopover:u})=>[m("div",Wa,[r[1]||(r[1]=m("span",{class:"block text-xs text-gray-600"},"Assignee",-1)),_(h,{variant:"outline",class:"!flex !justify-start w-full active:!bg-inherit hover:shadow-sm",ref:"assigneeButton",onClick:p=>u()},{suffix:S(()=>[_(b,{icon:t(je),class:"h-4 w-4 ml-auto text-ink-gray-5"},null,8,["icon"])]),default:S(()=>{var p,d,n,s;return[t(i).loading||((p=t(i).data)==null?void 0:p.length)===0?(v(),w("p",Ma,F(a.__("No assignees")),1)):((d=t(i).data)==null?void 0:d.length)>=1?(v(),w("div",Oa,[_(Ie,{avatars:t(i).data.map(f=>f.name),size:"sm"},null,8,["avatars"]),((n=t(i).data)==null?void 0:n.length)>1?(v(),w("p",Za,F((s=t(i).data)==null?void 0:s.length)+" assignees ",1)):D("",!0)])):D("",!0)]}),_:1},8,["onClick"])])]),body:S(({isOpen:C})=>[ct(_(Na,{modelValue:t(i).data,"onUpdate:modelValue":r[0]||(r[0]=y=>t(i).data=y),doctype:"HD Ticket",docname:t(e).name,open:C,onUpdate:g},null,8,["modelValue","docname","open"]),[[dt,C]])]),_:1})}}}),Ga={key:0,class:"my-4 flex items-center justify-start gap-5"},Xa={class:"flex flex-col gap-1.5"},Ka={class:"flex gap-2.5 items-center"},Ya={class:"text-ink-gray-8 font-medium text-xl max-w-[170px] truncate"},Qa={class:"flex gap-1.5"},es=N({__name:"TicketContact",setup(x){const e=ce(),{getUser:i}=Fe(),{isCallingEnabled:o}=ge(e),g=z(!1),k=U(X),a=U($e),r=B(()=>{var C,y,u,p,d;return((y=(C=a.value)==null?void 0:C.data)==null?void 0:y.image)||((d=i((p=(u=a.value)==null?void 0:u.data)==null?void 0:p.email_id))==null?void 0:d.user_image)||null});function b(C){let y=window.location.origin+"/app/contact/"+C;window.open(y,"_blank")}const h=()=>{if(!a.value.data.mobile_no&&!a.value.data.phone){g.value=!0;return}e.makeCall({number:a.value.data.mobile_no||a.value.data.phone,doctype:"HD Ticket",docname:k.value.name})};return(C,y)=>t(a).loading?D("",!0):(v(),w("div",Ga,[_(t(Pe),{label:t(a).data.name,image:r.value,size:"2xl"},null,8,["label","image"]),m("div",Xa,[_(t(ne),{text:t(a).data.name||t(a).data.email_id},{default:S(()=>[m("div",Ka,[m("p",Ya,F(t(a).data.name||t(a).data.email_id),1),_(t(Wt),{class:"size-4 text-ink-gray-6 cursor-pointer",onClick:y[0]||(y[0]=u=>b(t(a).data.name))})])]),_:1},8,["text"]),m("div",Qa,[_(t(ne),{text:t(a).data.email_id},{default:S(()=>[_(t(Se),{size:"sm",onClick:y[1]||(y[1]=u=>t(St)())},{icon:S(()=>[_(re,{class:"size-4"})]),_:1}),t(o)?(v(),A(t(Se),{key:0,size:"sm",onClick:h},{icon:S(()=>[_(he,{class:"size-4"})]),_:1})):D("",!0)]),_:1},8,["text"])])]),_(Ue,{modelValue:g.value,"onUpdate:modelValue":y[2]||(y[2]=u=>g.value=u),name:t(a).data.name,onOnUpdate:t(a).reload},null,8,["modelValue","name","onOnUpdate"])]))}}),ts={class:"h-full overflow-y-hidden flex flex-1 flex-col justify-between overflow-hidden max-h-full"},as={class:"px-5 pb-4 flex flex-col"},ss={class:"border-t flex flex-col flex-1 h-full pb-3 overflow-y-hidden"},ns={class:"overflow-y-scroll max-h-[80%]"},os=N({__name:"TicketDetailsTab",setup(x){var d;const e=U(X),i=U(Ce),o=U(we),g=U(oe),{getFields:k,getField:a}=mt("HD Ticket"),{notifyTicketUpdate:r}=Re((d=e.value)==null?void 0:d.name),b=B(()=>{const n=k();if(!n||n.length===0)return[];const s=[{group:!0,fields:[a("ticket_type"),a("priority")]},{group:!1,fields:[a("customer")]},{group:!0,fields:[a("agent_group")]}];return s.forEach(f=>{f.fields=f.fields.map(l=>(l=Le(l,e.value.doc),l.required=l.reqd,l.ref=l.fieldname,l=C(l,l),l.visible=!0,l))}),s}),h=B(()=>{var $;const n=k();if(!n||n.length===0)return[];if(!o.value.data||o.value.loading)return[];let s=(($=o.value.data)==null?void 0:$.custom_fields)||[];const f=["ticket_type","priority","customer","agent_group","subject","status"];return s=s.filter(R=>!f.includes(R.fieldname)),s.map(R=>{let W=a(R.fieldname);return W=Le(W,e.value.doc),W.required=W.reqd||R.required,C(R,W)})});function C(n,s){return{label:(s==null?void 0:s.label)||n.fieldname,value:e.value.doc[n.fieldname],fieldtype:s==null?void 0:s.fieldtype,doctype:(s==null?void 0:s.options)||"",options:(s==null?void 0:s.options)||"",placeholder:n.placeholder||`Enter ${(s==null?void 0:s.label)||n.fieldname}`,readonly:!!s.read_only,disabled:!!s.read_only,url_method:n.url_method||"",fieldname:n.fieldname,required:n.required||(s==null?void 0:s.required)||!1,visible:s.display_via_depends_on&&!s.hidden}}function y(n,s,f=!1){var l;if(e.value.doc[n]!=s){if(f){const $=((l=a(n))==null?void 0:l.label)||n;r($,s)}e.value.setValue.submit({[n]:s},{onSuccess:()=>{n==="agent_group"&&i.value.reload(),g.value.reload()}})}}const u=z({}),p=(n,s)=>{s&&(u.value[n]=s)};return J("t",()=>{var n,s,f,l;(l=(f=(s=(n=u.value)==null?void 0:n.ticket_type)==null?void 0:s.$el)==null?void 0:f.querySelector("button"))==null||l.click()}),J("p",()=>{var n,s,f,l;(l=(f=(s=(n=u.value)==null?void 0:n.priority)==null?void 0:s.$el)==null?void 0:f.querySelector("button"))==null||l.click()}),J({key:"t",shift:!0},()=>{var n,s,f,l;(l=(f=(s=(n=u.value)==null?void 0:n.agent_group)==null?void 0:s.$el)==null?void 0:f.querySelector("button"))==null||l.click()}),(n,s)=>(v(),w("div",ts,[m("div",as,[_(es),m("div",null,[(v(!0),w(P,null,G(b.value,(f,l)=>(v(),w("div",{key:l,class:Y(f.group?"flex gap-2 items-center w-full mb-3":"mb-3")},[(v(!0),w(P,null,G(f.fields,$=>(v(),w(P,null,[$.visible?(v(),A(t(xe),{key:$.fieldname,ref_for:!0,ref:R=>p($.fieldname,R),class:Y(["form-control-core",f.group?"flex-1":"w-full"]),id:$.fieldname,"page-length":10,label:$.label,placeholder:$.placeholder,doctype:$.doctype,modelValue:$.value,required:$.required,"onUpdate:modelValue":R=>y($.fieldname,R,!0)},null,8,["id","class","label","placeholder","doctype","modelValue","required","onUpdate:modelValue"])):D("",!0)],64))),256))],2))),128)),_(Ja)])]),m("div",ss,[m("div",ns,[(v(!0),w(P,null,G(h.value,f=>(v(),w(P,null,[f.visible?(v(),A(wt,{key:f.fieldname,field:f,value:f.value,onChange:s[0]||(s[0]=({fieldname:l,value:$})=>y(l,$))},null,8,["field","value"])):D("",!0)],64))),256))])])]))}});const ls=ie(os,[["__scopeId","data-v-419c42cd"]]),is={class:"flex-1 max-h-full"},rs=N({__name:"TicketSidebar",setup(x){const e=z("details"),i=[{label:"Details",value:"details"},{label:"Contact",value:"contact"}];return(o,g)=>(v(),A(ba,{class:"flex flex-col justify-between border-l",side:"right"},{default:S(()=>[_(t(jt),{buttons:i,modelValue:e.value,"onUpdate:modelValue":g[0]||(g[0]=k=>e.value=k),class:"tab-buttons mb-1 px-5 mt-3.5"},null,8,["modelValue"]),m("div",is,[e.value==="details"?(v(),A(ls,{key:0})):(v(),A(Ua,{key:1}))])]),_:1}))}});const me=pt({}),cs=x=>{let e=!1;return me[x]||(me[x]={ticket:vt({doctype:"HD Ticket",name:x,whitelistedMethods:{markSeen:"mark_seen"},setValue:{onSuccess:()=>{ee.success(__("Ticket updated")),e=!1},onError:i=>{if(e)return;e=!0;const o=i.exc_type?(i.messages||i.message||[]).join(", "):i.message;ee.error(o)}}}),assignees:Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_assignees",params:{ticket:x},auto:!0,transform:i=>JSON.parse(i).map(o=>({name:o}))}),contact:Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_contact",params:{ticket:x},auto:!0}),recentSimilarTickets:Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_recent_similar_tickets",params:{ticket:x},auto:!0}),activities:Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_activities",params:{ticket:x},auto:!0})}),me[x]},us={key:0,class:"flex-1"},ds={class:"h-full flex overflow-hidden"},ms={class:"flex-1 flex flex-col overflow-hidden"},Ms=N({__name:"TicketAgent",props:{ticketId:{type:String,required:!0}},setup(x){const e=ce(),{$socket:i}=He(),o=x,g=ke(),k=z(!1),a=B(()=>cs(o.ticketId)),r=B(()=>a.value.ticket),b=Z({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_ticket_customizations",cache:["HD Ticket","customizations"],auto:!0});K(X,r),K(Ce,B(()=>a.value.assignees)),K($e,B(()=>a.value.contact)),K(we,B(()=>b)),K(We,B(()=>a.value.recentSimilarTickets)),K(oe,B(()=>a.value.activities)),K("makeCall",()=>{var p,d,n,s;if(!((p=a.value.contact.data)!=null&&p.mobile_no)&&!((d=a.value.contact.data)!=null&&d.phone)){k.value=!0;return}e.makeCall({number:((n=a.value.contact.data)==null?void 0:n.phone)||((s=a.value.contact.data)==null?void 0:s.mobile_no),doctype:"HD Ticket",docname:o.ticketId})});const h=B(()=>Vt(r.value.name)),C=B(()=>h.value.currentViewers[o.ticketId]||[]),{startViewing:y,stopViewing:u}=h.value;return le(()=>g.params.ticketId,(p,d)=>{p!==d&&(d&&u(d),y(p))},{immediate:!0}),be(()=>{j.update({params:{ticket:o.ticketId,current_view:g.query.view}}),j.reload(),r.value.markSeen.reload(),i.on("ticket_update",p=>{var d;p.ticket_id===((d=r.value)==null?void 0:d.name)&&ee.info(`User ${p.user} updated ${p.field} to ${p.value}`)})}),_t(()=>{u(o.ticketId),Lt.value=!1,Bt.value=!1}),Rt(()=>({title:o.ticketId})),(p,d)=>{var n,s,f;return(n=r.value.doc)!=null&&n.name?(v(),w("div",us,[_(ka,{viewers:C.value},null,8,["viewers"]),m("div",ds,[m("div",ms,[_(ta)]),_(rs)]),_(Ue,{modelValue:k.value,"onUpdate:modelValue":d[0]||(d[0]=l=>k.value=l),name:(f=(s=r.value.data)==null?void 0:s.contact)==null?void 0:f.name,onOnUpdate:r.value.reload},null,8,["modelValue","name","onOnUpdate"])])):D("",!0)}}});export{Ms as default};
//# sourceMappingURL=TicketAgent-27545814.js.map
