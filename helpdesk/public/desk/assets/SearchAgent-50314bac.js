import{L as pe}from"./mail-34aba9dd.js";import{ba as ve,e as a,k as o,l as n,d as ne,z as w,aj as oe,c as f,a3 as re,g as p,w as S,a8 as q,h as m,aq as he,b9 as ge,y as _e,f as _,x as d,F as b,E as z,ap as ye,an as xe,al as ke,t as v,a0 as Z,bb as ie,bc as Q,v as ee,J,u as be,q as we,V as te,M as Se,aU as $e,s as Ce,bd as Te,r as se,be as Ve,b0 as Oe,am as ae}from"./index-3194ec9b.js";import{b as Me,q as De,r as Le}from"./TypingIndicator.vue_vue_type_style_index_0_scoped_3f215bd3_lang-a9d0f8af.js";import{_ as Ie}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-add081d8.js";import"./dayjs-f66c5460.js";import{L as Ae}from"./LayoutHeader-3eb7ac7a.js";import{_ as G}from"./Avatar.vue_vue_type_script_setup_true_lang-1b98856a.js";import"./Dropdown-c7dd9c29.js";const He={class:"lucide lucide-message-square",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function qe(B,i){return a(),o("svg",He,[...i[0]||(i[0]=[n("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},null,-1)])])}const ze=ve({name:"lucide-message-square",render:qe}),Re={class:"relative inline-block text-left"},Fe={class:"flex"},je={class:"flex -space-x-2 isolate"},Ee={class:"text-ink-gray-7"},Ne={key:1,class:"text-ink-gray-6"},Ue={key:0,class:"absolute z-50 mt-2 w-64 divide-y divide-outline-gray-modals rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none left-0 origin-top-left"},Be={class:"py-1.5 px-1.5"},Pe={class:"flex h-7 items-center text-sm font-medium text-ink-gray-6 justify-between"},Ke=["placeholder"],Ye={class:"px-1.5 pb-1.5 max-h-64 overflow-y-auto"},Je={key:0,class:"pt-1.5"},Ge=["onClick"],Xe={class:"text-ink-gray-7 flex-1 text-left truncate"},We={key:2,class:"text-xs text-ink-gray-5 ml-auto"},Ze={class:"flex h-7 pt-1.5 sticky top-0 bg-surface-white items-center px-2 text-sm font-medium text-ink-gray-6"},Qe=["onClick"],et={key:2,class:"mr-2 w-6 h-6 flex-shrink-0"},tt={class:"text-ink-gray-7 flex-1 text-left truncate"},st={key:3,class:"text-xs text-ink-gray-5 ml-auto"},at={key:1,class:"px-2 py-4 text-center text-sm text-ink-gray-5"},U=ne({__name:"SearchMultiSelect",props:{options:{default:()=>[]},modelValue:{},placeholder:{default:"Select options..."},label:{default:"Options"},selectionText:{default:"items"}},emits:["update:modelValue"],setup(B,{emit:i}){const r=B,g=i,c=w(!1),x=w(""),y=w(0),V=oe("inputRef"),h=f(()=>r.modelValue.length),k=f(()=>r.options.length>0&&"group"in r.options[0]&&"items"in r.options[0]),P=f(()=>k.value?[]:r.options),K=f(()=>k.value?r.options:[]),R=f(()=>k.value?r.options.flatMap(s=>s.items):r.options),O=f(()=>R.value.filter(s=>r.modelValue.includes(s.value))),M=f(()=>O.value.some(s=>s.image)),F=f(()=>R.value.some(s=>s.image||s.icon)),D=f(()=>{if(!k.value)return[];const s=x.value.toLowerCase();return K.value.map(e=>({...e,items:e.items.filter(t=>{const l=e.group.toLowerCase().includes(s),T=t.label.toLowerCase().includes(s);return l||T})})).filter(e=>e.items.length>0)}),L=f(()=>P.value.filter(s=>s.label.toLowerCase().includes(x.value.toLowerCase()))),I=f(()=>{const s=L.value,e=D.value.flatMap(t=>t.items);return[...s,...e]}),$=f(()=>I.value[y.value]||null);function C(){c.value=!c.value,c.value&&(y.value=0,ye(()=>{var s;(s=V.value)==null||s.focus()}))}function j(){c.value=!1}function A(s){const e=[...r.modelValue],t=e.indexOf(s.value);t>-1?e.splice(t,1):e.push(s.value),g("update:modelValue",e)}function Y(){x.value="",g("update:modelValue",[])}function H(s){c.value&&(s.key==="Escape"?(s.preventDefault(),j()):s.key==="Enter"&&$.value?(s.preventDefault(),s.stopPropagation(),A($.value)):s.key==="ArrowDown"?(s.preventDefault(),y.value=Math.min(y.value+1,I.value.length-1)):s.key==="ArrowUp"&&(s.preventDefault(),y.value=Math.max(y.value-1,0)))}function E(s){if(!s)return null;const e=typeof s=="string"?J("span",{class:"text-base"},s):J(s,{class:"w-4 h-4"});return J("span",{class:"flex-shrink-0 w-4 h-4 inline-flex items-center justify-center mr-2"},[e])}function N(s){var e;return((e=$.value)==null?void 0:e.value)===s.value}return re(x,()=>{y.value=0}),(s,e)=>(a(),o("div",Re,[n("div",Fe,[p(m(Z),{variant:"outline",class:q({"ring-2 ring-outline-gray-2":c.value}),onClick:C},{suffix:S(()=>[p(m(xe),{class:q(["ml-2 h-4 w-4 transition-transform duration-200",{"rotate-180":c.value}])},null,8,["class"])]),default:S(()=>{var t;return[n("div",{class:q(["flex items-center min-h-[20px]",{"gap-2":M.value&&h.value>0}])},[h.value>0?(a(),o(b,{key:0},[n("div",je,[(a(!0),o(b,null,z(O.value.slice(0,3),(l,T)=>(a(),o("div",{key:`avatar-${l.value}`,class:"relative flex",style:ke({zIndex:10-T})},[l.image?(a(),_(m(G),{key:0,image:l.image,label:l.label,class:"border-2 border-white flex-shrink-0",size:"sm"},null,8,["image","label"])):d("",!0)],4))),128))]),n("span",Ee,v(h.value===1?(t=O.value[0])==null?void 0:t.label:`${h.value} ${s.selectionText}`),1)],64)):(a(),o("span",Ne,v(s.placeholder),1))],2)]}),_:1},8,["class"])]),c.value?(a(),o("div",Ue,[n("div",Be,[n("div",Pe,[he(n("input",{ref_key:"inputRef",ref:V,"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),placeholder:s.label,class:"px-2 flex-1 bg-transparent border-none outline-none text-sm focus:border-none focus:ring-0 text-ink-gray-6 placeholder-ink-gray-4",onClick:e[1]||(e[1]=_e(()=>{},["stop"])),onKeydown:H},null,40,Ke),[[ge,x.value]]),h.value>0?(a(),_(m(Z),{key:0,variant:"ghost",size:"sm",onClick:Y},{icon:S(()=>[p(m(ie),{class:"size-4"})]),_:1})):d("",!0)])]),n("div",Ye,[L.value.length>0?(a(),o("div",Je,[(a(!0),o(b,null,z(L.value,t=>(a(),o("button",{key:`individual-${t.value}`,class:q(["group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6",{"bg-surface-gray-2":N(t)}]),onClick:l=>A(t)},[p(m(Q),{modelValue:r.modelValue.includes(t.value),class:"mr-2 flex-shrink-0"},null,8,["modelValue"]),t.icon?(a(),_(ee(E(t.icon)),{key:0})):F.value?(a(),_(m(G),{key:1,image:t.image,label:t.label,class:"mr-2 flex-shrink-0",size:"sm"},null,8,["image","label"])):d("",!0),n("span",Xe,v(t.label),1),(t.count??0)>0?(a(),o("span",We,v(t.count),1)):d("",!0)],10,Ge))),128))])):d("",!0),(a(!0),o(b,null,z(D.value,t=>(a(),o("div",{key:`group-${t.group}`},[n("div",Ze,v(t.group),1),(a(!0),o(b,null,z(t.items,l=>(a(),o("button",{key:`grouped-${l.value}`,class:q(["group flex h-7 w-full items-center rounded px-2 text-base hover:bg-surface-gray-3 text-ink-gray-6",{"bg-surface-gray-2":N(l)}]),onClick:T=>A(l)},[p(m(Q),{modelValue:r.modelValue.includes(l.value),class:"mr-2 flex-shrink-0"},null,8,["modelValue"]),l.icon?(a(),_(ee(E(l.icon)),{key:0})):l.image?(a(),_(m(G),{key:1,image:l.image,label:l.label,class:"mr-2 flex-shrink-0",size:"sm"},null,8,["image","label"])):F.value?(a(),o("div",et)):d("",!0),n("span",tt,v(l.label),1),(l.count??0)>0?(a(),o("span",st,v(l.count),1)):d("",!0)],10,Qe))),128))]))),128)),I.value.length===0?(a(),o("div",at," No options found ")):d("",!0)])])):d("",!0),c.value?(a(),o("div",{key:1,class:"fixed inset-0 z-40",onClick:j})):d("",!0)]))}}),lt={class:"mx-auto mt-6 max-w-4xl px-4 sm:px-5"},nt={class:"flex items-center space-x-2 px-2.5"},ot={class:"flex items-center"},rt={class:"mt-2 px-2.5"},it={class:"flex gap-2 items-center"},ut={class:"mt-2 px-2.5 text-sm flex items-center justify-between min-h-6"},ct={key:1,class:"text-ink-gray-6"},dt={key:2,class:"text-ink-gray-6"},mt={key:3,class:"space-y-1"},ft={class:"text-ink-gray-6"},pt={key:0},vt={key:0,class:"text-ink-gray-6"},ht={class:"ml-1 font-medium text-primary"},gt={class:"mt-5"},_t={class:"flex items-start space-x-2"},yt={class:"flex-shrink-0"},xt={class:"w-full"},kt={class:"flex items-center"},bt=["innerHTML"],wt={key:1,class:"text-base font-medium"},St={class:"px-1 leading-none text-sm text-ink-gray-5"},$t={class:"px-1 leading-none text-sm text-ink-gray-5"},Ct={class:"ml-auto text-sm text-ink-gray-5"},Tt=["innerHTML"],le="helpdesk_search:",qt=ne({__name:"SearchAgent",setup(B){const i=w(""),r=w(null),g=w(!0),c=w({}),x=oe("searchInput"),y=be(),V=we(),h=te({url:"helpdesk.api.search.search",makeParams(){return{query:i.value,filters:JSON.stringify(c.value),limit:50}},onSuccess(e){r.value=e,g.value=!1,i.value&&N(i.value,e)}}),k=te({url:"helpdesk.api.search.get_filter_options",auto:!0}),P=f(()=>{var t;const e=((t=k.data)==null?void 0:t.teams)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),K=f(()=>{var t;const e=((t=k.data)==null?void 0:t.statuses)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),R=f(()=>{var t;const e=((t=k.data)==null?void 0:t.priorities)||{};return Object.entries(e).map(([l])=>({value:l,label:`${l}`}))}),O=f(()=>[{value:"HD Ticket",label:"Tickets",count:0},{value:"Communication",label:"Emails",count:0},{value:"HD Ticket Comment",label:"Comments",count:0}]),M=Te(()=>{i.value.length>2&&h.submit()},500);function F(e){i.value=e,g.value=!0,M()}function D(){i.value.length>2&&(y.replace({name:"SearchAgent",query:{q:i.value}}),h.submit())}function L(){i.value="",r.value=null,g.value=!0,s(),y.replace({name:"SearchAgent"})}function I(){c.value={},i.value.length>2&&M()}function $(){return Object.values(c.value).some(e=>e&&e.length>0)}function C(e,t){!t||t.length===0?delete c.value[e]:c.value[e]=t,i.value.length>2&&M()}function j(e){return!e||!e.doctype||!e.name?{name:"SearchAgent"}:e.doctype==="HD Ticket"?{name:"TicketAgent",params:{ticketId:e.name}}:e.doctype==="HD Ticket Comment"&&e.reference_ticket?{name:"TicketAgent",params:{ticketId:e.reference_ticket},hash:`#comment-${e.name}`}:e.doctype==="Communication"&&e.reference_name?{name:"TicketAgent",params:{ticketId:e.reference_name},hash:`#communication-${e.name}`}:{name:"SearchAgent"}}function A(e){return!e||!e.doctype?"":e.doctype==="HD Ticket"?e.name||"":e.doctype==="HD Ticket Comment"?e.reference_ticket||"":e.doctype==="Communication"&&e.reference_name||""}function Y(e){if(!e)return"";let t="MMM D, YYYY hh:mm A";try{return typeof e=="number"?ae.unix(e).format(t):ae(e).format(t)}catch{return""}}function H(e){return`${le}${e}`}function E(e){const t=localStorage.getItem(H(e));if(t){const l=JSON.parse(t);if(Date.now()-l.timestamp<30*60*1e3)return r.value=l.results,l.filters&&(c.value=l.filters),g.value=!1,!0;localStorage.removeItem(H(e))}return!1}function N(e,t){const l={results:t,filters:c.value,timestamp:Date.now()};localStorage.setItem(H(e),JSON.stringify(l))}function s(){for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t!=null&&t.startsWith(le)&&localStorage.removeItem(t)}}return re(()=>V.query.q,e=>{e&&typeof e=="string"&&e!==i.value?(i.value=e,g.value=!1,h.submit()):!e&&i.value&&(i.value="",r.value=null,g.value=!0)}),Se(()=>{const e=V.query.q;e?(i.value=e,E(e)||D()):s(),Me("/",()=>{x.value.el.focus()})}),(e,t)=>{var X,W;const l=De,T=ie,ue=se("Button"),ce=Le,de=ze,me=pe,fe=se("router-link");return a(),o("div",null,[n("div",null,[p(m(Ae),null,{"left-header":S(()=>[p(m(Ie),{items:[{label:"Search",route:{name:"SearchAgent"}}]})]),_:1}),n("div",lt,[n("div",nt,[p(m(Ve),{ref_key:"searchInput",ref:x,class:"flex-1",placeholder:"Search tickets, comments, and communications...",autocomplete:"off","model-value":i.value,"onUpdate:modelValue":F,onKeydown:[t[0]||(t[0]=u=>g.value=!0),t[1]||(t[1]=$e(()=>D(),["enter"]))]},{prefix:S(()=>[p(l,{class:"w-4 text-ink-gray-5"})]),suffix:S(()=>[n("div",ot,[i.value?(a(),o("button",{key:0,onClick:L,class:"p-1 size-6 grid place-content-center focus:outline-none focus:ring focus:ring-outline-gray-3 rounded"},[p(T,{class:"w-4 text-ink-gray-7"})])):d("",!0)])]),_:1},8,["model-value"])]),n("div",rt,[n("div",it,[p(U,{options:P.value,"model-value":c.value.agent_group||[],"onUpdate:modelValue":t[2]||(t[2]=u=>C("agent_group",u)),placeholder:"Team",label:"Team"},null,8,["options","model-value"]),p(U,{options:K.value,"model-value":c.value.status||[],"onUpdate:modelValue":t[3]||(t[3]=u=>C("status",u)),placeholder:"Status",label:"Status"},null,8,["options","model-value"]),p(U,{options:R.value,"model-value":c.value.priority||[],"onUpdate:modelValue":t[4]||(t[4]=u=>C("priority",u)),placeholder:"Priority",label:"Priority"},null,8,["options","model-value"]),p(U,{options:O.value,"model-value":c.value.doctype||[],"onUpdate:modelValue":t[5]||(t[5]=u=>C("doctype",u)),placeholder:"Type",label:"Type"},null,8,["options","model-value"]),$()?(a(),_(ue,{key:0,size:"sm",class:"ml-auto text-ink-gray-5",variant:"gray-ghost",onClick:I,label:"Clear all filters"})):d("",!0)])]),n("div",ut,[n("div",null,[m(h).error?(a(),_(m(Oe),{key:0,message:m(h).error.type=="HelpdeskSearchIndexMissingError"?"Search index does not exist. Please build the index first.":m(h).error},null,8,["message"])):g.value&&i.value.length>2?(a(),o("p",ct,"Press enter to search")):m(h).loading?(a(),o("p",dt,"Searching...")):(X=r.value)!=null&&X.summary?(a(),o("div",mt,[n("p",ft,[Ce(v(r.value.summary.filtered_matches)+" matches ("+v(r.value.summary.duration)+"s) ",1),$()?(a(),o("span",pt," • "+v(Object.keys(r.value.summary.applied_filters||{}).length)+" filter(s) applied ",1)):d("",!0)]),r.value.summary.corrected_query?(a(),o("p",vt,[t[6]||(t[6]=n("span",{class:"text-ink-gray-5"},"Searched for:",-1)),n("span",ht,v(r.value.summary.corrected_query),1)])):d("",!0)])):d("",!0)])]),n("div",gt,[(a(!0),o(b,null,z((W=r.value)==null?void 0:W.results,u=>(a(),o(b,{key:u.id},[p(fe,{to:j(u),class:"flex space-x-2 overflow-hidden rounded px-2.5 py-3 hover:bg-surface-gray-2"},{default:S(()=>[n("div",_t,[n("div",yt,[u.doctype==="HD Ticket"?(a(),_(ce,{key:0,class:"h-4 w-4 text-ink-gray-6"})):u.doctype==="HD Ticket Comment"?(a(),_(de,{key:1,class:"h-4 w-4 text-ink-gray-6"})):u.doctype==="Communication"?(a(),_(me,{key:2,class:"h-4 w-4 text-ink-gray-6"})):d("",!0)])]),n("div",xt,[n("div",kt,[u.title?(a(),o("div",{key:0,class:"text-base font-medium",innerHTML:u.title},null,8,bt)):(a(),o("div",wt,v(u.name),1)),n("span",St," · "+v(u.doctype=="Communication"?"Email":u.doctype.replace("HD ","")),1),n("span",$t," · #"+v(A(u)),1),n("div",Ct,v(Y(u.modified)),1)]),u.content?(a(),o("div",{key:0,class:"mt-1 text-p-base text-ink-gray-6",innerHTML:u.content},null,8,Tt)):d("",!0)])]),_:2},1032,["to"]),t[7]||(t[7]=n("div",{class:"border-b mx-2"},null,-1))],64))),128))])])])])}}});export{qt as default};
//# sourceMappingURL=SearchAgent-50314bac.js.map
